
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Imagecutter_V5_9</title><meta name="generator" content="MATLAB 7.14"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2016-10-21"><meta name="DC.source" content="Imagecutter_V5_9.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, tt, code { font-size:12px; }
pre { margin:0px 0px 20px; }
pre.error { color:red; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }

  </style></head><body><div class="content"><pre class="codeinput"><span class="keyword">function</span>[csvHandler wellList] = Imagecutter_V5_9(Neuron_Channel, Oligo_Channel, Astro_Channel, foldername, csvHandler, optionHandler)

<span class="comment">%function csvHandler = Imagecutter_V5_8(Neuron_Channel, Oligo_Channel, Astro_Channel, foldername, csvHandler)</span>
<span class="comment">% This function is used to sepearte neurospheres from images of</span>
<span class="comment">% 8-chamber slide into seperate images, containing only one neurosphere.</span>
<span class="comment">% Therefore centroids of neurosphere cores were determined and distance</span>
<span class="comment">% between the boarders of the coverslip as well as distances among</span>
<span class="comment">% centroids are calculated. For both x and y coordinates the shortest</span>
<span class="comment">% distance among border and centroid centroid distances is either added or</span>
<span class="comment">% substracted from the centroid coordinate to generate a rectangular filter</span>
<span class="comment">% to cut out single spheres. In a last step those images are resized to a</span>
<span class="comment">% 96 well plate image.</span>
n = 0;
wellList = cell(0);
<span class="comment">% N gives the minimum required area for a neurosphere core</span>

N = 250000;
<span class="comment">%Neuron_Channel = 0;</span>
<span class="comment">%Oligo_Channel = 0;</span>
<span class="comment">%Astro_Channel = 0;</span>
<span class="comment">% The MinimumDistance defines the minimum distance of two sphere cores for</span>
<span class="comment">% which migration areas should not intersect</span>
MinimumDistance = 7168/2;
<span class="comment">%This is the maximum added or substracted from the center point. This</span>
<span class="comment">%should, if all spheres are at least 7168 pixels away from each other</span>
<span class="comment">%result in no overlapp of migration areas (3101 equals 2000&micro;M)</span>
maxaddedlength = 3101;
foldername = [foldername <span class="string">'/ConvertedCellomics'</span>];
foldername1 = foldername;

<span class="comment">%Well renamer:</span>

<span class="comment">% Sometimes the difference between x or y coordinates is very small. This</span>
<span class="comment">% is the result of two spheres with minimum distance smaller the defined</span>
<span class="comment">% positioned on the line (e.g. on a horizontal line or the upper two</span>
<span class="comment">% spheres of a five). Therefore a minimum ratio of x/y and y/x is defined</span>
<span class="comment">% as an additional criteria. To rule out the possibility that spheres are</span>
<span class="comment">% almost touching each other, further a mindist is defined at which the xy</span>
<span class="comment">% and yx cirtiria is applied:</span>
minxy_ratio = 0.25;
mindist = 3000;
<span class="comment">%Defines the source folder</span>
<span class="comment">%foldername = uigetdir;</span>
<span class="comment">%Define destination folder for saving processed images</span>
<span class="comment">%foldername1 = uigetdir;</span>
<span class="comment">%Iterate over all files in this folder</span>
allfiles = dir(foldername);
<span class="comment">% Iteration loop for all images in source folder</span>
<span class="keyword">for</span>(i=1:numel(allfiles))
    <span class="comment">%Check if file ends with NucleusBig.png</span>
    ind = strfind([foldername <span class="string">'/'</span> allfiles(i).name],<span class="string">'NucleusBig.png'</span>);
        <span class="keyword">if</span>(numel(ind) &gt; 0)
            n=n+1;
            NucleusM = csvHandler.CellPosMatrix(strcat(allfiles(i).name(1),allfiles(i).name(3)));
            <span class="keyword">if</span>(Neuron_Channel&gt;0);
                <span class="comment">% Looks for cooresponding neurite image by replacing NucleusBig by</span>
                <span class="comment">% NeuriteBig in the name of image i</span>
                newFileNeu = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,<span class="string">'NeuriteBig'</span>,<span class="string">'ignorecase'</span>);
                <span class="comment">% New file is defined as imgneurite</span>
                imgneurite = imread([foldername <span class="string">'/'</span> newFileNeu]);
            <span class="keyword">end</span>

            <span class="comment">%Same for OligoBig</span>
            <span class="keyword">if</span>(Oligo_Channel&gt;0);
                newFileOli = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,<span class="string">'OligoBig'</span>,<span class="string">'ignorecase'</span>);
                imgoligo = imread([foldername <span class="string">'/'</span> newFileOli]);
            <span class="keyword">end</span>

        <span class="comment">%Same for AstroBig</span>
            <span class="keyword">if</span>(Astro_Channel &gt;0)
                newFileAst = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,<span class="string">'AstroBig'</span>,<span class="string">'ignorecase'</span>);
                imgastro = imread([foldername <span class="string">'/'</span> newFileAst]);
            <span class="keyword">end</span>

        <span class="comment">% Loads NucleusBig</span>
        imgnucleus = imread([foldername <span class="string">'/'</span> allfiles(i).name]);
        <span class="comment">% Generates histogram of imgnucleus</span>
        [lehisto x] = imhist(imgnucleus);
        <span class="comment">% Calculates background of imgnucleus</span>
        level = triangle_th(lehisto,256);
        <span class="comment">% Converts imgnucleus to a binary 'imgnucleusbinary' image using</span>
        <span class="comment">% level as threshold</span>
        imgnucleusbinary = im2bw(imgnucleus,level);
        <span class="comment">% Convertes 'imgnucleusbinary' to an 8-bit image</span>
        imgnucleusbinary = uint8(imgnucleusbinary.*255);
        <span class="comment">% Excludes all areas in 'imgnucleusbinary' smaller than 250000</span>
        imgnucleusbinarysized = bwareaopen(imgnucleusbinary,N);
        <span class="comment">% Excludes objects touching the rim of the cover slip to get rid of</span>
        <span class="comment">% bright edges of the cover slip</span>
        imgnucleusbinarysized = imclearborder(imgnucleusbinarysized);

        <span class="comment">% Calculates all centroid coordinates of all areas in</span>
        <span class="comment">% 'imgnucleusbinarysized'</span>
        s = regionprops(imgnucleusbinarysized,<span class="string">'centroid'</span>);
        <span class="comment">% Determines the y-dimension of s</span>
        s_L = length(s)
        clear <span class="string">imgnucleusbinary</span>;
        clear <span class="string">imgnucleusbinarysized</span>;
        <span class="comment">% Case destinction is required, since through washing spheres can</span>
        <span class="comment">% be lost</span>
        <span class="comment">%Case 1: All spheres are lost, meaning no centroids and a y</span>
        <span class="comment">%dimension of s equals 0</span>
            <span class="keyword">if</span>(strfind(allfiles(i).name,  <span class="string">'D01'</span>))
                wellind = <span class="string">'A'</span>;
            <span class="keyword">end</span>
            <span class="keyword">if</span>(strfind(allfiles(i).name,  <span class="string">'C01'</span>))
                wellind = <span class="string">'B'</span>;
            <span class="keyword">end</span>
            <span class="keyword">if</span>(strfind(allfiles(i).name,  <span class="string">'B01'</span>))
                wellind = <span class="string">'C'</span>;
            <span class="keyword">end</span>
            <span class="keyword">if</span>(strfind(allfiles(i).name,  <span class="string">'A01'</span>))
                wellind = <span class="string">'D'</span>;
            <span class="keyword">end</span>
            <span class="keyword">if</span>(strfind(allfiles(i).name,  <span class="string">'D02'</span>))
                wellind = <span class="string">'E'</span>;
            <span class="keyword">end</span>
            <span class="keyword">if</span>(strfind(allfiles(i).name,  <span class="string">'C02'</span>))
                wellind = <span class="string">'F'</span>;
            <span class="keyword">end</span>
            <span class="keyword">if</span>(strfind(allfiles(i).name,  <span class="string">'B02'</span>))
                wellind = <span class="string">'G'</span>;
            <span class="keyword">end</span>
            <span class="keyword">if</span>(strfind(allfiles(i).name,  <span class="string">'A02'</span>))
                wellind = <span class="string">'H'</span>;
            <span class="keyword">end</span>
        <span class="keyword">if</span>(s_L &lt;=0);
            <span class="comment">%Well renamer:</span>

            <span class="comment">% Creation of five epmty images with dimensions 7168x7168</span>
            imagesphereresize1 = zeros(7168:7168);
            newFile1 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'01NucleusBig'</span>],<span class="string">'ignorecase'</span>);
            imwrite(imagesphereresize1,[foldername1 <span class="string">'/'</span> newFile1]);
            clear <span class="string">imagesphereresize1</span>;

            imagesphereresize2 = zeros(7168:7168);
            newFile2 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'02NucleusBig'</span>],<span class="string">'ignorecase'</span>);
            imwrite(imagesphereresize2,[foldername1 <span class="string">'/'</span> newFile2]);
            clear <span class="string">imagesphereresize2</span>;

            imagesphereresize3 = zeros(7168:7168);
            newFile3 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'03NucleusBig'</span>],<span class="string">'ignorecase'</span>);
            imwrite(imagesphereresize3,[foldername1 <span class="string">'/'</span> newFile3]);
            clear <span class="string">imagesphereresize3</span>;

            imagesphereresize4 = zeros(7168:7168);
            newFile4 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'04NucleusBig'</span>],<span class="string">'ignorecase'</span>);
            imwrite(imagesphereresize4,[foldername1 <span class="string">'/'</span> newFile4]);
            clear <span class="string">imagesphereresize4</span>;

            imagesphereresize5 = zeros(7168:7168);
            newFile5 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'05NucleusBig'</span>],<span class="string">'ignorecase'</span>);
            imwrite(imagesphereresize5,[foldername1 <span class="string">'/'</span> newFile5]);
            clear <span class="string">imagesphereresize5</span>;

            <span class="keyword">if</span>(Neuron_Channel &gt; 0)
                   <span class="comment">% Same for neurite channel</span>


                   imagesphereresize6 = zeros(7168:7168);
            	   newFile6 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'01NeuriteBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize6,[foldername1 <span class="string">'/'</span> newFile6]);
                   clear <span class="string">imagesphereresize6</span>;

                   imagesphereresize7 = zeros(7168:7168);
            	   newFile7 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'02NeuriteBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize7,[foldername1 <span class="string">'/'</span> newFile7]);
                   clear <span class="string">imagesphereresize7</span>;

                   imagesphereresize8 = zeros(7168:7168);
            	   newFile8 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'03NeuriteBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize8,[foldername1 <span class="string">'/'</span> newFile8]);
                   clear <span class="string">imagesphereresize8</span>;


                   imagesphereresize9 = zeros(7168:7168);
            	   newFile9 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'04NeuriteBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize9,[foldername1 <span class="string">'/'</span> newFile9]);
                   clear <span class="string">imagesphereresize9</span>;

                   imagesphereresize10 = zeros(7168:7168);
            	   newFile10 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'05NeuriteBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize10,[foldername1 <span class="string">'/'</span> newFile10]);
                   clear <span class="string">imagesphereresize10</span>;

               <span class="keyword">end</span>

               <span class="keyword">if</span>(Oligo_Channel &gt; 0)
                   <span class="comment">% Same for Oligos</span>
                   imagesphereresize11 = zeros(7168:7168);
            	   newFile11 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'01OligoBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize11,[foldername1 <span class="string">'/'</span> newFile11]);
                   clear <span class="string">imagesphereresize11</span>;

                   imagesphereresize12 = zeros(7168:7168);
            	   newFile12 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'02OligoBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize12,[foldername1 <span class="string">'/'</span> newFile12]);
                   clear <span class="string">imagesphereresize12</span>;

                   imagesphereresize13 = zeros(7168:7168);
            	   newFile13 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'03OligoBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize13,[foldername1 <span class="string">'/'</span> newFile13]);
                   clear <span class="string">imagesphereresize13</span>;

                   imagesphereresize14 = zeros(7168:7168);
            	   newFile14 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'04OligoBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize14,[foldername1 <span class="string">'/'</span> newFile14]);
                   clear <span class="string">imagesphereresize14</span>;

                   imagesphereresize15 = zeros(7168:7168);
            	   newFile15 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'05OligoBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize15,[foldername1 <span class="string">'/'</span> newFile15]);
                   clear <span class="string">imagesphereresize15</span>;
               <span class="keyword">end</span>

               <span class="keyword">if</span>(Astro_Channel &gt;0)
                   <span class="comment">% Same for Astros</span>
                   imagesphereresize16 = zeros(7168:7168);
            	   newFile16 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'01AstroBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize16,[foldername1 <span class="string">'/'</span> newFile16]);
                   clear <span class="string">imagesphereresize16</span>;

                   imagesphereresize17 = zeros(7168:7168);
            	   newFile17 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'02AstroBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize17,[foldername1 <span class="string">'/'</span> newFile17]);
                   clear <span class="string">imagesphereresize17</span>;

                   imagesphereresize18 = zeros(7168:7168);
            	   newFile18 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'03AstroBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize18,[foldername1 <span class="string">'/'</span> newFile18]);
                   clear <span class="string">imagesphereresize18</span>;

                   imagesphereresize19 = zeros(7168:7168);
            	   newFile19 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'04AstroBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize19,[foldername1 <span class="string">'/'</span> newFile19]);
                   clear <span class="string">imagesphereresize19</span>;

                   imagesphereresize20 = zeros(7168:7168);
            	   newFile20 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'05AstroBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize20,[foldername1 <span class="string">'/'</span> newFile20]);
                   clear <span class="string">imagesphereresize20</span>;
               <span class="keyword">end</span>

            <span class="keyword">else</span>
            <span class="keyword">end</span>
        <span class="comment">% Case 2: One sphere remained: s=1</span>
            <span class="keyword">if</span>(0&lt;s_L &amp;&amp; s_L&lt;2);
               <span class="comment">% Extracts the x and y coordinates from s</span>
               x_centroid(1) = s(1).Centroid(1);
               y_centroid(1) = s(1).Centroid(2);

               <span class="comment">% Calculates the distance between the centroid of the</span>
               <span class="comment">% neurosphere to all boarders of the cover slip</span>

               <span class="comment">% Distance between centroid and left x-boarder</span>
               d_x0_1 = x_centroid(1)-1;
               <span class="comment">% Distance between centroid and right x-boarder</span>
               d_x10752_1 = 10752 - x_centroid(1);
               <span class="comment">% Distance between centroid and upper y-boarder</span>
               d_y0_1 = y_centroid(1)-1;
               <span class="comment">% Distance between centroid and lower x-boarder</span>
               d_y10752_1 = 13824 - y_centroid(1);

               <span class="comment">%Generation of an vector containing all distances in x and y for  the sphere</span>
               <span class="comment">%core. 7168/2 is inserted as the maximal allowed value to</span>
               <span class="comment">%add or to substract</span>
               <span class="comment">% V_x1m contains all values left of the centroid</span>
               V_x1m = [d_x0_1;(7168/2)];
               <span class="comment">% V_x1p contains all values right of the centroid</span>
               V_x1p = [d_x10752_1;(7168/2)];
               <span class="comment">% V_y1m contains all values above the centroid</span>
               V_y1m = [d_y0_1;(7168/2)];
               <span class="comment">% V_y1p contains all values below the centroid</span>
               V_y1p = [d_y10752_1;(7168/2)];


               <span class="comment">% Determination of the smallest distance in all directions</span>
               <span class="comment">% of V</span>
               minx_1m = min(V_x1m(1:2));
               minx_1p = min(V_x1p(1:2));
               miny_1m = min(V_y1m(1:2));
               miny_1p = min(V_y1p(1:2));

               <span class="comment">% Calculates the x and y coordinates of the rectangular</span>
               <span class="comment">% around the sphere core. Always minimal distances were</span>
               <span class="comment">% substrated or added</span>
               x_1 = x_centroid(1) - minx_1m;
               x_2 = x_centroid(1) + minx_1p - 1;
               y_1 = y_centroid(1) - miny_1m;
               y_2 = y_centroid(1) + miny_1p - 1;




               <span class="comment">%The rectangular image is cutted from the imgnucleus image containing the whole cover slip</span>
               imagesphere1 = imgnucleus(y_1:y_2,x_1:x_2);
               <span class="comment">% Dimensions of imagesphere1 are determined</span>
               [r1 c1] = size(imagesphere1);
               <span class="comment">% An empty matrix is generated</span>
               imagesphereresize1 = zeros(7168:7168);
               <span class="comment">% imagesphereresize1 is converted to 8-bit</span>
               imagesphereresize1 = uint8(imagesphereresize1);
               <span class="comment">%The empty indices in the imagesphereresize1 matrix are overwritten with imagesphere 1 entries</span>
               imagesphereresize1(1:r1,1:c1)=imagesphere1;
               <span class="comment">% imagesphereresize1 is saved to final destination</span>
               newFile1 = regexprep(allfiles(i).name,allfiles(i).name(1:13),[wellind <span class="string">'01NucleusBig'</span>],<span class="string">'ignorecase'</span>);
               imwrite(imagesphereresize1,[foldername1 <span class="string">'/'</span> newFile1]);
               wellname = (newFile1(1:3));
               wellList{n} = wellname;
               csvHandler.CellPosMatrix(wellname) = NucleusM(y_1:y_2,x_1:x_2);
               imagesphereresize1_small = imresize(imagesphereresize1, optionHandler.ScalingFactor);


               clear <span class="string">imagesphereresize1</span>;
               clear <span class="string">imagesphere1</span>;

               imagesphereresize2 = zeros(7168:7168);
               newFile2 = regexprep(allfiles(i).name,allfiles(i).name(1:13),[wellind <span class="string">'02NucleusBig'</span>],<span class="string">'ignorecase'</span>);
               imwrite(imagesphereresize2,[foldername1 <span class="string">'/'</span> newFile2]);

               csvHandler.CellPosMatrix(newFile2) = sparse(zeros(7168,7168));
               clear <span class="string">imagesphereresize2</span>;

               imagesphereresize3 = zeros(7168:7168);
               newFile3 = regexprep(allfiles(i).name,allfiles(i).name(1:13),[wellind <span class="string">'03NucleusBig'</span>],<span class="string">'ignorecase'</span>);
               imwrite(imagesphereresize3,[foldername1 <span class="string">'/'</span> newFile3]);
               csvHandler.CellPosMatrix(newFile3) = sparse(zeros(7168,7168));
               clear <span class="string">imagesphereresize3</span>;

               imagesphereresize4 = zeros(7168:7168);
               newFile4 = regexprep(allfiles(i).name,allfiles(i).name(1:13),[wellind <span class="string">'04NucleusBig'</span>],<span class="string">'ignorecase'</span>);
               imwrite(imagesphereresize4,[foldername1 <span class="string">'/'</span> newFile4]);
               csvHandler.CellPosMatrix(newFile4) = sparse(zeros(7168,7168));
               clear <span class="string">imagesphereresize4</span>;

               imagesphereresize5 = zeros(7168:7168);
               newFile5 = regexprep(allfiles(i).name,allfiles(i).name(1:13),[wellind <span class="string">'05NucleusBig'</span>],<span class="string">'ignorecase'</span>);
               imwrite(imagesphereresize5,[foldername1 <span class="string">'/'</span> newFile5]);
               csvHandler.CellPosMatrix(newFile5) = sparse(zeros(7168,7168));
               clear <span class="string">imagesphereresize5</span>;

               <span class="keyword">if</span>(Neuron_Channel &gt; 0)
                   <span class="comment">% Same for neurite channel</span>


                   imagesphere6 = imgneurite(y_1:y_2,x_1:x_2);
                   [r1 c1] = size(imagesphere6);
                   imagesphereresize6 = zeros(7168:7168);
                   imagesphereresize6 = uint8(imagesphereresize6);
                   imagesphereresize6(1:r1,1:c1)=imagesphere6;
                   newFile6 = regexprep(allfiles(i).name,allfiles(i).name(1:13),[wellind <span class="string">'01NeuriteBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize6,[foldername1 <span class="string">'/'</span> newFile6]);
                   clear <span class="string">imagesphereresize6</span>;
                   clear <span class="string">imagesphere6</span>;

                   imagesphereresize7 = zeros(7168:7168);
            	   newFile7 = regexprep(allfiles(i).name,allfiles(i).name(1:13),[wellind <span class="string">'02NeuriteBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize7,[foldername1 <span class="string">'/'</span> newFile7]);
                   clear <span class="string">imagesphereresize7</span>;

                   imagesphereresize8 = zeros(7168:7168);
            	   newFile8 = regexprep(allfiles(i).name,allfiles(i).name(1:13),[wellind <span class="string">'03NeuriteBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize8,[foldername1 <span class="string">'/'</span> newFile8]);
                   clear <span class="string">imagesphereresize8</span>;


                   imagesphereresize9 = zeros(7168:7168);
            	   newFile9 = regexprep(allfiles(i).name,allfiles(i).name(1:13),[wellind <span class="string">'04NeuriteBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize9,[foldername1 <span class="string">'/'</span> newFile9]);
                   clear <span class="string">imagesphereresize9</span>;

                   imagesphereresize10 = zeros(7168:7168);
            	   newFile10 = regexprep(allfiles(i).name,allfiles(i).name(1:13),[wellind <span class="string">'05NeuriteBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize10,[foldername1 <span class="string">'/'</span> newFile10]);
                   clear <span class="string">imagesphereresize10</span>;

               <span class="keyword">end</span>



            <span class="keyword">else</span>
            <span class="keyword">end</span>
        <span class="comment">% Case 3: Two spheres remained: s=2</span>
            <span class="keyword">if</span>(s_L&gt;1 &amp;&amp; s_L&lt;3);
               <span class="comment">% Extracts the x and y coordinates from s</span>
               x_centroid(1) = s(1).Centroid(1);
               y_centroid(1) = s(1).Centroid(2);
               x_centroid(2) = s(2).Centroid(1);
               y_centroid(2) = s(2).Centroid(2);
               <span class="comment">% Calculates the distance between the centroid of the</span>
               <span class="comment">% neurosphere and all boarders of the cover slip</span>

               <span class="comment">% Distance between centroid(1) and centroid(2)</span>
               d1_2 = 0.5* ((x_centroid(1)-x_centroid(2))^2+(y_centroid(1)-y_centroid(2))^2)^0.5;
               <span class="comment">% Distance between centroid and left x-boarder</span>
               d_x0_1 = x_centroid(1)-1;
               <span class="comment">% Distance between centroid and right x-boarder</span>
               d_x10752_1 = 10752 - x_centroid(1);
               <span class="comment">% Distance between centroid and upper y-boarder</span>
               d_y0_1 = y_centroid(1)-1;
               <span class="comment">% Distance between centroid and lower y-boarder</span>
               d_y10752_1 = 13824 - y_centroid(1);
               <span class="comment">% Same for sphere core 2</span>
               d_x0_2 = x_centroid(2)-1;
               d_x10752_2 = 10752 - x_centroid(2);
               d_y0_2 = y_centroid(2)-1;
               d_y10752_2 = 13824 - y_centroid(2);
               <span class="comment">%Generation of an vector containing all distances in x and y for  the sphere</span>
               <span class="comment">%core. 7168/2 is inserted as the maximal allowed value to</span>
               <span class="comment">%add or to substract</span>
               <span class="comment">% V_x1m contains all values left of the centroid</span>
               V_x1m = [d1_2;d_x0_1;(7168/2)];
               <span class="comment">% V_x1p contains all values right of the centroid</span>
               V_x1p = [d1_2;d_x10752_1;(7168/2)];
               <span class="comment">% V_y1m contains all values above the centroid</span>
               V_y1m = [d1_2;d_y0_1;(7168/2)];
               <span class="comment">% V_y1p contains all values below the centroid</span>
               V_y1p = [d1_2;d_y10752_1;(7168/2)];
               <span class="comment">% Same for sphere core 2</span>
               V_x2m = [d1_2;d_x0_2;(7168/2)];
               V_x2p = [d1_2;d_x10752_2;(7168/2)];
               V_y2m = [d1_2;d_y0_2;(7168/2)];
               V_y2p = [d1_2;d_y10752_2;(7168/2)];


               <span class="comment">% Determination of the smallest distance in all directions</span>
               <span class="comment">% of V</span>

               minx_1m = min(V_x1m(1:3));
               minx_1p = min(V_x1p(1:3));
               miny_1m = min(V_y1m(1:3));
               miny_1p = min(V_y1p(1:3));
               minx_2m = min(V_x2m(1:3));
               minx_2p = min(V_x2p(1:3));
               miny_2m = min(V_y2m(1:3));
               miny_2p = min(V_y2p(1:3));

               <span class="comment">% Calculates the x and y coordinates of the rectangular</span>
               <span class="comment">% around the sphere core. Always minimal distances were</span>
               <span class="comment">% substrated or added</span>
               x_1 = x_centroid(1) - minx_1m;
               x_2 = x_centroid(1) + minx_1p;
               y_1 = y_centroid(1) - miny_1m;
               y_2 = y_centroid(1) + miny_1p;
               <span class="comment">%The rectangular image is cutted from the imgnucleus image containing the whole cover slip</span>
               imagesphere1 = imgnucleus(y_1:y_2,x_1:x_2);
               <span class="comment">% Dimensions of imagesphere1 are determined</span>
               [r1 c1] = size(imagesphere1);
               <span class="comment">% An empty matrix is generated</span>
               imagesphereresize1 = zeros(7168:7168);
               <span class="comment">% imagesphereresize1 is converted to 8-bit</span>
               imagesphereresize1 = uint8(imagesphereresize1);
               <span class="comment">%The empty indices in the imagesphereresize1 matrix are overwritten with imagesphere 1 entries</span>
               imagesphereresize1(1:r1,1:c1)=imagesphere1;
               <span class="comment">% imagesphereresize1 is saved to final destination</span>
               newFile1 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'01NucleusBig'</span>],<span class="string">'ignorecase'</span>);
               imwrite(imagesphereresize1,[foldername1 <span class="string">'/'</span> newFile1]);
               csvHandler.CellPosMatrix(newFile1) = NucleusM(y_1:y_2,x_1:x_2);
               clear <span class="string">imagesphereresize1</span>;
               clear <span class="string">imagesphere1</span>;


               <span class="comment">% Same for second sphere</span>


               x_3 = x_centroid(2) - minx_2m;
               x_4 = x_centroid(2) + minx_2p -1;
               y_3 = y_centroid(2) - miny_2m;
               y_4 = y_centroid(2) + miny_2p -1;
               imagesphere2 = imgnucleus(y_3:y_4,x_3:x_4);
               [r2 c2] = size(imagesphere2);
               imagesphereresize2 = zeros(7168:7168);
               imagesphereresize2 = uint8(imagesphereresize2);
               imagesphereresize2(1:r2,1:c2)=imagesphere2;
               newFile2 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'02NucleusBig'</span>],<span class="string">'ignorecase'</span>);
               imwrite(imagesphereresize2,[foldername1 <span class="string">'/'</span> newFile2]);
               csvHandler.CellPosMatrix(newFile2) = sparse(logical(zeros(7168,7168)));
               clear <span class="string">imagesphereresize2</span>;
               clear <span class="string">imagesphere2</span>;

               imagesphereresize3 = zeros(7168:7168);
               newFile3 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'03NucleusBig'</span>],<span class="string">'ignorecase'</span>);
               imwrite(imagesphereresize3,[foldername1 <span class="string">'/'</span> newFile3]);
               csvHandler.CellPosMatrix(newFile3) = sparse(logical(zeros(7168,7168)));
               clear <span class="string">imagesphereresize3</span>;

               imagesphereresize4 = zeros(7168:7168);
               newFile4 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'04NucleusBig'</span>],<span class="string">'ignorecase'</span>);
               imwrite(imagesphereresize4,[foldername1 <span class="string">'/'</span> newFile4]);
               csvHandler.CellPosMatrix(newFile4) = sparse(logical(zeros(7168,7168)));
               clear <span class="string">imagesphereresize4</span>;

               imagesphereresize5 = zeros(7168:7168);
               newFile5 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'05NucleusBig'</span>],<span class="string">'ignorecase'</span>);
               imwrite(imagesphereresize5,[foldername1 <span class="string">'/'</span> newFile5]);
               csvHandler.CellPosMatrix(newFile5) = sparse(logical(zeros(7168,7168)));
               clear <span class="string">imagesphereresize5</span>;

               <span class="keyword">if</span>(Neuron_Channel &gt; 0)
                   <span class="comment">% Same for neurite channel</span>


                   imagesphere6 = imgneurite(y_1:y_2,x_1:x_2);
                   [r1 c1] = size(imagesphere6);
                   imagesphereresize6 = zeros(7168:7168);
                   imagesphereresize6 = uint8(imagesphereresize6);
                   imagesphereresize6(1:r1,1:c1)=imagesphere6;
                   newFile6 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'01NeuriteBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize6,[foldername1 <span class="string">'/'</span> newFile6]);
                   clear <span class="string">imagesphereresize6</span>;
                   clear <span class="string">imagesphere6</span>;

                   imagesphere7 = imgneurite(y_3:y_4,x_3:x_4);
                   [r2 c2] = size(imagesphere7);
                   imagesphereresize7 = zeros(7168:7168);
                   imagesphereresize7 = uint8(imagesphereresize7);
                   imagesphereresize7(1:r2,1:c2)=imagesphere7;
                   newFile7 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'02NeuriteBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize7,[foldername1 <span class="string">'/'</span> newFile7]);
                   clear <span class="string">imagesphereresize7</span>;
                   clear <span class="string">imagesphere7</span>;

                   imagesphereresize8 = zeros(7168:7168);
            	   newFile8 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'03NeuriteBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize8,[foldername1 <span class="string">'/'</span> newFile8]);
                   clear <span class="string">imagesphereresize8</span>;


                   imagesphereresize9 = zeros(7168:7168);
            	   newFile9 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'04NeuriteBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize9,[foldername1 <span class="string">'/'</span> newFile9]);
                   clear <span class="string">imagesphereresize9</span>;

                   imagesphereresize10 = zeros(7168:7168);
            	   newFile10 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'05NeuriteBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize10,[foldername1 <span class="string">'/'</span> newFile10]);
                   clear <span class="string">imagesphereresize10</span>;

               <span class="keyword">end</span>

               <span class="keyword">if</span>(Oligo_Channel &gt; 0)
                   <span class="comment">% Same for Oligos</span>
                   imagesphere11 = imgoligo(y_1:y_2,x_1:x_2);
                   [r1 c1] = size(imagesphere11);
                   imagesphereresize11 = zeros(7168:7168);
                   imagesphereresize11 = uint8(imagesphereresize11);
                   imagesphereresize11(1:r1,1:c1)=imagesphere11;
                   newFile11 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'01OligoBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize11,[foldername1 <span class="string">'/'</span> newFile11]);
                   clear <span class="string">imagesphereresize11</span>;
                   clear <span class="string">imagesphere11</span>;

                   imagesphere12 = imgoligo(y_3:y_4,x_3:x_4);
                   [r2 c2] = size(imagesphere12);
                   imagesphereresize12 = zeros(7168:7168);
                   imagesphereresize12 = uint8(imagesphereresize12);
                   imagesphereresize12(1:r2,1:c2)=imagesphere12;
                   newFile12 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'02OligoBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize12,[foldername1 <span class="string">'/'</span> newFile12]);
                   clear <span class="string">imagesphereresize12</span>;
                   clear <span class="string">imagesphere12</span>;

                   imagesphereresize13 = zeros(7168:7168);
            	   newFile13 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'03OligoBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize13,[foldername1 <span class="string">'/'</span> newFile13]);
                   clear <span class="string">imagesphereresize13</span>;

                   imagesphereresize14 = zeros(7168:7168);
            	   newFile14 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'04OligoBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize14,[foldername1 <span class="string">'/'</span> newFile14]);
                   clear <span class="string">imagesphereresize14</span>;

                   imagesphereresize15 = zeros(7168:7168);
            	   newFile15 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'05OligoBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize15,[foldername1 <span class="string">'/'</span> newFile15]);
                   clear <span class="string">imagesphereresize15</span>;
               <span class="keyword">end</span>

               <span class="keyword">if</span>(Astro_Channel &gt;0)
                   <span class="comment">% Same for Astros</span>
                   imagesphere16 = imgastro(y_1:y_2,x_1:x_2);
                   [r1 c1] = size(imagesphere16);
                   imagesphereresize16 = zeros(7168:7168);
                   imagesphereresize16 = uint8(imagesphereresize16);
                   imagesphereresize16(1:r1,1:c1)=imagesphere16;
                   newFile16 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'01AstroBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize16,[foldername1 <span class="string">'/'</span> newFile16]);
                   clear <span class="string">imagesphereresize16</span>;
                   clear <span class="string">imagesphere16</span>;

                   imagesphere17 = imgastro(y_3:y_4,x_3:x_4);
                   [r2 c2] = size(imagesphere17);
                   imagesphereresize17 = zeros(7168:7168);
                   imagesphereresize17 = uint8(imagesphereresize17);
                   imagesphereresize17(1:r2,1:c2)=imagesphere17;
                   newFile17 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'02AstroBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize17,[foldername1 <span class="string">'/'</span> newFile17]);
                   clear <span class="string">imagesphereresize17</span>;
                   clear <span class="string">imagesphere17</span>;

                   imagesphereresize18 = zeros(7168:7168);
            	   newFile18 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'03AstroBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize18,[foldername1 <span class="string">'/'</span> newFile18]);
                   clear <span class="string">imagesphereresize18</span>;

                   imagesphereresize19 = zeros(7168:7168);
            	   newFile19 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'04AstroBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize19,[foldername1 <span class="string">'/'</span> newFile19]);
                   clear <span class="string">imagesphereresize19</span>;

                   imagesphereresize20 = zeros(7168:7168);
            	   newFile20 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'05AstroBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize20,[foldername1 <span class="string">'/'</span> newFile20]);
                   clear <span class="string">imagesphereresize20</span>;
               <span class="keyword">end</span>



            <span class="keyword">else</span>

            <span class="keyword">end</span>

        <span class="comment">% Case 4: Three spheres remained: s=3</span>

            <span class="keyword">if</span>(s_L &gt;2 &amp;&amp; s_L &lt;4);
               <span class="comment">% Extracts the x and y coordinates from s</span>
               x_centroid(1) = s(1).Centroid(1);
               y_centroid(1) = s(1).Centroid(2);
               x_centroid(2) = s(2).Centroid(1);
               y_centroid(2) = s(2).Centroid(2);
               x_centroid(3) = s(3).Centroid(1);
               y_centroid(3) = s(3).Centroid(2);
               <span class="comment">% Definition of a centroid quadrant in which the centroid of a potential center neurosphere has to be located.</span>
               <span class="comment">%All other centroids are considerd as rim coordinates</span>
               quadrant1_x1 = 4032;
               quadrant1_x2 = 6720;
               quadrant1_y1 = 5184;
               quadrant1_y2 = 8640;

               <span class="comment">%Calculates the distance between the centroids of the</span>
               <span class="comment">% three neurosphere</span>
               d1_2 = 0.5* ((x_centroid(1)-x_centroid(2))^2+(y_centroid(1)-y_centroid(2))^2)^0.5;
               d1_3 = 0.5* ((x_centroid(1)-x_centroid(3))^2+(y_centroid(1)-y_centroid(3))^2)^0.5;
               d2_3 = 0.5* ((x_centroid(3)-x_centroid(2))^2+(y_centroid(3)-y_centroid(2))^2)^0.5;

               Vd1 = [d1_2;d1_3]
               Vd2 = [d1_2;d2_3]
               Vd3 = [d1_3;d2_3]
               <span class="comment">% The shortest distance between neurosphere cores is the</span>
               <span class="comment">% distance between the rim spheres and the center sphere.</span>
               <span class="comment">% Therefore for all centroids it is checked wether the coordinates of</span>
               <span class="comment">% their centroid is located within the center quadrant.</span>
               <span class="keyword">if</span>(x_centroid(1)&gt;=quadrant1_x1 &amp;&amp; x_centroid(1)&lt;=quadrant1_x2 &amp;&amp; y_centroid(1)&gt;=quadrant1_y1 &amp;&amp; y_centroid(1)&lt;=quadrant1_y2);
               <span class="comment">% Since more than one sphere might be located in the</span>
               <span class="comment">% centroid quadrant, further the distance between center</span>
               <span class="comment">% spheres and the middle of the cover slip (dc_x) is</span>
               <span class="comment">% calculated</span>
                    dc_1 = ((x_centroid(1)-5376)^2+(y_centroid(1)-6912)^2)^0.5;

                <span class="keyword">else</span>
                <span class="comment">% If the centroid is not located in the center quadrant the distance is set to an abitrary high value of dc_1 = 1000000000</span>
                    dc_1 = 1000000000;
                <span class="keyword">end</span>
                <span class="comment">% Same for sphere 2 and 3</span>
                <span class="keyword">if</span>(x_centroid(2)&gt;=quadrant1_x1 &amp;&amp; x_centroid(2)&lt;=quadrant1_x2 &amp;&amp; y_centroid(2)&gt;=quadrant1_y1 &amp;&amp; y_centroid(2)&lt;=quadrant1_y2);
                    dc_2 = ((x_centroid(2)-5376)^2+(y_centroid(2)-6912)^2)^0.5;

                <span class="keyword">else</span>

                    dc_2 = 1000000000;
                <span class="keyword">end</span>

                <span class="keyword">if</span>(x_centroid(3)&gt;=quadrant1_x1 &amp;&amp; x_centroid(3)&lt;=quadrant1_x2 &amp;&amp; y_centroid(3)&gt;=quadrant1_y1 &amp;&amp; y_centroid(3)&lt;=quadrant1_y2);
                    dc_3 = ((x_centroid(3)-5376)^2+(y_centroid(3)-6912)^2)^0.5;

                <span class="keyword">else</span>

                    dc_3 = 1000000000;
                <span class="keyword">end</span>
               <span class="comment">% It is checked wether dc_1 is smaller than 1000000000 (no centroid sphere according to the above checked criteria) and smaller</span>
               <span class="comment">% than the distances of other centroid spheres. If dc_1 is</span>
               <span class="comment">% the smallest distance the centroid of sphere 1 is defined</span>
               <span class="comment">% as the centroid of the center sphere</span>
               <span class="keyword">if</span>(dc_1 &lt; 1000000000 &amp;&amp; dc_1 &lt; dc_2 &amp;&amp; dc_1 &lt; dc_3);
                   x_centroid_c = x_centroid(1);
                   y_centroid_c = y_centroid(1);
                   missingc1 = 0;


               <span class="keyword">else</span>
               <span class="comment">% If above criteria are not fullfilled the centroid sphere</span>
               <span class="comment">% is missing and the centroid of this sphere is treated as</span>
               <span class="comment">% a rim sphere</span>
                   missingc1 = 1;
               <span class="keyword">end</span>
               <span class="comment">%Same for sphere 2 and 3</span>
               <span class="keyword">if</span>(dc_2 &lt; 1000000000 &amp;&amp; dc_2 &lt; dc_1 &amp;&amp; dc_2 &lt; dc_3);
                   x_centroid_c = x_centroid(2);
                   y_centroid_c = y_centroid(2);
                   missingc2 = 0;
               <span class="keyword">else</span>
                   missingc2 = 1;
               <span class="keyword">end</span>

               <span class="keyword">if</span>(dc_3 &lt; 1000000000 &amp;&amp; dc_3 &lt; dc_1 &amp;&amp; dc_3 &lt; dc_2);
                   x_centroid_c = x_centroid(3);
                   y_centroid_c = y_centroid(3);
                   missingc3 = 0;

               <span class="keyword">else</span>
                   missingc3 = 1;
               <span class="keyword">end</span>
               <span class="comment">% If all 3 spheres were defined as rim spheres, an artifical</span>
               <span class="comment">% center point is defined as the center point of the cover</span>
               <span class="comment">% slip</span>
               <span class="keyword">if</span>((missingc1+missingc2+missingc3) &gt; 2);
                   x_centroid_c = 5376;
                   y_centroid_c = 6912;
               <span class="keyword">else</span>
               <span class="keyword">end</span>

               <span class="comment">% If sphere 1 is no center sphere the shortest distance</span>
               <span class="comment">% between sphere1 and the center sphere is calculated</span>
               <span class="keyword">if</span>(x_centroid(1) ~= x_centroid_c);
                   d_1_c = 0.5* (((x_centroid(1)-x_centroid_c)^2+(y_centroid(1)-y_centroid_c)^2)^0.5);
               <span class="keyword">else</span>
               <span class="keyword">end</span>
               <span class="comment">% Centroid of sphere 2 is located between sphere 1 and 3</span>
               <span class="keyword">if</span>(x_centroid(2) ~= x_centroid_c);
               <span class="comment">% If sphere 2 is no center sphere the shortest distance</span>
               <span class="comment">% between sphere2 and the center sphere is calculated</span>
                   d_2_c = 0.5* (((x_centroid(2)-x_centroid_c)^2+(y_centroid(2)-y_centroid_c)^2)^0.5);
               <span class="keyword">else</span>
               <span class="keyword">end</span>
               <span class="comment">% Centroid of sphere 3 is located right of sphere 1 and 2</span>
               <span class="keyword">if</span>(x_centroid(3) ~= x_centroid_c);
                   d_3_c = 0.5* (((x_centroid(3)-x_centroid_c)^2+(y_centroid(3)-y_centroid_c)^2)^0.5);
               <span class="keyword">else</span>
               <span class="keyword">end</span>


               <span class="comment">% Defines wether centroid of sphere 1 lays left or right of the center</span>
               <span class="comment">% sphere! If sphere 1 is not the center sphere</span>
                <span class="keyword">if</span>(x_centroid(1) ~= x_centroid_c);
                   <span class="comment">% First case: Check whether x_centroid(1) is left of the center sphere</span>
                   <span class="keyword">if</span>(x_centroid(1) &lt; x_centroid_c);
                      <span class="comment">% Check if y_centroid(1) is below y_centroid_c</span>
                      <span class="keyword">if</span>(y_centroid(1)&lt;y_centroid_c);
                       <span class="comment">% If y_centroid(1)&lt;y_centroid_c the sphere has to be located at the</span>
                       <span class="comment">% upper left corner of the cover slip</span>
                       x_centroid_l(1) = x_centroid(1);
                       y_centroid_l(1) = y_centroid(1);
                       <span class="comment">% Sphere is located in the upper left of the cover</span>
                       <span class="comment">% slip</span>
                       l_1_1 = 1;
                       <span class="comment">% Sphere is located in the lower left of the cover</span>
                       <span class="comment">% slip</span>
                       l_1_2 = 0;
                       <span class="comment">% Sphere is located in the upper right of the cover</span>
                       <span class="comment">% slip</span>
                       r_1_4 = 0;
                       <span class="comment">% Sphere is located in the lower right of the cover</span>
                       <span class="comment">% slip</span>
                       r_1_5 = 0;

                      <span class="keyword">else</span>
                       <span class="comment">% If y_centroid(1)&gt;y_centroid_c the sphere has to be located at the</span>
                       <span class="comment">% lower left corner of the cover slip</span>
                       x_centroid_l(2) = x_centroid(1);
                       y_centroid_l(2) = y_centroid(1);
                       l_1_1 = 0
                       l_1_2 = 1
                       r_1_4 = 0
                       r_1_5 = 0
                      <span class="keyword">end</span>
                   <span class="comment">% Second case: Check whether x_centroid(1) is right of the center sphere</span>
                   <span class="keyword">else</span>
                      <span class="comment">% Check if y_centroid(1) is below y_centroid_c)</span>
                      <span class="keyword">if</span>(y_centroid(1)&lt;y_centroid_c)
                       x_centroid_r(4) = x_centroid(1);
                       y_centroid_r(4) = y_centroid(1);
                       <span class="comment">% If y_centroid(1)&lt;y_centroid_c the sphere has to be located at the</span>
                       <span class="comment">% upper right corner of the cover slip</span>
                       l_1_1 = 0
                       l_1_2 = 0
                       r_1_4 = 1
                       r_1_5 = 0
                      <span class="keyword">else</span>
                      <span class="comment">% If y_centroid(1)&gt;y_centroid_c the sphere has to be located at the</span>
                       <span class="comment">% lower right corner of the cover slip</span>
                       x_centroid_r(5) = x_centroid(1);
                       y_centroid_r(5) = x_centroid(1);
                       l_1_1 = 0
                       l_1_2 = 0
                       r_1_4 = 0
                       r_1_5 = 1
                      <span class="keyword">end</span>
                   <span class="keyword">end</span>
                <span class="keyword">else</span>
                    l_1_1 = 0
                    l_1_2 = 0
                    r_1_4 = 0
                    r_1_5 = 0
                <span class="keyword">end</span>
               <span class="comment">% Same for sphere 2 and 3</span>
               <span class="keyword">if</span>(x_centroid(2) ~= x_centroid_c)
                   <span class="keyword">if</span>(x_centroid(2) &lt; x_centroid_c);
                      <span class="keyword">if</span>(y_centroid(2)&lt;y_centroid_c)
                       x_centroid_l(1) = x_centroid(2);
                       y_centroid_l(1) = y_centroid(2);
                       l_2_1 = 1
                       l_2_2 = 0
                       r_2_4 = 0
                       r_2_5 = 0

                      <span class="keyword">else</span>
                       x_centroid_l(2) = x_centroid(2);
                       y_centroid_l(2) = y_centroid(2);
                       l_2_1 = 0
                       l_2_2 = 1
                       r_2_4 = 0
                       r_2_5 = 0
                      <span class="keyword">end</span>
                   <span class="keyword">else</span>
                      <span class="keyword">if</span>(y_centroid(2)&lt;y_centroid_c)
                       x_centroid_r(4) = x_centroid(2);
                       y_centroid_r(4) = y_centroid(2);
                       l_2_1 = 0
                       l_2_2 = 0
                       r_2_4 = 1
                       r_2_5 = 0
                      <span class="keyword">else</span>
                       x_centroid_r(5) = x_centroid(2);
                       y_centroid_r(5) = x_centroid(2);
                       l_2_1 = 0
                       l_2_2 = 0
                       r_2_4 = 0
                       r_2_5 = 1
                      <span class="keyword">end</span>
                   <span class="keyword">end</span>
                <span class="keyword">else</span>
                    l_2_1 = 0
                    l_2_2 = 0
                    r_2_4 = 0
                    r_2_5 = 0
                <span class="keyword">end</span>

               <span class="keyword">if</span>(x_centroid(3) ~= x_centroid_c)
                   <span class="keyword">if</span>(x_centroid(3) &lt; x_centroid_c);
                      <span class="keyword">if</span>(y_centroid(3)&lt;y_centroid_c)
                       x_centroid_l(1) = x_centroid(3);
                       y_centroid_l(1) = y_centroid(3);
                       l_3_1 = 1
                       l_3_2 = 0
                       r_3_4 = 0
                       r_3_5 = 0

                      <span class="keyword">else</span>
                       x_centroid_l(2) = x_centroid(3);
                       y_centroid_l(2) = y_centroid(3);
                       l_3_1 = 0
                       l_3_2 = 1
                       r_3_4 = 0
                       r_3_5 = 0
                      <span class="keyword">end</span>
                   <span class="keyword">else</span>
                      <span class="keyword">if</span>(y_centroid(3)&lt;y_centroid_c)
                       x_centroid_r(4) = x_centroid(3);
                       y_centroid_r(4) = y_centroid(3);
                       l_3_1 = 0
                       l_3_2 = 0
                       r_3_4 = 1
                       r_3_5 = 0
                      <span class="keyword">else</span>
                       x_centroid_r(5) = x_centroid(3);
                       y_centroid_r(5) = x_centroid(3);
                       l_3_1 = 0
                       l_3_2 = 0
                       r_3_4 = 0
                       r_3_5 = 1
                      <span class="keyword">end</span>
                   <span class="keyword">end</span>
               <span class="keyword">else</span>
                    l_3_1 = 0
                    l_3_2 = 0
                    r_3_4 = 0
                    r_3_5 = 0
               <span class="keyword">end</span>


               <span class="comment">% Check for double entry positions:</span>

               <span class="comment">%Check if sphere 1,2 and 3 have the same position</span>
               <span class="keyword">if</span>(l_2_1 == l_1_1 &amp;&amp; l_2_2 == l_1_2 &amp;&amp; r_2_4 == r_1_4 &amp;&amp; r_2_5 == r_1_5 &amp;&amp; l_3_1 == l_1_1 &amp;&amp; l_3_2 == l_1_2 &amp;&amp; r_3_4 == r_1_4 &amp;&amp; r_3_5 == r_1_5)

                   l_1_1_t = l_1_1
                   l_1_2_t = l_1_2
                   r_1_4_t = r_1_4
                   r_1_5_t = r_1_5
                   l_2_1_t = l_2_1
                   l_2_2_t = l_2_2
                   r_2_4_t = r_2_4
                   r_2_5_t = r_2_5
                   l_3_1_t = l_3_1
                   l_3_2_t = l_3_2
                   r_3_4_t = r_3_4
                   r_3_5_t = r_3_5
                   l_1_1 = 0
                   l_1_2 = 0
                   r_1_4 = 0
                   r_1_5 = 0
                   l_2_1 = 0
                   l_2_2 = 0
                   r_2_4 = 0
                   r_2_5 = 0
                   l_3_1 = 0
                   l_3_2 = 0
                   r_3_4 = 0
                   r_3_5 = 0


               <span class="keyword">else</span>
                   l_1_1_t = 0
                   l_1_2_t = 0
                   r_1_4_t = 0
                   r_1_5_t = 0
                   l_2_1_t = 0
                   l_2_2_t = 0
                   r_2_4_t = 0
                   r_2_5_t = 0
                   l_3_1_t = 0
                   l_3_2_t = 0
                   r_3_4_t = 0
                   r_3_5_t = 0

               <span class="keyword">end</span>

               <span class="comment">% Check if sphere 1 and 2 share the same position</span>
               <span class="keyword">if</span>(l_2_1 == l_1_1 &amp;&amp; l_2_2 == l_1_2 &amp;&amp; r_2_4 == r_1_4 &amp;&amp; r_2_5 == r_1_5)

                   l_1_1_d12 = l_1_1
                   l_1_2_d12 = l_1_2
                   r_1_4_d12 = r_1_4
                   r_1_5_d12 = r_1_5
                   l_2_1_d12 = l_2_1
                   l_2_2_d12 = l_2_2
                   r_2_4_d12 = r_2_4
                   r_2_5_d12 = r_2_5
                   l_3_1_d12 = 0
                   l_3_2_d12 = 0
                   r_3_4_d12 = 0
                   r_3_5_d12 = 0
                   l_1_1 = 0
                   l_1_2 = 0
                   r_1_4 = 0
                   r_1_5 = 0
                   l_2_1 = 0
                   l_2_2 = 0
                   r_2_4 = 0
                   r_2_5 = 0

               <span class="keyword">else</span>
                   l_1_1_d12 = 0
                   l_1_2_d12 = 0
                   r_1_4_d12 = 0
                   r_1_5_d12 = 0
                   l_2_1_d12 = 0
                   l_2_2_d12 = 0
                   r_2_4_d12 = 0
                   r_2_5_d12 = 0


               <span class="keyword">end</span>

               <span class="comment">% Check if sphere 1 and 3 share the same position</span>
               <span class="keyword">if</span>(l_3_1 == l_1_1 &amp;&amp; l_3_2 == l_1_2 &amp;&amp; r_3_4 == r_1_4 &amp;&amp; r_3_5 == r_1_5)

                   l_1_1_d13 = l_1_1
                   l_1_2_d13 = l_1_2
                   r_1_4_d13 = r_1_4
                   r_1_5_d13 = r_1_5
                   l_2_1_d13 = 0
                   l_2_2_d13 = 0
                   r_2_4_d13 = 0
                   r_2_5_d13 = 0
                   l_3_1_d13 = l_3_1
                   l_3_2_d13 = l_3_2
                   r_3_4_d13 = r_3_4
                   r_3_5_d13 = r_3_5
                   l_1_1 = 0
                   l_1_2 = 0
                   r_1_4 = 0
                   r_1_5 = 0
                   l_3_1 = 0
                   l_3_2 = 0
                   r_3_4 = 0
                   r_3_5 = 0

               <span class="keyword">else</span>
                   l_1_1_d13 = 0
                   l_1_2_d13 = 0
                   r_1_4_d13 = 0
                   r_1_5_d13 = 0
                   l_3_1_d13 = 0
                   l_3_2_d13 = 0
                   r_3_4_d13 = 0
                   r_3_5_d13 = 0


                   <span class="keyword">end</span>





               <span class="keyword">if</span>(l_2_1 == l_3_1 &amp;&amp; l_2_2 == l_3_2 &amp;&amp; r_2_4 == r_3_4 &amp;&amp; r_2_5 == r_3_5)
                   B = 1
                   l_2_1_d23 = l_2_1
                   l_2_2_d23 = l_2_2
                   r_2_4_d23 = r_2_4
                   r_2_5_d23 = r_2_5
                   l_3_1_d23 = l_3_1
                   l_3_2_d23 = l_3_2
                   r_3_4_d23 = r_3_4
                   r_3_5_d23 = r_3_5
                   l_2_1 = 0
                   l_2_2 = 0
                   r_2_4 = 0
                   r_2_5 = 0
                   l_3_1 = 0
                   l_3_2 = 0
                   r_3_4 = 0
                   r_3_5 = 0

               <span class="keyword">else</span>
                   l_2_1_d23 = 0
                   l_2_2_d23 = 0
                   r_2_4_d23 = 0
                   r_2_5_d23 = 0
                   l_3_1_d23 = 0
                   l_3_2_d23 = 0
                   r_3_4_d23 = 0
                   r_3_5_d23 = 0

               <span class="keyword">end</span>






               <span class="comment">% Sphere 1 with smallest value of x_centroid</span>



               <span class="comment">% Go through potential positions</span>
               <span class="comment">% Case 1: Sphere is no center sphere and is located at the</span>
               <span class="comment">% upper left</span>
               <span class="keyword">if</span>(l_1_1 &gt;0 &amp;&amp; l_1_1 &lt; 2);
                       <span class="comment">% Coordinates to cut out sphere 1</span>
                       x_1 = 1;
                       x_2 = x_centroid(1) + d_1_c;
                       y_1 = 1;
                       y_2 = y_centroid(1) + d_1_c;
               <span class="keyword">else</span>
               <span class="keyword">end</span>
               <span class="comment">% Case 2: Sphere is no center sphere and is located at the</span>
               <span class="comment">% lower left</span>
               <span class="keyword">if</span>(l_1_2 &gt;0 &amp;&amp; l_1_2 &lt; 2);
                       <span class="comment">% Coordinates to cut out sphere 1</span>
                       x_1 = 1;
                       x_2 = x_centroid(1) + d_1_c;
                       y_1 = y_centroid(1) - d_1_c;
                       y_2 = 13824;
               <span class="keyword">else</span>
               <span class="keyword">end</span>
               <span class="comment">% Case 3: Sphere is no center sphere and is located at the</span>
               <span class="comment">% upper right</span>
               <span class="keyword">if</span>(r_1_4 &gt;0 &amp;&amp; r_1_4 &lt; 2);
                       <span class="comment">% Coordinates to cut out sphere 1</span>
                       x_1 = x_centroid(1) - d_1_c;
                       x_2 = 10752;
                       y_1 = 1;
                       y_2 = y_centroid(1) + d_1_c;
               <span class="keyword">else</span>
               <span class="keyword">end</span>
               <span class="comment">% Case 4: Sphere is no center sphere and is located at the</span>
               <span class="comment">% lower right</span>
               <span class="keyword">if</span>(r_1_5 &gt;0 &amp;&amp; r_1_5 &lt; 2);
                       <span class="comment">% Coordinates to cut out sphere 1</span>
                       x_1 = x_centroid(1) - d_1_c;
                       x_2 = 10752;
                       y_1 = y_centroid(1) - d_1_c;
                       y_2 = 13824;
               <span class="keyword">else</span>
               <span class="keyword">end</span>
               <span class="comment">% Going through all iterations for the case sphere 1 =</span>
               <span class="comment">% center sphere</span>
               <span class="keyword">if</span>(x_centroid(1) ~= x_centroid_c);
               <span class="keyword">else</span>
                   <span class="comment">% Case 1: sphere 2 and 3 are located left of sphere 1</span>
                   <span class="keyword">if</span>(x_centroid(2) &lt; x_centroid(1) &amp;&amp; x_centroid(3) &lt; x_centroid(1));
                       <span class="comment">% Find shortest distance to sphere 1 to sphere 2 and</span>
                       <span class="comment">% 3 to a maximum of 7168/2. Since both sphere 2 and sphere 3</span>
                       <span class="comment">% are located left of sphere 1, distance is just</span>
                       <span class="comment">% limited to the left and not to the right</span>
                       V_1m = [d1_2 ; d1_3 ; (7168/2)];
                       min1m = min(V_1m(1:3));
                       <span class="comment">% Maximal added distance to the right to obtain</span>
                       <span class="comment">% maximal images of 7168x7168 pixel</span>
                       min1p = (7168-min1m);
                   <span class="keyword">else</span>
                   <span class="keyword">end</span>
                   <span class="comment">% Case 2: sphere 2 and 3 are located right of sphere 1</span>
                   <span class="keyword">if</span>(x_centroid(2) &gt; x_centroid(1) &amp;&amp; x_centroid(3) &gt; x_centroid(1));
                       <span class="comment">% Find shortest distance to sphere 1 to sphere 2 and</span>
                       <span class="comment">% 3 to a maximum of 7168/2. Since both sphere 2 and sphere 3</span>
                       <span class="comment">% are located right of sphere 1, distance is just</span>
                       <span class="comment">% limited to the right and not to the left</span>
                       V_1p = [d1_2 ; d1_3 ; (7168/2)];
                       min1p = min(V_1p(1:3));
                       min1m = (7168-min1p);
                   <span class="keyword">else</span>
                   <span class="keyword">end</span>
                   <span class="comment">% Case 3: sphere 2 is located right of sphere 1 and 3 is located left of sphere 1</span>
                   <span class="keyword">if</span>(x_centroid(2) &gt; x_centroid(1) &amp;&amp; x_centroid(3) &lt; x_centroid(1));
                       <span class="comment">% Find minimal distance to the left and to the right. To the left</span>
                       <span class="comment">% only the distance between sphere 1 and 2 and to</span>
                       <span class="comment">% the right only the distance of sphere 1 and 3</span>
                       <span class="comment">% matter.</span>
                       V_1m = [d1_3 ; (7168/2)];
                       V_1p = [d1_2 ; (7168/2)];
                       min1p = min(V_1p(1:2));
                       min1m = min(V_1m(1:2));
                   <span class="keyword">else</span>
                   <span class="keyword">end</span>
                   <span class="comment">% Case 3: sphere 2 is located left of sphere 1 and 3 is located right of sphere 1</span>
                   <span class="keyword">if</span>(x_centroid(2) &lt; x_centroid(1) &amp;&amp; x_centroid(3) &gt; x_centroid(1));
                       <span class="comment">% Find minimal distance to the left and to the right. To the left</span>
                       <span class="comment">% only the distance between sphere 1 and 3 and to</span>
                       <span class="comment">% the right only the distance of sphere 1 and 2</span>
                       <span class="comment">% matter.</span>
                       V_1m = [d1_2 ; (7168/2)];
                       V_1p = [d1_3 ; (7168/2)];
                       min1p = min(V_1p(1:2));
                       min1m = min(V_1m(1:2));
                   <span class="keyword">else</span>
                   <span class="keyword">end</span>
              <span class="comment">% Coordinates to cut out sphere 1</span>
                   x_1 = x_centroid(1) - min1m
                   x_2 = x_centroid(1) + min1p
                   y_1 = y_centroid(1) - min1m
                   y_2 = y_centroid(1) + min1p
               <span class="keyword">end</span>

               <span class="comment">% Cases for having two or three spheres at one location</span>

               <span class="comment">% Sphere 1 and 2 are in the same location</span>

               <span class="keyword">if</span>(l_1_1_d12 == 1)
                  <span class="keyword">if</span>(y_centroid(1) &lt; y_centroid(2))
                  x_1 = 1;
                  x_2 = x_centroid(1) + d1_2;
                  y_1 = 1;
                  y_2 = y_centroid(1) + d1_2;
                  <span class="keyword">else</span>
                  x_1 = 1;
                  x_2 = x_centroid(1) + d1_2;
                  y_1 = y_centroid(1) - d1_2;
                  y_2 = y_centroid(1) + (7168 - d1_2);
                  <span class="keyword">end</span>
               <span class="keyword">end</span>

               <span class="keyword">if</span>(l_1_2_d12 == 1)
                  <span class="keyword">if</span>(y_centroid(1) &lt; y_centroid(2))
                  x_1 = 1;
                  x_2 = x_centroid(1) + d1_2;
                  y_1 = y_centroid(1) - (7168 - d1_2);
                  y_2 = y_centroid(1) + d1_2;
                  <span class="keyword">else</span>
                  x_1 = 1;
                  x_2 = x_centroid(1) + d1_2;
                  y_1 = y_centroid(1) - d1_2;
                  y_2 = 13824;
                  <span class="keyword">end</span>
               <span class="keyword">end</span>

               <span class="keyword">if</span>(r_1_4_d12 == 1)
                  <span class="keyword">if</span>(y_centroid(1) &lt; y_centroid(2))
                  x_1 = x_centroid(1) - (7168 - d1_2);
                  x_2 = x_centroid(1) + d1_2;
                  y_1 = 1;
                  y_2 = y_centroid(1) + d1_2;
                  <span class="keyword">else</span>
                  x_1 = x_centroid(1) - (7168 - d1_2);
                  x_2 = x_centroid(1) + d1_2;
                  y_1 = y_centroid(1) - d1_2
                  y_2 = y_centroid(1) + (7168 - d1_2);
                  <span class="keyword">end</span>
               <span class="keyword">end</span>

               <span class="keyword">if</span>(r_1_5_d12 == 1)
                  <span class="keyword">if</span>(y_centroid(1) &lt; y_centroid(2))
                  x_1 = x_centroid(1) - (7168 - d1_2);
                  x_2 = x_centroid(1) + d1_2;
                  y_1 = y_centroid(1) + d1_2;
                  y_2 = 13824;
                  <span class="keyword">else</span>
                  x_1 = x_centroid(1) - (7168 - d1_2);
                  x_2 = x_centroid(1) + d1_2;
                  y_1 = y_centroid(1) + (7168 - d1_2)
                  y_2 = y_centroid(1) + d1_2;
                  <span class="keyword">end</span>
               <span class="keyword">end</span>

               <span class="comment">% Sphere 1 and 3 are at the same quadrant</span>

               <span class="keyword">if</span>(l_1_1_d13 == 1)
                  <span class="keyword">if</span>(y_centroid(1) &lt; y_centroid(3))
                  x_1 = 1;
                  x_2 = x_centroid(1) + d1_3;
                  y_1 = 1;
                  y_2 = y_centroid(1) + d1_3;
                  <span class="keyword">else</span>
                  x_1 = 1;
                  x_2 = x_centroid(1) + d1_3;
                  y_1 = y_centroid(1) - d1_3;
                  y_2 = y_centroid(1) + (7168 - d1_3);
                  <span class="keyword">end</span>
               <span class="keyword">end</span>

               <span class="keyword">if</span>(l_1_2_d13 == 1)
                  <span class="keyword">if</span>(y_centroid(1) &lt; y_centroid(3))
                  x_1 = 1;
                  x_2 = x_centroid(1) + d1_3;
                  y_1 = y_centroid(1) - (7168 - d1_3);
                  y_2 = y_centroid(1) + d1_3;
                  <span class="keyword">else</span>
                  x_1 = 1;
                  x_2 = x_centroid(1) + d1_3;
                  y_1 = y_centroid(1) - d1_3;
                  y_2 = 13824;
                  <span class="keyword">end</span>
               <span class="keyword">end</span>

               <span class="keyword">if</span>(r_1_4_d13 == 1)
                  <span class="keyword">if</span>(y_centroid(1) &lt; y_centroid(3))
                  x_1 = x_centroid(1) - (7168 - d1_3);
                  x_2 = x_centroid(1) + d1_3;
                  y_1 = 1;
                  y_2 = y_centroid(1) + d1_3;
                  <span class="keyword">else</span>
                  x_1 = x_centroid(1) - (7168 - d1_3);
                  x_2 = x_centroid(1) + d1_3;
                  y_1 = y_centroid(1) - d1_3
                  y_2 = y_centroid(1) + (7168 - d1_3);
                  <span class="keyword">end</span>
               <span class="keyword">end</span>

               <span class="keyword">if</span>(r_1_5_d13 == 1)
                  <span class="keyword">if</span>(y_centroid(1) &lt; y_centroid(3))
                  x_1 = x_centroid(1) - (7168 - d1_3);
                  x_2 = x_centroid(1) + d1_3;
                  y_1 = y_centroid(1) + d1_3;
                  y_2 = 13824;
                  <span class="keyword">else</span>
                  x_1 = x_centroid(1) - (7168 - d1_3);
                  x_2 = x_centroid(1) + d1_3;
                  y_1 = y_centroid(1) + (7168 - d1_3)
                  y_2 = y_centroid(1) + d1_3;
                  <span class="keyword">end</span>
               <span class="keyword">end</span>


               <span class="comment">% Sphere 1 and 2 and 3 are in the same location</span>

               <span class="keyword">if</span>(l_1_1_t == 1)
                  <span class="keyword">if</span>(y_centroid(1) &lt; y_centroid(2) &amp;&amp; y_centroid(1) &lt; y_centroid(3))
                  minxy = min(Vd1(1:2))
                  x_1 = 1;
                  x_2 = x_centroid(1) + minxy;
                  y_1 = 1;
                  y_2 = y_centroid(1) + minxy;
                  <span class="keyword">end</span>
                  <span class="keyword">if</span>(y_centroid(1) &gt; y_centroid(2) &amp;&amp; y_centroid(1) &gt; y_centroid(3))
                  minxy = min(Vd1(1:2))
                  x_1 = 1;
                  x_2 = x_centroid(1) + minxy;
                  y_1 = y_centroid(1) - minxy;
                  y_2 = y_centroid(1) + (7168-minxy);
                  <span class="keyword">end</span>
                  <span class="keyword">if</span>(y_centroid(1) &lt; y_centroid(2) &amp;&amp; y_centroid(1) &gt; y_centroid(3))
                  minxy = min(Vd1(1:2))
                  x_1 = 1;
                  x_2 = x_centroid(1) + minxy;
                  y_1 = y_centroid(1) - d1_3;
                  y_2 = y_centroid(1) + d1_2;
                  <span class="keyword">end</span>
                  <span class="keyword">if</span>(y_centroid(1) &gt; y_centroid(2) &amp;&amp; y_centroid(1) &lt; y_centroid(3))
                  minxy = min(Vd1(1:2))
                  x_1 = 1;
                  x_2 = x_centroid(1) + minxy;
                  y_1 = y_centroid(1) - d1_2;
                  y_2 = y_centroid(1) + d1_3;
                  <span class="keyword">end</span>
               <span class="keyword">end</span>

               <span class="keyword">if</span>(l_1_2_t == 1)
                  <span class="keyword">if</span>(y_centroid(1) &lt; y_centroid(2) &amp;&amp; y_centroid(1) &lt; y_centroid(3))
                  minxy = min(Vd1(1:2))
                  x_1 = 1;
                  x_2 = x_centroid(1) + minxy;
                  y_1 = y_centroid(1) - (7168-minxy);
                  y_2 = y_centroid(1) + minxy;
                  <span class="keyword">end</span>
                  <span class="keyword">if</span>(y_centroid(1) &gt; y_centroid(2) &amp;&amp; y_centroid(1) &gt; y_centroid(3))
                  minxy = min(Vd1(1:2))
                  x_1 = 1;
                  x_2 = x_centroid(1) + minxy;
                  y_1 = y_centroid(1) - minxy;
                  y_2 = 13824;
                  <span class="keyword">end</span>
                  <span class="keyword">if</span>(y_centroid(1) &lt; y_centroid(2) &amp;&amp; y_centroid(1) &gt; y_centroid(3))
                  minxy = min(Vd1(1:2))
                  x_1 = 1;
                  x_2 = x_centroid(1) + minxy;
                  y_1 = y_centroid(1) - d1_3;
                  y_2 = y_centroid(1) + d1_2;
                  <span class="keyword">end</span>
                  <span class="keyword">if</span>(y_centroid(1) &gt; y_centroid(2) &amp;&amp; y_centroid(1) &lt; y_centroid(3))
                  minxy = min(Vd1(1:2))
                  x_1 = 1;
                  x_2 = x_centroid(1) + minxy;
                  y_1 = y_centroid(1) - d1_2;
                  y_2 = y_centroid(1) + d1_3;
                  <span class="keyword">end</span>
               <span class="keyword">end</span>

                <span class="keyword">if</span>(r_1_4_t == 1)
                  <span class="keyword">if</span>(y_centroid(1) &lt; y_centroid(2) &amp;&amp; y_centroid(1) &lt; y_centroid(3))
                  minxy = min(Vd1(1:2))
                  x_1 = x_centroid(1) - (7168 - minxy);
                  x_2 = x_centroid(1) + minxy;
                  y_1 = 1;
                  y_2 = y_centroid(1) + minxy;
                  <span class="keyword">end</span>
                  <span class="keyword">if</span>(y_centroid(1) &gt; y_centroid(2) &amp;&amp; y_centroid(1) &gt; y_centroid(3))
                  minxy = min(Vd1(1:2))
                  x_1 = x_centroid(1) - (7168 - minxy);
                  x_2 = x_centroid(1) + minxy;
                  y_1 = y_centroid(1) - minxy;
                  y_2 = y_centroid(1) + (7168 - minxy);
                  <span class="keyword">end</span>
                  <span class="keyword">if</span>(y_centroid(1) &lt; y_centroid(2) &amp;&amp; y_centroid(1) &gt; y_centroid(3))
                  minxy = min(Vd1(1:2))
                  x_1 = x_centroid(1) - (7168 - minxy);
                  x_2 = x_centroid(1) + minxy;
                  y_1 = y_centroid(1) - d1_3;
                  y_2 = y_centroid(1) + d1_2;
                  <span class="keyword">end</span>
                  <span class="keyword">if</span>(y_centroid(1) &gt; y_centroid(2) &amp;&amp; y_centroid(1) &lt; y_centroid(3))
                  minxy = min(Vd1(1:2))
                  x_1 = x_centroid(1) - (7168 - minxy);
                  x_2 = x_centroid(1) + minxy;
                  y_1 = y_centroid(1) - d1_2;
                  y_2 = y_centroid(1) + d1_3;
                  <span class="keyword">end</span>
                <span class="keyword">end</span>

                <span class="keyword">if</span>(r_1_5_t == 1)
                  <span class="keyword">if</span>(y_centroid(1) &lt; y_centroid(2) &amp;&amp; y_centroid(1) &lt; y_centroid(3))
                  minxy = min(Vd1(1:2))
                  x_1 = x_centroid(1) - (7168 - minxy);
                  x_2 = x_centroid(1) + minxy;
                  y_1 = y_centroid(1) - (7168-minxy);
                  y_2 = y_centroid(1) + minxy;
                  <span class="keyword">end</span>
                  <span class="keyword">if</span>(y_centroid(1) &gt; y_centroid(2) &amp;&amp; y_centroid(1) &gt; y_centroid(3))
                  minxy = min(Vd1(1:2))
                  x_1 = x_centroid(1) - (7168 - minxy);
                  x_2 = x_centroid(1) + minxy;
                  y_1 = y_centroid(1) - minxy;
                  y_2 = 13824;
                  <span class="keyword">end</span>
                  <span class="keyword">if</span>(y_centroid(1) &lt; y_centroid(2) &amp;&amp; y_centroid(1) &gt; y_centroid(3))
                  minxy = min(Vd1(1:2))
                  x_1 = x_centroid(1) - (7168 - minxy);
                  x_2 = x_centroid(1) + minxy;
                  y_1 = y_centroid(1) - d1_3;
                  y_2 = y_centroid(1) + d1_2;
                  <span class="keyword">end</span>
                  <span class="keyword">if</span>(y_centroid(1) &gt; y_centroid(2) &amp;&amp; y_centroid(1) &lt; y_centroid(3))
                  minxy = min(Vd1(1:2))
                  x_1 = x_centroid(1) - (7168 - minxy);
                  x_2 = x_centroid(1) + minxy;
                  y_1 = y_centroid(1) - d1_2;
                  y_2 = y_centroid(1) + d1_3;
                  <span class="keyword">end</span>
                <span class="keyword">end</span>

                <span class="keyword">if</span>(x_1 &lt; 0)
                    x_1 =0;
                <span class="keyword">end</span>
                <span class="keyword">if</span>(x_2 &gt; 10752)
                    x_2 =10752;
                <span class="keyword">end</span>
                <span class="keyword">if</span>(y_1 &lt; 0)
                    y_1 =0;
                <span class="keyword">end</span>
                <span class="keyword">if</span>(y_2 &gt; 13824)
                    y_2 =13824;
                <span class="keyword">end</span>

                <span class="comment">%The rectangular image is cutted from the imgnucleus image containing the whole cover slip</span>
               imagesphere1 = imgnucleus(y_1:y_2,x_1:x_2);
               <span class="comment">% Dimensions of imagesphere1 are determined</span>
               [r1 c1] = size(imagesphere1);
               <span class="comment">% An empty matrix is generated</span>
               imagesphereresize1 = zeros(7168:7168);
               <span class="comment">% imagesphereresize1 is converted to 8-bit</span>
               imagesphereresize1 = uint8(imagesphereresize1);
               <span class="comment">%The empty indices in the imagesphereresize1 matrix are overwritten with imagesphere 1 entries</span>
               imagesphereresize1(1:r1,1:c1)=imagesphere1;
               <span class="comment">% imagesphereresize1 is saved to final destination</span>
               newFile1 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'01NucleusBig'</span>],<span class="string">'ignorecase'</span>);
               imwrite(imagesphereresize1,[foldername1 <span class="string">'/'</span> newFile1]);
               csvHandler.CellPosMatrix(newFile1) = sparse(logical(zeros(7168,7168)));
               clear <span class="string">imagesphereresize1</span>;
               clear <span class="string">imagesphere1</span>;

               <span class="comment">% Sphere 2 with second smallest value of x_centroid</span>




               <span class="keyword">if</span>(l_2_1 &gt;0 &amp;&amp; l_2_1 &lt; 2);
                       x_3 = 1;
                       x_4 = x_centroid(2) + d_2_c;
                       y_3 = 1;
                       y_4 = y_centroid(2) + d_2_c;
               <span class="keyword">else</span>
               <span class="keyword">end</span>

               <span class="keyword">if</span>(l_2_2 &gt;0 &amp;&amp; l_2_2 &lt; 2);
                       x_3 = 1;
                       x_4 = x_centroid(2) + d_2_c;
                       y_3 = y_centroid(2) - d_2_c;
                       y_4 = 13824;
               <span class="keyword">else</span>
               <span class="keyword">end</span>

               <span class="keyword">if</span>(r_2_4 &gt;0 &amp;&amp; r_2_4 &lt; 2);
                       x_3 = x_centroid(2) - d_2_c;
                       x_4 = 10752;
                       y_3 = 1;
                       y_4 = y_centroid(2) + d_2_c;
               <span class="keyword">else</span>
               <span class="keyword">end</span>

               <span class="keyword">if</span>(r_2_5 &gt;0 &amp;&amp; r_2_5 &lt; 2);
                       x_3 = x_centroid(2) - d_2_c;
                       x_4 = 10752;
                       y_3 = y_centroid(2) - d_2_c;
                       y_4 = 13824;
               <span class="keyword">else</span>
               <span class="keyword">end</span>

               <span class="keyword">if</span>(x_centroid(2) ~= x_centroid_c);
               <span class="keyword">else</span>
                   <span class="keyword">if</span>(x_centroid(1) &lt; x_centroid(2) &amp;&amp; x_centroid(3) &lt; x_centroid(2));
                       V_1m = [d1_2 ; d2_3 ; (7168/2)];
                       min1m = min(V_1m(1:3));
                       min1p = (7168-min1m);
                   <span class="keyword">else</span>
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(x_centroid(1) &gt; x_centroid(2) &amp;&amp; x_centroid(3) &gt; x_centroid(2));
                       V_1p = [d1_2 ; d2_3 ; (7168/2)];
                       min1p = min(V_1p(1:3));
                       min1m = (7168-min1p);
                   <span class="keyword">else</span>
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(x_centroid(1) &gt; x_centroid(2) &amp;&amp; x_centroid(3) &lt; x_centroid(2));
                       V_1m = [d2_3 ; (7168/2)];
                       V_1p = [d1_2 ; (7168/2)];
                       min1p = min(V_1p(1:2));
                       min1m = min(V_1m(1:2));
                   <span class="keyword">else</span>

                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(x_centroid(1) &lt; x_centroid(2) &amp;&amp; x_centroid(3) &gt; x_centroid(2));
                       V_1m = [d1_2 ; (7168/2)];
                       V_1p = [d2_3 ; (7168/2)];
                       min1p = min(V_1p(1:2));
                       min1m = min(V_1m(1:2));

                   <span class="keyword">else</span>

                   <span class="keyword">end</span>

                   x_3 = x_centroid(2) - min1m
                   x_4 = x_centroid(2) + min1p
                   y_3 = y_centroid(2) - min1m
                   y_4 = y_centroid(2) + min1p
               <span class="keyword">end</span>

               <span class="comment">% Cases for having two or three spheres at one location</span>

               <span class="comment">% Sphere 1 and 2 are in the same location</span>

               <span class="keyword">if</span>(l_2_1_d12 == 1)
                  <span class="keyword">if</span>(y_centroid(2) &lt; y_centroid(1))
                  x_3 = x_centroid(2) - d1_2;
                  x_4 = x_centroid(2) + (7168 - d1_2);
                  y_3 = 1;
                  y_4 = y_centroid(2) + d1_2;
                  <span class="keyword">else</span>
                  x_3 = x_centroid(2) - d1_2;
                  x_4 = x_centroid(2) + (7168 - d1_2);
                  y_3 = y_centroid(2) - d1_2;
                  y_4 = y_centroid(2) + (7168 - d1_2);
                  <span class="keyword">end</span>
               <span class="keyword">end</span>

               <span class="keyword">if</span>(l_2_2_d12 == 1)
                  <span class="keyword">if</span>(y_centroid(2) &lt; y_centroid(1))
                  x_3 = x_centroid(2) - d1_2;
                  x_4 = x_centroid(2) + (7168 - d1_2);
                  y_3 = y_centroid(2) - (7168 - d1_2);
                  y_4 = y_centroid(2) + d1_2;
                  <span class="keyword">else</span>
                  x_3 = x_centroid(2) - d1_2;
                  x_4 = x_centroid(2) + (7168 - d1_2);
                  y_3 = y_centroid(2) - d1_2;
                  y_4 = 13824;
                  <span class="keyword">end</span>
               <span class="keyword">end</span>

               <span class="keyword">if</span>(r_2_4_d12 == 1)
                  <span class="keyword">if</span>(y_centroid(2) &lt; y_centroid(1))
                  x_3 = x_centroid(2) - d1_2;
                  x_4 = 10752;
                  y_3 = 1;
                  y_4 = y_centroid(2) + d1_2;
                  <span class="keyword">else</span>
                  x_3 = x_centroid(2) - d1_2;
                  x_4 = 10752;
                  y_3 = y_centroid(2) - d1_2
                  y_4 = y_centroid(2) + (7168 - d1_2);
                  <span class="keyword">end</span>
               <span class="keyword">end</span>

               <span class="keyword">if</span>(r_2_5_d12 == 1)
                  <span class="keyword">if</span>(y_centroid(2) &lt; y_centroid(1))
                  x_3 = x_centroid(2) - d1_2;
                  x_4 = 10752;
                  y_3 = y_centroid(2) + d1_2;
                  y_4 = 13824;
                  <span class="keyword">else</span>
                  x_3 = x_centroid(2) - d1_2;
                  x_4 = 10752;
                  y_3 = y_centroid(2) + (7168 - d1_2)
                  y_4 = y_centroid(2) + d1_2;
                  <span class="keyword">end</span>
               <span class="keyword">end</span>

               <span class="comment">% Sphere 2 and 3 are in the same location</span>

               <span class="keyword">if</span>(l_2_1_d23 == 1)
                  <span class="keyword">if</span>(y_centroid(2) &lt; y_centroid(3))
                  x_3 = 1;
                  x_4 = x_centroid(2) + d2_3;
                  y_3 = 1;
                  y_4 = y_centroid(2) + d2_3;
                  <span class="keyword">else</span>
                  x_3 = 1;
                  x_4 = x_centroid(2) + d2_3;
                  y_3 = y_centroid(2) - d2_3;
                  y_4 = y_centroid(2) + (7168 - d2_3);
                  <span class="keyword">end</span>
               <span class="keyword">end</span>

               <span class="keyword">if</span>(l_2_2_d23 == 1)
                  <span class="keyword">if</span>(y_centroid(2) &lt; y_centroid(3))
                  x_3 = 1;
                  x_4 = x_centroid(2) + d2_3;
                  y_3 = y_centroid(2) - (7168 - d2_3);
                  y_4 = y_centroid(2) + d2_3;
                  <span class="keyword">else</span>
                  x_3 = 1;
                  x_4 = x_centroid(2) + d2_3;
                  y_3 = y_centroid(2) - d2_3;
                  y_4 = 13824;
                  <span class="keyword">end</span>
               <span class="keyword">end</span>

               <span class="keyword">if</span>(r_2_4_d23 == 1)
                  <span class="keyword">if</span>(y_centroid(2) &lt; y_centroid(3))
                  x_3 = x_centroid(2) - (7168 - d2_3);
                  x_4 = x_centroid(2) + d2_3;
                  y_3 = 1;
                  y_4 = y_centroid(2) + d2_3;
                  <span class="keyword">else</span>
                  x_3 = x_centroid(2) - (7168 - d2_3);
                  x_4 = x_centroid(2) + d2_3;
                  y_3 = y_centroid(2) - d2_3
                  y_4 = y_centroid(2) + (7168 - d2_3);
                  <span class="keyword">end</span>
               <span class="keyword">end</span>

               <span class="keyword">if</span>(r_2_5_d23 == 1)
                  <span class="keyword">if</span>(y_centroid(2) &lt; y_centroid(3))
                  x_3 = x_centroid(2) - (7168 - d2_3);
                  x_4 = x_centroid(2) + d2_3;
                  y_3 = y_centroid(2) - (7168 - d2_3);
                  y_4 = y_centroid(2) + d2_3;
                  <span class="keyword">else</span>
                  x_3 = x_centroid(2) - (7168 - d2_3);
                  x_4 = x_centroid(2) + d2_3;
                  y_3 = y_centroid(2) - d2_3;
                  y_4 = 13824;
                  <span class="keyword">end</span>
               <span class="keyword">end</span>

               <span class="comment">% Sphere 1 and 2 and 3 are in the same location</span>

               <span class="keyword">if</span>(l_2_1_t == 1)
                  <span class="keyword">if</span>(y_centroid(2) &lt; y_centroid(1) &amp;&amp; y_centroid(2) &lt; y_centroid(3))
                  minxy = min(Vd2(1:2))
                  x_3 = x_centroid(2) -d1_2;
                  x_4 = x_centroid(2) +d2_3;
                  y_3 = 1;
                  y_4 = y_centroid(2) + minxy;
                  <span class="keyword">end</span>
                  <span class="keyword">if</span>(y_centroid(2) &gt; y_centroid(1) &amp;&amp; y_centroid(2) &gt; y_centroid(3))
                  minxy = min(Vd2(1:2))
                  x_3 = x_centroid(2) -d1_2;
                  x_4 = x_centroid(2) +d2_3;
                  y_3 = y_centroid(2) - minxy;
                  y_4 = y_centroid(2) + (7168 - minxy);
                  <span class="keyword">end</span>
                  <span class="keyword">if</span>(y_centroid(2) &lt; y_centroid(1) &amp;&amp; y_centroid(2) &gt; y_centroid(3))
                  minxy = min(Vd2(1:2))
                  x_3 = x_centroid(2) -d1_2;
                  x_4 = x_centroid(2) +d2_3;
                  y_3 = y_centroid(2) - d2_3;
                  y_4 = y_centroid(2) + d1_2;
                  <span class="keyword">end</span>
                  <span class="keyword">if</span>(y_centroid(2) &gt; y_centroid(1) &amp;&amp; y_centroid(2) &lt; y_centroid(3))
                  minxy = min(Vd2(1:2))
                  x_3 = x_centroid(2) -d1_2;
                  x_4 = x_centroid(2) +d2_3;
                  y_3 = y_centroid(2) - d1_2;
                  y_4 = y_centroid(2) + d2_3;
                  <span class="keyword">end</span>
               <span class="keyword">end</span>

               <span class="keyword">if</span>(l_2_2_t == 1)
                  <span class="keyword">if</span>(y_centroid(2) &lt; y_centroid(1) &amp;&amp; y_centroid(2) &lt; y_centroid(3))
                  minxy = min(Vd2(1:2))
                  x_3 = x_centroid(2) -d1_2;
                  x_4 = x_centroid(2) +d2_3;
                  y_3 = y_centroid(2) - (7168-minxy);
                  y_4 = y_centroid(2) + minxy;
                  <span class="keyword">end</span>
                  <span class="keyword">if</span>(y_centroid(2) &gt; y_centroid(1) &amp;&amp; y_centroid(2) &gt; y_centroid(3))
                  minxy = min(Vd2(1:2))
                  x_3 = x_centroid(2) -d1_2;
                  x_4 = x_centroid(2) +d2_3;
                  y_3 = y_centroid(2) - minxy;
                  y_4 = 13824;
                  <span class="keyword">end</span>
                  <span class="keyword">if</span>(y_centroid(2) &lt; y_centroid(1) &amp;&amp; y_centroid(2) &gt; y_centroid(3))
                  minxy = min(Vd2(1:2))
                  x_3 = x_centroid(2) -d1_2;
                  x_4 = x_centroid(2) +d2_3;
                  y_3 = y_centroid(2) - d2_3;
                  y_4 = y_centroid(2) + d1_2;
                  <span class="keyword">end</span>
                  <span class="keyword">if</span>(y_centroid(2) &gt; y_centroid(1) &amp;&amp; y_centroid(2) &lt; y_centroid(3))
                  minxy = min(Vd2(1:2))
                  x_3 = x_centroid(2) -d1_2;
                  x_4 = x_centroid(2) +d2_3;
                  y_3 = y_centroid(2) - d1_2;
                  y_4 = y_centroid(2) + d2_3;
                  <span class="keyword">end</span>
               <span class="keyword">end</span>

                <span class="keyword">if</span>(r_2_4_t == 1)
                  <span class="keyword">if</span>(y_centroid(2) &lt; y_centroid(1) &amp;&amp; y_centroid(2) &lt; y_centroid(3))
                  minxy = min(Vd2(1:2))
                  x_3 = x_centroid(2) -d1_2;
                  x_4 = x_centroid(2) +d2_3;
                  y_3 = 1;
                  y_4 = y_centroid(2) + minxy;
                  <span class="keyword">end</span>
                  <span class="keyword">if</span>(y_centroid(2) &gt; y_centroid(1) &amp;&amp; y_centroid(2) &gt; y_centroid(3))
                  minxy = min(Vd2(1:2))
                  x_3 = x_centroid(2) -d1_2;
                  x_4 = x_centroid(2) +d2_3;
                  y_3 = y_centroid(2) - minxy;
                  y_4 = y_centroid(2) + (7168 - minxy);
                  <span class="keyword">end</span>
                  <span class="keyword">if</span>(y_centroid(2) &lt; y_centroid(1) &amp;&amp; y_centroid(2) &gt; y_centroid(3))
                  minxy = min(Vd2(1:2))
                  x_3 = x_centroid(2) -d1_2;
                  x_4 = x_centroid(2) +d2_3;
                  y_3 = y_centroid(2) - d2_3;
                  y_4 = y_centroid(2) + d1_2;
                  <span class="keyword">end</span>
                  <span class="keyword">if</span>(y_centroid(2) &gt; y_centroid(1) &amp;&amp; y_centroid(2) &lt; y_centroid(3))
                  minxy = min(Vd2(1:2))
                  x_3 = x_centroid(2) -d1_2;
                  x_4 = x_centroid(2) +d2_3;
                  y_3 = y_centroid(2) - d1_2;
                  y_4 = y_centroid(2) + d2_3;
                  <span class="keyword">end</span>
                <span class="keyword">end</span>

                <span class="keyword">if</span>(r_2_5_t == 1)
                  <span class="keyword">if</span>(y_centroid(2) &lt; y_centroid(1) &amp;&amp; y_centroid(2) &lt; y_centroid(3))
                  minxy = min(Vd2(1:2))
                  x_3 = x_centroid(2) -d1_2;
                  x_4 = x_centroid(2) +d2_3;
                  y_3 = y_centroid(2) - (7168-minxy);
                  y_4 = y_centroid(2) + minxy;
                  <span class="keyword">end</span>
                  <span class="keyword">if</span>(y_centroid(2) &gt; y_centroid(1) &amp;&amp; y_centroid(2) &gt; y_centroid(3))
                  minxy = min(Vd2(1:2))
                  x_3 = x_centroid(2) -d1_2;
                  x_4 = x_centroid(2) +d2_3;
                  y_3 = y_centroid(2) - minxy;
                  y_4 = 13824;
                  <span class="keyword">end</span>
                  <span class="keyword">if</span>(y_centroid(2) &lt; y_centroid(1) &amp;&amp; y_centroid(2) &gt; y_centroid(3))
                  minxy = min(Vd2(1:2))
                  x_3 = x_centroid(2) -d1_2;
                  x_4 = x_centroid(2) +d2_3;
                  y_3 = y_centroid(2) - d2_3;
                  y_4 = y_centroid(2) + d1_2;
                  <span class="keyword">end</span>
                  <span class="keyword">if</span>(y_centroid(2) &gt; y_centroid(1) &amp;&amp; y_centroid(2) &lt; y_centroid(3))
                  minxy = min(Vd2(1:2))
                  x_3 = x_centroid(2) -d1_2;
                  x_4 = x_centroid(2) +d2_3;
                  y_3 = y_centroid(2) - d1_2;
                  y_4 = y_centroid(2) + d2_3;
                  <span class="keyword">end</span>
                <span class="keyword">end</span>

                <span class="keyword">if</span>(x_3 &lt; 0)
                    x_3 =0;
                <span class="keyword">end</span>
                <span class="keyword">if</span>(x_4 &gt; 10752)
                    x_4 =10752;
                <span class="keyword">end</span>
                <span class="keyword">if</span>(y_3 &lt; 0)
                    y_3 =0;
                <span class="keyword">end</span>
                <span class="keyword">if</span>(y_4 &gt; 13824)
                    y_4 =13824;
                <span class="keyword">end</span>
               <span class="comment">%The rectangular image is cutted from the imgnucleus image containing the whole cover slip</span>
               imagesphere2 = imgnucleus(y_3:y_4,x_3:x_4);
               <span class="comment">% Dimensions of imagesphere1 are determined</span>
               [r2 c2] = size(imagesphere2);
               <span class="comment">% An empty matrix is generated</span>
               imagesphereresize2 = zeros(7168:7168);
               <span class="comment">% imagesphereresize1 is converted to 8-bit</span>
               imagesphereresize2 = uint8(imagesphereresize2);
               <span class="comment">%The empty indices in the imagesphereresize1 matrix are overwritten with imagesphere 1 entries</span>
               imagesphereresize2(1:r2,1:c2)=imagesphere2;
               <span class="comment">% imagesphereresize1 is saved to final destination</span>
               newFile2 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'02NucleusBig'</span>],<span class="string">'ignorecase'</span>);
               imwrite(imagesphereresize2,[foldername1 <span class="string">'/'</span> newFile2]);
               clear <span class="string">imagesphereresize2</span>;
               clear <span class="string">imagesphere2</span>;


            <span class="comment">% Sphere 3 with third smallest value of x_centroid</span>



               <span class="keyword">if</span>(l_3_1 &gt;0 &amp;&amp; l_3_1 &lt; 2);
                       x_5 = 1;
                       x_6 = x_centroid(3) + d_3_c;
                       y_5 = 1;
                       y_6 = y_centroid(3) + d_3_c;
               <span class="keyword">else</span>
               <span class="keyword">end</span>

               <span class="keyword">if</span>(l_3_2 &gt;0 &amp;&amp; l_3_2 &lt; 2);
                       x_5 = 1;
                       x_6 = x_centroid(3) + d_3_c;
                       y_5 = y_centroid(3) - d_3_c;
                       y_6 = 13824;
               <span class="keyword">else</span>
               <span class="keyword">end</span>

               <span class="keyword">if</span>(r_3_4 &gt;0 &amp;&amp; r_3_4 &lt; 2);
                       x_5 = x_centroid(3) - d_3_c;
                       x_6 = 10752;
                       y_5 = 1;
                       y_6 = y_centroid(3) + d_3_c;
               <span class="keyword">else</span>
               <span class="keyword">end</span>

               <span class="keyword">if</span>(r_3_5 &gt;0 &amp;&amp; r_3_5 &lt; 2);
                       x_5 = x_centroid(3) - d_3_c;
                       x_6 = 10752;
                       y_5 = y_centroid(3) - d_3_c;
                       y_6 = 13824;
               <span class="keyword">else</span>
               <span class="keyword">end</span>

               <span class="keyword">if</span>(x_centroid(3) ~= x_centroid_c);
               <span class="keyword">else</span>
                   <span class="keyword">if</span>(x_centroid(1) &lt; x_centroid(3) &amp;&amp; x_centroid(1) &lt; x_centroid(3));
                       V_1m = [d1_2 ; d1_3 ; (7168/2)];
                       min1m = min(V_1m(1:3));
                       min1p = (7168-min1m);
                   <span class="keyword">else</span>
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(x_centroid(1) &gt; x_centroid(3) &amp;&amp; x_centroid(2) &gt; x_centroid(3));
                       V_1p = [d1_2 ; d1_3 ; (7168/2)];
                       min1p = min(V_1p(1:3));
                       min1m = (7168-min1p);
                   <span class="keyword">else</span>
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(x_centroid(1) &gt; x_centroid(3) &amp;&amp; x_centroid(2) &lt; x_centroid(3));
                       V_1m = [d1_3 ; (7168/2)];
                       V_1p = [d1_2 ; (7168/2)];
                       min1p = min(V_1p(1:2));
                       min1m = min(V_1m(1:2));
                   <span class="keyword">else</span>

                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(x_centroid(1) &lt; x_centroid(3) &amp;&amp; x_centroid(2) &gt; x_centroid(3));
                       V_1m = [d1_2 ; (7168/2)];
                       V_1p = [d1_3 ; (7168/2)];
                       min1p = min(V_1p(1:2));
                       min1m = min(V_1m(1:2));

                   <span class="keyword">else</span>

                   <span class="keyword">end</span>

                   x_5 = x_centroid(3) - min1m
                   x_6 = x_centroid(3) + min1p
                   y_5 = y_centroid(3) - min1m
                   y_6 = y_centroid(3) + min1p
               <span class="keyword">end</span>

               <span class="comment">% Cases for having two or three spheres at one location</span>

                <span class="comment">% Sphere 1 and 3 are in the same location</span>

               <span class="keyword">if</span>(l_3_1_d13 == 1)
                  <span class="keyword">if</span>(y_centroid(3) &lt; y_centroid(1))
                  x_5 = x_centroid(3) - d1_3;
                  x_6 = x_centroid(3) + (7168 - d1_3);
                  y_5 = 1;
                  y_6 = y_centroid(3) + d1_3;
                  <span class="keyword">else</span>
                  x_5 = x_centroid(3) - d1_3;
                  x_6 = x_centroid(3) + (7168 - d1_3);
                  y_5 = y_centroid(3) - d1_3;
                  y_6 = y_centroid(3) + (7168 - d1_3);
                  <span class="keyword">end</span>
               <span class="keyword">end</span>

               <span class="keyword">if</span>(l_3_2_d13 == 1)
                  <span class="keyword">if</span>(y_centroid(3) &lt; y_centroid(1))
                  x_5 = x_centroid(3) - d1_3;
                  x_6 = x_centroid(3) + (7168 - d1_3);
                  y_5 = y_centroid(3) - (7168 - d1_3);
                  y_6 = y_centroid(3) + d1_3;
                  <span class="keyword">else</span>
                  x_5 = x_centroid(3) - d1_3;
                  x_6 = x_centroid(3) + (7168 - d1_3);
                  y_5 = y_centroid(3) - d1_3;
                  y_6 = 13824;
                  <span class="keyword">end</span>
               <span class="keyword">end</span>

               <span class="keyword">if</span>(r_3_4_d13 == 1)
                  <span class="keyword">if</span>(y_centroid(3) &lt; y_centroid(1))
                  x_5 = x_centroid(3)  - d1_3;
                  x_6 = 10752;
                  y_5 = 1;
                  y_6 = y_centroid(3) + d1_3;
                  <span class="keyword">else</span>
                  x_5 = x_centroid(3)  - d1_3;
                  x_6 = 10752;
                  y_5 = y_centroid(3) - d1_3
                  y_6 = y_centroid(3) + (7168 - d1_3);
                  <span class="keyword">end</span>
               <span class="keyword">end</span>

               <span class="comment">% Sphere 2 and 3 are in the same location</span>

               <span class="keyword">if</span>(l_3_1_d23 == 1)
                  <span class="keyword">if</span>(y_centroid(3) &lt; y_centroid(2))
                  x_5 = x_centroid(3) - d2_3;
                  x_6 = x_centroid(3) + (7168 - d2_3);
                  y_5 = 1;
                  y_6 = y_centroid(3) + d2_3;
                  <span class="keyword">else</span>
                  x_5 = x_centroid(3) - d2_3;
                  x_6 = x_centroid(3) + (7168 - d2_3);
                  y_5 = y_centroid(3) - d1_3;
                  y_6 = y_centroid(3) + (7168 - d2_3);
                  <span class="keyword">end</span>
               <span class="keyword">end</span>

               <span class="keyword">if</span>(l_3_2_d23 == 1)
                  <span class="keyword">if</span>(y_centroid(3) &lt; y_centroid(2))
                  x_5 = x_centroid(3) - d2_3;
                  x_6 = x_centroid(3) + (7168 - d2_3);
                  y_5 = y_centroid(3) - (7168 - d2_3);
                  y_6 = y_centroid(3) + d2_3;
                  <span class="keyword">else</span>
                  x_5 = x_centroid(3) - d2_3;
                  x_6 = x_centroid(3) + (7168 - d2_3);
                  y_5 = y_centroid(3) - d2_3;
                  y_6 = 13824;
                  <span class="keyword">end</span>
               <span class="keyword">end</span>

               <span class="keyword">if</span>(r_3_4_d23 == 1)
                  <span class="keyword">if</span>(y_centroid(3) &lt; y_centroid(2))
                  x_5 = x_centroid(3)  - d2_3;
                  x_6 = 10752;
                  y_5 = 1;
                  y_6 = y_centroid(3) + d2_3;
                  <span class="keyword">else</span>
                  x_5 = x_centroid(3)  - d2_3;
                  x_6 = 10752;
                  y_5 = y_centroid(3) - d2_3
                  y_6 = y_centroid(3) + (7168 - d2_3);
                  <span class="keyword">end</span>
               <span class="keyword">end</span>

               <span class="keyword">if</span>(r_3_5_d23 == 1)
                  <span class="keyword">if</span>(y_centroid(3) &lt; y_centroid(2))
                  x_5 = x_centroid(3)  - d2_3;
                  x_6 = 10752;
                  y_5 = y_centroid(3) - (7168 - d2_3);
                  y_6 = y_centroid(3) + d2_3;
                  <span class="keyword">else</span>
                  x_5 = x_centroid(3)  - d2_3;
                  x_6 = 10752;
                  y_5 = y_centroid(3) - d2_3;
                  y_6 = 13824;
                  <span class="keyword">end</span>
               <span class="keyword">end</span>

               <span class="comment">% Sphere 1 and 2 and 3 are in the same location</span>

               <span class="keyword">if</span>(l_3_1_t == 1)
                  <span class="keyword">if</span>(y_centroid(3) &lt; y_centroid(1) &amp;&amp; y_centroid(3) &lt; y_centroid(2))
                  minxy = min(Vd3(1:2))
                  x_5 = x_centroid(3) - d2_3;
                  x_6 = x_centroid(3) + (7168 -d2_3);
                  y_5 = 1;
                  y_6 = y_centroid(3) + minxy;
                  <span class="keyword">end</span>
                  <span class="keyword">if</span>(y_centroid(3) &gt; y_centroid(1) &amp;&amp; y_centroid(3) &gt; y_centroid(2))
                  minxy = min(Vd3(1:2))
                  x_5 = x_centroid(3) - d2_3;
                  x_6 = x_centroid(3) + (7168 -d2_3);
                  y_5 = y_centroid(3) - minxy;
                  y_6 = y_centroid(3) + (7168 - minxy);
                  <span class="keyword">end</span>
                  <span class="keyword">if</span>(y_centroid(3) &lt; y_centroid(1) &amp;&amp; y_centroid(3) &gt; y_centroid(2))
                  minxy = min(Vd3(1:2))
                  x_5 = x_centroid(3) - d2_3;
                  x_6 = x_centroid(3) + (7168 -d2_3);
                  y_5 = y_centroid(3) - d1_3;
                  y_6 = y_centroid(3) + d1_2;
                  <span class="keyword">end</span>
                  <span class="keyword">if</span>(y_centroid(3) &gt; y_centroid(1) &amp;&amp; y_centroid(3) &lt; y_centroid(2))
                  minxy = min(Vd3(1:2))
                  x_5 = x_centroid(3) - d2_3;
                  x_6 = x_centroid(3) + (7168 -d2_3);
                  y_5 = y_centroid(3) - d1_2;
                  y_6 = y_centroid(3) + d1_3;
                  <span class="keyword">end</span>
               <span class="keyword">end</span>

               <span class="keyword">if</span>(l_3_2_t == 1)
                  <span class="keyword">if</span>(y_centroid(3) &lt; y_centroid(1) &amp;&amp; y_centroid(3) &lt; y_centroid(2))
                  minxy = min(Vd3(1:2))
                  x_5 = x_centroid(3) - d2_3;
                  x_6 = x_centroid(3) + (7168 -d2_3);
                  y_5 = y_centroid(3) - (7168-minxy);
                  y_6 = y_centroid(3) + minxy;
                  <span class="keyword">end</span>
                  <span class="keyword">if</span>(y_centroid(3) &gt; y_centroid(1) &amp;&amp; y_centroid(3) &gt; y_centroid(2))
                  minxy = min(Vd3(1:2))
                  x_5 = x_centroid(3) - d2_3;
                  x_6 = x_centroid(3) + (7168 -d2_3);
                  y_5 = y_centroid(3) - minxy;
                  y_6 = 13824;
                  <span class="keyword">end</span>
                  <span class="keyword">if</span>(y_centroid(3) &lt; y_centroid(1) &amp;&amp; y_centroid(3) &gt; y_centroid(2))
                  minxy = min(Vd3(1:2))
                  x_5 = x_centroid(3) - d2_3;
                  x_6 = x_centroid(3) + (7168 -d2_3);
                  y_5 = y_centroid(3) - d1_3;
                  y_6 = y_centroid(3) + d1_2;
                  <span class="keyword">end</span>
                  <span class="keyword">if</span>(y_centroid(3) &gt; y_centroid(1) &amp;&amp; y_centroid(3) &lt; y_centroid(2))
                  minxy = min(Vd3(1:2))
                  x_5 = x_centroid(3) - d2_3;
                  x_6 = x_centroid(3) + (7168 -d2_3);
                  y_5 = y_centroid(3) - d1_2;
                  y_6 = y_centroid(3) + d1_3;
                  <span class="keyword">end</span>
               <span class="keyword">end</span>

                <span class="keyword">if</span>(r_3_4_t == 1)
                  <span class="keyword">if</span>(y_centroid(3) &lt; y_centroid(1) &amp;&amp; y_centroid(3) &lt; y_centroid(2))
                  minxy = min(Vd3(1:2))
                  x_5 = x_centroid(3) -d2_3;
                  x_6 = 10752;
                  y_5 = 1;
                  y_6 = y_centroid(3) + minxy;
                  <span class="keyword">end</span>
                  <span class="keyword">if</span>(y_centroid(3) &gt; y_centroid(1) &amp;&amp; y_centroid(3) &gt; y_centroid(2))
                  minxy = min(Vd3(1:2))
                  x_5 = x_centroid(3) -d2_3;
                  x_6 = 10752;
                  y_5 = y_centroid(3) - minxy;
                  y_6 = y_centroid(3) + (7168 - minxy);
                  <span class="keyword">end</span>
                  <span class="keyword">if</span>(y_centroid(3) &lt; y_centroid(1) &amp;&amp; y_centroid(3) &gt; y_centroid(2))
                  minxy = min(Vd3(1:2))
                  x_5 = x_centroid(3) -d2_3;
                  x_6 = 10752;
                  y_5 = y_centroid(3) - d1_3;
                  y_6 = y_centroid(3) + d1_2;
                  <span class="keyword">end</span>
                  <span class="keyword">if</span>(y_centroid(3) &gt; y_centroid(1) &amp;&amp; y_centroid(3) &lt; y_centroid(2))
                  minxy = min(Vd3(1:2))
                  x_5 = x_centroid(3) -d2_3;
                  x_6 = 10752;
                  y_5 = y_centroid(3) - d1_2;
                  y_6 = y_centroid(3) + d1_3;
                  <span class="keyword">end</span>
                <span class="keyword">end</span>

                <span class="keyword">if</span>(r_3_5_t == 1)
                  <span class="keyword">if</span>(y_centroid(3) &lt; y_centroid(1) &amp;&amp; y_centroid(3) &lt; y_centroid(2))
                  minxy = min(Vd3(1:2))
                  x_5 = x_centroid(3) -d2_3;
                  x_6 = 10752;
                  y_5 = y_centroid(3) - (7168-minxy);
                  y_6 = y_centroid(3) + minxy;
                  <span class="keyword">end</span>
                  <span class="keyword">if</span>(y_centroid(3) &gt; y_centroid(1) &amp;&amp; y_centroid(3) &gt; y_centroid(2))
                  minxy = min(Vd3(1:2))
                  x_5 = x_centroid(3) -d2_3;
                  x_6 = 10752;
                  y_5 = y_centroid(3) - minxy;
                  y_6 = 13824;
                  <span class="keyword">end</span>
                  <span class="keyword">if</span>(y_centroid(3) &lt; y_centroid(1) &amp;&amp; y_centroid(3) &gt; y_centroid(2))
                  minxy = min(Vd3(1:2))
                  x_5 = x_centroid(3) -d2_3;
                  x_6 = 10752;
                  y_5 = y_centroid(3) - d1_3;
                  y_6 = y_centroid(3) + d1_2;
                  <span class="keyword">end</span>
                  <span class="keyword">if</span>(y_centroid(3) &gt; y_centroid(1) &amp;&amp; y_centroid(3) &lt; y_centroid(2))
                  minxy = min(Vd3(1:2))
                  x_5 = x_centroid(3) -d2_3;
                  x_6 = 10752;
                  y_5 = y_centroid(3) - d1_2;
                  y_6 = y_centroid(3) + d1_3;
                  <span class="keyword">end</span>
                <span class="keyword">end</span>

               <span class="keyword">if</span>(x_5 &lt; 0)
                    x_5 =0;
                <span class="keyword">end</span>
                <span class="keyword">if</span>(x_6 &gt; 10752)
                    x_6 =10752;
                <span class="keyword">end</span>
                <span class="keyword">if</span>(y_5 &lt; 0)
                    y_5 =0;
                <span class="keyword">end</span>
                <span class="keyword">if</span>(y_6 &gt; 13824)
                    y_6 =13824;
                <span class="keyword">end</span>

                <span class="comment">%The rectangular image is cutted from the imgnucleus image containing the whole cover slip</span>
               imagesphere3 = imgnucleus(y_5:y_6,x_5:x_6);
               <span class="comment">% Dimensions of imagesphere1 are determined</span>
               [r3 c3] = size(imagesphere3);
               <span class="comment">% An empty matrix is generated</span>
               imagesphereresize3 = zeros(7168:7168);
               <span class="comment">% imagesphereresize1 is converted to 8-bit</span>
               imagesphereresize3 = uint8(imagesphereresize3);
               <span class="comment">%The empty indices in the imagesphereresize1 matrix are overwritten with imagesphere 1 entries</span>
               imagesphereresize3(1:r3,1:c3)=imagesphere3;
               <span class="comment">% imagesphereresize1 is saved to final destination</span>
               newFile3 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'03NucleusBig'</span>],<span class="string">'ignorecase'</span>);
               imwrite(imagesphereresize3,[foldername1 <span class="string">'/'</span> newFile3]);
               clear <span class="string">imagesphereresize3</span>;
               clear <span class="string">imagesphere3</span>;

               imagesphereresize4 = zeros(7168:7168);
               newFile4 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'04NucleusBig'</span>],<span class="string">'ignorecase'</span>);
               imwrite(imagesphereresize4,[foldername1 <span class="string">'/'</span> newFile4]);
               clear <span class="string">imagesphereresize4</span>;

               imagesphereresize5 = zeros(7168:7168);
               newFile5 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'05NucleusBig'</span>],<span class="string">'ignorecase'</span>);
               imwrite(imagesphereresize5,[foldername1 <span class="string">'/'</span> newFile5]);
               clear <span class="string">imagesphereresize5</span>;

               <span class="keyword">if</span>(Neuron_Channel &gt; 0)
                   <span class="comment">% Same for neurite channel</span>


                   imagesphere6 = imgneurite(y_1:y_2,x_1:x_2);
                   [r1 c1] = size(imagesphere6);
                   imagesphereresize6 = zeros(7168:7168);
                   imagesphereresize6 = uint8(imagesphereresize6);
                   imagesphereresize6(1:r1,1:c1)=imagesphere6;
                   newFile6 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'01NeuriteBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize6,[foldername1 <span class="string">'/'</span> newFile6]);
                   clear <span class="string">imagesphereresize6</span>;
                   clear <span class="string">imagesphere6</span>;

                   imagesphere7 = imgneurite(y_3:y_4,x_3:x_4);
                   [r2 c2] = size(imagesphere7);
                   imagesphereresize7 = zeros(7168:7168);
                   imagesphereresize7 = uint8(imagesphereresize7);
                   imagesphereresize7(1:r2,1:c2)=imagesphere7;
                   newFile7 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'02NeuriteBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize7,[foldername1 <span class="string">'/'</span> newFile7]);
                   clear <span class="string">imagesphereresize7</span>;
                   clear <span class="string">imagesphere7</span>;

                   imagesphere8 = imgneurite(y_5:y_6,x_5:x_6);
                   [r3 c3] = size(imagesphere8);
                   imagesphereresize8 = zeros(7168:7168);
                   imagesphereresize8 = uint8(imagesphereresize8);
                   imagesphereresize8(1:r3,1:c3)=imagesphere8;
                   newFile8 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'03NeuriteBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize8,[foldername1 <span class="string">'/'</span> newFile8]);
                   clear <span class="string">imagesphereresize8</span>;
                   clear <span class="string">imagesphere8</span>;

                   imagesphereresize9 = zeros(7168:7168);
            	   newFile9 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'04NeuriteBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize9,[foldername1 <span class="string">'/'</span> newFile9]);
                   clear <span class="string">imagesphereresize9</span>;

                   imagesphereresize10 = zeros(7168:7168);
            	   newFile10 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'05NeuriteBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize10,[foldername1 <span class="string">'/'</span> newFile10]);
                   clear <span class="string">imagesphereresize10</span>;

               <span class="keyword">end</span>

               <span class="keyword">if</span>(Oligo_Channel &gt; 0)
                   <span class="comment">% Same for Oligos</span>
                   imagesphere11 = imgoligo(y_1:y_2,x_1:x_2);
                   [r1 c1] = size(imagesphere11);
                   imagesphereresize11 = zeros(7168:7168);
                   imagesphereresize11 = uint8(imagesphereresize11);
                   imagesphereresize11(1:r1,1:c1)=imagesphere11;
                   newFile11 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'01OligoBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize11,[foldername1 <span class="string">'/'</span> newFile11]);
                   clear <span class="string">imagesphereresize11</span>;
                   clear <span class="string">imagesphere11</span>;

                   imagesphere12 = imgoligo(y_3:y_4,x_3:x_4);
                   [r2 c2] = size(imagesphere12);
                   imagesphereresize12 = zeros(7168:7168);
                   imagesphereresize12 = uint8(imagesphereresize12);
                   imagesphereresize12(1:r2,1:c2)=imagesphere12;
                   newFile12 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'02OligoBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize12,[foldername1 <span class="string">'/'</span> newFile12]);
                   clear <span class="string">imagesphereresize12</span>;
                   clear <span class="string">imagesphere12</span>;

                   imagesphere13 = imgoligo(y_5:y_6,x_5:x_6);
                   [r3 c3] = size(imagesphere13);
                   imagesphereresize13 = zeros(7168:7168);
                   imagesphereresize13 = uint8(imagesphereresize13);
                   imagesphereresize13(1:r3,1:c3)=imagesphere13;
                   newFile13 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'03OligoBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize13,[foldername1 <span class="string">'/'</span> newFile13]);
                   clear <span class="string">imagesphereresize13</span>;
                   clear <span class="string">imagesphere13</span>;

                   imagesphereresize14 = zeros(7168:7168);
            	   newFile14 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'04OligoBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize14,[foldername1 <span class="string">'/'</span> newFile14]);
                   clear <span class="string">imagesphereresize14</span>;

                   imagesphereresize15 = zeros(7168:7168);
            	   newFile15 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'05OligoBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize15,[foldername1 <span class="string">'/'</span> newFile15]);
                   clear <span class="string">imagesphereresize15</span>;
               <span class="keyword">end</span>

               <span class="keyword">if</span>(Astro_Channel &gt;0)
                   <span class="comment">% Same for Astros</span>
                   imagesphere16 = imgastro(y_1:y_2,x_1:x_2);
                   [r1 c1] = size(imagesphere16);
                   imagesphereresize16 = zeros(7168:7168);
                   imagesphereresize16 = uint8(imagesphereresize16);
                   imagesphereresize16(1:r1,1:c1)=imagesphere16;
                   newFile16 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'01AstroBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize16,[foldername1 <span class="string">'/'</span> newFile16]);
                   clear <span class="string">imagesphereresize16</span>;
                   clear <span class="string">imagesphere16</span>;

                   imagesphere17 = imgastro(y_3:y_4,x_3:x_4);
                   [r2 c2] = size(imagesphere17);
                   imagesphereresize17 = zeros(7168:7168);
                   imagesphereresize17 = uint8(imagesphereresize17);
                   imagesphereresize17(1:r2,1:c2)=imagesphere17;
                   newFile17 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'02AstroBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize17,[foldername1 <span class="string">'/'</span> newFile17]);
                   clear <span class="string">imagesphereresize17</span>;
                   clear <span class="string">imagesphere17</span>;

                   imagesphere18 = imgastro(y_5:y_6,x_5:x_6);
                   [r3 c3] = size(imagesphere18);
                   imagesphereresize18 = zeros(7168:7168);
                   imagesphereresize18 = uint8(imagesphereresize18);
                   imagesphereresize18(1:r3,1:c3)=imagesphere18;
                   newFile18 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'03AstroBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize18,[foldername1 <span class="string">'/'</span> newFile18]);
                   clear <span class="string">imagesphereresize18</span>;
                   clear <span class="string">imagesphere18</span>;

                   imagesphereresize19 = zeros(7168:7168);
            	   newFile19 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'04AstroBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize19,[foldername1 <span class="string">'/'</span> newFile19]);
                   clear <span class="string">imagesphereresize19</span>;

                   imagesphereresize20 = zeros(7168:7168);
            	   newFile20 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'05AstroBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize20,[foldername1 <span class="string">'/'</span> newFile20]);
                   clear <span class="string">imagesphereresize20</span>;
               <span class="keyword">end</span>

            <span class="keyword">else</span>

            <span class="keyword">end</span>

            <span class="comment">% Case 5: Four spheres remained: s=4</span>

            <span class="keyword">if</span>(s_L&gt;3 &amp;&amp; s_L&lt;5);
               <span class="comment">% Extracts the x and y coordinates from s</span>
               x_centroid(1) = s(1).Centroid(1);
               y_centroid(1) = s(1).Centroid(2);
               x_centroid(2) = s(2).Centroid(1);
               y_centroid(2) = s(2).Centroid(2);
               x_centroid(3) = s(3).Centroid(1);
               y_centroid(3) = s(3).Centroid(2);
               x_centroid(4) = s(4).Centroid(1);
               y_centroid(4) = s(4).Centroid(2);
               <span class="comment">% Definition of a centroid quadrant in which the centroid of a potential center neurosphere has to be located.</span>
               <span class="comment">% All other centroids are considerd as rim coordinates</span>
               quadrant1_x1 = 4032;
               quadrant1_x2 = 6720;
               quadrant1_y1 = 5184;
               quadrant1_y2 = 8640;
               <span class="comment">% Calculates the distance between the centroids of the</span>
               <span class="comment">% four neurosphere</span>
               d1_2 = 0.5* ((x_centroid(1)-x_centroid(2))^2+(y_centroid(1)-y_centroid(2))^2)^0.5;
               d1_3 = 0.5* ((x_centroid(1)-x_centroid(3))^2+(y_centroid(1)-y_centroid(3))^2)^0.5;
               d1_4 = 0.5* ((x_centroid(1)-x_centroid(4))^2+(y_centroid(1)-y_centroid(4))^2)^0.5;
               d2_3 = 0.5* ((x_centroid(3)-x_centroid(2))^2+(y_centroid(3)-y_centroid(2))^2)^0.5;
               d2_4 = 0.5* ((x_centroid(4)-x_centroid(2))^2+(y_centroid(4)-y_centroid(2))^2)^0.5;
               d3_4 = 0.5* ((x_centroid(3)-x_centroid(4))^2+(y_centroid(3)-y_centroid(4))^2)^0.5;
               <span class="comment">% The shortest distance between neurosphere cores is the</span>
               <span class="comment">% distance between the rim spheres and the center sphere.</span>
               <span class="comment">% Therefore for all centroids it is checked wether the coordinates of</span>
               <span class="comment">% their centroid is located within the center quadrant.</span>
                <span class="keyword">if</span>(x_centroid(1)&gt;=quadrant1_x1 &amp;&amp; x_centroid(1)&lt;=quadrant1_x2 &amp;&amp; y_centroid(1)&gt;=quadrant1_y1 &amp;&amp; y_centroid(1)&lt;=quadrant1_y2);
                    <span class="comment">% Since more than one sphere might be located in the</span>
                    <span class="comment">% centroid quadrant, further the distance between center</span>
                    <span class="comment">% spheres and the middle of the cover slip (dc_x) is</span>
                    <span class="comment">% calculated</span>
                    dc_1 = ((x_centroid(1)-5376)^2+(y_centroid(1)-6912)^2)^0.5;
                <span class="keyword">else</span>
                    <span class="comment">% If the centroid is not located in the center quadrant the distance is set to an abitrary high value of dc_1 = 1000000000</span>
                    dc_1 = 1000000000;
                <span class="keyword">end</span>
                <span class="comment">% Same for sphere 2,3 and 4</span>
                <span class="keyword">if</span>(x_centroid(2)&gt;=quadrant1_x1 &amp;&amp; x_centroid(2)&lt;=quadrant1_x2 &amp;&amp; y_centroid(2)&gt;=quadrant1_y1 &amp;&amp; y_centroid(2)&lt;=quadrant1_y2);
                    dc_2 = ((x_centroid(2)-5376)^2+(y_centroid(2)-6912)^2)^0.5;

                <span class="keyword">else</span>

                    dc_2 = 1000000000;
                <span class="keyword">end</span>

                <span class="keyword">if</span>(x_centroid(3)&gt;=quadrant1_x1 &amp;&amp; x_centroid(3)&lt;=quadrant1_x2 &amp;&amp; y_centroid(3)&gt;=quadrant1_y1 &amp;&amp; y_centroid(3)&lt;=quadrant1_y2);
                    dc_3 = ((x_centroid(3)-5376)^2+(y_centroid(3)-6912)^2)^0.5;

                <span class="keyword">else</span>

                    dc_3 = 1000000000;
                <span class="keyword">end</span>

                <span class="keyword">if</span>(x_centroid(4)&gt;=quadrant1_x1 &amp;&amp; x_centroid(4)&lt;=quadrant1_x2 &amp;&amp; y_centroid(4)&gt;=quadrant1_y1 &amp;&amp; y_centroid(4)&lt;=quadrant1_y2);
                    dc_4 = ((x_centroid(4)-5376)^2+(y_centroid(4)-6912)^2)^0.5;

                <span class="keyword">else</span>

                    dc_4 = 1000000000;
                <span class="keyword">end</span>
               <span class="comment">% It is checked whether dc_1 is smaller than 1000000000 (no centroid sphere according to the above checked criteria) and smaller</span>
               <span class="comment">% than the distances of other centroid spheres. If dc_1 is</span>
               <span class="comment">% the smallest distance the centroid of sphere 1 is defined</span>
               <span class="comment">% as the centroid of the center sphere</span>
               <span class="keyword">if</span>(dc_1 &lt; 1000000000 &amp;&amp; dc_1 &lt; dc_2 &amp;&amp; dc_1 &lt; dc_3 &amp;&amp; dc_1 &lt; dc_4);
                   x_centroid_c = x_centroid(1);
                   y_centroid_c = y_centroid(1);
                   missingc1 = 0;


               <span class="keyword">else</span>
                   <span class="comment">% If above criteria are not fullfilled the centroid sphere</span>
                   <span class="comment">% is missing and the centroid of this sphere is treated as</span>
                   <span class="comment">% a rim sphere</span>
                   missingc1 = 1;
               <span class="keyword">end</span>
               <span class="comment">%Same for sphere 2, 3 and 4</span>
               <span class="keyword">if</span>(dc_2 &lt; 1000000000 &amp;&amp; dc_2 &lt; dc_1 &amp;&amp; dc_2 &lt; dc_3 &amp;&amp; dc_2 &lt; dc_4);
                   x_centroid_c = x_centroid(2);
                   y_centroid_c = y_centroid(2);
                   missingc2 = 0;
               <span class="keyword">else</span>
                   missingc2 = 1;
               <span class="keyword">end</span>

               <span class="keyword">if</span>(dc_3 &lt; 1000000000 &amp;&amp; dc_3 &lt; dc_1 &amp;&amp; dc_3 &lt; dc_2 &amp;&amp; dc_3 &lt; dc_4);
                   x_centroid_c = x_centroid(3);
                   y_centroid_c = y_centroid(3);
                   missingc3 = 0;

               <span class="keyword">else</span>
                   missingc3 = 1;
               <span class="keyword">end</span>

               <span class="keyword">if</span>(dc_4 &lt; 1000000000 &amp;&amp; dc_4 &lt; dc_1 &amp;&amp; dc_4 &lt; dc_2 &amp;&amp; dc_4 &lt; dc_3);
                   x_centroid_c = x_centroid(4);
                   y_centroid_c = y_centroid(4);
                   missingc4 = 0;

               <span class="keyword">else</span>
                   missingc4 = 1;
               <span class="keyword">end</span>
               <span class="comment">% If all 4 spheres were defined as rim spheres, an artifical</span>
               <span class="comment">% center point is defined as the center point of the cover</span>
               <span class="comment">% slip</span>
               <span class="keyword">if</span>((missingc1+missingc2+missingc3+missingc4) &gt; 3);
                   x_centroid_c = 5376;
                   y_centroid_c = 6912;
               <span class="keyword">else</span>
               <span class="keyword">end</span>
               <span class="comment">% If sphere 1 is no center sphere the shortest distance</span>
               <span class="comment">% between sphere 1 and the center sphere is calculated</span>
               <span class="keyword">if</span>(x_centroid(1) ~= x_centroid_c);
                   d_1_c = 0.5* (((x_centroid(1)-x_centroid_c)^2+(y_centroid(1)-y_centroid_c)^2)^0.5);
               <span class="keyword">else</span>
               <span class="keyword">end</span>
               <span class="comment">% Same for sphere 2, 3 and 4</span>
               <span class="keyword">if</span>(x_centroid(2) ~= x_centroid_c);
                   d_2_c = 0.5* (((x_centroid(2)-x_centroid_c)^2+(y_centroid(2)-y_centroid_c)^2)^0.5);
               <span class="keyword">else</span>
               <span class="keyword">end</span>
               <span class="keyword">if</span>(x_centroid(3) ~= x_centroid_c);
                   d_3_c = 0.5* (((x_centroid(3)-x_centroid_c)^2+(y_centroid(3)-y_centroid_c)^2)^0.5);
               <span class="keyword">else</span>
               <span class="keyword">end</span>

               <span class="keyword">if</span>(x_centroid(4) ~= x_centroid_c);
                   d_4_c = 0.5* (((x_centroid(4)-x_centroid_c)^2+(y_centroid(4)-y_centroid_c)^2)^0.5);
               <span class="keyword">else</span>
                   V_4 = [d1_4 ; d2_4 ; d3_4 ; (7168/2)];
                   min4 = min(V_4(1:4));
                   d_4_c = min4;
               <span class="keyword">end</span>

               <span class="comment">% Defines wether centroid lays left or right of the center</span>
               <span class="comment">% sphere! If sphere 1 is not the center sphere</span>
                <span class="keyword">if</span>(x_centroid(1) ~= x_centroid_c);
                   <span class="comment">% First case: Check whether x_centroid(1) is left of the center sphere</span>
                   <span class="keyword">if</span>(x_centroid(1) &lt; x_centroid_c);
                      <span class="comment">% Check if y_centroid(1) is below y_centroid_c</span>
                      <span class="keyword">if</span>(y_centroid(1)&lt;y_centroid_c);
                       <span class="comment">% If y_centroid(1)&lt;y_centroid_c the sphere has to be located at the</span>
                       <span class="comment">% upper left corner of the cover slip</span>
                       x_centroid_l(1) = x_centroid(1);
                       y_centroid_l(1) = y_centroid(1);
                       <span class="comment">% Sphere is located in the upper left of the cover</span>
                       <span class="comment">% slip</span>
                       l_1_1 = 1
                       <span class="comment">% Sphere is located in the lower left of the cover</span>
                       <span class="comment">% slip</span>
                       l_1_2 = 0
                       <span class="comment">% Sphere is located in the upper right of the cover</span>
                       <span class="comment">% slip</span>
                       r_1_4 = 0
                       <span class="comment">% Sphere is located in the lower right of the cover</span>
                       <span class="comment">% slip</span>
                       r_1_5 = 0

                      <span class="keyword">else</span>
                       <span class="comment">% If y_centroid(1)&gt;y_centroid_c the sphere has to be located at the</span>
                       <span class="comment">% lower left corner of the cover slip</span>
                       x_centroid_l(2) = x_centroid(1);
                       y_centroid_l(2) = y_centroid(1);
                       l_1_1 = 0
                       l_1_2 = 1
                       r_1_4 = 0
                       r_1_5 = 0
                      <span class="keyword">end</span>
                   <span class="keyword">else</span>
                   <span class="comment">% Second case: Check whether x_centroid(1) is right of the center sphere</span>
                      <span class="comment">% Check if y_centroid(1) is below y_centroid_c)</span>
                      <span class="keyword">if</span>(y_centroid(1)&lt;y_centroid_c)
                       <span class="comment">% If y_centroid(1)&lt;y_centroid_c the sphere has to be located at the</span>
                       <span class="comment">% upper right corner of the cover slip</span>
                       x_centroid_r(4) = x_centroid(1);
                       y_centroid_r(4) = y_centroid(1);
                       l_1_1 = 0
                       l_1_2 = 0
                       r_1_4 = 1
                       r_1_5 = 0
                      <span class="keyword">else</span>
                       <span class="comment">% If y_centroid(1)&gt;y_centroid_c the sphere has to be located at the</span>
                       <span class="comment">% lower right corner of the cover slip</span>
                       x_centroid_r(5) = x_centroid(1);
                       y_centroid_r(5) = x_centroid(1);
                       l_1_1 = 0
                       l_1_2 = 0
                       r_1_4 = 0
                       r_1_5 = 1
                      <span class="keyword">end</span>
                   <span class="keyword">end</span>
                <span class="keyword">else</span>
                    l_1_1 = 0
                    l_1_2 = 0
                    r_1_4 = 0
                    r_1_5 = 0
                <span class="keyword">end</span>
               <span class="comment">% Same for sphere 2, 3 and 4</span>
               <span class="keyword">if</span>(x_centroid(2) ~= x_centroid_c)
                   <span class="keyword">if</span>(x_centroid(2) &lt; x_centroid_c);
                      <span class="keyword">if</span>(y_centroid(2)&lt;y_centroid_c)
                       x_centroid_l(1) = x_centroid(2);
                       y_centroid_l(1) = y_centroid(2);
                       l_2_1 = 1
                       l_2_2 = 0
                       r_2_4 = 0
                       r_2_5 = 0

                      <span class="keyword">else</span>
                       x_centroid_l(2) = x_centroid(2);
                       y_centroid_l(2) = y_centroid(2);
                       l_2_1 = 0
                       l_2_2 = 1
                       r_2_4 = 0
                       r_2_5 = 0
                      <span class="keyword">end</span>
                   <span class="keyword">else</span>
                      <span class="keyword">if</span>(y_centroid(2)&lt;y_centroid_c)
                       x_centroid_r(4) = x_centroid(2);
                       y_centroid_r(4) = y_centroid(2);
                       l_2_1 = 0
                       l_2_2 = 0
                       r_2_4 = 1
                       r_2_5 = 0
                      <span class="keyword">else</span>
                       x_centroid_r(5) = x_centroid(2);
                       y_centroid_r(5) = x_centroid(2);
                       l_2_1 = 0
                       l_2_2 = 0
                       r_2_4 = 0
                       r_2_5 = 1
                      <span class="keyword">end</span>
                   <span class="keyword">end</span>
                <span class="keyword">else</span>
                    l_2_1 = 0
                    l_2_2 = 0
                    r_2_4 = 0
                    r_2_5 = 0
                <span class="keyword">end</span>

               <span class="keyword">if</span>(x_centroid(3) ~= x_centroid_c)
                   <span class="keyword">if</span>(x_centroid(3) &lt; x_centroid_c);
                      <span class="keyword">if</span>(y_centroid(3)&lt;y_centroid_c)
                       x_centroid_l(1) = x_centroid(3);
                       y_centroid_l(1) = y_centroid(3);
                       l_3_1 = 1
                       l_3_2 = 0
                       r_3_4 = 0
                       r_3_5 = 0

                      <span class="keyword">else</span>
                       x_centroid_l(2) = x_centroid(3);
                       y_centroid_l(2) = y_centroid(3);
                       l_3_1 = 0
                       l_3_2 = 1
                       r_3_4 = 0
                       r_3_5 = 0
                      <span class="keyword">end</span>
                   <span class="keyword">else</span>
                      <span class="keyword">if</span>(y_centroid(3)&lt;y_centroid_c)
                       x_centroid_r(4) = x_centroid(3);
                       y_centroid_r(4) = y_centroid(3);
                       l_3_1 = 0
                       l_3_2 = 0
                       r_3_4 = 1
                       r_3_5 = 0
                      <span class="keyword">else</span>
                       x_centroid_r(5) = x_centroid(3);
                       y_centroid_r(5) = x_centroid(3);
                       l_3_1 = 0
                       l_3_2 = 0
                       r_3_4 = 0
                       r_3_5 = 1
                      <span class="keyword">end</span>
                   <span class="keyword">end</span>
               <span class="keyword">else</span>
                    l_3_1 = 0
                    l_3_2 = 0
                    r_3_4 = 0
                    r_3_5 = 0
               <span class="keyword">end</span>


               <span class="keyword">if</span>(x_centroid(4) ~= x_centroid_c);
                   <span class="keyword">if</span>(x_centroid(4) &lt; x_centroid_c);
                      <span class="keyword">if</span>(y_centroid(4)&lt;y_centroid_c);
                       x_centroid_l(1) = x_centroid(4);
                       y_centroid_l(1) = y_centroid(4);
                       l_4_1 = 1
                       l_4_2 = 0
                       r_4_4 = 0
                       r_4_5 = 0

                      <span class="keyword">else</span>
                       x_centroid_l(2) = x_centroid(4);
                       y_centroid_l(2) = y_centroid(4);
                       l_4_1 = 0
                       l_4_2 = 1
                       r_4_4 = 0
                       r_4_5 = 0
                      <span class="keyword">end</span>
                   <span class="keyword">else</span>
                      <span class="keyword">if</span>(y_centroid(4)&lt;y_centroid_c)
                       x_centroid_r(4) = x_centroid(4);
                       y_centroid_r(4) = y_centroid(4);
                       l_4_1 = 0
                       l_4_2 = 0
                       r_4_4 = 1
                       r_4_5 = 0
                      <span class="keyword">else</span>
                       x_centroid_r(5) = x_centroid(4);
                       y_centroid_r(5) = x_centroid(4);
                       l_4_1 = 0
                       l_4_2 = 0
                       r_4_4 = 0
                       r_4_5 = 1
                      <span class="keyword">end</span>
                   <span class="keyword">end</span>
                <span class="keyword">else</span>
                    l_4_1 = 0
                    l_4_2 = 0
                    r_4_4 = 0
                    r_4_5 = 0
               <span class="keyword">end</span>


               <span class="comment">% Check for multiple entry positions:</span>

               <span class="comment">% Check if all spheres at the same position</span>
               <span class="keyword">if</span>(l_2_1 == l_1_1 &amp;&amp; l_2_2 == l_1_2 &amp;&amp; r_2_4 == r_1_4 &amp;&amp; r_2_5 == r_1_5 &amp;&amp; l_3_1 == l_1_1 &amp;&amp; l_3_2 == l_1_2 &amp;&amp; r_3_4 == r_1_4 &amp;&amp; r_3_5 == r_1_5 &amp;&amp; l_4_1 == l_1_1 &amp;&amp; l_4_2 == l_1_2 &amp;&amp; r_4_4 == r_1_4 &amp;&amp; r_4_5 == r_1_5)

                   l_1_1_q = l_1_1
                   l_1_2_q = l_1_2
                   r_1_4_q = r_1_4
                   r_1_5_q = r_1_5
                   l_2_1_q = l_2_1
                   l_2_2_q = l_2_2
                   r_2_4_q = r_2_4
                   r_2_5_q = r_2_5
                   l_3_1_q = l_3_1
                   l_3_2_q = l_3_2
                   r_3_4_q = r_3_4
                   r_3_5_q = r_3_5
                   l_4_1_q = l_4_1
                   l_4_2_q = l_4_2
                   r_4_4_q = r_4_4
                   r_4_5_q = r_4_5
                   l_1_1 = 0
                   l_1_2 = 0
                   r_1_4 = 0
                   r_1_5 = 0
                   l_2_1 = 0
                   l_2_2 = 0
                   r_2_4 = 0
                   r_2_5 = 0
                   l_3_1 = 0
                   l_3_2 = 0
                   r_3_4 = 0
                   r_3_5 = 0
                   l_4_1 = 0
                   l_4_2 = 0
                   r_4_4 = 0
                   r_4_5 = 0

                <span class="keyword">else</span>
                   l_1_1_q = 0
                   l_1_2_q = 0
                   r_1_4_q = 0
                   r_1_5_q = 0
                   l_2_1_q = 0
                   l_2_2_q = 0
                   r_2_4_q = 0
                   r_2_5_q = 0
                   l_3_1_q = 0
                   l_3_2_q = 0
                   r_3_4_q = 0
                   r_3_5_q = 0
                   l_4_1_q = 0
                   l_4_2_q = 0
                   r_4_4_q = 0
                   r_4_5_q = 0

               <span class="keyword">end</span>

               <span class="comment">% Check for Triplets</span>
               <span class="comment">% 1,2,3 Triplet</span>

               <span class="keyword">if</span>(l_1_1 == l_2_1 &amp;&amp; l_1_2 == l_2_2 &amp;&amp; r_1_4 == r_2_4 &amp;&amp; r_1_5 == r_2_5 &amp;&amp; l_1_1 == l_3_1 &amp;&amp; l_1_2 == l_3_2 &amp;&amp; r_1_4 == r_3_4 &amp;&amp; r_1_5 == r_3_5)
                   l_1_1_t = l_1_1
                   l_1_2_t = l_1_2
                   r_1_4_t = r_1_4
                   r_1_5_t = r_1_5
                   l_2_1_t = l_2_1
                   l_2_2_t = l_2_2
                   r_2_4_t = r_2_4
                   r_2_5_t = r_2_5
                   l_3_1_t = l_3_1
                   l_3_2_t = l_3_2
                   r_3_4_t = r_3_4
                   r_3_5_t = r_3_5
                   l_4_1_t = 0
                   l_4_2_t = 0
                   r_4_4_t = 0
                   r_4_5_t = 0
                   l_1_1 = 0
                   l_1_2 = 0
                   r_1_4 = 0
                   r_1_5 = 0
                   l_2_1 = 0
                   l_2_2 = 0
                   r_2_4 = 0
                   r_2_5 = 0
                   l_3_1 = 0
                   l_3_2 = 0
                   r_3_4 = 0
                   r_3_5 = 0



               <span class="keyword">else</span>
                   l_1_1_t = 0
                   l_1_2_t = 0
                   r_1_4_t = 0
                   r_1_5_t = 0
                   l_2_1_t = 0
                   l_2_2_t = 0
                   r_2_4_t = 0
                   r_2_5_t = 0
                   l_3_1_t = 0
                   l_3_2_t = 0
                   r_3_4_t = 0
                   r_3_5_t = 0


               <span class="keyword">end</span>

               <span class="comment">% 1,2,4 Triplet</span>
               <span class="keyword">if</span>(l_1_1 == l_2_1 &amp;&amp; l_1_2 == l_2_2 &amp;&amp; r_1_4 == r_2_4 &amp;&amp; r_1_5 == r_2_5 &amp;&amp; l_1_1 == l_3_1 &amp;&amp; l_1_2 == l_3_2 &amp;&amp; r_1_4 == r_3_4 &amp;&amp; r_1_5 == r_3_5)
                   t = 1
               <span class="keyword">else</span>
               <span class="keyword">if</span>(l_1_1 == l_2_1 &amp;&amp; l_1_2 == l_2_2 &amp;&amp; r_1_4 == r_2_4 &amp;&amp; r_1_5 == r_2_5 &amp;&amp; l_1_1 == l_4_1 &amp;&amp; l_1_2 == l_4_2 &amp;&amp; r_1_4 == r_4_4 &amp;&amp; r_1_5 == r_4_5)
                   l_1_1_t = l_1_1
                   l_1_2_t = l_1_2
                   r_1_4_t = r_1_4
                   r_1_5_t = r_1_5
                   l_2_1_t = l_2_1
                   l_2_2_t = l_2_2
                   r_2_4_t = r_2_4
                   r_2_5_t = r_2_5
                   l_3_1_t = 0
                   l_3_2_t = 0
                   r_3_4_t = 0
                   r_3_5_t = 0
                   l_4_1_t = l_4_1
                   l_4_2_t = l_4_2
                   r_4_4_t = r_4_4
                   r_4_5_t = r_4_5
                   l_1_1 = 0
                   l_1_2 = 0
                   r_1_4 = 0
                   r_1_5 = 0
                   l_2_1 = 0
                   l_2_2 = 0
                   r_2_4 = 0
                   r_2_5 = 0
                   l_4_1 = 0
                   l_4_2 = 0
                   r_4_4 = 0
                   r_4_5 = 0

                   t = 1

               <span class="keyword">else</span>
                   l_1_1_t = 0
                   l_1_2_t = 0
                   r_1_4_t = 0
                   r_1_5_t = 0
                   l_2_1_t = 0
                   l_2_2_t = 0
                   r_2_4_t = 0
                   r_2_5_t = 0
                   l_4_1_t = 0
                   l_4_2_t = 0
                   r_4_4_t = 0
                   r_4_5_t = 0
                   t = 0

               <span class="keyword">end</span>
               <span class="keyword">end</span>


               <span class="comment">% 1,3,4 Triplet</span>
               <span class="keyword">if</span>(t == 1)
                   t = 1
               <span class="keyword">else</span>
               <span class="keyword">if</span>(l_1_1 == l_3_1 &amp;&amp; l_1_2 == l_3_2 &amp;&amp; r_1_4 == r_3_4 &amp;&amp; r_1_5 == r_3_5 &amp;&amp; l_1_1 == l_4_1 &amp;&amp; l_1_2 == l_4_2 &amp;&amp; r_1_4 == r_4_4 &amp;&amp; r_1_5 == r_4_5)
                   l_1_1_t = l_1_1
                   l_1_2_t = l_1_2
                   r_1_4_t = r_1_4
                   r_1_5_t = r_1_5
                   l_2_1_t = 0
                   l_2_2_t = 0
                   r_2_4_t = 0
                   r_2_5_t = 0
                   l_3_1_t = l_3_1
                   l_3_2_t = l_3_2
                   r_3_4_t = r_3_4
                   r_3_5_t = r_3_5
                   l_4_1_t = l_4_1
                   l_4_2_t = l_4_2
                   r_4_4_t = r_4_4
                   r_4_5_t = r_4_5
                   l_1_1 = 0
                   l_1_2 = 0
                   r_1_4 = 0
                   r_1_5 = 0
                   l_3_1 = 0
                   l_3_2 = 0
                   r_3_4 = 0
                   r_3_5 = 0
                   l_4_1 = 0
                   l_4_2 = 0
                   r_4_4 = 0
                   r_4_5 = 0
                   t=1


               <span class="keyword">else</span>
                   l_1_1_t = 0
                   l_1_2_t = 0
                   r_1_4_t = 0
                   r_1_5_t = 0
                   l_3_1_t = 0
                   l_3_2_t = 0
                   r_3_4_t = 0
                   r_3_5_t = 0
                   l_4_1_t = 0
                   l_4_2_t = 0
                   r_4_4_t = 0
                   r_4_5_t = 0
                   t = 0


               <span class="keyword">end</span>
               <span class="keyword">end</span>

               <span class="comment">% 2,3,4 Triplet</span>
               <span class="keyword">if</span>(t==1)

               <span class="keyword">else</span>
               <span class="keyword">if</span>(l_3_1 == l_2_1 &amp;&amp; l_3_2 == l_2_2 &amp;&amp; r_3_4 == r_2_4 &amp;&amp; r_3_5 == r_2_5 &amp;&amp; l_4_1 == l_2_1 &amp;&amp; l_4_2 == l_2_2 &amp;&amp; r_4_4 == r_2_4 &amp;&amp; r_4_5 == r_2_5)

                   l_1_1_t = 0
                   l_1_2_t = 0
                   r_1_4_t = 0
                   r_1_5_t = 0
                   l_2_1_t = l_2_1
                   l_2_2_t = l_2_2
                   r_2_4_t = r_2_4
                   r_2_5_t = r_2_5
                   l_3_1_t = l_3_1
                   l_3_2_t = l_3_2
                   r_3_4_t = r_3_4
                   r_3_5_t = r_3_5
                   l_4_1_t = l_4_1
                   l_4_2_t = l_4_2
                   r_4_4_t = r_4_4
                   r_4_5_t = r_4_5
                   l_2_1 = 0
                   l_2_2 = 0
                   r_2_4 = 0
                   r_2_5 = 0
                   l_3_1 = 0
                   l_3_2 = 0
                   r_3_4 = 0
                   r_3_5 = 0
                   l_4_1 = 0
                   l_4_2 = 0
                   r_4_4 = 0
                   r_4_5 = 0


               <span class="keyword">else</span>
                   l_2_1_t = 0
                   l_2_2_t = 0
                   r_2_4_t = 0
                   r_2_5_t = 0
                   l_3_1_t = 0
                   l_3_2_t = 0
                   r_3_4_t = 0
                   r_3_5_t = 0
                   l_4_1_t = 0
                   l_4_2_t = 0
                   r_4_4_t = 0
                   r_4_5_t = 0

               <span class="keyword">end</span>
               <span class="keyword">end</span>
               <span class="comment">% Check for doublets</span>

               <span class="comment">% Same position of 1,2</span>

               <span class="keyword">if</span>(l_1_1 == l_2_1 &amp;&amp; l_1_2 == l_2_2 &amp;&amp; r_1_4 == r_2_4 &amp;&amp; r_1_5 == r_2_5)

                   l_1_1_d12 = l_1_1
                   l_1_2_d12 = l_1_2
                   r_1_4_d12 = r_1_4
                   r_1_5_d12 = r_1_5
                   l_2_1_d12 = l_2_1
                   l_2_2_d12 = l_2_2
                   r_2_4_d12 = r_2_4
                   r_2_5_d12 = r_2_5
                   l_1_1 = 0
                   l_1_2 = 0
                   r_1_4 = 0
                   r_1_5 = 0
                   l_2_1 = 0
                   l_2_2 = 0
                   r_2_4 = 0
                   r_2_5 = 0

               <span class="keyword">else</span>
                   l_1_1_d12 = 0
                   l_1_2_d12 = 0
                   r_1_4_d12 = 0
                   r_1_5_d12 = 0
                   l_2_1_d12 = 0
                   l_2_2_d12 = 0
                   r_2_4_d12 = 0
                   r_2_5_d12 = 0

               <span class="keyword">end</span>

               <span class="comment">% Same position of 1,3</span>

               <span class="keyword">if</span>(l_1_1 == l_3_1 &amp;&amp; l_1_2 == l_3_2 &amp;&amp; r_1_4 == r_3_4 &amp;&amp; r_1_5 == r_3_5)

                   l_1_1_d13 = l_1_1
                   l_1_2_d13 = l_1_2
                   r_1_4_d13 = r_1_4
                   r_1_5_d13 = r_1_5
                   l_3_1_d13 = l_2_1
                   l_3_2_d13 = l_2_2
                   r_3_4_d13 = r_2_4
                   r_3_5_d13 = r_2_5
                   l_1_1 = 0
                   l_1_2 = 0
                   r_1_4 = 0
                   r_1_5 = 0
                   l_3_1 = 0
                   l_3_2 = 0
                   r_3_4 = 0
                   r_3_5 = 0

               <span class="keyword">else</span>
                   l_1_1_d13 = 0
                   l_1_2_d13 = 0
                   r_1_4_d13 = 0
                   r_1_5_d13 = 0
                   l_3_1_d13 = 0
                   l_3_2_d13 = 0
                   r_3_4_d13 = 0
                   r_3_5_d13 = 0

               <span class="keyword">end</span>

               <span class="comment">% Same position of 1,4</span>

               <span class="keyword">if</span>(l_1_1 == l_4_1 &amp;&amp; l_1_2 == l_4_2 &amp;&amp; r_1_4 == r_4_4 &amp;&amp; r_1_5 == r_4_5)

                   l_1_1_d14 = l_1_1
                   l_1_2_d14 = l_1_2
                   r_1_4_d14 = r_1_4
                   r_1_5_d14 = r_1_5
                   l_4_1_d14 = l_2_1
                   l_4_2_d14 = l_2_2
                   r_4_4_d14 = r_2_4
                   r_4_5_d14 = r_2_5
                   l_1_1 = 0
                   l_1_2 = 0
                   r_1_4 = 0
                   r_1_5 = 0
                   l_4_1 = 0
                   l_4_2 = 0
                   r_4_4 = 0
                   r_4_5 = 0

               <span class="keyword">else</span>
                   l_1_1_d14 = 0
                   l_1_2_d14 = 0
                   r_1_4_d14 = 0
                   r_1_5_d14 = 0
                   l_4_1_d14 = 0
                   l_4_2_d14 = 0
                   r_4_4_d14 = 0
                   r_4_5_d14 = 0

              <span class="keyword">end</span>


              <span class="comment">% Same position of 2,3</span>


               <span class="keyword">if</span>(l_2_1 == l_3_1 &amp;&amp; l_2_2 == l_3_2 &amp;&amp; r_2_4 == r_3_4 &amp;&amp; r_2_5 == r_3_5)
                   B = 1
                   l_2_1_d23 = l_2_1
                   l_2_2_d23 = l_2_2
                   r_2_4_d23 = r_2_4
                   r_2_5_d23 = r_2_5
                   l_3_1_d23 = l_3_1
                   l_3_2_d23 = l_3_2
                   r_3_4_d23 = r_3_4
                   r_3_5_d23 = r_3_5
                   l_2_1 = 0
                   l_2_2 = 0
                   r_2_4 = 0
                   r_2_5 = 0
                   l_3_1 = 0
                   l_3_2 = 0
                   r_3_4 = 0
                   r_3_5 = 0

               <span class="keyword">else</span>
                   l_2_1_d23 = 0
                   l_2_2_d23 = 0
                   r_2_4_d23 = 0
                   r_2_5_d23 = 0
                   l_3_1_d23 = 0
                   l_3_2_d23 = 0
                   r_3_4_d23 = 0
                   r_3_5_d23 = 0

               <span class="keyword">end</span>

               <span class="comment">% Same position of 2,4</span>


               <span class="keyword">if</span>(l_2_1 == l_4_1 &amp;&amp; l_2_2 == l_4_2 &amp;&amp; r_2_4 == r_4_4 &amp;&amp; r_2_5 == r_4_5)
                   B = 1
                   l_2_1_d24 = l_2_1
                   l_2_2_d24 = l_2_2
                   r_2_4_d24 = r_2_4
                   r_2_5_d24 = r_2_5
                   l_4_1_d24 = l_3_1
                   l_4_2_d24 = l_3_2
                   r_4_4_d24 = r_3_4
                   r_4_5_d24 = r_3_5
                   l_2_1 = 0
                   l_2_2 = 0
                   r_2_4 = 0
                   r_2_5 = 0
                   l_4_1 = 0
                   l_4_2 = 0
                   r_4_4 = 0
                   r_4_5 = 0

               <span class="keyword">else</span>
                   l_2_1_d24 = 0
                   l_2_2_d24 = 0
                   r_2_4_d24 = 0
                   r_2_5_d24 = 0
                   l_4_1_d24 = 0
                   l_4_2_d24 = 0
                   r_4_4_d24 = 0
                   r_4_5_d24 = 0

               <span class="keyword">end</span>
               <span class="comment">% Same position of 3,4</span>


               <span class="keyword">if</span>(l_4_1 == l_3_1 &amp;&amp; l_4_2 == l_3_2 &amp;&amp; r_4_4 == r_3_4 &amp;&amp; r_4_5 == r_3_5)
                   B = 1
                   l_3_1_d34 = l_3_1
                   l_3_2_d34 = l_3_2
                   r_3_4_d34 = r_3_4
                   r_3_5_d34 = r_3_5
                   l_4_1_d34 = l_4_1
                   l_4_2_d34 = l_4_2
                   r_4_4_d34 = r_4_4
                   r_4_5_d34 = r_4_5
                   l_3_1 = 0
                   l_3_2 = 0
                   r_3_4 = 0
                   r_3_5 = 0
                   l_4_1 = 0
                   l_4_2 = 0
                   r_4_4 = 0
                   r_4_5 = 0

               <span class="keyword">else</span>
                   l_3_1_d34 = 0
                   l_3_2_d34 = 0
                   r_3_4_d34 = 0
                   r_3_5_d34 = 0
                   l_4_1_d34 = 0
                   l_4_2_d34 = 0
                   r_4_4_d34 = 0
                   r_4_5_d34 = 0

               <span class="keyword">end</span>

               <span class="comment">% Sphere 1 with smallest value of x_centroid</span>

               <span class="comment">% Go through potential positions</span>
               <span class="comment">% Case 1: Sphere is no center sphere and is located at the</span>
               <span class="comment">% upper left</span>
               <span class="keyword">if</span>(l_1_1 &gt;0 &amp;&amp; l_1_1 &lt; 2);
                       <span class="comment">% Coordinates to cut out sphere 1</span>
                       x_1 = 1;
                       x_2 = x_centroid(1) + d_1_c;
                       y_1 = 1;
                       y_2 = y_centroid(1) + d_1_c;
               <span class="keyword">else</span>
               <span class="keyword">end</span>
               <span class="comment">% Case 2: Sphere is no center sphere and is located at the</span>
               <span class="comment">% lower left</span>
               <span class="keyword">if</span>(l_1_2 &gt;0 &amp;&amp; l_1_2 &lt; 2);
                       <span class="comment">% Coordinates to cut out sphere 1</span>
                       x_1 = 1;
                       x_2 = x_centroid(1) + d_1_c;
                       y_1 = y_centroid(1) - d_1_c;
                       y_2 = 13824;
               <span class="keyword">else</span>
               <span class="keyword">end</span>
               <span class="comment">% Case 3: Sphere is no center sphere and is located at the</span>
               <span class="comment">% upper right</span>
               <span class="keyword">if</span>(r_1_4 &gt;0 &amp;&amp; r_1_4 &lt; 2);
                       <span class="comment">% Coordinates to cut out sphere 1</span>
                       x_1 = x_centroid(1) - d_1_c;
                       x_2 = 10752;
                       y_1 = 1;
                       y_2 = y_centroid(1) + d_1_c;
               <span class="keyword">else</span>
               <span class="keyword">end</span>
               <span class="comment">% Case 4: Sphere is no center sphere and is located at the</span>
               <span class="comment">% lower right</span>
               <span class="keyword">if</span>(r_1_5 &gt;0 &amp;&amp; r_1_5 &lt; 2);
                       <span class="comment">% Coordinates to cut out sphere 1</span>
                       x_1 = x_centroid(1) - d_1_c;
                       x_2 = 10752;
                       y_1 = y_centroid(1) - d_1_c;
                       y_2 = 13824;
               <span class="keyword">else</span>
               <span class="keyword">end</span>

               <span class="comment">% Going through all iterations for the case sphere 1 =</span>
               <span class="comment">% center sphere</span>
               <span class="keyword">if</span>(x_centroid(1) ~= x_centroid_c);
               <span class="keyword">else</span>
                   <span class="comment">% Case 1: sphere 2, 3, 4 are located left of sphere 1</span>
                   <span class="keyword">if</span>(x_centroid(2) &lt; x_centroid(1) &amp;&amp; x_centroid(3) &lt; x_centroid(1) &amp;&amp; x_centroid(4) &lt; x_centroid(1));
                       <span class="comment">% Find shortest distance to sphere 1 to sphere 2,3</span>
                       <span class="comment">% and 3 to a maximum of 7168/2. Since sphere 2, 3</span>
                       <span class="comment">% and 4 are located left of sphere 1, distance is just</span>
                       <span class="comment">% limited to the left and not to the right</span>
                       V_1m = [d1_2 ; d1_3 ; d1_4 ; (7168/2)];
                       min1m = min(V_1m);
                       <span class="comment">% Maximal added distance to the right to obtain</span>
                       <span class="comment">% maximal images of 7168x7168 pixel</span>
                       min1p = (7168-min1m);
                   <span class="keyword">else</span>
                   <span class="keyword">end</span>
                   <span class="comment">% Case 2: sphere 2, 3 and 4 are located right of sphere 1</span>
                   <span class="keyword">if</span>(x_centroid(2) &gt; x_centroid(1) &amp;&amp; x_centroid(3) &gt; x_centroid(1) &amp;&amp; x_centroid(4) &gt; x_centroid(1));
                       <span class="comment">% Find shortest distance to sphere 1 to sphere 2, 3 and</span>
                       <span class="comment">% 4 to a maximum of 7168/2. Since sphere 2, 3</span>
                       <span class="comment">% and 4 are located right of sphere 1, distance is just</span>
                       <span class="comment">% limited to the right and not to the left</span>
                       V_1p = [d1_2 ; d1_3 ; d1_4 (7168/2)];
                       min1p = min(V_1p);
                       <span class="comment">% Maximal added distance to the left to obtain</span>
                       <span class="comment">% maximal images of 7168x7168 pixel</span>
                       min1m = (7168-min1p);
                   <span class="keyword">else</span>
                   <span class="keyword">end</span>
                   <span class="comment">% Case 3: sphere 2 and 3 are located left of sphere 1 and 4 is located right of sphere 1</span>
                   <span class="keyword">if</span>(x_centroid(2) &lt; x_centroid(1) &amp;&amp; x_centroid(3) &lt; x_centroid(1) &amp;&amp; x_centroid(4) &gt; x_centroid(1));
                       <span class="comment">% Find minimal distance to the left and to the right. To the left</span>
                       <span class="comment">% only the distance between sphere 1 and 2 and 1 and 3 and to</span>
                       <span class="comment">% the right only the distance of sphere 1 and 4</span>
                       <span class="comment">% matter.</span>
                       V_1m = [d1_2 ; d1_3 ; (7168/2)];
                       V_1p = [d1_4 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   <span class="keyword">else</span>
                   <span class="keyword">end</span>
                   <span class="comment">% Case 4: sphere 2 and 4 are located left of sphere 1 and 3 is located right of sphere 1</span>
                   <span class="keyword">if</span>(x_centroid(2) &lt; x_centroid(1) &amp;&amp; x_centroid(3) &gt; x_centroid(1) &amp;&amp; x_centroid(4) &lt; x_centroid(1));
                       <span class="comment">% Find minimal distance to the left and to the right. To the left</span>
                       <span class="comment">% only the distance between sphere 1 and 2 and 1 and 4 and to</span>
                       <span class="comment">% the right only the distance of sphere 1 and 4</span>
                       <span class="comment">% matter.</span>
                       V_1m = [d1_2 ; d1_4 ; (7168/2)];
                       V_1p = [d1_3 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   <span class="keyword">else</span>
                   <span class="keyword">end</span>
                   <span class="comment">% Case 5: sphere 3 and 4 are located left of sphere 1 and 2 is located right of sphere 1</span>
                   <span class="keyword">if</span>(x_centroid(2) &gt; x_centroid(1) &amp;&amp; x_centroid(3) &lt; x_centroid(1) &amp;&amp; x_centroid(4) &lt; x_centroid(1));
                       <span class="comment">% Find minimal distance to the left and to the right. To the left</span>
                       <span class="comment">% only the distance between sphere 1 and 3 and 1 and 4 and to</span>
                       <span class="comment">% the right only the distance of sphere 1 and 2</span>
                       <span class="comment">% matter.</span>
                       V_1m = [d1_3 ; d1_4 ; (7168/2)];
                       V_1p = [d1_2 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   <span class="keyword">else</span>
                   <span class="keyword">end</span>
                   <span class="comment">% Case 6: sphere 2 is located left of sphere 1 and 3 and 4 are located right of sphere 1</span>
                   <span class="keyword">if</span>(x_centroid(2) &lt; x_centroid(1) &amp;&amp; x_centroid(3) &gt; x_centroid(1) &amp;&amp; x_centroid(4) &gt; x_centroid(1));
                       <span class="comment">% Find minimal distance to the left and to the right. To the left</span>
                       <span class="comment">% only the distance between sphere 1 and 2 and to</span>
                       <span class="comment">% the right only the distance of sphere 1 and 3 and</span>
                       <span class="comment">% 1 and 4 matter.</span>
                       V_1m = [d1_2 ; (7168/2)];
                       V_1p = [d1_3 ; d1_4 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   <span class="keyword">else</span>
                   <span class="keyword">end</span>
                   <span class="comment">% Case 7: sphere 4 is located left of sphere 1 and 2 and 3 are located right of sphere 1</span>
                   <span class="keyword">if</span>(x_centroid(2) &gt; x_centroid(1) &amp;&amp; x_centroid(3) &gt; x_centroid(1) &amp;&amp; x_centroid(4) &lt; x_centroid(1));
                       <span class="comment">% Find minimal distance to the left and to the right. To the left</span>
                       <span class="comment">% only the distance between sphere 1 and 4 and to</span>
                       <span class="comment">% the right only the distance of sphere 1 and 2 and</span>
                       <span class="comment">% 1 and 3 matter.</span>
                       V_1m = [d1_4 ; (7168/2)];
                       V_1p = [d1_2 ; d1_3 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   <span class="keyword">else</span>
                   <span class="keyword">end</span>
                   <span class="comment">% Case 8: sphere 3 is located left of sphere 1 and 2 and 4 are located right of sphere 1</span>
                   <span class="keyword">if</span>(x_centroid(2) &gt; x_centroid(1) &amp;&amp; x_centroid(3) &lt; x_centroid(1) &amp;&amp; x_centroid(4) &gt; x_centroid(1));
                       <span class="comment">% Find minimal distance to the left and to the right. To the left</span>
                       <span class="comment">% only the distance between sphere 1 and 3 and to</span>
                       <span class="comment">% the right only the distance of sphere 1 and 2 and</span>
                       <span class="comment">% 1 and 4 matter.</span>
                       V_1m = [d1_3 ; (7168/2)];
                       V_1p = [d1_2 ; d1_4 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   <span class="keyword">else</span>
                   <span class="keyword">end</span>

                   <span class="comment">% Coordinates to cut out sphere 1</span>
                   x_1 = x_centroid(1) - min1m
                   x_2 = x_centroid(1) + min1p
                   y_1 = y_centroid(1) - min1m
                   y_2 = y_centroid(1) + min1p


               <span class="keyword">end</span>
               <span class="comment">% Case for all four spheres in the same spot</span>

                   <span class="keyword">if</span>(l_1_1_q == 1)
                       Vdq_x = [d1_2 ; d1_3 ; d1_4 ; 7168/2]
                       Vdq_y_m = [d1_2 ; d1_3 ; d1_4 ; 7168/2 ; (y_centroid(1)-1)]
                       Vdq_y_p = [d1_2 ; d1_3 ; d1_4 ; 7168/2 ]
                       miny_m = min(Vdq_y_m(1:5))
                       miny_p = min(Vdq_y_m(1:4))
                       minx = min(Vdq_x(1:4))
                       x_1 = 1
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(l_1_2_q == 1)
                       Vdq_x = [d1_2 ; d1_3 ; d1_4 ; 7168/2]
                       Vdq_y_m = [d1_2 ; d1_3 ; d1_4 ; 7168/2]
                       Vdq_y_p = [d1_2 ; d1_3 ; d1_4 ; 7168/2 ; (13824 - y_centroid(1))]
                       miny_m = min(Vdq_y_m(1:4))
                       miny_p = min(Vdq_y_p(1:5))
                       minx = min(Vdq_x(1:4))
                       x_1 = 1
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_1_4_q == 1)
                       Vdq_x = [d1_2 ; d1_3 ; d1_4 ; 7168/2]
                       Vdq_y_m = [d1_2 ; d1_3 ; d1_4 ; 7168/2 ; (y_centroid(1)-1)]
                       Vdq_y_p = [d1_2 ; d1_3 ; d1_4 ; 7168/2 ]
                       miny_m = min(Vdq_y_m(1:5))
                       miny_p = min(Vdq_y_p(1:4))
                       minx = min(Vdq_x(1:4))
                       x_1 = x_centroid(1) - (7168 - minx)
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_1_5_q == 1)
                       Vdq_x = [d1_2 ; d1_3 ; d1_4 ; 7168/2]
                        Vdq_y_m = [d1_2 ; d1_3 ; d1_4 ; 7168/2]
                       Vdq_y_p = [d1_2 ; d1_3 ; d1_4 ; 7168/2 ; (13824 - y_centroid(1))]
                       miny_m = min(Vdq_y_m(1:4))
                       miny_p = min(Vdq_y_p(1:5))
                       minx = min(Vdq_x(1:4))
                       x_1 = x_centroid(1) - (7168 - minx)
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   <span class="keyword">end</span>

                   <span class="comment">% Case for 1,2,3 at the same position</span>
                   <span class="keyword">if</span>(l_1_1_t == 1)
                       Vdt_x = [d1_2 ; d1_3 ; 7168/2]
                       Vdt_y_m = [d1_2 ; d1_3  ; 7168/2 ; (y_centroid(1)-1)]
                       Vdt_y_p = [d1_2 ; d1_3  ; 7168/2 ]
                       miny_m = min(Vdt_y_m(1:4))
                       miny_p = min(Vdt_y_m(1:3))
                       minx = min(Vdt_x(1:3))
                       x_1 = 1
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(l_1_2_t == 1)
                       Vdt_x = [d1_2 ; d1_3 ;  7168/2]
                       Vdt_y_m = [d1_2 ; d1_3 ;  7168/2]
                       Vdt_y_p = [d1_2 ; d1_3 ;  7168/2 ; (13824 - y_centroid(1))]
                       miny_m = min(Vdt_y_m(1:3))
                       miny_p = min(Vdt_y_p(1:4))
                       minx = min(Vdt_x(1:3))
                       x_1 = 1
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_1_4_t == 1)
                       Vdt_x = [d1_2 ; d1_3 ;  7168/2]
                       Vdt_y_m = [d1_2 ; d1_3 ;  7168/2 ; (y_centroid(1)-1)]
                       Vdt_y_p = [d1_2 ; d1_3 ;  7168/2 ]
                       miny_m = min(Vdt_y_m(1:4))
                       miny_p = min(Vdt_y_p(1:3))
                       minx = min(Vdt_x(1:3))
                       x_1 = x_centroid(1) - (7168 - minx)
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_1_5_t == 1)
                       Vdt_x = [d1_2 ; d1_3 ;  7168/2]
                        Vdt_y_m = [d1_2 ; d1_3 ;  7168/2]
                       Vdt_y_p = [d1_2 ; d1_3 ;  7168/2 ; (13824 - y_centroid(1))]
                       miny_m = min(Vdt_y_m(1:3))
                       miny_p = min(Vdt_y_p(1:4))
                       minx = min(Vdt_x(1:3))
                       x_1 = x_centroid(1) - (7168 - minx)
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   <span class="keyword">end</span>


                   <span class="comment">% Case fox 1,2 are the same quadrant</span>

                   <span class="keyword">if</span>(l_1_1_d12 == 1)
                       Vdd_x = [d1_2 ; 7168/2]
                       Vdd_y_m = [d1_2; 7168/2 ; (y_centroid(1)-1)]
                       Vdd_y_p = [d1_2 7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_m(1:2))
                       minx = min(Vdd_x(1:2))
                       x_1 = 1
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(l_1_2_d12 == 1)
                       Vdd_x = [d1_2 ; 7168/2]
                       Vdd_y_m = [d1_2  ;  7168/2]
                       Vdd_y_p = [d1_2;  7168/2 ; (13824 - y_centroid(1))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_1 = 1
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_1_4_d12 == 1)
                       Vdd_x = [d1_2;   7168/2]
                       Vdd_y_m = [d1_2;   7168/2 ; (y_centroid(1)-1)]
                       Vdd_y_p = [d1_2;   7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_p(1:2))
                       minx = min(Vdd_x(1:2))
                       x_1 = x_centroid(1) - (7168 - minx)
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_1_5_d12 == 1)
                       Vdd_x = [d1_2;  7168/2]
                        Vdd_y_m = [d1_2;  7168/2]
                       Vdd_y_p = [d1_2;   7168/2 ; (13824 - y_centroid(1))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdt_x(1:2))
                       x_1 = x_centroid(1) - (7168 - minx)
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   <span class="keyword">end</span>

                <span class="comment">% Case fox 1,3 are the same quadrant</span>

                   <span class="keyword">if</span>(l_1_1_d13 == 1)
                       Vdd_x = [d1_3 ; 7168/2]
                       Vdd_y_m = [d1_3; 7168/2 ; (y_centroid(1)-1)]
                       Vdd_y_p = [d1_3 7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_m(1:2))
                       minx = min(Vdd_x(1:2))
                       x_1 = 1
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(l_1_2_d13 == 1)
                       Vdd_x = [d1_3 ; 7168/2]
                       Vdd_y_m = [d1_3  ;  7168/2]
                       Vdd_y_p = [d1_3;  7168/2 ; (13824 - y_centroid(1))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_1 = 1
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_1_4_d13 == 1)
                       Vdd_x = [d1_3;   7168/2]
                       Vdd_y_m = [d1_3;   7168/2 ; (y_centroid(1)-1)]
                       Vdd_y_p = [d1_3;   7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_p(1:2))
                       minx = min(Vdd_x(1:2))
                       x_1 = x_centroid(1) - (7168 - minx)
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_1_5_d13 == 1)
                       Vdd_x = [d1_3;  7168/2]
                        Vdd_y_m = [d1_3;  7168/2]
                       Vdd_y_p = [d1_3;   7168/2 ; (13824 - y_centroid(1))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdt_x(1:2))
                       x_1 = x_centroid(1) - (7168 - minx)
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   <span class="keyword">end</span>
                  <span class="comment">% Case fox 1,4 are the same quadrant</span>

                   <span class="keyword">if</span>(l_1_1_d14 == 1)
                       Vdd_x = [d1_4 ; 7168/2]
                       Vdd_y_m = [d1_4; 7168/2 ; (y_centroid(1)-1)]
                       Vdd_y_p = [d1_4 7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_m(1:2))
                       minx = min(Vdd_x(1:2))
                       x_1 = 1
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(l_1_2_d14 == 1)
                       Vdd_x = [d1_4 ; 7168/2]
                       Vdd_y_m = [d1_4  ;  7168/2]
                       Vdd_y_p = [d1_4;  7168/2 ; (13824 - y_centroid(1))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_1 = 1
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_1_4_d14 == 1)
                       Vdd_x = [d1_4;   7168/2]
                       Vdd_y_m = [d1_4;   7168/2 ; (y_centroid(1)-1)]
                       Vdd_y_p = [d1_4;   7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_p(1:2))
                       minx = min(Vdd_x(1:2))
                       x_1 = x_centroid(1) - (7168 - minx)
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_1_5_d14 == 1)
                       Vdd_x = [d1_4;  7168/2]
                        Vdd_y_m = [d1_4;  7168/2]
                       Vdd_y_p = [d1_4;   7168/2 ; (13824 - y_centroid(1))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdt_x(1:2))
                       x_1 = x_centroid(1) - (7168 - minx)
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   <span class="keyword">end</span>


                <span class="keyword">if</span>(x_1 &lt; 1)
                    x_1 = 1
                <span class="keyword">end</span>

                <span class="keyword">if</span>(x_2 &gt; 10752)
                    x_2 = 10752
                <span class="keyword">end</span>

                <span class="keyword">if</span>(y_1 &lt; 1)
                    y_1 = 1
                <span class="keyword">end</span>
                <span class="keyword">if</span>(y_2 &lt; 1)
                    y_2 = 1
                <span class="keyword">end</span>
                <span class="comment">%The rectangular image is cutted from the imgnucleus image containing the whole cover slip</span>
               imagesphere1 = imgnucleus(y_1:y_2,x_1:x_2);
               <span class="comment">% Dimensions of imagesphere1 are determined</span>
               [r1 c1] = size(imagesphere1);
               <span class="comment">% An empty matrix is generated</span>
               imagesphereresize1 = zeros(7168:7168);
               <span class="comment">% imagesphereresize1 is converted to 8-bit</span>
               imagesphereresize1 = uint8(imagesphereresize1);
               <span class="comment">%The empty indices in the imagesphereresize1 matrix are overwritten with imagesphere 1 entries</span>
               imagesphereresize1(1:r1,1:c1)=imagesphere1;
               <span class="comment">% imagesphereresize1 is saved to final destination</span>
               newFile1 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'01NucleusBig'</span>],<span class="string">'ignorecase'</span>);
               imwrite(imagesphereresize1,[foldername1 <span class="string">'/'</span> newFile1]);
               clear <span class="string">imagesphereresize1</span>;
               clear <span class="string">imagesphere1</span>;


               <span class="comment">% Sphere 2 with smallest value of x_centroid</span>

               <span class="keyword">if</span>(l_2_1 &gt;0 &amp;&amp; l_2_1 &lt; 2);
                       x_3 = 1;
                       x_4 = x_centroid(2) + d_2_c;
                       y_3 = 1;
                       y_4 = y_centroid(2) + d_2_c;
               <span class="keyword">else</span>
               <span class="keyword">end</span>

               <span class="keyword">if</span>(l_2_2 &gt;0 &amp;&amp; l_2_2 &lt; 2);
                       x_3 = 1;
                       x_4 = x_centroid(2) + d_2_c;
                       y_3 = y_centroid(2) - d_2_c;
                       y_4 = 13824;
               <span class="keyword">else</span>
               <span class="keyword">end</span>

               <span class="keyword">if</span>(r_2_4 &gt;0 &amp;&amp; r_2_4 &lt; 2);
                       x_3 = x_centroid(2) - d_2_c;
                       x_4 = 10752;
                       y_3 = 1;
                       y_4 = y_centroid(2) + d_2_c;
               <span class="keyword">else</span>
               <span class="keyword">end</span>

               <span class="keyword">if</span>(r_2_5 &gt;0 &amp;&amp; r_2_5 &lt; 2);
                       x_3 = x_centroid(2) - d_2_c;
                       x_4 = 10752;
                       y_3 = y_centroid(2) - d_2_c;
                       y_4 = 13824;
               <span class="keyword">else</span>
               <span class="keyword">end</span>

               <span class="comment">% Going over all possible distributions of sphere cores</span>
               <span class="keyword">if</span>(x_centroid(2) ~= x_centroid_c);
               <span class="keyword">else</span>
                   <span class="comment">% 1st permutation</span>
                   <span class="keyword">if</span>(x_centroid(1) &lt; x_centroid(2) &amp;&amp; x_centroid(3) &lt; x_centroid(2) &amp;&amp; x_centroid(4) &lt; x_centroid(2));
                       V_1m = [d1_2 ; d2_3 ; d2_4 ; (7168/2)];
                       min1m = min(V_1m);
                       min1p = (7168-min1m);
                   <span class="keyword">else</span>
                   <span class="keyword">end</span>
                   <span class="comment">% 2nd permutation</span>
                   <span class="keyword">if</span>(x_centroid(1) &gt; x_centroid(2) &amp;&amp; x_centroid(3) &gt; x_centroid(2) &amp;&amp; x_centroid(4) &gt; x_centroid(2));
                       V_1p = [d1_2 ; d2_3 ; d2_4 (7168/2)];
                       min1p = min(V_1p);
                       min1m = (7168-min1p);
                   <span class="keyword">else</span>
                   <span class="keyword">end</span>
                   <span class="comment">%3rd permutation</span>
                   <span class="keyword">if</span>(x_centroid(1) &lt; x_centroid(2) &amp;&amp; x_centroid(3) &lt; x_centroid(2) &amp;&amp; x_centroid(4) &gt; x_centroid(2));
                       V_1m = [d1_2 ; d2_3 ; (7168/2)];
                       V_1p = [d2_4 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);

                   <span class="keyword">else</span>

                   <span class="keyword">end</span>
                   <span class="comment">%4th permutation</span>
                   <span class="keyword">if</span>(x_centroid(1) &lt; x_centroid(2) &amp;&amp; x_centroid(3) &gt; x_centroid(2) &amp;&amp; x_centroid(4) &lt; x_centroid(2));
                       V_1m = [d1_2 ; d2_4 ; (7168/2)];
                       V_1p = [d2_3 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   <span class="keyword">else</span>
                   <span class="keyword">end</span>
                   <span class="comment">%5th permutation</span>
                   <span class="keyword">if</span>(x_centroid(1) &gt; x_centroid(2) &amp;&amp; x_centroid(3) &lt; x_centroid(2) &amp;&amp; x_centroid(4) &lt; x_centroid(2));
                       V_1m = [d2_3 ; d2_4 ; (7168/2)];
                       V_1p = [d1_2 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   <span class="keyword">else</span>
                   <span class="keyword">end</span>
                   <span class="comment">%6th permutation</span>
                   <span class="keyword">if</span>(x_centroid(1) &lt; x_centroid(2) &amp;&amp; x_centroid(3) &gt; x_centroid(2) &amp;&amp; x_centroid(4) &gt; x_centroid(2));
                       V_1m = [d1_2 ; (7168/2)];
                       V_1p = [d2_3 ; d2_4 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   <span class="keyword">else</span>
                   <span class="keyword">end</span>
                   <span class="comment">%7th permutation</span>
                   <span class="keyword">if</span>(x_centroid(1) &gt; x_centroid(2) &amp;&amp; x_centroid(3) &gt; x_centroid(2) &amp;&amp; x_centroid(4) &lt; x_centroid(2));
                       V_1m = [d2_4 ; (7168/2)];
                       V_1p = [d1_2 ; d2_3 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   <span class="keyword">else</span>
                   <span class="keyword">end</span>
                   <span class="comment">%8th permutation</span>
                   <span class="keyword">if</span>(x_centroid(1) &gt; x_centroid(2) &amp;&amp; x_centroid(3) &lt; x_centroid(2) &amp;&amp; x_centroid(4) &gt; x_centroid(2));
                       V_1m = [d2_3 ; (7168/2)];
                       V_1p = [d1_2 ; d2_4 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   <span class="keyword">else</span>
                   <span class="keyword">end</span>
                   x_3 = x_centroid(2) - min1m
                   x_4 = x_centroid(2) + min1p
                   y_3 = y_centroid(2) - min1m
                   y_4 = y_centroid(2) + min1p






               <span class="keyword">end</span>

               <span class="comment">% Case for all four spheres in the same spot</span>

                   <span class="keyword">if</span>(l_2_1_q == 1)
                       Vdq_x = [d1_2 ; d2_3 ; d2_4 ; 7168/2]
                       Vdq_y_m = [d1_2 ; d2_3 ; d2_4 ; 7168/2 ; (y_centroid(2)-1)]
                       Vdq_y_p = [d1_2 ; d2_3 ; d2_4 ; 7168/2 ]
                       miny_m = min(Vdq_y_m(1:5))
                       miny_p = min(Vdq_y_p(1:4))
                       minx = min(Vdq_x(1:4))
                       x_3 = x_centroid(2) - minx
                       x_4 = x_centroid(2) + minx
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(l_2_2_q == 1)
                       Vdq_x = [d1_2 ; d2_3 ; d2_4 ; 7168/2]
                       Vdq_y_m = [d1_2 ; d2_3 ; d2_4 ; 7168/2]
                       Vdq_y_p = [d1_2 ; d2_3 ; d2_4 ; 7168/2 ; (13824 - y_centroid(2))]
                       miny_m = min(Vdq_y_m(1:4))
                       miny_p = min(Vdq_y_p(1:5))
                       minx = min(Vdq_x(1:4))
                       x_3 = x_centroid(2) - minx
                       x_4 = x_centroid(2) + minx
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_2_4_q == 1)
                       Vdq_x = [d1_2 ; d2_3 ; d2_4 ; 7168/2]
                       Vdq_y_m = [d1_2 ; d2_3 ; d2_4 ; 7168/2 ; (y_centroid(2)-1)]
                       Vdq_y_p = [d1_2 ; d2_3 ; d2_4 ; 7168/2 ]
                       miny_m = min(Vdq_y_m(1:5))
                       miny_p = min(Vdq_y_p(1:4))
                       minx = min(Vdq_x(1:4))
                       x_3 = x_centroid(2) - minx
                       x_4 = x_centroid(2) + minx
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_2_5_q == 1)
                       Vdq_x = [d1_2 ; d2_3 ; d2_4 ; 7168/2]
                        Vdq_y_m = [d1_2 ; d2_3 ; d2_4 ; 7168/2]
                       Vdq_y_p = [d1_2 ; d2_3 ; d2_4 ; 7168/2 ; (13824 - y_centroid(2))]
                       miny_m = min(Vdq_y_m(1:4))
                       miny_p = min(Vdq_y_p(1:5))
                       minx = min(Vdq_x(1:4))
                       x_3 = x_centroid(2) - minx
                       x_4 = x_centroid(2) + minx
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   <span class="keyword">end</span>


               <span class="comment">% Case for 1,2,3 at the same position</span>
                   <span class="keyword">if</span>(l_2_1_t == 1)
                       Vdt_x = [d1_2 ; d2_3 ; 7168/2]
                       Vdt_y_m = [d1_2 ; d2_3  ; 7168/2 ; (y_centroid(2)-1)]
                       Vdt_y_p = [d1_2 ; d2_3  ; 7168/2 ]
                       miny_m = min(Vdt_y_m(1:4))
                       miny_p = min(Vdt_y_m(1:3))
                       minx = min(Vdt_x(1:3))
                       x_3 = x_centroid(2) - minx
                       x_4 = x_centroid(2) + minx
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(l_2_2_t == 1)
                       Vdt_x = [d1_2 ; d2_3 ;  7168/2]
                       Vdt_y_m = [d1_2 ; d2_3 ;  7168/2]
                       Vdt_y_p = [d1_2 ; d2_3 ;  7168/2 ; (13824 - y_centroid(2))]
                       miny_m = min(Vdt_y_m(1:3))
                       miny_p = min(Vdt_y_p(1:4))
                       minx = min(Vdt_x(1:3))
                       x_3 = x_centroid(2) - minx
                       x_4 = x_centroid(2) + minx
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_2_4_t == 1)
                       Vdt_x = [d1_2 ; d2_3 ;  7168/2]
                       Vdt_y_m = [d1_2 ; d2_3 ;  7168/2 ; (y_centroid(2)-1)]
                       Vdt_y_p = [d1_2 ; d2_3 ;  7168/2 ]
                       miny_m = min(Vdt_y_m(1:4))
                       miny_p = min(Vdt_y_p(1:3))
                       minx = min(Vdt_x(1:3))
                       x_3 = x_centroid(2) - minx
                       x_4 = x_centroid(2) + minx
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_2_5_t == 1)
                       Vdt_x = [d1_2 ; d2_3 ;  7168/2]
                        Vdt_y_m = [d1_2 ; d2_3 ;  7168/2]
                       Vdt_y_p = [d1_2 ; d2_3 ;  7168/2 ; (13824 - y_centroid(2))]
                       miny_m = min(Vdt_y_m(1:3))
                       miny_p = min(Vdt_y_p(1:4))
                       minx = min(Vdt_x(1:3))
                       x_3 = x_centroid(2) - minx
                       x_4 = x_centroid(2) + minx
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   <span class="keyword">end</span>

                    <span class="comment">% Case for 2,3,4 at the same position</span>
                   <span class="keyword">if</span>(l_2_1_t == 1)
                       Vdt_x = [d2_4 ; d2_3 ; 7168/2]
                       Vdt_y_m = [d2_4 ; d2_3  ; 7168/2 ; (y_centroid(2)-1)]
                       Vdt_y_p = [d2_4 ; d2_3  ; 7168/2 ]
                       miny_m = min(Vdt_y_m(1:4))
                       miny_p = min(Vdt_y_m(1:3))
                       minx = min(Vdt_x(1:3))
                       x_3 = x_centroid(2) - minx
                       x_4 = x_centroid(2) + minx
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(l_2_2_t == 1)
                       Vdt_x = [d2_4 ; d2_3 ;  7168/2]
                       Vdt_y_m = [d2_4 ; d2_3 ;  7168/2]
                       Vdt_y_p = [d2_4 ; d2_3 ;  7168/2 ; (13824 - y_centroid(2))]
                       miny_m = min(Vdt_y_m(1:3))
                       miny_p = min(Vdt_y_p(1:4))
                       minx = min(Vdt_x(1:3))
                       x_3 = x_centroid(2) - minx
                       x_4 = x_centroid(2) + minx
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_2_4_t == 1)
                       Vdt_x = [d2_4 ; d2_3 ;  7168/2]
                       Vdt_y_m = [d2_4 ; d2_3 ;  7168/2 ; (y_centroid(2)-1)]
                       Vdt_y_p = [d2_4 ; d2_3 ;  7168/2 ]
                       miny_m = min(Vdt_y_m(1:4))
                       miny_p = min(Vdt_y_p(1:3))
                       minx = min(Vdt_x(1:3))
                       x_3 = x_centroid(2) - minx
                       x_4 = x_centroid(2) + minx
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_2_5_t == 1)
                       Vdt_x = [d2_4 ; d2_3 ;  7168/2]
                        Vdt_y_m = [d2_4 ; d2_3 ;  7168/2]
                       Vdt_y_p = [d2_4 ; d2_3 ;  7168/2 ; (13824 - y_centroid(2))]
                       miny_m = min(Vdt_y_m(1:3))
                       miny_p = min(Vdt_y_p(1:4))
                       minx = min(Vdt_x(1:3))
                       x_3 = x_centroid(2) - minx
                       x_4 = x_centroid(2) + minx
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   <span class="keyword">end</span>

                <span class="comment">% Case fox 1,2 are the same quadrant</span>

                   <span class="keyword">if</span>(l_2_1_d12 == 1)
                       Vdd_x = [d1_2 ; 7168/2]
                       Vdd_y_m = [d1_2 ; 7168/2 ; (y_centroid(2)-1)]
                       Vdd_y_p = [d1_2 ;  7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_m(1:2))
                       minx = min(Vdd_x(1:2))
                       x_3 = x_centroid(2) - minx
                       x_4 = x_centroid(2) + (7168-minx)
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(l_2_2_d12 == 1)
                       Vdd_x = [d1_2 ;  7168/2]
                       Vdd_y_m = [d1_2  ;  7168/2]
                       Vdd_y_p = [d1_2 ;  7168/2 ; (13824 - y_centroid(2))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_3 = x_centroid(2) - minx
                       x_4 = x_centroid(2) + (7168-minx)
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_2_4_d12 == 1)
                       Vdd_x = [d1_2 ;   7168/2]
                       Vdd_y_m = [d1_2 ;   7168/2 ; (y_centroid(2)-1)]
                       Vdd_y_p = [d1_2 ;   7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_p(1:2))
                       minx = min(Vdd_x(1:2))
                       x_3 = x_centroid(2) - minx
                       x_4 = 10752
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_2_5_d12 == 1)
                       Vdd_x = [d1_2 ;  7168/2]
                        Vdd_y_m = [d1_2 ;  7168/2]
                       Vdd_y_p = [d1_2 ;   7168/2 ; (13824 - y_centroid(2))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdt_x(1:2))
                       x_3 = x_centroid(2) - minx
                       x_4 = 10752
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   <span class="keyword">end</span>

                   <span class="comment">% Case fox 2,3 are the same quadrant</span>


                   <span class="keyword">if</span>(l_2_1_d23 == 1)
                       Vdd_x = [d2_3 ; 7168/2]
                       Vdd_y_m = [d2_3 ; 7168/2 ; (y_centroid(2)-1)]
                       Vdd_y_p = [d2_3 ;  7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_m(1:2))
                       minx = min(Vdd_x(1:2))
                       x_3 = x_centroid(2) - minx
                       x_4 = x_centroid(2) + (7168-minx)
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(l_2_2_d23 == 1)
                       Vdd_x = [d2_3 ;  7168/2]
                       Vdd_y_m = [d2_3  ;  7168/2]
                       Vdd_y_p = [d2_3 ;  7168/2 ; (13824 - y_centroid(2))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_3 = x_centroid(2) - minx
                       x_4 = x_centroid(2) + (7168-minx)
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_2_4_d23 == 1)
                       Vdd_x = [d2_3 ;   7168/2]
                       Vdd_y_m = [d2_3 ;   7168/2 ; (y_centroid(2)-1)]
                       Vdd_y_p = [d2_3 ;   7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_p(1:2))
                       minx = min(Vdd_x(1:2))
                       x_3 = x_centroid(2) - minx
                       x_4 = 10752
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_2_5_d23 == 1)
                       Vdd_x = [d2_3 ;  7168/2]
                        Vdd_y_m = [d2_3 ;  7168/2]
                       Vdd_y_p = [d2_3 ;   7168/2 ; (13824 - y_centroid(2))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_3 = x_centroid(2) - minx
                       x_4 = 10752
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   <span class="keyword">end</span>

                   <span class="comment">% Case fox 2,4 are the same quadrant</span>


                   <span class="keyword">if</span>(l_2_1_d24 == 1)
                       Vdd_x = [d2_4 ; 7168/2]
                       Vdd_y_m = [d2_4 ; 7168/2 ; (y_centroid(2)-1)]
                       Vdd_y_p = [d2_4 ;  7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_m(1:2))
                       minx = min(Vdd_x(1:2))
                       x_3 = x_centroid(2) - minx
                       x_4 = x_centroid(2) + (7168-minx)
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(l_2_2_d24 == 1)
                       Vdd_x = [d2_4 ;  7168/2]
                       Vdd_y_m = [d2_4  ;  7168/2]
                       Vdd_y_p = [d2_4 ;  7168/2 ; (13824 - y_centroid(2))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_3 = x_centroid(2) - minx
                       x_4 = x_centroid(2) + (7168-minx)
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_2_4_d24 == 1)
                       Vdd_x = [d2_4 ;   7168/2]
                       Vdd_y_m = [d2_4 ;   7168/2 ; (y_centroid(2)-1)]
                       Vdd_y_p = [d2_4 ;   7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_p(1:2))
                       minx = min(Vdd_x(1:2))
                       x_3 = x_centroid(2) - minx
                       x_4 = 10752
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_2_5_d24 == 1)
                       Vdd_x = [d2_4 ;  7168/2]
                        Vdd_y_m = [d2_4 ;  7168/2]
                       Vdd_y_p = [d2_4 ;   7168/2 ; (13824 - y_centroid(2))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_3 = x_centroid(2) - minx
                       x_4 = 10752
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   <span class="keyword">end</span>
                <span class="keyword">if</span>(x_3 &lt; 1)
                    x_3 = 1
                <span class="keyword">end</span>

                <span class="keyword">if</span>(x_4 &gt; 10752)
                    x_4 = 10752
                <span class="keyword">end</span>

                <span class="keyword">if</span>(y_3 &lt; 1)
                    y_3 = 1
                <span class="keyword">end</span>
                <span class="keyword">if</span>(y_4 &lt; 1)
                    y_4 = 1
                <span class="keyword">end</span>
                <span class="comment">%The rectangular image is cutted from the imgnucleus image containing the whole cover slip</span>
               imagesphere2 = imgnucleus(y_3:y_4,x_3:x_4);
               <span class="comment">% Dimensions of imagesphere1 are determined</span>
               [r2 c2] = size(imagesphere2);
               <span class="comment">% An empty matrix is generated</span>
               imagesphereresize2 = zeros(7168:7168);
               <span class="comment">% imagesphereresize1 is converted to 8-bit</span>
               imagesphereresize2 = uint8(imagesphereresize2);
               <span class="comment">%The empty indices in the imagesphereresize1 matrix are overwritten with imagesphere 1 entries</span>
               imagesphereresize2(1:r2,1:c2)=imagesphere2;
               <span class="comment">% imagesphereresize1 is saved to final destination</span>
               newFile2 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'02NucleusBig'</span>],<span class="string">'ignorecase'</span>);
               imwrite(imagesphereresize2,[foldername1 <span class="string">'/'</span> newFile2]);
               clear <span class="string">imagesphereresize2</span>;
               clear <span class="string">imagesphere2</span>;

               <span class="comment">% Sphere 3 with smallest value of x_centroid</span>

               <span class="keyword">if</span>(l_3_1 &gt;0 &amp;&amp; l_3_1 &lt; 2);
                       x_5 = 1;
                       x_6 = x_centroid(3) + d_3_c;
                       y_5 = 1;
                       y_6 = y_centroid(3) + d_3_c;
               <span class="keyword">else</span>
               <span class="keyword">end</span>

               <span class="keyword">if</span>(l_3_2 &gt;0 &amp;&amp; l_3_2 &lt; 2);
                       x_5 = 1;
                       x_6 = x_centroid(3) + d_3_c;
                       y_5 = y_centroid(3) - d_3_c;
                       y_6 = 13824;
               <span class="keyword">else</span>
               <span class="keyword">end</span>

               <span class="keyword">if</span>(r_3_4 &gt;0 &amp;&amp; r_3_4 &lt; 2);
                       x_5 = x_centroid(3) - d_3_c;
                       x_6 = 10752;
                       y_5 = 1;
                       y_6 = y_centroid(3) + d_3_c;
               <span class="keyword">else</span>
               <span class="keyword">end</span>

               <span class="keyword">if</span>(r_3_5 &gt;0 &amp;&amp; r_3_5 &lt; 2);
                       x_5 = x_centroid(3) - d_3_c;
                       x_6 = 10752;
                       y_5 = y_centroid(3) - d_3_c;
                       y_6 = 13824;
               <span class="keyword">else</span>
               <span class="keyword">end</span>

               <span class="comment">% Going over all possible distributions of sphere cores</span>
               <span class="keyword">if</span>(x_centroid(3) ~= x_centroid_c);
               <span class="keyword">else</span>
                   <span class="comment">% 1st permutation</span>
                   <span class="keyword">if</span>(x_centroid(1) &lt; x_centroid(3) &amp;&amp; x_centroid(2) &lt; x_centroid(3) &amp;&amp; x_centroid(4) &lt; x_centroid(3));
                       V_1m = [d1_3 ; d2_3 ; d3_4 ; (7168/2)];
                       min1m = min(V_1m);
                       min1p = (7168-min1m);
                   <span class="keyword">else</span>
                   <span class="keyword">end</span>
                   <span class="comment">% 2nd permutation</span>
                   <span class="keyword">if</span>(x_centroid(1) &gt; x_centroid(3) &amp;&amp; x_centroid(2) &gt; x_centroid(3) &amp;&amp; x_centroid(4) &gt; x_centroid(3));
                       V_1p = [d1_3 ; d2_3 ; d3_4 (7168/2)];
                       min1p = min(V_1p);
                       min1m = (7168-min1p);
                   <span class="keyword">else</span>
                   <span class="keyword">end</span>
                   <span class="comment">%3rd permutation</span>
                   <span class="keyword">if</span>(x_centroid(1) &lt; x_centroid(3) &amp;&amp; x_centroid(2) &lt; x_centroid(3) &amp;&amp; x_centroid(4) &gt; x_centroid(3));
                       V_1m = [d1_3 ; d2_3 ; (7168/2)];
                       V_1p = [d3_4 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);

                   <span class="keyword">else</span>

                   <span class="keyword">end</span>
                   <span class="comment">%4th permutation</span>
                   <span class="keyword">if</span>(x_centroid(1) &lt; x_centroid(3) &amp;&amp; x_centroid(2) &gt; x_centroid(3) &amp;&amp; x_centroid(4) &lt; x_centroid(3));
                       V_1m = [d1_3 ; d3_4 ; (7168/2)];
                       V_1p = [d2_3 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   <span class="keyword">else</span>
                   <span class="keyword">end</span>
                   <span class="comment">%5th permutation</span>
                   <span class="keyword">if</span>(x_centroid(1) &gt; x_centroid(3) &amp;&amp; x_centroid(2) &lt; x_centroid(3) &amp;&amp; x_centroid(4) &lt; x_centroid(3));
                       V_1m = [d2_3 ; d3_4 ; (7168/2)];
                       V_1p = [d1_3 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   <span class="keyword">else</span>
                   <span class="keyword">end</span>
                   <span class="comment">%6th permutation</span>
                   <span class="keyword">if</span>(x_centroid(1) &lt; x_centroid(3) &amp;&amp; x_centroid(2) &gt; x_centroid(3) &amp;&amp; x_centroid(4) &gt; x_centroid(3));
                       V_1m = [d1_3 ; (7168/2)];
                       V_1p = [d2_3 ; d3_4 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   <span class="keyword">else</span>
                   <span class="keyword">end</span>
                   <span class="comment">%7th permutation</span>
                   <span class="keyword">if</span>(x_centroid(1) &gt; x_centroid(3) &amp;&amp; x_centroid(2) &gt; x_centroid(3) &amp;&amp; x_centroid(4) &lt; x_centroid(3));
                       V_1m = [d3_4 ; (7168/2)];
                       V_1p = [d1_3 ; d2_3 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   <span class="keyword">else</span>
                   <span class="keyword">end</span>
                   <span class="comment">%8th permutation</span>
                   <span class="keyword">if</span>(x_centroid(1) &gt; x_centroid(3) &amp;&amp; x_centroid(2) &lt; x_centroid(3) &amp;&amp; x_centroid(4) &gt; x_centroid(3));
                       V_1m = [d2_3 ; (7168/2)];
                       V_1p = [d1_3 ; d3_4 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   <span class="keyword">else</span>
                   <span class="keyword">end</span>
                   x_5 = x_centroid(3) - min1m
                   x_6 = x_centroid(3) + min1p
                   y_5 = y_centroid(3) - min1m
                   y_6 = y_centroid(3) + min1p



               <span class="keyword">end</span>

               <span class="comment">% Case for all four spheres in the same spot</span>

                   <span class="keyword">if</span>(l_3_1_q == 1)
                       Vdq_x = [d1_3 ; d2_3 ; d3_4 ; 7168/2]
                       Vdq_y_m = [d1_3 ; d2_3 ; d3_4 ; 7168/2 ; (y_centroid(3)-1)]
                       Vdq_y_p = [d1_3 ; d2_3 ; d3_4 ; 7168/2 ]
                       miny_m = min(Vdq_y_m(1:5))
                       miny_p = min(Vdq_y_p(1:4))
                       minx = min(Vdq_x(1:4))
                       x_5 = x_centroid(3) - minx
                       x_6 = x_centroid(3) + minx
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(l_3_2_q == 1)
                       Vdq_x = [d1_3 ; d2_3 ; d3_4 ; 7168/2]
                       Vdq_y_m = [d1_3 ; d2_3 ; d3_4 ; 7168/2]
                       Vdq_y_p = [d1_3 ; d2_3 ; d3_4 ; 7168/2 ; (13824 - y_centroid(3))]
                       miny_m = min(Vdq_y_m(1:4))
                       miny_p = min(Vdq_p_m(1:5))
                       minx = min(Vdq_x(1:4))
                       x_5 = x_centroid(3) - minx
                       x_6 = x_centroid(3) + minx
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_3_4_q == 1)
                       Vdq_x = [d1_3 ; d2_3 ; d3_4 ; 7168/2]
                       Vdq_y_m = [d1_3 ; d2_3 ; d3_4 ; 7168/2 ; (y_centroid(3)-1)]
                       Vdq_y_p = [d1_3 ; d2_3 ; d3_4 ; 7168/2 ]
                       miny_m = min(Vdq_y_m(1:5))
                       miny_p = min(Vdq_y_p(1:4))
                       minx = min(Vdq_x(1:4))
                       x_5 = x_centroid(3) - minx
                       x_6 = x_centroid(3) + minx
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_3_5_q == 1)
                       Vdq_x = [d1_3 ; d2_3 ; d3_4 ; 7168/2]
                        Vdq_y_m = [d1_3 ; d2_3 ; d3_4 ; 7168/2]
                       Vdq_y_p = [d1_3 ; d2_3 ; d3_4 ; 7168/2 ; (13824 - y_centroid(3))]
                       miny_m = min(Vdq_y_m(1:4))
                       miny_p = min(Vdq_y_p(1:5))
                       minx = min(Vdq_x(1:4))
                       x_5 = x_centroid(3) - minx
                       x_6 = x_centroid(3) + minx
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   <span class="keyword">end</span>

                 <span class="comment">% Case for 1,2,3 at the same position</span>

                   <span class="keyword">if</span>(l_3_1_t == 1)
                       Vdt_x = [d1_3 ; d2_3 ; 7168/2]
                       Vdt_y_m = [d1_3 ; d2_3  ; 7168/2 ; (y_centroid(3)-1)]
                       Vdt_y_p = [d1_3 ; d2_3  ; 7168/2 ]
                       miny_m = min(Vdt_y_m(1:4))
                       miny_p = min(Vdt_y_m(1:3))
                       minx = min(Vdt_x(1:3))
                       x_5 = x_centroid(3) - minx
                       x_6 = x_centroid(3) + minx
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(l_3_2_t == 1)
                       Vdt_x = [d1_3 ; d2_3 ;  7168/2]
                       Vdt_y_m = [d1_3 ; d2_3 ;  7168/2]
                       Vdt_y_p = [d1_3 ; d2_3 ;  7168/2 ; (13824 - y_centroid(3))]
                       miny_m = min(Vdt_y_m(1:3))
                       miny_p = min(Vdt_y_p(1:4))
                       minx = min(Vdt_x(1:3))
                       x_5 = x_centroid(3) - minx
                       x_6 = x_centroid(3) + minx
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_3_4_t == 1)
                       Vdt_x = [d1_3 ; d2_3 ;  7168/2]
                       Vdt_y_m = [d1_3 ; d2_3 ;  7168/2 ; (y_centroid(3)-1)]
                       Vdt_y_p = [d1_3 ; d2_3 ;  7168/2 ]
                       miny_m = min(Vdt_y_m(1:4))
                       miny_p = min(Vdt_y_p(1:3))
                       minx = min(Vdt_x(1:3))
                       x_5 = x_centroid(3) - minx
                       x_6 = x_centroid(3) + minx
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_3_5_t == 1)
                       Vdt_x = [d1_3 ; d2_3 ;  7168/2]
                        Vdt_y_m = [d1_3 ; d2_3 ;  7168/2]
                       Vdt_y_p = [d1_3 ; d2_3 ;  7168/2 ; (13824 - y_centroid(3))]
                       miny_m = min(Vdt_y_m(1:3))
                       miny_p = min(Vdt_y_p(1:4))
                       minx = min(Vdt_x(1:3))
                       x_5 = x_centroid(3) - minx
                       x_6 = x_centroid(3) + minx
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   <span class="keyword">end</span>

                 <span class="comment">% Case for 2,3,4 at the same position</span>
                   <span class="keyword">if</span>(l_3_1_t == 1)
                       Vdt_x = [d3_4 ; d2_3 ; 7168/2]
                       Vdt_y_m = [d3_4 ; d2_3  ; 7168/2 ; (y_centroid(3)-1)]
                       Vdt_y_p = [d3_4 ; d2_3  ; 7168/2 ]
                       miny_m = min(Vdt_y_m(1:4))
                       miny_p = min(Vdt_y_m(1:3))
                       minx = min(Vdt_x(1:3))
                       x_5 = x_centroid(3) - minx
                       x_6 = x_centroid(3) + minx
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(l_3_2_t == 1)
                       Vdt_x = [d3_4 ; d2_3 ;  7168/2]
                       Vdt_y_m = [d3_4 ; d2_3 ;  7168/2]
                       Vdt_y_p = [d3_4 ; d2_3 ;  7168/2 ; (13824 - y_centroid(3))]
                       miny_m = min(Vdt_y_m(1:3))
                       miny_p = min(Vdt_y_p(1:4))
                       minx = min(Vdt_x(1:3))
                       x_5 = x_centroid(3) - minx
                       x_6 = x_centroid(3) + minx
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_3_4_t == 1)
                       Vdt_x = [d3_4 ; d2_3 ;  7168/2]
                       Vdt_y_m = [d3_4 ; d2_3 ;  7168/2 ; (y_centroid(3)-1)]
                       Vdt_y_p = [d3_4 ; d2_3 ;  7168/2 ]
                       miny_m = min(Vdt_y_m(1:4))
                       miny_p = min(Vdt_y_p(1:3))
                       minx = min(Vdt_x(1:3))
                       x_5 = x_centroid(3) - minx
                       x_6 = x_centroid(3) + minx
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_3_5_t == 1)
                       Vdt_x = [d3_4 ; d2_3 ;  7168/2]
                        Vdt_y_m = [d3_4 ; d2_3 ;  7168/2]
                       Vdt_y_p = [d3_4 ; d2_3 ;  7168/2 ; (13824 - y_centroid(3))]
                       miny_m = min(Vdt_y_m(1:3))
                       miny_p = min(Vdt_y_p(1:4))
                       minx = min(Vdt_x(1:3))
                       x_5 = x_centroid(3) - minx
                       x_6 = x_centroid(3) + minx
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   <span class="keyword">end</span>
               <span class="comment">% Case fox 1,3 are the same quadrant</span>

                   <span class="keyword">if</span>(l_3_1_d13 == 1)
                       Vdd_x = [d1_3 ; 7168/2]
                       Vdd_y_m = [d1_3 ; 7168/2 ; (y_centroid(3)-1)]
                       Vdd_y_p = [d1_3 ;  7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_m(1:2))
                       minx = min(Vdd_x(1:2))
                       x_5 = x_centroid(3) - minx
                       x_6 = x_centroid(3) + (7168 - minx)
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(l_3_2_d13 == 1)
                       Vdd_x = [d1_3 ;  7168/2]
                       Vdd_y_m = [d1_3  ;  7168/2]
                       Vdd_y_p = [d1_3 ;  7168/2 ; (13824 - y_centroid(3))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_5 = x_centroid(3) - minx
                       x_6 = x_centroid(3) + (7168 - minx)
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_3_4_d13 == 1)
                       Vdd_x = [d1_3 ;   7168/2]
                       Vdd_y_m = [d1_3 ;   7168/2 ; (y_centroid(3)-1)]
                       Vdd_y_p = [d1_3 ;   7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_p(1:2))
                       minx = min(Vdd_x(1:2))
                       x_5 = x_centroid(3) - minx
                       x_6 = 10752
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_3_5_d13 == 1)
                       Vdd_x = [d1_3 ;  7168/2]
                        Vdd_y_m = [d1_3 ;  7168/2]
                       Vdd_y_p = [d1_3 ;   7168/2 ; (13824 - y_centroid(3))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_5 = x_centroid(3) - minx
                       x_6 = 10752
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   <span class="keyword">end</span>

                <span class="comment">% Case fox 2,3 are the same quadrant</span>

                   <span class="keyword">if</span>(l_3_1_d23 == 1)
                       Vdd_x = [d2_3 ; 7168/2]
                       Vdd_y_m = [d2_3;7168/2 ; (y_centroid(3)-1)]
                       Vdd_y_p = [d2_3 ;  7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_m(1:2))
                       minx = min(Vdd_x(1:2))
                       x_5 = x_centroid(3) - minx
                       x_6 = x_centroid(3) + (7168 - minx)
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(l_3_2_d23 == 1)
                       Vdd_x = [d2_3 ;  7168/2]
                       Vdd_y_m = [d2_3  ;  7168/2]
                       Vdd_y_p = [d2_3 ;  7168/2 ; (13824 - y_centroid(3))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_5 = x_centroid(3) - minx
                       x_6 = x_centroid(3) + (7168 - minx)
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_3_4_d23 == 1)
                       Vdd_x = [d2_3 ;   7168/2]
                       Vdd_y_m = [d2_3 ;   7168/2 ; (y_centroid(3)-1)]
                       Vdd_y_p = [d2_3 ;   7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_p(1:2))
                       minx = min(Vdd_x(1:2))
                       x_5 = x_centroid(3) - minx
                       x_6 = 10752
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_3_5_d23 == 1)
                       Vdd_x = [d2_3 ;  7168/2]
                        Vdd_y_m = [d2_3 ;  7168/2]
                       Vdd_y_p = [d2_3 ;   7168/2 ; (13824 - y_centroid(3))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_5 = x_centroid(3) - minx
                       x_6 = 10752
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   <span class="keyword">end</span>

                   <span class="comment">% Case fox 3,4 are the same quadrant</span>

                   <span class="keyword">if</span>(l_3_1_d34 == 1)
                       Vdd_x = [d3_4 ; 7168/2]
                       Vdd_y_m = [d3_4 ; 7168/2 ; (y_centroid(3)-1)]
                       Vdd_y_p = [d3_4 ;  7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_m(1:2))
                       minx = min(Vdd_x(1:2))
                       x_5 = x_centroid(3) - minx
                       x_6 = x_centroid(3) + (7168 - minx)
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(l_3_2_d34 == 1)
                       Vdd_x = [d3_4 ;  7168/2]
                       Vdd_y_m = [d3_4  ;  7168/2]
                       Vdd_y_p = [d3_4 ;  7168/2 ; (13824 - y_centroid(3))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_5 = x_centroid(3) - minx
                       x_6 = x_centroid(3) + (7168 - minx)
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_3_4_d34 == 1)
                       Vdd_x = [d3_4 ;   7168/2]
                       Vdd_y_m = [d3_4 ;   7168/2 ; (y_centroid(3)-1)]
                       Vdd_y_p = [d3_4 ;   7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_p(1:2))
                       minx = min(Vdd_x(1:2))
                       x_5 = x_centroid(3) - minx
                       x_6 = 10752
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_3_5_d34 == 1)
                       Vdd_x = [d3_4 ;  7168/2]
                        Vdd_y_m = [d3_4 ;  7168/2]
                       Vdd_y_p = [d3_4 ;   7168/2 ; (13824 - y_centroid(3))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_5 = x_centroid(3) - minx
                       x_6 = 10752
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   <span class="keyword">end</span>
                <span class="keyword">if</span>(x_5 &lt; 1)
                    x_5 = 1
                <span class="keyword">end</span>

                <span class="keyword">if</span>(x_6 &gt; 10752)
                    x_6 = 10752
                <span class="keyword">end</span>

                <span class="keyword">if</span>(y_5 &lt; 1)
                    y_5 = 1
                <span class="keyword">end</span>
                <span class="keyword">if</span>(y_6 &lt; 1)
                    y_6 = 1
                <span class="keyword">end</span>
                <span class="comment">%The rectangular image is cutted from the imgnucleus image containing the whole cover slip</span>
               imagesphere3 = imgnucleus(y_5:y_6,x_5:x_6);
               <span class="comment">% Dimensions of imagesphere1 are determined</span>
               [r3 c3] = size(imagesphere3);
               <span class="comment">% An empty matrix is generated</span>
               imagesphereresize3 = zeros(7168:7168);
               <span class="comment">% imagesphereresize1 is converted to 8-bit</span>
               imagesphereresize3 = uint8(imagesphereresize3);
               <span class="comment">%The empty indices in the imagesphereresize1 matrix are overwritten with imagesphere 1 entries</span>
               imagesphereresize3(1:r3,1:c3)=imagesphere3;
               <span class="comment">% imagesphereresize1 is saved to final destination</span>
               newFile3 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'03NucleusBig'</span>],<span class="string">'ignorecase'</span>);
               imwrite(imagesphereresize3,[foldername1 <span class="string">'/'</span> newFile3]);
               clear <span class="string">imagesphereresize3</span>;
               clear <span class="string">imagesphere3</span>;


               <span class="comment">% Sphere 4 with smallest value of x_centroid</span>

               <span class="keyword">if</span>(l_4_1 &gt;0 &amp;&amp; l_4_1 &lt; 2);
                       x_7 = 1;
                       x_8 = x_centroid(4) + d_4_c;
                       y_7 = 1;
                       y_8 = y_centroid(4) + d_4_c;
               <span class="keyword">else</span>
               <span class="keyword">end</span>

               <span class="keyword">if</span>(l_4_2 &gt;0 &amp;&amp; l_4_2 &lt; 2);
                       x_7 = 1;
                       x_8 = x_centroid(4) + d_4_c;
                       y_7 = y_centroid(4) - d_4_c;
                       y_8 = 13824;
               <span class="keyword">else</span>
               <span class="keyword">end</span>

               <span class="keyword">if</span>(r_4_4 &gt;0 &amp;&amp; r_4_4 &lt; 2);
                       x_7 = x_centroid(4) - d_4_c;
                       x_8 = 10752;
                       y_7 = 1;
                       y_8 = y_centroid(4) + d_4_c;
               <span class="keyword">else</span>
               <span class="keyword">end</span>

               <span class="keyword">if</span>(r_4_5 &gt;0 &amp;&amp; r_4_5 &lt; 2);
                       x_7 = x_centroid(4) - d_4_c;
                       x_8 = 10752;
                       y_7 = y_centroid(4) - d_4_c;
                       y_8 = 13824;
               <span class="keyword">else</span>
               <span class="keyword">end</span>

               <span class="comment">% Going over all possible distributions of sphere cores</span>
               <span class="keyword">if</span>(x_centroid(4) ~= x_centroid_c);
               <span class="keyword">else</span>
                   <span class="comment">% 1st permutation</span>
                   <span class="keyword">if</span>(x_centroid(1) &lt; x_centroid(4) &amp;&amp; x_centroid(2) &lt; x_centroid(4) &amp;&amp; x_centroid(3) &lt; x_centroid(4));
                       V_1m = [d1_4 ; d2_4 ; d3_4 ; (7168/2)];
                       min1m = min(V_1m);
                       min1p = (7168-min1m);
                   <span class="keyword">else</span>
                   <span class="keyword">end</span>
                   <span class="comment">% 2nd permutation</span>
                   <span class="keyword">if</span>(x_centroid(1) &gt; x_centroid(4) &amp;&amp; x_centroid(2) &gt; x_centroid(4) &amp;&amp; x_centroid(3) &gt; x_centroid(4));
                       V_1p = [d1_4 ; d2_4 ; d3_4 (7168/2)];
                       min1p = min(V_1p);
                       min1m = (7168-min1p);
                   <span class="keyword">else</span>
                   <span class="keyword">end</span>
                   <span class="comment">%3rd permutation</span>
                   <span class="keyword">if</span>(x_centroid(1) &lt; x_centroid(4) &amp;&amp; x_centroid(2) &lt; x_centroid(4) &amp;&amp; x_centroid(3) &gt; x_centroid(4));
                       V_1m = [d1_4 ; d2_4 ; (7168/2)];
                       V_1p = [d3_4 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);

                   <span class="keyword">else</span>

                   <span class="keyword">end</span>
                   <span class="comment">%4th permutation</span>
                   <span class="keyword">if</span>(x_centroid(1) &lt; x_centroid(4) &amp;&amp; x_centroid(2) &gt; x_centroid(4) &amp;&amp; x_centroid(3) &lt; x_centroid(4));
                       V_1m = [d1_4 ; d3_4 ; (7168/2)];
                       V_1p = [d2_4 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   <span class="keyword">else</span>
                   <span class="keyword">end</span>
                   <span class="comment">%5th permutation</span>
                   <span class="keyword">if</span>(x_centroid(1) &gt; x_centroid(4) &amp;&amp; x_centroid(2) &lt; x_centroid(4) &amp;&amp; x_centroid(3) &lt; x_centroid(4));
                       V_1m = [d2_4 ; d3_4 ; (7168/2)];
                       V_1p = [d1_4 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   <span class="keyword">else</span>
                   <span class="keyword">end</span>
                   <span class="comment">%6th permutation</span>
                   <span class="keyword">if</span>(x_centroid(1) &lt; x_centroid(4) &amp;&amp; x_centroid(2) &gt; x_centroid(4) &amp;&amp; x_centroid(3) &gt; x_centroid(4));
                       V_1m = [d1_4 ; (7168/2)];
                       V_1p = [d2_4 ; d3_4 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   <span class="keyword">else</span>
                   <span class="keyword">end</span>
                   <span class="comment">%7th permutation</span>
                   <span class="keyword">if</span>(x_centroid(1) &gt; x_centroid(4) &amp;&amp; x_centroid(2) &gt; x_centroid(4) &amp;&amp; x_centroid(3) &lt; x_centroid(4));
                       V_1m = [d3_4 ; (7168/2)];
                       V_1p = [d1_4 ; d2_4 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   <span class="keyword">else</span>
                   <span class="keyword">end</span>
                   <span class="comment">%8th permutation</span>
                   <span class="keyword">if</span>(x_centroid(1) &gt; x_centroid(4) &amp;&amp; x_centroid(2) &lt; x_centroid(4) &amp;&amp; x_centroid(3) &gt; x_centroid(4));
                       V_1m = [d2_4 ; (7168/2)];
                       V_1p = [d1_4 ; d3_4 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   <span class="keyword">else</span>
                   <span class="keyword">end</span>
                   x_7 = x_centroid(4) - min1m
                   x_8 = x_centroid(4) + min1p
                   y_7 = y_centroid(4) - min1m
                   y_8 = y_centroid(4) + min1p





               <span class="keyword">end</span>

                <span class="comment">% Case for all four spheres in the same spot</span>

                   <span class="keyword">if</span>(l_4_1_q == 1)
                       Vdq_x = [d1_4 ; d2_4 ; d3_4 ; 7168/2]
                       Vdq_y_m = [d1_4 ; d2_4 ; d3_4 ; 7168/2 ; (y_centroid(4)-1)]
                       Vdq_y_p = [d1_4 ; d2_4 ; d3_4 ; 7168/2 ]
                       miny_m = min(Vdq_y_m(1:5))
                       miny_p = min(Vdq_y_p(1:4))
                       minx = min(Vdq_x(1:4))
                       x_7 = x_centroid(4) - minx
                       x_8 = x_centroid(4) + minx
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(l_4_2_q == 1)
                       Vdq_x = [d1_4 ; d2_4 ; d3_4 ; 7168/2]
                       Vdq_y_m = [d1_4 ; d2_4 ; d3_4 ; 7168/2]
                       Vdq_y_p = [d1_4 ; d2_4 ; d3_4 ; 7168/2 ; (13824 - y_centroid(4))]
                       miny_m = min(Vdq_y_m(1:4))
                       miny_p = min(Vdq_y_p(1:5))
                       minx = min(Vdq_x(1:4))
                       x_7 = x_centroid(4) - minx
                       x_8 = x_centroid(4) + minx
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_4_4_q == 1)
                       Vdq_x = [d1_4 ; d2_4 ; d3_4 ; 7168/2]
                       Vdq_y_m = [d1_4 ; d2_4 ; d3_4 ; 7168/2 ; (y_centroid(4)-1)]
                       Vdq_y_p = [d1_4 ; d2_4 ; d3_4 ; 7168/2 ]
                       miny_m = min(Vdq_y_m(1:5))
                       miny_p = min(Vdq_y_p(1:4))
                       minx = min(Vdq_x(1:4))
                       x_7 = x_centroid(4) - minx
                       x_8 = x_centroid(4) + minx
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_4_5_q == 1)
                       Vdq_x = [d1_4 ; d2_4 ; d3_4 ; 7168/2]
                        Vdq_y_m = [d1_4 ; d2_4 ; d3_4 ; 7168/2]
                       Vdq_y_p = [d1_4 ; d2_4 ; d3_4 ; 7168/2 ; (13824 - y_centroid(4))]
                       miny_m = min(Vdq_y_m(1:4))
                       miny_p = min(Vdq_y_p(1:5))
                       minx = min(Vdq_x(1:4))
                       x_7 = x_centroid(4) - minx
                       x_8 = x_centroid(4) + minx
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   <span class="keyword">end</span>


                 <span class="comment">% Case for 2,3,4 at the same position</span>
                   <span class="keyword">if</span>(l_4_1_t == 1)
                       Vdt_x = [d3_4 ; d2_4 ; 7168/2]
                       Vdt_y_m = [d3_4 ; d2_4  ; 7168/2 ; (y_centroid(4)-1)]
                       Vdt_y_p = [d3_4 ; d2_4  ; 7168/2 ]
                       miny_m = min(Vdt_y_m(1:4))
                       miny_p = min(Vdt_y_m(1:3))
                       minx = min(Vdt_x(1:3))
                       x_7 = x_centroid(4) - minx
                       x_8 = x_centroid(4) + minx
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(l_4_2_t == 1)
                       Vdt_x = [d3_4 ; d2_4 ;  7168/2]
                       Vdt_y_m = [d3_4 ; d2_4 ;  7168/2]
                       Vdt_y_p = [d3_4 ; d2_4 ;  7168/2 ; (13824 - y_centroid(4))]
                       miny_m = min(Vdt_y_m(1:3))
                       miny_p = min(Vdt_y_p(1:4))
                       minx = min(Vdt_x(1:3))
                       x_7 = x_centroid(4) - minx
                       x_8 = x_centroid(4) + minx
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_4_4_t == 1)
                       Vdt_x = [d3_4 ; d2_4 ;  7168/2]
                       Vdt_y_m = [d3_4 ; d2_4 ;  7168/2 ; (y_centroid(4)-1)]
                       Vdt_y_p = [d3_4 ; d2_4 ;  7168/2 ]
                       miny_m = min(Vdt_y_m(1:4))
                       miny_p = min(Vdt_y_p(1:3))
                       minx = min(Vdt_x(1:3))
                       x_7 = x_centroid(4) - minx
                       x_8 = x_centroid(4) + minx
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_4_5_t == 1)
                       Vdt_x = [d3_4 ; d2_4 ;  7168/2]
                        Vdt_y_m = [d3_4 ; d2_4 ;  7168/2]
                       Vdt_y_p = [d3_4 ; d2_4 ;  7168/2 ; (13824 - y_centroid(4))]
                       miny_m = min(Vdt_y_m(1:3))
                       miny_p = min(Vdt_y_p(1:4))
                       minx = min(Vdt_x(1:3))
                       x_7 = x_centroid(4) - minx
                       x_8 = x_centroid(4) + minx
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   <span class="keyword">end</span>
                    <span class="comment">% Case fox 1,4 are the same quadrant</span>

                   <span class="keyword">if</span>(l_4_1_d14 == 1)
                       Vdd_x = [d1_4 ; 7168/2]
                       Vdd_y_m = [d1_4 ; 7168/2 ; (y_centroid(4)-1)]
                       Vdd_y_p = [d1_4 ;  7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_m(1:2))
                       minx = min(Vdd_x(1:2))
                       x_7 = x_centroid(4) - minx
                       x_8 = x_centroid(4) + (7168 - minx)
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(l_4_2_d14 == 1)
                       Vdd_x = [d1_4 ;  7168/2]
                       Vdd_y_m = [d1_4  ;  7168/2]
                       Vdd_y_p = [d1_4 ;  7168/2 ; (13824 - y_centroid(4))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_7 = x_centroid(4) - minx
                       x_8 = x_centroid(4) + (7168 - minx)
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_4_4_d14 == 1)
                       Vdd_x = [d1_4 ;   7168/2]
                       Vdd_y_m = [d1_4 ;   7168/2 ; (y_centroid(4)-1)]
                       Vdd_y_p = [d1_4 ;   7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_p(1:2))
                       minx = min(Vdd_x(1:2))
                       x_7 = x_centroid(4) - minx
                       x_8 = 10752
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_4_5_d14 == 1)
                       Vdd_x = [d1_4 ;  7168/2]
                        Vdd_y_m = [d1_4 ;  7168/2]
                       Vdd_y_p = [d1_4 ;   7168/2 ; (13824 - y_centroid(4))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_7 = x_centroid(4) - minx
                       x_8 = 10752
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   <span class="keyword">end</span>

                    <span class="comment">% Case fox 2,4 are the same quadrant</span>

                   <span class="keyword">if</span>(l_4_1_d24 == 1)
                       Vdd_x = [d2_4 ; 7168/2]
                       Vdd_y_m = [d2_4 ; 7168/2 ; (y_centroid(4)-1)]
                       Vdd_y_p = [d2_4 ;  7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_m(1:2))
                       minx = min(Vdd_x(1:2))
                       x_7 = x_centroid(4) - minx
                       x_8 = x_centroid(4) + (7168 - minx)
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(l_4_2_d24 == 1)
                       Vdd_x = [d2_4 ;  7168/2]
                       Vdd_y_m = [d2_4  ;  7168/2]
                       Vdd_y_p = [d2_4 ;  7168/2 ; (13824 - y_centroid(4))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_7 = x_centroid(4) - minx
                       x_8 = x_centroid(4) + (7168 - minx)
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_4_4_d24 == 1)
                       Vdd_x = [d2_4 ;   7168/2]
                       Vdd_y_m = [d2_4 ;   7168/2 ; (y_centroid(4)-1)]
                       Vdd_y_p = [d2_4 ;   7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_p(1:2))
                       minx = min(Vdd_x(1:2))
                       x_7 = x_centroid(4) - minx
                       x_8 = 10752
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_4_5_d24 == 1)
                       Vdd_x = [d2_4 ;  7168/2]
                        Vdd_y_m = [d2_4 ;  7168/2]
                       Vdd_y_p = [d2_4 ;   7168/2 ; (13824 - y_centroid(4))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_7 = x_centroid(4) - minx
                       x_8 = 10752
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   <span class="keyword">end</span>

                   <span class="comment">% Case fox 3,4 are the same quadrant</span>

                   <span class="keyword">if</span>(l_4_1_d34 == 1)
                       Vdd_x = [d3_4 ; 7168/2]
                       Vdd_y_m = [d3_4 ; 7168/2 ; (y_centroid(4)-1)]
                       Vdd_y_p = [d3_4 ;  7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_m(1:2))
                       minx = min(Vdd_x(1:2))
                       x_7 = x_centroid(4) - minx
                       x_8 = x_centroid(4) + (7168 - minx)
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(l_4_2_d34 == 1)
                       Vdd_x = [d3_4 ;  7168/2]
                       Vdd_y_m = [d3_4  ;  7168/2]
                       Vdd_y_p = [d3_4 ;  7168/2 ; (13824 - y_centroid(4))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_7 = x_centroid(4) - minx
                       x_8 = x_centroid(4) + (7168 - minx)
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_4_4_d34 == 1)
                       Vdd_x = [d3_4 ;   7168/2]
                       Vdd_y_m = [d3_4 ;   7168/2 ; (y_centroid(4)-1)]
                       Vdd_y_p = [d3_4 ;   7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_p(1:2))
                       minx = min(Vdd_x(1:2))
                       x_7 = x_centroid(4) - minx
                       x_8 = 10752
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   <span class="keyword">end</span>

                   <span class="keyword">if</span>(r_4_5_d34 == 1)
                       Vdd_x = [d3_4 ;  7168/2]
                        Vdd_y_m = [d3_4 ;  7168/2]
                       Vdd_y_p = [d3_4 ;   7168/2 ; (13824 - y_centroid(4))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_7 = x_centroid(4) - minx
                       x_8 = 10752
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   <span class="keyword">end</span>

                <span class="keyword">if</span>(x_7 &lt; 1)
                    x_7 = 1
                <span class="keyword">end</span>

                <span class="keyword">if</span>(x_8 &gt; 10752)
                    x_8 = 10752
                <span class="keyword">end</span>

                <span class="keyword">if</span>(y_7 &lt; 1)
                    y_7 = 1
                <span class="keyword">end</span>
                <span class="keyword">if</span>(y_8 &lt; 1)
                    y_8 = 1
                <span class="keyword">end</span>
                <span class="comment">%The rectangular image is cutted from the imgnucleus image containing the whole cover slip</span>
               imagesphere4 = imgnucleus(y_7:y_8,x_7:x_8);
               <span class="comment">% Dimensions of imagesphere1 are determined</span>
               [r4 c4] = size(imagesphere4);
               <span class="comment">% An empty matrix is generated</span>
               imagesphereresize4 = zeros(7168:7168);
               <span class="comment">% imagesphereresize1 is converted to 8-bit</span>
               imagesphereresize4 = uint8(imagesphereresize4);
               <span class="comment">%The empty indices in the imagesphereresize1 matrix are overwritten with imagesphere 1 entries</span>
               imagesphereresize4(1:r4,1:c4)=imagesphere4;
               <span class="comment">% imagesphereresize1 is saved to final destination</span>
               newFile4 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'04NucleusBig'</span>],<span class="string">'ignorecase'</span>);
               imwrite(imagesphereresize4,[foldername1 <span class="string">'/'</span> newFile4]);
               clear <span class="string">imagesphereresize4</span>;
               clear <span class="string">imagesphere4</span>;

               imagesphereresize5 = zeros(7168:7168);
               newFile5 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'05NucleusBig'</span>],<span class="string">'ignorecase'</span>);
               imwrite(imagesphereresize5,[foldername1 <span class="string">'/'</span> newFile5]);
               clear <span class="string">imagesphereresize5</span>;

               <span class="keyword">if</span>(Neuron_Channel &gt; 0)
                   <span class="comment">% Same for neurite channel</span>


                   imagesphere6 = imgneurite(y_1:y_2,x_1:x_2);
                   [r1 c1] = size(imagesphere6);
                   imagesphereresize6 = zeros(7168:7168);
                   imagesphereresize6 = uint8(imagesphereresize6);
                   imagesphereresize6(1:r1,1:c1)=imagesphere6;
                   newFile6 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'01NeuriteBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize6,[foldername1 <span class="string">'/'</span> newFile6]);
                   clear <span class="string">imagesphereresize6</span>;
                   clear <span class="string">imagesphere6</span>;

                   imagesphere7 = imgneurite(y_3:y_4,x_3:x_4);
                   [r2 c2] = size(imagesphere7);
                   imagesphereresize7 = zeros(7168:7168);
                   imagesphereresize7 = uint8(imagesphereresize7);
                   imagesphereresize7(1:r2,1:c2)=imagesphere7;
                   newFile7 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'02NeuriteBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize7,[foldername1 <span class="string">'/'</span> newFile7]);
                   clear <span class="string">imagesphereresize7</span>;
                   clear <span class="string">imagesphere7</span>;

                   imagesphere8 = imgneurite(y_5:y_6,x_5:x_6);
                   [r3 c3] = size(imagesphere8);
                   imagesphereresize8 = zeros(7168:7168);
                   imagesphereresize8 = uint8(imagesphereresize8);
                   imagesphereresize8(1:r3,1:c3)=imagesphere8;
                   newFile8 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'03NeuriteBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize8,[foldername1 <span class="string">'/'</span> newFile8]);
                   clear <span class="string">imagesphereresize8</span>;
                   clear <span class="string">imagesphere8</span>;

                   imagesphere9 = imgneurite(y_7:y_8,x_7:x_8);
                   [r4 c4] = size(imagesphere9);
                   imagesphereresize9 = zeros(7168:7168);
                   imagesphereresize9 = uint8(imagesphereresize9);
                   imagesphereresize9(1:r4,1:c4)=imagesphere9;
                   newFile9 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'04NeuriteBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize9,[foldername1 <span class="string">'/'</span> newFile9]);
                   clear <span class="string">imagesphereresize9</span>;
                   clear <span class="string">imagesphere9</span>;

                   imagesphereresize10 = zeros(7168:7168);
            	   newFile10 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'05NeuriteBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize10,[foldername1 <span class="string">'/'</span> newFile10]);
                   clear <span class="string">imagesphereresize10</span>;

               <span class="keyword">end</span>

               <span class="keyword">if</span>(Oligo_Channel &gt; 0)
                   <span class="comment">% Same for Oligos</span>
                   imagesphere11 = imgoligo(y_1:y_2,x_1:x_2);
                   [r1 c1] = size(imagesphere11);
                   imagesphereresize11 = zeros(7168:7168);
                   imagesphereresize11 = uint8(imagesphereresize11);
                   imagesphereresize11(1:r1,1:c1)=imagesphere11;
                   newFile11 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'01OligoBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize11,[foldername1 <span class="string">'/'</span> newFile11]);
                   clear <span class="string">imagesphereresize11</span>;
                   clear <span class="string">imagesphere11</span>;

                   imagesphere12 = imgoligo(y_3:y_4,x_3:x_4);
                   [r2 c2] = size(imagesphere12);
                   imagesphereresize12 = zeros(7168:7168);
                   imagesphereresize12 = uint8(imagesphereresize12);
                   imagesphereresize12(1:r2,1:c2)=imagesphere12;
                   newFile12 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'02OligoBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize12,[foldername1 <span class="string">'/'</span> newFile12]);
                   clear <span class="string">imagesphereresize12</span>;
                   clear <span class="string">imagesphere12</span>;

                   imagesphere13 = imgoligo(y_5:y_6,x_5:x_6);
                   [r3 c3] = size(imagesphere13);
                   imagesphereresize13 = zeros(7168:7168);
                   imagesphereresize13 = uint8(imagesphereresize13);
                   imagesphereresize13(1:r3,1:c3)=imagesphere13;
                   newFile13 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'03OligoBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize13,[foldername1 <span class="string">'/'</span> newFile13]);
                   clear <span class="string">imagesphereresize13</span>;
                   clear <span class="string">imagesphere13</span>;

                   imagesphere14 = imgoligo(y_7:y_8,x_7:x_8);
                   [r4 c4] = size(imagesphere14);
                   imagesphereresize14 = zeros(7168:7168);
                   imagesphereresize14 = uint8(imagesphereresize14);
                   imagesphereresize14(1:r4,1:c4)=imagesphere14;
                   newFile14 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'04OligoBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize14,[foldername1 <span class="string">'/'</span> newFile14]);
                   clear <span class="string">imagesphereresize14</span>;
                   clear <span class="string">imagesphere14</span>;

                   imagesphereresize15 = zeros(7168:7168);
            	   newFile15 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'05OligoBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize15,[foldername1 <span class="string">'/'</span> newFile15]);
                   clear <span class="string">imagesphereresize15</span>;
               <span class="keyword">end</span>

               <span class="keyword">if</span>(Astro_Channel &gt;0)
                   <span class="comment">% Same for Astros</span>
                   imagesphere16 = imgastro(y_1:y_2,x_1:x_2);
                   [r1 c1] = size(imagesphere16);
                   imagesphereresize16 = zeros(7168:7168);
                   imagesphereresize16 = uint8(imagesphereresize16);
                   imagesphereresize16(1:r1,1:c1)=imagesphere16;
                   newFile16 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'01AstroBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize16,[foldername1 <span class="string">'/'</span> newFile16]);
                   clear <span class="string">imagesphereresize16</span>;
                   clear <span class="string">imagesphere16</span>;

                   imagesphere17 = imgastro(y_3:y_4,x_3:x_4);
                   [r2 c2] = size(imagesphere17);
                   imagesphereresize17 = zeros(7168:7168);
                   imagesphereresize17 = uint8(imagesphereresize17);
                   imagesphereresize17(1:r2,1:c2)=imagesphere17;
                   newFile17 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'02AstroBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize17,[foldername1 <span class="string">'/'</span> newFile17]);
                   clear <span class="string">imagesphereresize17</span>;
                   clear <span class="string">imagesphere17</span>;

                   imagesphere18 = imgastro(y_5:y_6,x_5:x_6);
                   [r3 c3] = size(imagesphere18);
                   imagesphereresize18 = zeros(7168:7168);
                   imagesphereresize18 = uint8(imagesphereresize18);
                   imagesphereresize18(1:r3,1:c3)=imagesphere18;
                   newFile18 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'03AstroBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize18,[foldername1 <span class="string">'/'</span> newFile18]);
                   clear <span class="string">imagesphereresize18</span>;
                   clear <span class="string">imagesphere18</span>;

                   imagesphere19 = imgastro(y_7:y_8,x_7:x_8);
                   [r4 c4] = size(imagesphere19);
                   imagesphereresize19 = zeros(7168:7168);
                   imagesphereresize19 = uint8(imagesphereresize19);
                   imagesphereresize19(1:r4,1:c4)=imagesphere19;
                   newFile19 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'04AstroBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize19,[foldername1 <span class="string">'/'</span> newFile19]);
                   clear <span class="string">imagesphereresize19</span>;
                   clear <span class="string">imagesphere19</span>;

                   imagesphereresize20 = zeros(7168:7168);
            	   newFile20 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'05AstroBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize20,[foldername1 <span class="string">'/'</span> newFile20]);
                   clear <span class="string">imagesphereresize20</span>;
               <span class="keyword">end</span>
            <span class="keyword">else</span>

            <span class="keyword">end</span>

            <span class="keyword">if</span>(s_L &gt;= 5);
               <span class="comment">% Extracts the x and y coordinates from s</span>
               x_centroid(1) = s(1).Centroid(1);
               y_centroid(1) = s(1).Centroid(2);
               x_centroid(2) = s(2).Centroid(1);
               y_centroid(2) = s(2).Centroid(2);
               x_centroid(3) = s(3).Centroid(1);
               y_centroid(3) = s(3).Centroid(2);
               x_centroid(4) = s(4).Centroid(1);
               y_centroid(4) = s(4).Centroid(2);
               x_centroid(5) = s(5).Centroid(1);
               y_centroid(5) = s(5).Centroid(2);
               <span class="comment">% Calculates the distance between the centroids of the</span>
               <span class="comment">% neurosphere an all boarders of the cover slip</span>





               <span class="comment">% Distance between centroid(1) and centroid(2)</span>
               d1_2 = ((x_centroid(1)-x_centroid(2))^2+(y_centroid(1)-y_centroid(2))^2)^0.5;
               <span class="comment">% Distance between centroid(1) and centroid(3)</span>
               d1_3 = ((x_centroid(1)-x_centroid(3))^2+(y_centroid(1)-y_centroid(3))^2)^0.5;
               <span class="comment">% Distance between centroid(1) and centroid(4)</span>
               d1_4 = ((x_centroid(1)-x_centroid(4))^2+(y_centroid(1)-y_centroid(4))^2)^0.5;
               <span class="comment">% Distance between centroid(1) and centroid(5)</span>
               d1_5 = ((x_centroid(1)-x_centroid(5))^2+(y_centroid(1)-y_centroid(5))^2)^0.5;
               <span class="comment">% Distance between centroid(2) and centroid(3)</span>
               d2_3 = ((x_centroid(3)-x_centroid(2))^2+(y_centroid(3)-y_centroid(2))^2)^0.5;
               <span class="comment">% Distance between centroid(2) and centroid(4)</span>
               d2_4 = ((x_centroid(4)-x_centroid(2))^2+(y_centroid(4)-y_centroid(2))^2)^0.5;
               <span class="comment">% Distance between centroid(2) and centroid(5)</span>
               d2_5 = ((x_centroid(5)-x_centroid(2))^2+(y_centroid(5)-y_centroid(2))^2)^0.5;
               <span class="comment">% Distance between centroid(3) and centroid(4)</span>
               d3_4 = ((x_centroid(4)-x_centroid(3))^2+(y_centroid(4)-y_centroid(3))^2)^0.5;
               <span class="comment">% Distance between centroid(3) and centroid(5)</span>
               d3_5 = ((x_centroid(5)-x_centroid(3))^2+(y_centroid(5)-y_centroid(3))^2)^0.5;
               <span class="comment">% Distance between centroid(4) and centroid(5)</span>
               d4_5 = ((x_centroid(4)-x_centroid(5))^2+(y_centroid(4)-y_centroid(5))^2)^0.5;
               <span class="comment">%Distances to rims for sphere 1</span>

               d1_x_1 = ((x_centroid(1)-1)^2+(y_centroid(1)-y_centroid(1))^2)^0.5
               d1_x10752 = ((10752 - x_centroid(1)-1)+(y_centroid(1)-y_centroid(1))^2)^0.5
               d1_y0 = ((x_centroid(1)-x_centroid(1))^2+(y_centroid(1)-1)^2)^0.5
               d1_y13824 = ((x_centroid(1)-x_centroid(1))^2+(13824-y_centroid(1))^2)^0.5







               <span class="comment">%Sphere 1 and 2:</span>
               <span class="keyword">if</span>(d1_2&lt;MinimumDistance);
                   S12 = 1;
                   <span class="comment">% Calculate line equation for d_12</span>
                   m_12 = (y_centroid(2)-y_centroid(1))/(x_centroid(2)-x_centroid(1));
                   b_12 = y_centroid(1)-(m_12*x_centroid(1));
                   <span class="comment">% 2) Calculate Coordinate of d_12/2</span>
                   x_c_12 = x_centroid(1) + (x_centroid(2)-x_centroid(1))/2;
                   y_c_12 = m_12*x_c_12 + b_12
                   <span class="comment">% Calculate max distance in x from sphere 2 to 1:</span>
                   x_12_1 = x_centroid(1) - (maxaddedlength);
                   x_12_2 = x_c_12
                   <span class="comment">%Introduce ratio of x/y (to rule out cases where two</span>
                   <span class="comment">%spheres have a very small differences in x or y but not</span>
                   <span class="comment">%in the other coordinate</span>
                   xy_1 = abs(x_centroid(2)-x_centroid(1))/abs(y_centroid(2)-y_centroid(1))
                   yx_1 = abs(y_centroid(2)-y_centroid(1))/abs(x_centroid(2)-x_centroid(1))
                   <span class="keyword">if</span>(xy_1 &lt; minxy_ratio &amp;&amp; d1_2 &gt; mindist)
                       x_c_12 = 1000000;
                       y_c_12 = 1000000;
                       x_12_1 = x_centroid(1) - (maxaddedlength);
                       x_12_2 = x_centroid(1) + (maxaddedlength);
                       y_12_1 = y_centroid(1)-(maxaddedlength);
                       y_12_2 = y_centroid(1)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(yx_1 &lt; minxy_ratio &amp;&amp; d1_2 &gt; mindist)
                       x_c_12 = 1000000;
                       y_c_12 = 1000000;
                       x_12_1 = x_centroid(1) - (maxaddedlength);
                       x_12_2 = x_centroid(1) + (maxaddedlength);
                       y_12_1 = y_centroid(1)-(maxaddedlength);
                       y_12_2 = y_centroid(1)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_12 &gt; y_centroid(1))
                       y_12_1 = y_centroid(1)-(maxaddedlength)
                       y_12_2 = y_c_12
                   <span class="keyword">else</span>
                       y_12_1 = y_c_12
                       y_12_2 = y_centroid(1)+(maxaddedlength)
                   <span class="keyword">end</span>
               <span class="keyword">else</span>
                   S12 = 0;
                   x_c_12 = 1000000;
                   y_c_12 = 1000000;
                   x_12_1 = x_centroid(1) - (maxaddedlength);
                   x_12_2 = x_centroid(1) + (maxaddedlength);
                   y_12_1 = y_centroid(1)-(maxaddedlength);
                   y_12_2 = y_centroid(1)+(maxaddedlength);
               <span class="keyword">end</span>

               <span class="comment">%Sphere 1 and 3:</span>
               <span class="keyword">if</span>(d1_3&lt;MinimumDistance);
                   S13 = 1;
                   <span class="comment">% Calculate line equation for d_13</span>
                   m_13 = (y_centroid(3)-y_centroid(1))/(x_centroid(3)-x_centroid(1));
                   b_13 = y_centroid(1)-(m_13*x_centroid(1));
                   <span class="comment">% 2) Calculate Coordinate of d_13/2</span>
                   x_c_13 = x_centroid(1) + (x_centroid(3)-x_centroid(1))/2;
                   y_c_13 = m_13*x_c_13 + b_13
                   <span class="comment">% Calculate max distance in x from sphere 2 to 1:</span>
                   x_13_1 = x_centroid(1) - (maxaddedlength);
                   x_13_2 = x_c_13
                   <span class="comment">%Introduce ratio of x/y (to rule out cases where two</span>
                   <span class="comment">%spheres have a very small differences in x or y but not</span>
                   <span class="comment">%in the other coordinate</span>
                   xy_2 = abs(x_centroid(3)-x_centroid(1))/abs(y_centroid(3)-y_centroid(1))
                   yx_2 = abs(y_centroid(3)-y_centroid(1))/abs(x_centroid(3)-x_centroid(1))
                   <span class="keyword">if</span>(xy_2 &lt; minxy_ratio &amp;&amp; d1_3 &gt; mindist)
                       x_c_13 = 1000000;
                       y_c_13 = 1000000;
                       x_13_1 = x_centroid(1) - (maxaddedlength);
                       x_13_2 = x_centroid(1) + (maxaddedlength);
                       y_13_1 = y_centroid(1)-(maxaddedlength);
                       y_13_2 = y_centroid(1)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(yx_2 &lt; minxy_ratio &amp;&amp; d1_3 &gt; mindist)
                       x_c_13 = 1000000;
                       y_c_13 = 1000000;
                       x_13_1 = x_centroid(1) - (maxaddedlength);
                       x_13_2 = x_centroid(1) + (maxaddedlength);
                       y_13_1 = y_centroid(1)-(maxaddedlength);
                       y_13_2 = y_centroid(1)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_13 &gt; y_centroid(1))
                       y_13_1 = y_centroid(1)-(maxaddedlength)
                       y_13_2 = y_c_13
                   <span class="keyword">else</span>
                       y_13_1 = y_c_13
                       y_13_2 = y_centroid(1)+(maxaddedlength)
                   <span class="keyword">end</span>
               <span class="keyword">else</span>
                   S13 = 0;
                   x_c_13 = 1000000;
                   y_c_13 = 1000000;
                   x_13_1 = x_centroid(1) - (maxaddedlength);
                   x_13_2 = x_centroid(1) + (maxaddedlength);
                   y_13_1 = y_centroid(1)-(maxaddedlength);
                   y_13_2 = y_centroid(1)+(maxaddedlength);
               <span class="keyword">end</span>

               <span class="comment">%Sphere 1 and 4:</span>
               <span class="keyword">if</span>(d1_4&lt;MinimumDistance);
                   S14 = 1;
                   <span class="comment">% Calculate line equation for d_14</span>
                   m_14 = (y_centroid(4)-y_centroid(1))/(x_centroid(4)-x_centroid(1));
                   b_14 = y_centroid(1)-(m_14*x_centroid(1));
                   <span class="comment">% 2) Calculate Coordinate of d_14/2</span>
                   x_c_14 = x_centroid(1) + (x_centroid(4)-x_centroid(1))/2;
                   y_c_14 = m_14*x_c_14 + b_14
                   <span class="comment">% Calculate max distance in x from sphere 2 to 1:</span>
                   x_14_1 = x_centroid(1) - (maxaddedlength);
                   x_14_2 = x_c_14
                   <span class="comment">%Introduce ratio of x/y (to rule out cases where two</span>
                   <span class="comment">%spheres have a very small differences in x or y but not</span>
                   <span class="comment">%in the other coordinate</span>
                   xy_3 = abs(x_centroid(4)-x_centroid(1))/abs(y_centroid(4)-y_centroid(1))
                   yx_3 = abs(y_centroid(4)-y_centroid(1))/abs(x_centroid(4)-x_centroid(1))
                   <span class="keyword">if</span>(xy_3 &lt; minxy_ratio &amp;&amp; d1_4 &gt; mindist)
                       x_c_14 = 1000000;
                       y_c_14 = 1000000;
                       x_14_1 = x_centroid(1) - (maxaddedlength);
                       x_14_2 = x_centroid(1) + (maxaddedlength);
                       y_14_1 = y_centroid(1)-(maxaddedlength);
                       y_14_2 = y_centroid(1)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(yx_3 &lt; minxy_ratio &amp;&amp; d1_4 &gt; mindist)
                       x_c_14 = 1000000;
                       y_c_14 = 1000000;
                       x_14_1 = x_centroid(1) - (maxaddedlength);
                       x_14_2 = x_centroid(1) + (maxaddedlength);
                       y_14_1 = y_centroid(1)-(maxaddedlength);
                       y_14_2 = y_centroid(1)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_14 &gt; y_centroid(1))
                       y_14_1 = y_centroid(1)-(maxaddedlength)
                       y_14_2 = y_c_14
                   <span class="keyword">else</span>
                       y_14_1 = y_c_14
                       y_14_2 = y_centroid(1)+(maxaddedlength)
                   <span class="keyword">end</span>
               <span class="keyword">else</span>
                   S14 = 0;
                   x_c_14 = 1000000;
                   y_c_14 = 1000000;
                   x_14_1 = x_centroid(1) - (maxaddedlength);
                   x_14_2 = x_centroid(1) + (maxaddedlength);
                   y_14_1 = y_centroid(1)-(maxaddedlength);
                   y_14_2 = y_centroid(1)+(maxaddedlength);
               <span class="keyword">end</span>

               <span class="comment">%Sphere 1 and 5:</span>
               <span class="keyword">if</span>(d1_5&lt;MinimumDistance);
                   S15 = 1;
                   <span class="comment">% Calculate line equation for d_15</span>
                   m_15 = (y_centroid(5)-y_centroid(1))/(x_centroid(5)-x_centroid(1));
                   b_15 = y_centroid(1)-(m_15*x_centroid(1));
                   <span class="comment">% 2) Calculate Coordinate of d_15/2</span>
                   x_c_15 = x_centroid(1) + (x_centroid(5)-x_centroid(1))/2;
                   y_c_15 = m_15*x_c_15 + b_15
                   <span class="comment">% Calculate max distance in x from sphere 2 to 1:</span>
                   x_15_1 = x_centroid(1) - (maxaddedlength);
                   x_15_2 = x_c_15
                   <span class="comment">%Introduce ratio of x/y (to rule out cases where two</span>
                   <span class="comment">%spheres have a very small differences in x or y but not</span>
                   <span class="comment">%in the other coordinate</span>
                   xy_4 = abs(x_centroid(5)-x_centroid(1))/abs(y_centroid(5)-y_centroid(1))
                   yx_4 = abs(y_centroid(5)-y_centroid(1))/abs(x_centroid(5)-x_centroid(1))
                   <span class="keyword">if</span>(xy_4 &lt; minxy_ratio &amp;&amp; d1_5 &gt; mindist)
                       x_c_15 = 1000000;
                       y_c_15 = 1000000;
                       x_15_1 = x_centroid(1) - (maxaddedlength);
                       x_15_2 = x_centroid(1) + (maxaddedlength);
                       y_15_1 = y_centroid(1)-(maxaddedlength);
                       y_15_2 = y_centroid(1)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(yx_4 &lt; minxy_ratio &amp;&amp; d1_5 &gt; mindist)
                       x_c_15 = 1000000;
                       y_c_15 = 1000000;
                       x_15_1 = x_centroid(1) - (maxaddedlength);
                       x_15_2 = x_centroid(1) + (maxaddedlength);
                       y_15_1 = y_centroid(1)-(maxaddedlength);
                       y_15_2 = y_centroid(1)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_15 &gt; y_centroid(1))
                       y_15_1 = y_centroid(1)-(maxaddedlength)
                       y_15_2 = y_c_15
                   <span class="keyword">else</span>
                       y_15_1 = y_c_15
                       y_15_2 = y_centroid(1)+(maxaddedlength)
                   <span class="keyword">end</span>
               <span class="keyword">else</span>
                   S15 = 0;
                   x_c_15 = 1000000;
                   y_c_15 = 1000000;
                   x_15_1 = x_centroid(1) - (maxaddedlength);
                   x_15_2 = x_centroid(1) + (maxaddedlength);
                   y_15_1 = y_centroid(1)-(maxaddedlength);
                   y_15_2 = y_centroid(1)+(maxaddedlength);
               <span class="keyword">end</span>



               min_x_1 = x_centroid(1) - (maxaddedlength);

               V_x6 = [x_c_12;x_c_13;x_c_14;x_c_15];
               min_x_2 = min(V_x6(1:4));


               <span class="keyword">if</span>(min_x_2 == 1000000)
                   min_x_2 = x_centroid(1) + (maxaddedlength);
               <span class="keyword">end</span>

               <span class="keyword">if</span>(y_c_12 &lt; 1000000 || y_c_13 &lt; 1000000 || y_c_14 &lt; 1000000 || y_c_15 &lt; 1000000)

                   <span class="keyword">if</span>(y_c_12 - y_centroid(1)&gt;0 &amp;&amp; y_c_12 - y_centroid(1)&lt;500000);
                       y_c_12_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_12_s = y_c_12;
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_13 - y_centroid(1)&gt;0 &amp;&amp; y_c_13 - y_centroid(1)&lt;500000);
                       y_c_13_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_13_s = y_c_13;
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_14 - y_centroid(1)&gt;0 &amp;&amp; y_c_14 - y_centroid(1)&lt;500000);
                       y_c_14_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_14_s = y_c_14;
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_15 - y_centroid(1)&gt;0 &amp;&amp; y_c_15 - y_centroid(1)&lt;500000);
                       y_c_15_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_15_s = y_c_15;
                   <span class="keyword">end</span>
                   V_y5=[y_c_12_s;y_c_13_s;y_c_14_s;y_c_15_s];
                   min_y_1 = min(V_y5(1:4));
                   <span class="keyword">if</span>(min_y_1 == 1000000)
                       min_y_1 = y_centroid(1)- (maxaddedlength);
                   <span class="keyword">end</span>

               <span class="keyword">else</span>
                   min_y_1 = y_centroid(1)- (maxaddedlength);
               <span class="keyword">end</span>

               <span class="keyword">if</span>(y_c_12 &lt; 1000000 || y_c_13 &lt; 1000000 || y_c_14 &lt; 1000000 || y_c_15 &lt; 1000000)
                   <span class="keyword">if</span>(y_c_12 - y_centroid(1)&lt;0 &amp;&amp; y_c_12 - y_centroid(1)&lt;500000);
                       y_c_12_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_12_s = y_c_12;
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_13 - y_centroid(1)&lt;0 &amp;&amp; y_c_13 - y_centroid(1)&lt;500000);
                       y_c_13_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_13_s = y_c_13;
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_14 - y_centroid(1)&lt;0 &amp;&amp; y_c_14 - y_centroid(1)&lt;500000);
                       y_c_14_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_14_s = y_c_14;
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_15 - y_centroid(1)&lt;0 &amp;&amp; y_c_15 - y_centroid(1)&lt;500000);
                       y_c_15_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_15_s = y_c_15;
                   <span class="keyword">end</span>
                   V_y6=[y_c_12_s;y_c_13_s;y_c_14_s;y_c_15_s];
                   min_y_2 = min(V_y6(1:4));
                   <span class="keyword">if</span>(min_y_2 == 1000000)
                       min_y_2 = y_centroid(1)+ (maxaddedlength);
                   <span class="keyword">end</span>

               <span class="keyword">else</span>
                   min_y_2 = y_centroid(1)+ (maxaddedlength);
               <span class="keyword">end</span>


               <span class="keyword">if</span>(min_x_1&lt;1)
                   x_1 = 1
               <span class="keyword">else</span>
                   x_1 = min_x_1;
               <span class="keyword">end</span>

               <span class="keyword">if</span>(min_x_2&gt;10752)
                   x_2 = 10752
               <span class="keyword">else</span>
                   x_2 = min_x_2;
               <span class="keyword">end</span>

               <span class="keyword">if</span>(min_y_1&lt;1)
                   y_1 = 1
               <span class="keyword">else</span>
                   y_1 = min_y_1;
               <span class="keyword">end</span>

               <span class="keyword">if</span>(min_y_2&gt;13824)
                   y_2 = 13824
               <span class="keyword">else</span>
                   y_2 = min_y_2;
               <span class="keyword">end</span>



               <span class="comment">%The rectangular image is cutted from the imgnucleus image containing the whole cover slip</span>
               imagesphere1 = imgnucleus(y_1:y_2,x_1:x_2);
               <span class="comment">% Dimensions of imagesphere1 are determined</span>
               [r1 c1] = size(imagesphere1);
               <span class="comment">% An empty matrix is generated</span>
               imagesphereresize1 = zeros(7168:7168);
               <span class="comment">% imagesphereresize1 is converted to 8-bit</span>
               imagesphereresize1 = uint8(imagesphereresize1);
               <span class="comment">%The empty indices in the imagesphereresize1 matrix are overwritten with imagesphere 1 entries</span>
               imagesphereresize1(1:r1,1:c1)=imagesphere1;
               <span class="comment">% imagesphereresize1 is saved to final destination</span>
               newFile1 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'01NucleusBig'</span>],<span class="string">'ignorecase'</span>);
               imwrite(imagesphereresize1,[foldername1 <span class="string">'/'</span> newFile1]);
               clear <span class="string">imagesphereresize1</span>;
               clear <span class="string">imagesphere1</span>;

               <span class="comment">% Same for sphere core 2</span>
              <span class="keyword">if</span>(d1_2&lt;MinimumDistance);
                   S21 = 1;
                   <span class="comment">% Calculate line equation for d_12</span>
                   m_12 = (y_centroid(2)-y_centroid(1))/(x_centroid(2)-x_centroid(1));
                   b_12 = y_centroid(1)-(m_12*x_centroid(1));
                   <span class="comment">% 2) Calculate Coordinate of d_12/2</span>
                   x_c_12 = x_centroid(1) + (x_centroid(2)-x_centroid(1))/2;
                   y_c_12 = m_12*x_c_12 + b_12
                   <span class="comment">% Calculate max distance in x from sphere 2 to 1:</span>
                   x_12_1 = x_c_12;
                   x_12_2 = x_centroid(2) + (maxaddedlength);
                   <span class="comment">%Introduce ratio of x/y (to rule out cases where two</span>
                   <span class="comment">%spheres have a very small differences in x or y but not</span>
                   <span class="comment">%in the other coordinate</span>
                   xy_1 = abs(x_centroid(2)-x_centroid(1))/abs(y_centroid(2)-y_centroid(1))
                   yx_1 = abs(y_centroid(2)-y_centroid(1))/abs(x_centroid(2)-x_centroid(1))
                   <span class="keyword">if</span>(xy_1 &lt; minxy_ratio &amp;&amp; d1_2 &gt; mindist)
                       x_c_12 = 1000000;
                       y_c_12 = 1000000;
                       x_12_1 = x_centroid(2) - (maxaddedlength);
                       x_12_2 = x_centroid(2) + (maxaddedlength);
                       y_12_1 = y_centroid(2)-(maxaddedlength);
                       y_12_2 = y_centroid(2)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(yx_1 &lt; minxy_ratio &amp;&amp; d1_2 &gt; mindist)
                       x_c_12 = 1000000;
                       y_c_12 = 1000000;
                       x_12_1 = x_centroid(2) - (maxaddedlength);
                       x_12_2 = x_centroid(2) + (maxaddedlength);
                       y_12_1 = y_centroid(2)-(maxaddedlength);
                       y_12_2 = y_centroid(2)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_12 &gt; y_centroid(2))
                       y_12_1 = y_centroid(2)-(maxaddedlength)
                       y_12_2 = y_c_12
                   <span class="keyword">else</span>
                       y_12_1 = y_c_12
                       y_12_2 = y_centroid(2)+(maxaddedlength)
                   <span class="keyword">end</span>
               <span class="keyword">else</span>
                   S12 = 0;
                   x_c_12 = 1000000;
                   y_c_12 = 1000000;
                   x_12_1 = x_centroid(2) - (maxaddedlength);
                   x_12_2 = x_centroid(2) + (maxaddedlength);
                   y_12_1 = y_centroid(2)-(maxaddedlength);
                   y_12_2 = y_centroid(2)+(maxaddedlength);
              <span class="keyword">end</span>

              <span class="keyword">if</span>(d2_3&lt;MinimumDistance);
                   S23 = 1;
                   <span class="comment">% Calculate line equation for d_12</span>
                   m_23 = (y_centroid(3)-y_centroid(2))/(x_centroid(3)-x_centroid(2));
                   b_23 = y_centroid(2)-(m_23*x_centroid(2));
                   <span class="comment">% 2) Calculate Coordinate of d_12/2</span>
                   x_c_23 = x_centroid(2) + (x_centroid(3)-x_centroid(2))/2;
                   y_c_23 = m_23*x_c_23 + b_23
                   <span class="comment">% Calculate max distance in x from sphere 2 to 1:</span>
                   x_23_1 = x_centroid(2) - (maxaddedlength);
                   x_23_2 = x_c_23;
                   xy_2 = abs(x_centroid(2)-x_centroid(3))/abs(y_centroid(2)-y_centroid(3))
                   yx_2 = abs(y_centroid(2)-y_centroid(3))/abs(x_centroid(2)-x_centroid(3))
                   <span class="keyword">if</span>(xy_2 &lt; minxy_ratio &amp;&amp; d2_3 &gt; mindist)
                       x_c_23 = 1000000;
                       y_c_23 = 1000000;
                       x_23_1 = x_centroid(2) - (maxaddedlength);
                       x_23_2 = x_centroid(2) + (maxaddedlength);
                       y_23_1 = y_centroid(2)-(maxaddedlength);
                       y_23_2 = y_centroid(2)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(yx_2 &lt; minxy_ratio &amp;&amp; d2_3 &gt; mindist)
                       x_c_23 = 1000000;
                       y_c_23 = 1000000;
                       x_23_1 = x_centroid(2) - (maxaddedlength);
                       x_23_2 = x_centroid(2) + (maxaddedlength);
                       y_23_1 = y_centroid(2)-(maxaddedlength);
                       y_23_2 = y_centroid(2)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_23 &gt; y_centroid(2))
                       y_23_1 = y_centroid(2)-(maxaddedlength)
                       y_23_2 = y_c_23
                   <span class="keyword">else</span>
                       y_23_1 = y_c_23
                       y_23_2 = y_centroid(2)+(maxaddedlength)
                   <span class="keyword">end</span>
               <span class="keyword">else</span>
                   S12 = 0;
                   x_c_23 = 1000000;
                   y_c_23 = 1000000;
                   x_23_1 = x_centroid(2) - (maxaddedlength);
                   x_23_2 = x_centroid(2) + (maxaddedlength);
                   y_23_1 = y_centroid(2)-(maxaddedlength);
                   y_23_2 = y_centroid(2)+(maxaddedlength);
              <span class="keyword">end</span>

              <span class="keyword">if</span>(d2_4&lt;MinimumDistance);
                   S24 = 1;
                   <span class="comment">% Calculate line equation for d_12</span>
                   m_24 = (y_centroid(4)-y_centroid(2))/(x_centroid(4)-x_centroid(2));
                   b_24 = y_centroid(2)-(m_24*x_centroid(2));
                   <span class="comment">% 2) Calculate Coordinate of d_12/2</span>
                   x_c_24 = x_centroid(2) + (x_centroid(4)-x_centroid(2))/2;
                   y_c_24 = m_24*x_c_24 + b_24
                   <span class="comment">% Calculate max distance in x from sphere 2 to 1:</span>
                   x_24_1 = x_centroid(2) - (maxaddedlength);
                   x_24_2 = x_c_24;
                   xy_3 = abs(x_centroid(2)-x_centroid(4))/abs(y_centroid(2)-y_centroid(4))
                   yx_3 = abs(y_centroid(2)-y_centroid(4))/abs(x_centroid(2)-x_centroid(4))
                   <span class="keyword">if</span>(xy_3 &lt; minxy_ratio &amp;&amp; d2_4 &gt; mindist)
                       x_c_24 = 1000000;
                       y_c_24 = 1000000;
                       x_24_1 = x_centroid(2) - (maxaddedlength);
                       x_24_2 = x_centroid(2) + (maxaddedlength);
                       y_24_1 = y_centroid(2)-(maxaddedlength);
                       y_24_2 = y_centroid(2)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(yx_3 &lt; minxy_ratio &amp;&amp; d2_4 &gt; mindist)
                       x_c_24 = 1000000;
                       y_c_24 = 1000000;
                       x_24_1 = x_centroid(2) - (maxaddedlength);
                       x_24_2 = x_centroid(2) + (maxaddedlength);
                       y_24_1 = y_centroid(2)-(maxaddedlength);
                       y_24_2 = y_centroid(2)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_24 &gt; y_centroid(2))
                       y_24_1 = y_centroid(2)-(maxaddedlength)
                       y_24_2 = y_c_24
                   <span class="keyword">else</span>
                       y_24_1 = y_c_24
                       y_24_2 = y_centroid(2)+(maxaddedlength)
                   <span class="keyword">end</span>
               <span class="keyword">else</span>
                   S24 = 0;
                   x_c_24 = 1000000;
                   y_c_24 = 1000000;
                   x_24_1 = x_centroid(2) - (maxaddedlength);
                   x_24_2 = x_centroid(2) + (maxaddedlength);
                   y_24_1 = y_centroid(2)-(maxaddedlength);
                   y_24_2 = y_centroid(2)+(maxaddedlength);
              <span class="keyword">end</span>
               <span class="keyword">if</span>(d2_5&lt;MinimumDistance);
                   S25 = 1;
                   <span class="comment">% Calculate line equation for d_12</span>
                   m_25 = (y_centroid(5)-y_centroid(2))/(x_centroid(5)-x_centroid(2));
                   b_25 = y_centroid(2)-(m_25*x_centroid(2));
                   <span class="comment">% 2) Calculate Coordinate of d_12/2</span>
                   x_c_25 = x_centroid(2) + (x_centroid(5)-x_centroid(2))/2;
                   y_c_25 = m_25*x_c_25 + b_25
                   <span class="comment">% Calculate max distance in x from sphere 2 to 1:</span>
                   x_25_1 = x_centroid(2) - (maxaddedlength);
                   x_25_2 = x_c_25;
                   xy_4 = abs(x_centroid(2)-x_centroid(5))/abs(y_centroid(2)-y_centroid(5))
                   yx_4 = abs(y_centroid(2)-y_centroid(5))/abs(x_centroid(2)-x_centroid(5))
                   <span class="keyword">if</span>(xy_4 &lt; minxy_ratio &amp;&amp; d2_5 &gt; mindist)
                       x_c_25 = 1000000;
                       y_c_25 = 1000000;
                       x_25_1 = x_centroid(2) - (maxaddedlength);
                       x_25_2 = x_centroid(2) + (maxaddedlength);
                       y_25_1 = y_centroid(2)-(maxaddedlength);
                       y_25_2 = y_centroid(2)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(yx_4 &lt; minxy_ratio &amp;&amp; d2_5 &gt; mindist)
                       x_c_25 = 1000000;
                       y_c_25 = 1000000;
                       x_25_1 = x_centroid(2) - (maxaddedlength);
                       x_25_2 = x_centroid(2) + (maxaddedlength);
                       y_25_1 = y_centroid(2)-(maxaddedlength);
                       y_25_2 = y_centroid(2)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_25 &gt; y_centroid(2))
                       y_25_1 = y_centroid(2)-(maxaddedlength)
                       y_25_2 = y_c_25
                   <span class="keyword">else</span>
                       y_25_1 = y_c_25
                       y_25_2 = y_centroid(2)+(maxaddedlength)
                   <span class="keyword">end</span>
               <span class="keyword">else</span>
                   S25 = 0;
                   x_c_25 = 1000000;
                   y_c_25 = 1000000;
                   x_25_1 = x_centroid(2) - (maxaddedlength);
                   x_25_2 = x_centroid(2) + (maxaddedlength);
                   y_25_1 = y_centroid(2)-(maxaddedlength);
                   y_25_2 = y_centroid(2)+(maxaddedlength);
               <span class="keyword">end</span>

               <span class="keyword">if</span>(x_c_12 &lt; 1000000)
                   min_x_3 = x_c_12;
               <span class="keyword">else</span>
                   min_x_3 = x_centroid(2) - (maxaddedlength);
               <span class="keyword">end</span>

               V_x6 = [x_c_23;x_c_24;x_c_25];
               min_x_4 = min(V_x6(1:3));

               <span class="keyword">if</span>(min_x_4 == 1000000)
                   min_x_4 = x_centroid(2) + (maxaddedlength);
               <span class="keyword">end</span>

               <span class="keyword">if</span>(y_c_12 &lt; 1000000 || y_c_23 &lt; 1000000 || y_c_24 &lt; 1000000 || y_c_25 &lt; 1000000)

                   <span class="keyword">if</span>(y_c_12 - y_centroid(2)&gt;0 &amp;&amp; y_c_12 - y_centroid(2)&lt;500000);
                       y_c_12_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_12_s = y_c_12;
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_23 - y_centroid(2)&gt;0 &amp;&amp; y_c_23 - y_centroid(2)&lt;500000);
                       y_c_23_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_23_s = y_c_23;
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_24 - y_centroid(2)&gt;0 &amp;&amp; y_c_24 - y_centroid(2)&lt;500000);
                       y_c_24_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_24_s = y_c_24;
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_25 - y_centroid(2)&gt;0 &amp;&amp; y_c_25 - y_centroid(2)&lt;500000);
                       y_c_25_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_25_s = y_c_25;
                   <span class="keyword">end</span>
                   V_y5=[y_c_12_s;y_c_23_s;y_c_24_s;y_c_25_s];
                   min_y_3 = min(V_y5(1:4));
                   <span class="keyword">if</span>(min_y_3 == 1000000)
                       min_y_3 = y_centroid(2)- (maxaddedlength);
                   <span class="keyword">end</span>

               <span class="keyword">else</span>
                   min_y_3 = y_centroid(2)- (maxaddedlength);
               <span class="keyword">end</span>

               <span class="keyword">if</span>(y_c_12 &lt; 1000000 || y_c_23 &lt; 1000000 || y_c_24 &lt; 1000000 || y_c_25 &lt; 1000000)
                   <span class="keyword">if</span>(y_c_12 - y_centroid(2)&lt;0 &amp;&amp; y_c_12 - y_centroid(2)&lt;500000);
                       y_c_12_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_12_s = y_c_12;
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_23 - y_centroid(2)&lt;0 &amp;&amp; y_c_23 - y_centroid(2)&lt;500000);
                       y_c_23_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_23_s = y_c_23;
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_24 - y_centroid(2)&lt;0 &amp;&amp; y_c_24 - y_centroid(2)&lt;500000);
                       y_c_24_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_24_s = y_c_24;
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_25 - y_centroid(2)&lt;0 &amp;&amp; y_c_25 - y_centroid(2)&lt;500000);
                       y_c_25_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_25_s = y_c_25;
                   <span class="keyword">end</span>
                   V_y6=[y_c_12_s;y_c_23_s;y_c_24_s;y_c_25_s];
                   min_y_4 = min(V_y6(1:4));
                   <span class="keyword">if</span>(min_y_4 == 1000000)
                       min_y_4 = y_centroid(2)+ (maxaddedlength);
                   <span class="keyword">end</span>

               <span class="keyword">else</span>
                   min_y_4 = y_centroid(2)+ (maxaddedlength);
               <span class="keyword">end</span>

               <span class="keyword">if</span>(min_x_3&lt;1)
                   x_3 = 1
               <span class="keyword">else</span>
                   x_3 = min_x_3;
               <span class="keyword">end</span>

               <span class="keyword">if</span>(min_x_4&gt;10752)
                   x_4 = 10752
               <span class="keyword">else</span>
                   x_4 = min_x_4;
               <span class="keyword">end</span>

               <span class="keyword">if</span>(min_y_3&lt;1)
                   y_3 = 1
               <span class="keyword">else</span>
                   y_3 = min_y_3;
               <span class="keyword">end</span>

               <span class="keyword">if</span>(min_y_4&gt;13824)
                   y_4 = 13824
               <span class="keyword">else</span>
                   y_4 = min_y_4;
               <span class="keyword">end</span>

               imagesphere2 = imgnucleus(y_3:y_4,x_3:x_4);
               [r2 c2] = size(imagesphere2);
               imagesphereresize2 = zeros(7168:7168);
               imagesphereresize2 = uint8(imagesphereresize2);
               imagesphereresize2(1:r2,1:c2)=imagesphere2;
               newFile2 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'02NucleusBig'</span>],<span class="string">'ignorecase'</span>);
               imwrite(imagesphereresize2,[foldername1 <span class="string">'/'</span> newFile2]);
               clear <span class="string">imagesphereresize2</span>;
               clear <span class="string">imagesphere2</span>;

               <span class="comment">% Same for sphere core 3</span>

               <span class="keyword">if</span>(d1_3&lt;MinimumDistance);
                   S31 = 1;
                   <span class="comment">% Calculate line equation for d_12</span>
                   m_13 = (y_centroid(3)-y_centroid(1))/(x_centroid(3)-x_centroid(1));
                   b_13 = y_centroid(1)-(m_13*x_centroid(1));
                   <span class="comment">% 2) Calculate Coordinate of d_12/2</span>
                   x_c_13 = x_centroid(1) + (x_centroid(3)-x_centroid(1))/2;
                   y_c_13 = m_13*x_c_13 + b_13
                   <span class="comment">% Calculate max distance in x from sphere 2 to 1:</span>
                   x_13_1 = x_c_13;
                   x_13_2 = x_centroid(3) + (maxaddedlength);
                   <span class="comment">%Introduce ratio of x/y (to rule out cases where two</span>
                   <span class="comment">%spheres have a very small differences in x or y but not</span>
                   <span class="comment">%in the other coordinate</span>
                   xy_1 = abs(x_centroid(3)-x_centroid(1))/abs(y_centroid(3)-y_centroid(1))
                   yx_1 = abs(y_centroid(3)-y_centroid(1))/abs(x_centroid(3)-x_centroid(1))
                   <span class="keyword">if</span>(xy_1 &lt; minxy_ratio &amp;&amp; d1_3 &gt; mindist)
                       x_c_13 = 1000000;
                       y_c_13 = 1000000;
                       x_13_1 = x_centroid(3) - (maxaddedlength);
                       x_13_2 = x_centroid(3) + (maxaddedlength);
                       y_13_1 = y_centroid(3)-(maxaddedlength);
                       y_13_2 = y_centroid(3)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(yx_1 &lt; minxy_ratio &amp;&amp; d1_3 &gt; mindist)
                       x_c_13 = 1000000;
                       y_c_13 = 1000000;
                       x_13_1 = x_centroid(3) - (maxaddedlength);
                       x_13_2 = x_centroid(3) + (maxaddedlength);
                       y_13_1 = y_centroid(3)-(maxaddedlength);
                       y_13_2 = y_centroid(3)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_13 &gt; y_centroid(3))
                       y_13_1 = y_centroid(3)-(maxaddedlength)
                       y_13_2 = y_c_13
                   <span class="keyword">else</span>
                       y_13_1 = y_c_13
                       y_13_2 = y_centroid(3)+(maxaddedlength)
                   <span class="keyword">end</span>
               <span class="keyword">else</span>
                   S31 = 0;
                   x_c_13 = 1000000;
                   y_c_13 = 1000000;
                   x_13_1 = x_centroid(3) - (maxaddedlength);
                   x_13_2 = x_centroid(3) + (maxaddedlength);
                   y_13_1 = y_centroid(3)-(maxaddedlength);
                   y_13_2 = y_centroid(3)+(maxaddedlength);
              <span class="keyword">end</span>

              <span class="keyword">if</span>(d2_3&lt;MinimumDistance);
                   S32 = 1;
                   <span class="comment">% Calculate line equation for d_12</span>
                   m_23 = (y_centroid(3)-y_centroid(2))/(x_centroid(3)-x_centroid(2));
                   b_23 = y_centroid(2)-(m_23*x_centroid(2));
                   <span class="comment">% 2) Calculate Coordinate of d_12/2</span>
                   x_c_23 = x_centroid(2) + (x_centroid(3)-x_centroid(2))/2;
                   y_c_23 = m_23*x_c_23 + b_23
                   <span class="comment">% Calculate max distance in x from sphere 2 to 1:</span>
                   x_23_1 = x_c_23;
                   x_23_2 = x_centroid(3) + (maxaddedlength);
                   xy_2 = abs(x_centroid(3)-x_centroid(2))/abs(y_centroid(3)-y_centroid(2))
                   yx_2 = abs(y_centroid(3)-y_centroid(2))/abs(x_centroid(3)-x_centroid(2))
                   <span class="keyword">if</span>(xy_2 &lt; minxy_ratio &amp;&amp; d2_3 &gt; mindist)
                       x_c_23 = 1000000;
                       y_c_23 = 1000000;
                       x_23_1 = x_centroid(3) - (maxaddedlength);
                       x_23_2 = x_centroid(3) + (maxaddedlength);
                       y_23_1 = y_centroid(3)-(maxaddedlength);
                       y_23_2 = y_centroid(3)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(yx_2 &lt; minxy_ratio &amp;&amp; d2_3 &gt; mindist)
                       x_c_23 = 1000000;
                       y_c_23 = 1000000;
                       x_23_1 = x_centroid(3) - (maxaddedlength);
                       x_23_2 = x_centroid(3) + (maxaddedlength);
                       y_23_1 = y_centroid(3)-(maxaddedlength);
                       y_23_2 = y_centroid(3)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_23 &gt; y_centroid(3))
                       y_23_1 = y_centroid(3)-(maxaddedlength)
                       y_23_2 = y_c_23
                   <span class="keyword">else</span>
                       y_23_1 = y_c_23
                       y_23_2 = y_centroid(3)+(maxaddedlength)
                   <span class="keyword">end</span>
               <span class="keyword">else</span>
                   S32 = 0;
                   x_c_23 = 1000000;
                   y_c_23 = 1000000;
                   x_23_1 = x_centroid(3) - (maxaddedlength);
                   x_23_2 = x_centroid(3) + (maxaddedlength);
                   y_23_1 = y_centroid(3)-(maxaddedlength);
                   y_23_2 = y_centroid(3)+(maxaddedlength);
              <span class="keyword">end</span>

              <span class="keyword">if</span>(d3_4&lt;MinimumDistance);
                   S34 = 1;
                   <span class="comment">% Calculate line equation for d_12</span>
                   m_34 = (y_centroid(4)-y_centroid(3))/(x_centroid(4)-x_centroid(3));
                   b_34 = y_centroid(3)-(m_34*x_centroid(3));
                   <span class="comment">% 2) Calculate Coordinate of d_12/2</span>
                   x_c_34 = x_centroid(3) + (x_centroid(4)-x_centroid(3))/2;
                   y_c_34 = m_34*x_c_34 + b_34
                   <span class="comment">% Calculate max distance in x from sphere 2 to 1:</span>
                   x_34_1 = x_centroid(3) - (maxaddedlength);
                   x_34_2 = x_c_34;
                   xy_3 = abs(x_centroid(3)-x_centroid(4))/abs(y_centroid(3)-y_centroid(4))
                   yx_3 = abs(y_centroid(3)-y_centroid(4))/abs(x_centroid(3)-x_centroid(4))
                   <span class="keyword">if</span>(xy_3 &lt; minxy_ratio &amp;&amp; d3_4 &gt; mindist)
                       x_c_34 = 1000000;
                       y_c_34 = 1000000;
                       x_34_1 = x_centroid(3) - (maxaddedlength);
                       x_34_2 = x_centroid(3) + (maxaddedlength);
                       y_34_1 = y_centroid(3)-(maxaddedlength);
                       y_34_2 = y_centroid(3)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(yx_3 &lt; minxy_ratio &amp;&amp; d3_4 &gt; mindist)
                       x_c_34 = 1000000;
                       y_c_34 = 1000000;
                       x_34_1 = x_centroid(3) - (maxaddedlength);
                       x_34_2 = x_centroid(3) + (maxaddedlength);
                       y_34_1 = y_centroid(3)-(maxaddedlength);
                       y_34_2 = y_centroid(3)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_34 &gt; y_centroid(3))
                       y_34_1 = y_centroid(3)-(maxaddedlength)
                       y_34_2 = y_c_34
                   <span class="keyword">else</span>
                       y_34_1 = y_c_34
                       y_34_2 = y_centroid(3)+(maxaddedlength)
                   <span class="keyword">end</span>
               <span class="keyword">else</span>
                   S34 = 0;
                   x_c_34 = 1000000;
                   y_c_34 = 1000000;
                   x_34_1 = x_centroid(3) - (maxaddedlength);
                   x_34_2 = x_centroid(3) + (maxaddedlength);
                   y_34_1 = y_centroid(3)-(maxaddedlength);
                   y_34_2 = y_centroid(3)+(maxaddedlength);
              <span class="keyword">end</span>
               <span class="keyword">if</span>(d3_5&lt;MinimumDistance);
                   S35 = 1;
                   <span class="comment">% Calculate line equation for d_12</span>
                   m_35 = (y_centroid(5)-y_centroid(3))/(x_centroid(5)-x_centroid(3));
                   b_35 = y_centroid(3)-(m_35*x_centroid(3));
                   <span class="comment">% 2) Calculate Coordinate of d_12/2</span>
                   x_c_35 = x_centroid(3) + (x_centroid(5)-x_centroid(3))/2;
                   y_c_35 = m_35*x_c_35 + b_35
                   <span class="comment">% Calculate max distance in x from sphere 2 to 1:</span>
                   x_35_1 = x_centroid(3) - (maxaddedlength);
                   x_35_2 = x_c_35;
                   xy_4 = abs(x_centroid(3)-x_centroid(5))/abs(y_centroid(3)-y_centroid(5))
                   yx_4 = abs(y_centroid(3)-y_centroid(5))/abs(x_centroid(3)-x_centroid(5))
                   <span class="keyword">if</span>(xy_4 &lt; minxy_ratio &amp;&amp; d3_5 &gt; mindist)
                       x_c_35 = 1000000;
                       y_c_35 = 1000000;
                       x_35_1 = x_centroid(3) - (maxaddedlength);
                       x_35_2 = x_centroid(3) + (maxaddedlength);
                       y_35_1 = y_centroid(3)-(maxaddedlength);
                       y_35_2 = y_centroid(3)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(yx_4 &lt; minxy_ratio &amp;&amp; d3_5 &gt; mindist)
                       x_c_35 = 1000000;
                       y_c_35 = 1000000;
                       x_35_1 = x_centroid(3) - (maxaddedlength);
                       x_35_2 = x_centroid(3) + (maxaddedlength);
                       y_35_1 = y_centroid(3)-(maxaddedlength);
                       y_35_2 = y_centroid(3)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_35 &gt; y_centroid(3))
                       y_35_1 = y_centroid(3)-(maxaddedlength)
                       y_35_2 = y_c_35
                   <span class="keyword">else</span>
                       y_35_1 = y_c_35
                       y_35_2 = y_centroid(3)+(maxaddedlength)
                   <span class="keyword">end</span>
               <span class="keyword">else</span>
                   S35 = 0;
                   x_c_35 = 1000000;
                   y_c_35 = 1000000;
                   x_35_1 = x_centroid(3) - (maxaddedlength);
                   x_35_2 = x_centroid(3) + (maxaddedlength);
                   y_35_1 = y_centroid(3)-(maxaddedlength);
                   y_35_2 = y_centroid(3)+(maxaddedlength);
               <span class="keyword">end</span>

               <span class="keyword">if</span>(x_c_13 &gt;0 &amp;&amp; x_c_23&gt;0 &amp;&amp; x_c_13 &lt;1000000 &amp;&amp; x_c_23&lt;1000000 )
                   V_x5=[x_c_13;x_c_23];
                   min_x_5 = min(V_x5(1:2));
               <span class="keyword">else</span>
                   <span class="keyword">if</span>(x_c_13&gt;0 &amp;&amp; x_c_13 &lt;1000000)
                       min_x_5 = x_c_13
                   <span class="keyword">else</span>
                       <span class="keyword">if</span>(x_c_23&gt;0 &amp;&amp; x_c_23&lt;1000000)
                       min_x_5 = x_c_23
                       <span class="keyword">else</span>
                           min_x_5 = x_centroid(3)-(maxaddedlength);
                       <span class="keyword">end</span>
                   <span class="keyword">end</span>
               <span class="keyword">end</span>

               <span class="keyword">if</span>(x_c_34 &gt;0 &amp;&amp; x_c_35&gt;0 &amp;&amp; x_c_34 &lt;1000000 &amp;&amp; x_c_35&lt;1000000)
                   V_x6=[x_c_34;x_c_35];
                   min_x_6 = min(V_x6(1:2));
               <span class="keyword">else</span>
                   <span class="keyword">if</span>(x_c_34&gt;0 &amp;&amp; x_c_34 &lt;1000000)
                       min_x_6 = x_c_34
                   <span class="keyword">else</span>
                       <span class="keyword">if</span>(x_c_35&gt;0 &amp;&amp; x_c_35&lt;1000000)
                       min_x_6 = x_c_35
                       <span class="keyword">else</span>
                           min_x_6 = x_centroid(3)+(maxaddedlength);
                       <span class="keyword">end</span>
                   <span class="keyword">end</span>
               <span class="keyword">end</span>



               <span class="keyword">if</span>(y_c_13 &lt; 1000000 || y_c_23 &lt; 1000000 || y_c_34 &lt; 1000000 || y_c_35 &lt; 1000000)

                   <span class="keyword">if</span>(y_c_13 - y_centroid(3)&gt;0 &amp;&amp; y_c_13 - y_centroid(3)&lt;500000);
                       y_c_13_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_13_s = y_c_13;
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_23 - y_centroid(3)&gt;0 &amp;&amp; y_c_23 - y_centroid(3)&lt;500000);
                       y_c_23_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_23_s = y_c_23;
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_34 - y_centroid(3)&gt;0 &amp;&amp; y_c_34 - y_centroid(3)&lt;500000);
                       y_c_34_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_34_s = y_c_34;
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_35 - y_centroid(3)&gt;0 &amp;&amp; y_c_35 - y_centroid(3)&lt;500000);
                       y_c_35_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_35_s = y_c_35;
                   <span class="keyword">end</span>
                   V_y5=[y_c_13_s;y_c_23_s;y_c_34_s;y_c_35_s];
                   min_y_5 = min(V_y5(1:4));
                   <span class="keyword">if</span>(min_y_5 == 1000000)
                       min_y_5 = y_centroid(3)- (maxaddedlength);
                   <span class="keyword">end</span>

               <span class="keyword">else</span>
                   min_y_5 = y_centroid(3)- (maxaddedlength);
               <span class="keyword">end</span>

               <span class="keyword">if</span>(y_c_13 &lt; 1000000 || y_c_23 &lt; 1000000 || y_c_34 &lt; 1000000 || y_c_35 &lt; 1000000)
                   <span class="keyword">if</span>(y_c_13 - y_centroid(3)&lt;0 &amp;&amp; y_c_13 - y_centroid(3)&lt;500000);
                       y_c_13_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_13_s = y_c_13;
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_23 - y_centroid(3)&lt;0 &amp;&amp; y_c_23 - y_centroid(3)&lt;500000);
                       y_c_23_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_23_s = y_c_23;
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_34 - y_centroid(3)&lt;0 &amp;&amp; y_c_34 - y_centroid(3)&lt;500000);
                       y_c_34_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_34_s = y_c_34;
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_35 - y_centroid(3)&lt;0 &amp;&amp; y_c_35 - y_centroid(3)&lt;500000);
                       y_c_35_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_35_s = y_c_35;
                   <span class="keyword">end</span>
                   V_y6=[y_c_13_s;y_c_23_s;y_c_34_s;y_c_35_s];
                   min_y_6 = min(V_y6(1:4));
                   <span class="keyword">if</span>(min_y_6 == 1000000)
                       min_y_6 = y_centroid(3)+ (maxaddedlength);
                   <span class="keyword">end</span>

               <span class="keyword">else</span>
                   min_y_6 = y_centroid(3)+ (maxaddedlength);
               <span class="keyword">end</span>

               <span class="keyword">if</span>(min_x_5&lt;1)
                   x_5 = 1
               <span class="keyword">else</span>
                   x_5 = min_x_5;
               <span class="keyword">end</span>

               <span class="keyword">if</span>(min_x_6&gt;10752)
                   x_6 = 10752
               <span class="keyword">else</span>
                   x_6 = min_x_6;
               <span class="keyword">end</span>

               <span class="keyword">if</span>(min_y_5&lt;1)
                   y_5 = 1
               <span class="keyword">else</span>
                   y_5 = min_y_5;
               <span class="keyword">end</span>

               <span class="keyword">if</span>(min_y_6&gt;13824)
                   y_6 = 13824
               <span class="keyword">else</span>
                   y_6 = min_y_6;
               <span class="keyword">end</span>






               imagesphere3 = imgnucleus(y_5:y_6,x_5:x_6);
               [r3 c3] = size(imagesphere3);
               imagesphereresize3 = zeros(7168:7168);
               imagesphereresize3 = uint8(imagesphereresize3);
               imagesphereresize3(1:r3,1:c3)=imagesphere3;
               newFile3 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'03NucleusBig'</span>],<span class="string">'ignorecase'</span>);
               imwrite(imagesphereresize3,[foldername1 <span class="string">'/'</span> newFile3]);
               clear <span class="string">imagesphereresize3</span>;
               clear <span class="string">imagesphere3</span>;

               <span class="comment">% Same for sphere core 4</span>

               <span class="keyword">if</span>(d1_4&lt;MinimumDistance);
                   S41 = 1;
                   <span class="comment">% Calculate line equation for d_12</span>
                   m_14 = (y_centroid(4)-y_centroid(1))/(x_centroid(4)-x_centroid(1));
                   b_14 = y_centroid(1)-(m_14*x_centroid(1));
                   <span class="comment">% 2) Calculate Coordinate of d_12/2</span>
                   x_c_14 = x_centroid(1) + (x_centroid(4)-x_centroid(1))/2;
                   y_c_14 = m_14*x_c_14 + b_14
                   <span class="comment">% Calculate max distance in x from sphere 2 to 1:</span>
                   x_14_1 = x_c_14;
                   x_14_2 = x_centroid(4) + (maxaddedlength);
                   <span class="comment">%Introduce ratio of x/y (to rule out cases where two</span>
                   <span class="comment">%spheres have a very small differences in x or y but not</span>
                   <span class="comment">%in the other coordinate</span>
                   xy_1 = abs(x_centroid(4)-x_centroid(1))/abs(y_centroid(4)-y_centroid(1))
                   yx_1 = abs(y_centroid(4)-y_centroid(1))/abs(x_centroid(4)-x_centroid(1))
                   <span class="keyword">if</span>(xy_1 &lt; minxy_ratio &amp;&amp; d1_4 &gt; mindist)
                       x_c_14 = 1000000;
                       y_c_14 = 1000000;
                       x_14_1 = x_centroid(4) - (maxaddedlength);
                       x_14_2 = x_centroid(4) + (maxaddedlength);
                       y_14_1 = y_centroid(4)-(maxaddedlength);
                       y_14_2 = y_centroid(4)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(yx_1 &lt; minxy_ratio &amp;&amp; d1_4 &gt; mindist)
                       x_c_14 = 1000000;
                       y_c_14 = 1000000;
                       x_14_1 = x_centroid(4) - (maxaddedlength);
                       x_14_2 = x_centroid(4) + (maxaddedlength);
                       y_14_1 = y_centroid(4)-(maxaddedlength);
                       y_14_2 = y_centroid(4)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_14 &gt; y_centroid(4))
                       y_14_1 = y_centroid(4)-(maxaddedlength)
                       y_14_2 = y_c_14
                   <span class="keyword">else</span>
                       y_14_1 = y_c_14
                       y_14_2 = y_centroid(4)+(maxaddedlength)
                   <span class="keyword">end</span>
               <span class="keyword">else</span>
                   S41 = 0;
                   x_c_14 = 1000000;
                   y_c_14 = 1000000;
                   x_14_1 = x_centroid(4) - (maxaddedlength);
                   x_14_2 = x_centroid(4) + (maxaddedlength);
                   y_14_1 = y_centroid(4)-(maxaddedlength);
                   y_14_2 = y_centroid(4)+(maxaddedlength);
              <span class="keyword">end</span>

              <span class="keyword">if</span>(d2_4&lt;MinimumDistance);
                   S42 = 1;
                   <span class="comment">% Calculate line equation for d_12</span>
                   m_24 = (y_centroid(4)-y_centroid(2))/(x_centroid(4)-x_centroid(2));
                   b_24 = y_centroid(2)-(m_24*x_centroid(2));
                   <span class="comment">% 2) Calculate Coordinate of d_12/2</span>
                   x_c_24 = x_centroid(2) + (x_centroid(4)-x_centroid(2))/2;
                   y_c_24 = m_24*x_c_24 + b_24
                   <span class="comment">% Calculate max distance in x from sphere 2 to 1:</span>
                   x_24_1 = x_c_24;
                   x_24_2 = x_centroid(4) + (maxaddedlength);
                   xy_2 = abs(x_centroid(4)-x_centroid(2))/abs(y_centroid(4)-y_centroid(2))
                   yx_2 = abs(y_centroid(4)-y_centroid(2))/abs(x_centroid(4)-x_centroid(2))
                   <span class="keyword">if</span>(xy_2 &lt; minxy_ratio &amp;&amp; d2_4 &gt; mindist)
                       x_c_24 = 1000000;
                       y_c_24 = 1000000;
                       x_24_1 = x_centroid(4) - (maxaddedlength);
                       x_24_2 = x_centroid(4) + (maxaddedlength);
                       y_24_1 = y_centroid(4)-(maxaddedlength);
                       y_24_2 = y_centroid(4)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(yx_2 &lt; minxy_ratio &amp;&amp; d2_4 &gt; mindist)
                       x_c_24 = 1000000;
                       y_c_24 = 1000000;
                       x_24_1 = x_centroid(4) - (maxaddedlength);
                       x_24_2 = x_centroid(4) + (maxaddedlength);
                       y_24_1 = y_centroid(4)-(maxaddedlength);
                       y_24_2 = y_centroid(4)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_24 &gt; y_centroid(4))
                       y_24_1 = y_centroid(4)-(maxaddedlength)
                       y_24_2 = y_c_24
                   <span class="keyword">else</span>
                       y_24_1 = y_c_24
                       y_24_2 = y_centroid(4)+(maxaddedlength)
                   <span class="keyword">end</span>
               <span class="keyword">else</span>
                   S42 = 0;
                   x_c_24 = 1000000;
                   y_c_24 = 1000000;
                   x_24_1 = x_centroid(4) - (maxaddedlength);
                   x_24_2 = x_centroid(4) + (maxaddedlength);
                   y_24_1 = y_centroid(4)-(maxaddedlength);
                   y_24_2 = y_centroid(4)+(maxaddedlength);
              <span class="keyword">end</span>

              <span class="keyword">if</span>(d3_4&lt;MinimumDistance);
                   S43 = 1;
                   <span class="comment">% Calculate line equation for d_12</span>
                   m_34 = (y_centroid(4)-y_centroid(3))/(x_centroid(4)-x_centroid(3));
                   b_34 = y_centroid(3)-(m_34*x_centroid(3));
                   <span class="comment">% 2) Calculate Coordinate of d_12/2</span>
                   x_c_34 = x_centroid(3) + (x_centroid(4)-x_centroid(3))/2;
                   y_c_34 = m_34*x_c_34 + b_34
                   <span class="comment">% Calculate max distance in x from sphere 2 to 1:</span>
                   x_34_1 = x_c_34;
                   x_34_2 = x_centroid(4) - (maxaddedlength);
                   xy_3 = abs(x_centroid(3)-x_centroid(4))/abs(y_centroid(3)-y_centroid(4))
                   yx_3 = abs(y_centroid(3)-y_centroid(4))/abs(x_centroid(3)-x_centroid(4))
                   <span class="keyword">if</span>(xy_3 &lt; minxy_ratio &amp;&amp; d3_4 &gt; mindist)
                       x_c_34 = 1000000;
                       y_c_34 = 1000000;
                       x_34_1 = x_centroid(4) - (maxaddedlength);
                       x_34_2 = x_centroid(4) + (maxaddedlength);
                       y_34_1 = y_centroid(4)-(maxaddedlength);
                       y_34_2 = y_centroid(4)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(yx_3 &lt; minxy_ratio &amp;&amp; d3_4 &gt; mindist)
                       x_c_34 = 1000000;
                       y_c_34 = 1000000;
                       x_34_1 = x_centroid(4) - (maxaddedlength);
                       x_34_2 = x_centroid(4) + (maxaddedlength);
                       y_34_1 = y_centroid(4)-(maxaddedlength);
                       y_34_2 = y_centroid(4)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_34 &gt; y_centroid(4))
                       y_34_1 = y_centroid(4)-(maxaddedlength)
                       y_34_2 = y_c_34
                   <span class="keyword">else</span>
                       y_34_1 = y_c_34
                       y_34_2 = y_centroid(4)+(maxaddedlength)
                   <span class="keyword">end</span>
               <span class="keyword">else</span>
                   S34 = 0;
                   x_c_34 = 1000000;
                   y_c_34 = 1000000;
                   x_34_1 = x_centroid(4) - (maxaddedlength);
                   x_34_2 = x_centroid(4) + (maxaddedlength);
                   y_34_1 = y_centroid(4)-(maxaddedlength);
                   y_34_2 = y_centroid(4)+(maxaddedlength);
              <span class="keyword">end</span>
               <span class="keyword">if</span>(d4_5&lt;MinimumDistance);
                   S54 = 1;
                   <span class="comment">% Calculate line equation for d_12</span>
                   m_45 = (y_centroid(5)-y_centroid(4))/(x_centroid(5)-x_centroid(4));
                   b_45 = y_centroid(4)-(m_45*x_centroid(4));
                   <span class="comment">% 2) Calculate Coordinate of d_12/2</span>
                   x_c_45 = x_centroid(4) + (x_centroid(5)-x_centroid(4))/2;
                   y_c_45 = m_45*x_c_45 + b_45
                   <span class="comment">% Calculate max distance in x from sphere 2 to 1:</span>
                   x_45_1 = x_centroid(4) - (maxaddedlength);
                   x_45_2 = x_c_45;
                   xy_4 = abs(x_centroid(4)-x_centroid(5))/abs(y_centroid(4)-y_centroid(5))
                   yx_4 = abs(y_centroid(4)-y_centroid(5))/abs(x_centroid(4)-x_centroid(5))
                   <span class="keyword">if</span>(xy_4 &lt; minxy_ratio &amp;&amp; d4_5 &gt; mindist)
                       x_c_45 = 1000000;
                       y_c_45 = 1000000;
                       x_45_1 = x_centroid(4) - (maxaddedlength);
                       x_45_2 = x_centroid(4) + (maxaddedlength);
                       y_45_1 = y_centroid(4)-(maxaddedlength);
                       y_45_2 = y_centroid(4)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(yx_4 &lt; minxy_ratio &amp;&amp; d4_5 &gt; mindist)
                       x_c_45 = 1000000;
                       y_c_45 = 1000000;
                       x_45_1 = x_centroid(4) - (maxaddedlength);
                       x_45_2 = x_centroid(4) + (maxaddedlength);
                       y_45_1 = y_centroid(4)-(maxaddedlength);
                       y_45_2 = y_centroid(4)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_45 &gt; y_centroid(4))
                       y_45_1 = y_centroid(4)-(maxaddedlength)
                       y_45_2 = y_c_45
                   <span class="keyword">else</span>
                       y_45_1 = y_c_45
                       y_45_2 = y_centroid(4)+(maxaddedlength)
                   <span class="keyword">end</span>
               <span class="keyword">else</span>
                   S45 = 0;
                   x_c_45 = 1000000;
                   y_c_45 = 1000000;
                   x_45_1 = x_centroid(4) - (maxaddedlength);
                   x_45_2 = x_centroid(4) + (maxaddedlength);
                   y_45_1 = y_centroid(4)-(maxaddedlength);
                   y_45_2 = y_centroid(4)+(maxaddedlength);
               <span class="keyword">end</span>

               V_x7 = [x_c_14;x_c_24;x_c_35];
               min_x_7 = min(V_x7(1:3));
               <span class="keyword">if</span>(min_x_7 ==1000000)
                   min_x_7 = x_centroid(4)-(maxaddedlength);
               <span class="keyword">end</span>
               min_x_8 = x_c_45;
               <span class="keyword">if</span>(min_x_8 == 1000000)
                   min_x_8 = x_centroid(4) + (maxaddedlength);
               <span class="keyword">end</span>


               <span class="keyword">if</span>(y_c_14 &lt; 1000000 || y_c_24 &lt; 1000000 || y_c_34 &lt; 1000000 || y_c_45 &lt; 1000000)

                   <span class="keyword">if</span>(y_c_14 - y_centroid(4)&gt;0 &amp;&amp; y_c_14 - y_centroid(4)&lt;500000);
                       y_c_14_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_14_s = y_c_14;
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_24 - y_centroid(4)&gt;0 &amp;&amp; y_c_24 - y_centroid(4)&lt;500000);
                       y_c_24_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_24_s = y_c_24;
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_34 - y_centroid(4)&gt;0 &amp;&amp; y_c_34 - y_centroid(4)&lt;500000);
                       y_c_34_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_34_s = y_c_34;
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_45 - y_centroid(4)&gt;0 &amp;&amp; y_c_45 - y_centroid(4)&lt;500000);
                       y_c_45_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_45_s = y_c_45;
                   <span class="keyword">end</span>
                   V_y5=[y_c_14_s;y_c_24_s;y_c_34_s;y_c_45_s];
                   min_y_7 = min(V_y5(1:4));
                   <span class="keyword">if</span>(min_y_7 == 1000000)
                       min_y_7 = y_centroid(4)- (maxaddedlength);
                   <span class="keyword">end</span>

               <span class="keyword">else</span>
                   min_y_7 = y_centroid(4)- (maxaddedlength);
               <span class="keyword">end</span>

               <span class="keyword">if</span>(y_c_14 &lt; 1000000 || y_c_24 &lt; 1000000 || y_c_34 &lt; 1000000 || y_c_45 &lt; 1000000)
                   <span class="keyword">if</span>(y_c_14 - y_centroid(4)&lt;0 &amp;&amp; y_c_14 - y_centroid(4)&lt;500000);
                       y_c_14_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_14_s = y_c_14;
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_24 - y_centroid(4)&lt;0 &amp;&amp; y_c_24 - y_centroid(4)&lt;500000);
                       y_c_24_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_24_s = y_c_24;
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_34 - y_centroid(4)&lt;0 &amp;&amp; y_c_34 - y_centroid(4)&lt;500000);
                       y_c_34_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_34_s = y_c_34;
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_45 - y_centroid(4)&lt;0 &amp;&amp; y_c_45 - y_centroid(4)&lt;500000);
                       y_c_45_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_45_s = y_c_45;
                   <span class="keyword">end</span>
                   V_y6=[y_c_14_s;y_c_24_s;y_c_34_s;y_c_45_s];
                   min_y_8 = min(V_y6(1:4));
                   <span class="keyword">if</span>(min_y_8 == 1000000)
                       min_y_8 = y_centroid(4)+ (maxaddedlength);
                   <span class="keyword">end</span>

               <span class="keyword">else</span>
                   min_y_8 = y_centroid(4)+ (maxaddedlength);
               <span class="keyword">end</span>

               <span class="keyword">if</span>(min_x_7&lt;1)
                   x_7 = 1
               <span class="keyword">else</span>
                   x_7 = min_x_7;
               <span class="keyword">end</span>

               <span class="keyword">if</span>(min_x_8&gt;10752)
                   x_8 = 10752
               <span class="keyword">else</span>
                   x_8 = min_x_8;
               <span class="keyword">end</span>

               <span class="keyword">if</span>(min_y_7&lt;1)
                   y_7 = 1
               <span class="keyword">else</span>
                   y_7 = min_y_7;
               <span class="keyword">end</span>

               <span class="keyword">if</span>(min_y_8&gt;13824)
                   y_8 = 13824
               <span class="keyword">else</span>
                   y_8 = min_y_8;
               <span class="keyword">end</span>



               imagesphere4 = imgnucleus(y_7:y_8,x_7:x_8);
               [r4 c4] = size(imagesphere4);
               imagesphereresize4 = zeros(7168:7168);
               imagesphereresize4 = uint8(imagesphereresize4);
               imagesphereresize4(1:r4,1:c4)=imagesphere4;
               newFile4 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'04NucleusBig'</span>],<span class="string">'ignorecase'</span>);
               imwrite(imagesphereresize4,[foldername1 <span class="string">'/'</span> newFile4]);
               clear <span class="string">imagesphereresize4</span>;
               clear <span class="string">imagesphere4</span>;

               <span class="keyword">if</span>(d1_5&lt;MinimumDistance);
                   S51 = 1;
                   <span class="comment">% Calculate line equation for d_12</span>
                   m_15 = (y_centroid(5)-y_centroid(1))/(x_centroid(5)-x_centroid(1));
                   b_15 = y_centroid(1)-(m_15*x_centroid(1));
                   <span class="comment">% 2) Calculate Coordinate of d_12/2</span>
                   x_c_15 = x_centroid(1) + (x_centroid(5)-x_centroid(1))/2;
                   y_c_15 = m_15*x_c_15 + b_15
                   <span class="comment">% Calculate max distance in x from sphere 2 to 1:</span>
                   x_15_1 = x_c_15;
                   x_15_2 = x_centroid(5) + (maxaddedlength);
                   <span class="comment">%Introduce ratio of x/y (to rule out cases where two</span>
                   <span class="comment">%spheres have a very small differences in x or y but not</span>
                   <span class="comment">%in the other coordinate</span>
                   xy_1 = abs(x_centroid(5)-x_centroid(1))/abs(y_centroid(5)-y_centroid(1))
                   yx_1 = abs(y_centroid(5)-y_centroid(1))/abs(x_centroid(5)-x_centroid(1))
                   <span class="keyword">if</span>(xy_1 &lt; minxy_ratio &amp;&amp; d1_5 &gt; mindist)
                       x_c_15 = 1000000;
                       y_c_15 = 1000000;
                       x_15_1 = x_centroid(5) - (maxaddedlength);
                       x_15_2 = x_centroid(5) + (maxaddedlength);
                       y_15_1 = y_centroid(5)-(maxaddedlength);
                       y_15_2 = y_centroid(5)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(yx_1 &lt; minxy_ratio &amp;&amp; d1_5 &gt; mindist)
                       x_c_15 = 1000000;
                       y_c_15 = 1000000;
                       x_15_1 = x_centroid(5) - (maxaddedlength);
                       x_15_2 = x_centroid(5) + (maxaddedlength);
                       y_15_1 = y_centroid(5)-(maxaddedlength);
                       y_15_2 = y_centroid(5)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_15 &gt; y_centroid(5))
                       y_15_1 = y_centroid(5)-(maxaddedlength)
                       y_15_2 = y_c_15
                   <span class="keyword">else</span>
                       y_15_1 = y_c_15
                       y_15_2 = y_centroid(5)+(maxaddedlength)
                   <span class="keyword">end</span>
               <span class="keyword">else</span>
                   S51 = 0;
                   x_c_15 = 1000000;
                   y_c_15 = 1000000;
                   x_15_1 = x_centroid(5) - (maxaddedlength);
                   x_15_2 = x_centroid(5) + (maxaddedlength);
                   y_15_1 = y_centroid(5)-(maxaddedlength);
                   y_15_2 = y_centroid(5)+(maxaddedlength);
              <span class="keyword">end</span>

              <span class="keyword">if</span>(d2_5&lt;MinimumDistance);
                   S52 = 1;
                   <span class="comment">% Calculate line equation for d_12</span>
                   m_25 = (y_centroid(5)-y_centroid(2))/(x_centroid(5)-x_centroid(2));
                   b_25 = y_centroid(2)-(m_25*x_centroid(2));
                   <span class="comment">% 2) Calculate Coordinate of d_12/2</span>
                   x_c_25 = x_centroid(2) + (x_centroid(5)-x_centroid(2))/2;
                   y_c_25 = m_25*x_c_25 + b_25
                   <span class="comment">% Calculate max distance in x from sphere 2 to 1:</span>
                   x_25_1 = x_c_25;
                   x_25_2 = x_centroid(5) + (maxaddedlength);
                   xy_2 = abs(x_centroid(5)-x_centroid(2))/abs(y_centroid(5)-y_centroid(2))
                   yx_2 = abs(y_centroid(5)-y_centroid(2))/abs(x_centroid(5)-x_centroid(2))
                   <span class="keyword">if</span>(xy_2 &lt; minxy_ratio &amp;&amp; d2_5 &gt; mindist)
                       x_c_25 = 1000000;
                       y_c_25 = 1000000;
                       x_25_1 = x_centroid(5) - (maxaddedlength);
                       x_25_2 = x_centroid(5) + (maxaddedlength);
                       y_25_1 = y_centroid(5)-(maxaddedlength);
                       y_25_2 = y_centroid(5)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(yx_2 &lt; minxy_ratio &amp;&amp; d2_5 &gt; mindist)
                       x_c_25 = 1000000;
                       y_c_25 = 1000000;
                       x_25_1 = x_centroid(5) - (maxaddedlength);
                       x_25_2 = x_centroid(5) + (maxaddedlength);
                       y_25_1 = y_centroid(5)-(maxaddedlength);
                       y_25_2 = y_centroid(5)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_25 &gt; y_centroid(5))
                       y_25_1 = y_centroid(5)-(maxaddedlength)
                       y_25_2 = y_c_25
                   <span class="keyword">else</span>
                       y_25_1 = y_c_25
                       y_25_2 = y_centroid(5)+(maxaddedlength)
                   <span class="keyword">end</span>
               <span class="keyword">else</span>
                   S52 = 0;
                   x_c_25 = 1000000;
                   y_c_25 = 1000000;
                   x_25_1 = x_centroid(5) - (maxaddedlength);
                   x_25_2 = x_centroid(5) + (maxaddedlength);
                   y_25_1 = y_centroid(5)-(maxaddedlength);
                   y_25_2 = y_centroid(5)+(maxaddedlength);
              <span class="keyword">end</span>

              <span class="keyword">if</span>(d3_5&lt;MinimumDistance);
                   S53 = 1;
                   <span class="comment">% Calculate line equation for d_12</span>
                   m_35 = (y_centroid(5)-y_centroid(3))/(x_centroid(5)-x_centroid(3));
                   b_35 = y_centroid(3)-(m_35*x_centroid(3));
                   <span class="comment">% 2) Calculate Coordinate of d_12/2</span>
                   x_c_35 = x_centroid(3) + (x_centroid(5)-x_centroid(3))/2;
                   y_c_35 = m_35*x_c_35 + b_35
                   <span class="comment">% Calculate max distance in x from sphere 2 to 1:</span>
                   x_35_1 = x_c_35;
                   x_35_2 = x_centroid(5) - (maxaddedlength);
                   xy_3 = abs(x_centroid(3)-x_centroid(5))/abs(y_centroid(3)-y_centroid(5))
                   yx_3 = abs(y_centroid(3)-y_centroid(5))/abs(x_centroid(3)-x_centroid(5))
                   <span class="keyword">if</span>(xy_3 &lt; minxy_ratio &amp;&amp; d3_5 &gt; mindist)
                       x_c_35 = 1000000;
                       y_c_35 = 1000000;
                       x_35_1 = x_centroid(5) - (maxaddedlength);
                       x_35_2 = x_centroid(5) + (maxaddedlength);
                       y_35_1 = y_centroid(5)-(maxaddedlength);
                       y_35_2 = y_centroid(5)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(yx_3 &lt; minxy_ratio &amp;&amp; d3_5 &gt; mindist)
                       x_c_35 = 1000000;
                       y_c_35 = 1000000;
                       x_35_1 = x_centroid(5) - (maxaddedlength);
                       x_35_2 = x_centroid(5) + (maxaddedlength);
                       y_35_1 = y_centroid(5)-(maxaddedlength);
                       y_35_2 = y_centroid(5)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_35 &gt; y_centroid(5))
                       y_35_1 = y_centroid(5)-(maxaddedlength)
                       y_35_2 = y_c_35
                   <span class="keyword">else</span>
                       y_35_1 = y_c_35
                       y_35_2 = y_centroid(5)+(maxaddedlength)
                   <span class="keyword">end</span>
               <span class="keyword">else</span>
                   S53 = 0;
                   x_c_35 = 1000000;
                   y_c_35 = 1000000;
                   x_35_1 = x_centroid(5) - (maxaddedlength);
                   x_35_2 = x_centroid(5) + (maxaddedlength);
                   y_35_1 = y_centroid(5)-(maxaddedlength);
                   y_35_2 = y_centroid(5)+(maxaddedlength);
              <span class="keyword">end</span>
               <span class="keyword">if</span>(d4_5&lt;MinimumDistance);
                   S54 = 1;
                   <span class="comment">% Calculate line equation for d_12</span>
                   m_45 = (y_centroid(5)-y_centroid(4))/(x_centroid(5)-x_centroid(4));
                   b_45 = y_centroid(4)-(m_45*x_centroid(4));
                   <span class="comment">% 2) Calculate Coordinate of d_12/2</span>
                   x_c_45 = x_centroid(4) + (x_centroid(5)-x_centroid(4))/2;
                   y_c_45 = m_45*x_c_45 + b_45
                   <span class="comment">% Calculate max distance in x from sphere 2 to 1:</span>
                   x_45_1 = x_c_45;
                   x_45_2 = x_centroid(4) - (maxaddedlength);
                   xy_4 = abs(x_centroid(4)-x_centroid(5))/abs(y_centroid(4)-y_centroid(5))
                   yx_4 = abs(y_centroid(4)-y_centroid(5))/abs(x_centroid(4)-x_centroid(5))
                   <span class="keyword">if</span>(xy_4 &lt; minxy_ratio &amp;&amp; d4_5 &gt; mindist)
                       x_c_45 = 1000000;
                       y_c_45 = 1000000;
                       x_45_1 = x_centroid(5) - (maxaddedlength);
                       x_45_2 = x_centroid(5) + (maxaddedlength);
                       y_45_1 = y_centroid(5)-(maxaddedlength);
                       y_45_2 = y_centroid(5)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(yx_4 &lt; minxy_ratio &amp;&amp; d4_5 &gt; mindist)
                       x_c_45 = 1000000;
                       y_c_45 = 1000000;
                       x_45_1 = x_centroid(5) - (maxaddedlength);
                       x_45_2 = x_centroid(5) + (maxaddedlength);
                       y_45_1 = y_centroid(5)-(maxaddedlength);
                       y_45_2 = y_centroid(5)+(maxaddedlength);
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_45 &gt; y_centroid(5))
                       y_45_1 = y_centroid(5)-(maxaddedlength)
                       y_45_2 = y_c_45
                   <span class="keyword">else</span>
                       y_45_1 = y_c_45
                       y_45_2 = y_centroid(5)+(maxaddedlength)
                   <span class="keyword">end</span>
               <span class="keyword">else</span>
                   S45 = 0;
                   x_c_45 = 1000000;
                   y_c_45 = 1000000;
                   x_45_1 = x_centroid(5) - (maxaddedlength);
                   x_45_2 = x_centroid(5) + (maxaddedlength);
                   y_45_1 = y_centroid(5)-(maxaddedlength);
                   y_45_2 = y_centroid(5)+(maxaddedlength);
               <span class="keyword">end</span>

               V_x9 = [x_c_15;x_c_25;x_c_35;x_c_45];
               min_x_9 = min(V_x9(1:4));
               <span class="keyword">if</span>(min_x_9 ==1000000)
                   min_x_9 = x_centroid(5)-(maxaddedlength);
               <span class="keyword">end</span>
               min_x_10 = x_centroid(5) + (maxaddedlength);



               <span class="keyword">if</span>(y_c_15 &lt; 1000000 || y_c_25 &lt; 1000000 || y_c_35 &lt; 1000000 || y_c_45 &lt; 1000000)

                   <span class="keyword">if</span>(y_c_15 - y_centroid(5)&gt;0 &amp;&amp; y_c_15 - y_centroid(5)&lt;500000);
                       y_c_15_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_15_s = y_c_15;
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_25 - y_centroid(5)&gt;0 &amp;&amp; y_c_25 - y_centroid(5)&lt;500000);
                       y_c_25_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_25_s = y_c_25;
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_35 - y_centroid(5)&gt;0 &amp;&amp; y_c_35 - y_centroid(5)&lt;500000);
                       y_c_35_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_35_s = y_c_35;
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_45 - y_centroid(5)&gt;0 &amp;&amp; y_c_45 - y_centroid(5)&lt;500000);
                       y_c_45_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_45_s = y_c_45;
                   <span class="keyword">end</span>
                   V_y9=[y_c_15_s;y_c_25_s;y_c_35_s;y_c_45_s];
                   min_y_9 = min(V_y9(1:4));
                   <span class="keyword">if</span>(min_y_9 == 1000000)
                       min_y_9 = y_centroid(5)- (maxaddedlength);
                   <span class="keyword">end</span>

               <span class="keyword">else</span>
                   min_y_9 = y_centroid(5)- (maxaddedlength);
               <span class="keyword">end</span>

               <span class="keyword">if</span>(y_c_15 &lt; 1000000 || y_c_25 &lt; 1000000 || y_c_35 &lt; 1000000 || y_c_45 &lt; 1000000)
                   <span class="keyword">if</span>(y_c_15 - y_centroid(5)&lt;0 &amp;&amp; y_c_15 - y_centroid(5)&lt;500000);
                       y_c_15_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_15_s = y_c_15;
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_25 - y_centroid(5)&lt;0 &amp;&amp; y_c_25 - y_centroid(5)&lt;500000);
                       y_c_25_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_25_s = y_c_25;
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_35 - y_centroid(5)&lt;0 &amp;&amp; y_c_35 - y_centroid(5)&lt;500000);
                       y_c_35_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_35_s = y_c_35;
                   <span class="keyword">end</span>
                   <span class="keyword">if</span>(y_c_45 - y_centroid(5)&lt;0 &amp;&amp; y_c_45 - y_centroid(5)&lt;500000);
                       y_c_45_s = 1000000;
                   <span class="keyword">else</span>
                       y_c_45_s = y_c_45;
                   <span class="keyword">end</span>
                   V_y10=[y_c_15_s;y_c_25_s;y_c_35_s;y_c_45_s];
                   min_y_10 = min(V_y10(1:4));
                   <span class="keyword">if</span>(min_y_10 == 1000000)
                       min_y_10 = y_centroid(5)+ (maxaddedlength);
                   <span class="keyword">end</span>

               <span class="keyword">else</span>
                   min_y_10 = y_centroid(5)+ (maxaddedlength);
               <span class="keyword">end</span>

               <span class="keyword">if</span>(min_x_9&lt;1)
                   x_9 = 1
               <span class="keyword">else</span>
                   x_9 = min_x_9;
               <span class="keyword">end</span>

               <span class="keyword">if</span>(min_x_10&gt;10752)
                   x_10 = 10752
               <span class="keyword">else</span>
                   x_10 = min_x_10;
               <span class="keyword">end</span>

               <span class="keyword">if</span>(min_y_9&lt;1)
                   y_9 = 1
               <span class="keyword">else</span>
                   y_9 = min_y_9;
               <span class="keyword">end</span>

               <span class="keyword">if</span>(min_y_10&gt;13824)
                   y_10 = 13824
               <span class="keyword">else</span>
                   y_10 = min_y_10;
               <span class="keyword">end</span>



               imagesphere5 = imgnucleus(y_9:y_10,x_9:x_10);
               [r5 c5] = size(imagesphere5);
               imagesphereresize5 = zeros(7168:7168);
               imagesphereresize5 = uint8(imagesphereresize5);
               imagesphereresize5(1:r5,1:c5)=imagesphere5;
               newFile5 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'05NucleusBig'</span>],<span class="string">'ignorecase'</span>);
               imwrite(imagesphereresize5,[foldername1 <span class="string">'/'</span> newFile5]);
               clear <span class="string">imagesphereresize5</span>;
               clear <span class="string">imagesphere5</span>;


               <span class="keyword">if</span>(Neuron_Channel &gt; 0)
                   <span class="comment">% Same for neurite channel</span>


                   imagesphere6 = imgneurite(y_1:y_2,x_1:x_2);
                   [r1 c1] = size(imagesphere6);
                   imagesphereresize6 = zeros(7168:7168);
                   imagesphereresize6 = uint8(imagesphereresize6);
                   imagesphereresize6(1:r1,1:c1)=imagesphere6;
                   newFile6 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'01NeuriteBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize6,[foldername1 <span class="string">'/'</span> newFile6]);
                   clear <span class="string">imagesphereresize6</span>;
                   clear <span class="string">imagesphere6</span>;

                   imagesphere7 = imgneurite(y_3:y_4,x_3:x_4);
                   [r2 c2] = size(imagesphere7);
                   imagesphereresize7 = zeros(7168:7168);
                   imagesphereresize7 = uint8(imagesphereresize7);
                   imagesphereresize7(1:r2,1:c2)=imagesphere7;
                   newFile7 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'02NeuriteBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize7,[foldername1 <span class="string">'/'</span> newFile7]);
                   clear <span class="string">imagesphereresize7</span>;
                   clear <span class="string">imagesphere7</span>;

                   imagesphere8 = imgneurite(y_5:y_6,x_5:x_6);
                   [r3 c3] = size(imagesphere8);
                   imagesphereresize8 = zeros(7168:7168);
                   imagesphereresize8 = uint8(imagesphereresize8);
                   imagesphereresize8(1:r3,1:c3)=imagesphere8;
                   newFile8 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'03NeuriteBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize8,[foldername1 <span class="string">'/'</span> newFile8]);
                   clear <span class="string">imagesphereresize8</span>;
                   clear <span class="string">imagesphere8</span>;

                   imagesphere9 = imgneurite(y_7:y_8,x_7:x_8);
                   [r4 c4] = size(imagesphere9);
                   imagesphereresize9 = zeros(7168:7168);
                   imagesphereresize9 = uint8(imagesphereresize9);
                   imagesphereresize9(1:r4,1:c4)=imagesphere9;
                   newFile9 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'04NeuriteBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize9,[foldername1 <span class="string">'/'</span> newFile9]);
                   clear <span class="string">imagesphereresize9</span>;
                   clear <span class="string">imagesphere9</span>;

                   imagesphere10 = imgneurite(y_9:y_10,x_9:x_10);
                   [r5 c5] = size(imagesphere10);
                   imagesphereresize10 = zeros(7168:7168);
                   imagesphereresize10 = uint8(imagesphereresize10);
                   imagesphereresize10(1:r5,1:c5)=imagesphere10;
                   newFile5 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'05NeuriteBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize10,[foldername1 <span class="string">'/'</span> newFile5]);
                   clear <span class="string">imagesphereresize10</span>;
                   clear <span class="string">imagesphere10</span>;
               <span class="keyword">end</span>

               <span class="keyword">if</span>(Oligo_Channel &gt; 0)
                   <span class="comment">% Same for Oligos</span>
                   imagesphere11 = imgoligo(y_1:y_2,x_1:x_2);
                   [r1 c1] = size(imagesphere11);
                   imagesphereresize11 = zeros(7168:7168);
                   imagesphereresize11 = uint8(imagesphereresize11);
                   imagesphereresize11(1:r1,1:c1)=imagesphere11;
                   newFile11 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'01OligoBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize11,[foldername1 <span class="string">'/'</span> newFile11]);
                   clear <span class="string">imagesphereresize11</span>;
                   clear <span class="string">imagesphere11</span>;

                   imagesphere12 = imgoligo(y_3:y_4,x_3:x_4);
                   [r2 c2] = size(imagesphere12);
                   imagesphereresize12 = zeros(7168:7168);
                   imagesphereresize12 = uint8(imagesphereresize12);
                   imagesphereresize12(1:r2,1:c2)=imagesphere12;
                   newFile12 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'02OligoBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize12,[foldername1 <span class="string">'/'</span> newFile12]);
                   clear <span class="string">imagesphereresize12</span>;
                   clear <span class="string">imagesphere12</span>;

                   imagesphere13 = imgoligo(y_5:y_6,x_5:x_6);
                   [r3 c3] = size(imagesphere13);
                   imagesphereresize13 = zeros(7168:7168);
                   imagesphereresize13 = uint8(imagesphereresize13);
                   imagesphereresize13(1:r3,1:c3)=imagesphere13;
                   newFile13 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'03OligoBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize13,[foldername1 <span class="string">'/'</span> newFile13]);
                   clear <span class="string">imagesphereresize13</span>;
                   clear <span class="string">imagesphere13</span>;

                   imagesphere14 = imgoligo(y_7:y_8,x_7:x_8);
                   [r4 c4] = size(imagesphere14);
                   imagesphereresize14 = zeros(7168:7168);
                   imagesphereresize14 = uint8(imagesphereresize14);
                   imagesphereresize14(1:r4,1:c4)=imagesphere14;
                   newFile14 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'04OligoBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize14,[foldername1 <span class="string">'/'</span> newFile14]);
                   clear <span class="string">imagesphereresize14</span>;
                   clear <span class="string">imagesphere14</span>;

                   imagesphere15 = imgoligo(y_9:y_10,x_9:x_10);
                   [r5 c5] = size(imagesphere15);
                   imagesphereresize15 = zeros(7168:7168);
                   imagesphereresize15 = uint8(imagesphereresize15);
                   imagesphereresize15(1:r5,1:c5)=imagesphere15;
                   newFile15 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'05OligoBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize15,[foldername1 <span class="string">'/'</span> newFile15]);
                   clear <span class="string">imagesphereresize15</span>;
                   clear <span class="string">imagesphere15</span>;
               <span class="keyword">end</span>

               <span class="keyword">if</span>(Astro_Channel &gt;0)
                   <span class="comment">% Same for Astros</span>
                   imagesphere16 = imgastro(y_1:y_2,x_1:x_2);
                   [r1 c1] = size(imagesphere16);
                   imagesphereresize16 = zeros(7168:7168);
                   imagesphereresize16 = uint8(imagesphereresize16);
                   imagesphereresize16(1:r1,1:c1)=imagesphere16;
                   newFile16 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'01AstroBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize16,[foldername1 <span class="string">'/'</span> newFile16]);
                   clear <span class="string">imagesphereresize16</span>;
                   clear <span class="string">imagesphere16</span>;

                   imagesphere17 = imgastro(y_3:y_4,x_3:x_4);
                   [r2 c2] = size(imagesphere17);
                   imagesphereresize17 = zeros(7168:7168);
                   imagesphereresize17 = uint8(imagesphereresize17);
                   imagesphereresize17(1:r2,1:c2)=imagesphere17;
                   newFile17 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'02AstroBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize17,[foldername1 <span class="string">'/'</span> newFile17]);
                   clear <span class="string">imagesphereresize17</span>;
                   clear <span class="string">imagesphere17</span>;

                   imagesphere18 = imgastro(y_5:y_6,x_5:x_6);
                   [r3 c3] = size(imagesphere18);
                   imagesphereresize18 = zeros(7168:7168);
                   imagesphereresize18 = uint8(imagesphereresize18);
                   imagesphereresize18(1:r3,1:c3)=imagesphere18;
                   newFile18 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'03AstroBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize18,[foldername1 <span class="string">'/'</span> newFile18]);
                   clear <span class="string">imagesphereresize18</span>;
                   clear <span class="string">imagesphere18</span>;

                   imagesphere19 = imgastro(y_7:y_8,x_7:x_8);
                   [r4 c4] = size(imagesphere19);
                   imagesphereresize19 = zeros(7168:7168);
                   imagesphereresize19 = uint8(imagesphereresize19);
                   imagesphereresize19(1:r4,1:c4)=imagesphere19;
                   newFile19 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'04AstroBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize19,[foldername1 <span class="string">'/'</span> newFile19]);
                   clear <span class="string">imagesphereresize19</span>;
                   clear <span class="string">imagesphere19</span>;

                   imagesphere20 = imgastro(y_9:y_10,x_9:x_10);
                   [r5 c5] = size(imagesphere20);
                   imagesphereresize20 = zeros(7168:7168);
                   imagesphereresize20 = uint8(imagesphereresize20);
                   imagesphereresize20(1:r5,1:c5)=imagesphere20;
                   newFile20 = regexprep(allfiles(i).name,<span class="string">'NucleusBig'</span>,[wellind <span class="string">'05AstroBig'</span>],<span class="string">'ignorecase'</span>);
                   imwrite(imagesphereresize20,[foldername1 <span class="string">'/'</span> newFile20]);
                   clear <span class="string">imagesphereresize20</span>;
                   clear <span class="string">imagesphere20</span>;
               <span class="keyword">end</span>


            <span class="keyword">else</span>

            <span class="keyword">end</span>





   csvHandler.CellPosMatrix(allfiles(i).name) = 0;
<span class="keyword">end</span>

        clear <span class="string">imgnucleus</span>;
        clear <span class="string">imgneurite</span>;
        clear <span class="string">imgoligo</span>;
        clear <span class="string">imgastro</span>;
     <span class="comment">%Delete original Matrix</span>

<span class="keyword">end</span>

<span class="keyword">end</span>
</pre><pre class="codeoutput">Error using Imagecutter_V5_9 (line 28)
Not enough input arguments.
</pre><p class="footer"><br>
      Published with MATLAB&reg; 7.14<br></p></div><!--
##### SOURCE BEGIN #####
function[csvHandler wellList] = Imagecutter_V5_9(Neuron_Channel, Oligo_Channel, Astro_Channel, foldername, csvHandler, optionHandler)

%function csvHandler = Imagecutter_V5_8(Neuron_Channel, Oligo_Channel, Astro_Channel, foldername, csvHandler)
% This function is used to sepearte neurospheres from images of
% 8-chamber slide into seperate images, containing only one neurosphere.
% Therefore centroids of neurosphere cores were determined and distance
% between the boarders of the coverslip as well as distances among
% centroids are calculated. For both x and y coordinates the shortest
% distance among border and centroid centroid distances is either added or
% substracted from the centroid coordinate to generate a rectangular filter
% to cut out single spheres. In a last step those images are resized to a
% 96 well plate image.
n = 0;
wellList = cell(0);
% N gives the minimum required area for a neurosphere core

N = 250000;
%Neuron_Channel = 0;
%Oligo_Channel = 0;
%Astro_Channel = 0;
% The MinimumDistance defines the minimum distance of two sphere cores for
% which migration areas should not intersect
MinimumDistance = 7168/2;
%This is the maximum added or substracted from the center point. This
%should, if all spheres are at least 7168 pixels away from each other
%result in no overlapp of migration areas (3101 equals 2000M)
maxaddedlength = 3101;
foldername = [foldername '/ConvertedCellomics'];
foldername1 = foldername;

%Well renamer:

% Sometimes the difference between x or y coordinates is very small. This
% is the result of two spheres with minimum distance smaller the defined
% positioned on the line (e.g. on a horizontal line or the upper two
% spheres of a five). Therefore a minimum ratio of x/y and y/x is defined
% as an additional criteria. To rule out the possibility that spheres are
% almost touching each other, further a mindist is defined at which the xy
% and yx cirtiria is applied:
minxy_ratio = 0.25;
mindist = 3000;
%Defines the source folder
%foldername = uigetdir;
%Define destination folder for saving processed images
%foldername1 = uigetdir;
%Iterate over all files in this folder
allfiles = dir(foldername);
% Iteration loop for all images in source folder
for(i=1:numel(allfiles))
    %Check if file ends with NucleusBig.png
    ind = strfind([foldername '/' allfiles(i).name],'NucleusBig.png');
        if(numel(ind) > 0)
            n=n+1;
            NucleusM = csvHandler.CellPosMatrix(strcat(allfiles(i).name(1),allfiles(i).name(3)));      
            if(Neuron_Channel>0);
                % Looks for cooresponding neurite image by replacing NucleusBig by
                % NeuriteBig in the name of image i
                newFileNeu = regexprep(allfiles(i).name,'NucleusBig','NeuriteBig','ignorecase'); 
                % New file is defined as imgneurite
                imgneurite = imread([foldername '/' newFileNeu]);
            end
            
            %Same for OligoBig
            if(Oligo_Channel>0);
                newFileOli = regexprep(allfiles(i).name,'NucleusBig','OligoBig','ignorecase');        
                imgoligo = imread([foldername '/' newFileOli]);
            end
                    
        %Same for AstroBig
            if(Astro_Channel >0)
                newFileAst = regexprep(allfiles(i).name,'NucleusBig','AstroBig','ignorecase');        
                imgastro = imread([foldername '/' newFileAst]);
            end    
        
        % Loads NucleusBig     
        imgnucleus = imread([foldername '/' allfiles(i).name]);
        % Generates histogram of imgnucleus
        [lehisto x] = imhist(imgnucleus);
        % Calculates background of imgnucleus
        level = triangle_th(lehisto,256);
        % Converts imgnucleus to a binary 'imgnucleusbinary' image using
        % level as threshold
        imgnucleusbinary = im2bw(imgnucleus,level);
        % Convertes 'imgnucleusbinary' to an 8-bit image
        imgnucleusbinary = uint8(imgnucleusbinary.*255);
        % Excludes all areas in 'imgnucleusbinary' smaller than 250000
        imgnucleusbinarysized = bwareaopen(imgnucleusbinary,N);
        % Excludes objects touching the rim of the cover slip to get rid of
        % bright edges of the cover slip
        imgnucleusbinarysized = imclearborder(imgnucleusbinarysized);
        
        % Calculates all centroid coordinates of all areas in
        % 'imgnucleusbinarysized'
        s = regionprops(imgnucleusbinarysized,'centroid');
        % Determines the y-dimension of s
        s_L = length(s) 
        clear imgnucleusbinary;
        clear imgnucleusbinarysized;
        % Case destinction is required, since through washing spheres can
        % be lost
        %Case 1: All spheres are lost, meaning no centroids and a y
        %dimension of s equals 0
            if(strfind(allfiles(i).name,  'D01'))
                wellind = 'A';
            end   
            if(strfind(allfiles(i).name,  'C01'))
                wellind = 'B';
            end 
            if(strfind(allfiles(i).name,  'B01'))
                wellind = 'C';
            end 
            if(strfind(allfiles(i).name,  'A01'))
                wellind = 'D';
            end 
            if(strfind(allfiles(i).name,  'D02'))
                wellind = 'E';
            end 
            if(strfind(allfiles(i).name,  'C02'))
                wellind = 'F';
            end 
            if(strfind(allfiles(i).name,  'B02'))
                wellind = 'G';
            end 
            if(strfind(allfiles(i).name,  'A02'))
                wellind = 'H';
            end
        if(s_L <=0);
            %Well renamer:
            
            % Creation of five epmty images with dimensions 7168x7168    
            imagesphereresize1 = zeros(7168:7168);
            newFile1 = regexprep(allfiles(i).name,'NucleusBig',[wellind '01NucleusBig'],'ignorecase');        
            imwrite(imagesphereresize1,[foldername1 '/' newFile1]);
            clear imagesphereresize1; 
            
            imagesphereresize2 = zeros(7168:7168);
            newFile2 = regexprep(allfiles(i).name,'NucleusBig',[wellind '02NucleusBig'],'ignorecase');        
            imwrite(imagesphereresize2,[foldername1 '/' newFile2]);
            clear imagesphereresize2; 
            
            imagesphereresize3 = zeros(7168:7168);
            newFile3 = regexprep(allfiles(i).name,'NucleusBig',[wellind '03NucleusBig'],'ignorecase');        
            imwrite(imagesphereresize3,[foldername1 '/' newFile3]);
            clear imagesphereresize3; 
            
            imagesphereresize4 = zeros(7168:7168);
            newFile4 = regexprep(allfiles(i).name,'NucleusBig',[wellind '04NucleusBig'],'ignorecase');        
            imwrite(imagesphereresize4,[foldername1 '/' newFile4]);
            clear imagesphereresize4; 
            
            imagesphereresize5 = zeros(7168:7168);
            newFile5 = regexprep(allfiles(i).name,'NucleusBig',[wellind '05NucleusBig'],'ignorecase');        
            imwrite(imagesphereresize5,[foldername1 '/' newFile5]);
            clear imagesphereresize5;
            
            if(Neuron_Channel > 0)
                   % Same for neurite channel


                   imagesphereresize6 = zeros(7168:7168);
            	   newFile6 = regexprep(allfiles(i).name,'NucleusBig',[wellind '01NeuriteBig'],'ignorecase');        
                   imwrite(imagesphereresize6,[foldername1 '/' newFile6]);
                   clear imagesphereresize6;

                   imagesphereresize7 = zeros(7168:7168);
            	   newFile7 = regexprep(allfiles(i).name,'NucleusBig',[wellind '02NeuriteBig'],'ignorecase');        
                   imwrite(imagesphereresize7,[foldername1 '/' newFile7]);
                   clear imagesphereresize7;

                   imagesphereresize8 = zeros(7168:7168);
            	   newFile8 = regexprep(allfiles(i).name,'NucleusBig',[wellind '03NeuriteBig'],'ignorecase');        
                   imwrite(imagesphereresize8,[foldername1 '/' newFile8]);
                   clear imagesphereresize8;


                   imagesphereresize9 = zeros(7168:7168);
            	   newFile9 = regexprep(allfiles(i).name,'NucleusBig',[wellind '04NeuriteBig'],'ignorecase');        
                   imwrite(imagesphereresize9,[foldername1 '/' newFile9]);
                   clear imagesphereresize9;

                   imagesphereresize10 = zeros(7168:7168);
            	   newFile10 = regexprep(allfiles(i).name,'NucleusBig',[wellind '05NeuriteBig'],'ignorecase');        
                   imwrite(imagesphereresize10,[foldername1 '/' newFile10]);
                   clear imagesphereresize10;

               end
               
               if(Oligo_Channel > 0)
                   % Same for Oligos
                   imagesphereresize11 = zeros(7168:7168);
            	   newFile11 = regexprep(allfiles(i).name,'NucleusBig',[wellind '01OligoBig'],'ignorecase');        
                   imwrite(imagesphereresize11,[foldername1 '/' newFile11]);
                   clear imagesphereresize11;

                   imagesphereresize12 = zeros(7168:7168);
            	   newFile12 = regexprep(allfiles(i).name,'NucleusBig',[wellind '02OligoBig'],'ignorecase');        
                   imwrite(imagesphereresize12,[foldername1 '/' newFile12]);
                   clear imagesphereresize12;

                   imagesphereresize13 = zeros(7168:7168);
            	   newFile13 = regexprep(allfiles(i).name,'NucleusBig',[wellind '03OligoBig'],'ignorecase');        
                   imwrite(imagesphereresize13,[foldername1 '/' newFile13]);
                   clear imagesphereresize13;

                   imagesphereresize14 = zeros(7168:7168);
            	   newFile14 = regexprep(allfiles(i).name,'NucleusBig',[wellind '04OligoBig'],'ignorecase');        
                   imwrite(imagesphereresize14,[foldername1 '/' newFile14]);
                   clear imagesphereresize14;

                   imagesphereresize15 = zeros(7168:7168);
            	   newFile15 = regexprep(allfiles(i).name,'NucleusBig',[wellind '05OligoBig'],'ignorecase');        
                   imwrite(imagesphereresize15,[foldername1 '/' newFile15]);
                   clear imagesphereresize15;
               end
               
               if(Astro_Channel >0)
                   % Same for Astros
                   imagesphereresize16 = zeros(7168:7168);
            	   newFile16 = regexprep(allfiles(i).name,'NucleusBig',[wellind '01AstroBig'],'ignorecase');        
                   imwrite(imagesphereresize16,[foldername1 '/' newFile16]);
                   clear imagesphereresize16;

                   imagesphereresize17 = zeros(7168:7168);
            	   newFile17 = regexprep(allfiles(i).name,'NucleusBig',[wellind '02AstroBig'],'ignorecase');        
                   imwrite(imagesphereresize17,[foldername1 '/' newFile17]);
                   clear imagesphereresize17;

                   imagesphereresize18 = zeros(7168:7168);
            	   newFile18 = regexprep(allfiles(i).name,'NucleusBig',[wellind '03AstroBig'],'ignorecase');        
                   imwrite(imagesphereresize18,[foldername1 '/' newFile18]);
                   clear imagesphereresize18;

                   imagesphereresize19 = zeros(7168:7168);
            	   newFile19 = regexprep(allfiles(i).name,'NucleusBig',[wellind '04AstroBig'],'ignorecase');        
                   imwrite(imagesphereresize19,[foldername1 '/' newFile19]);
                   clear imagesphereresize19;

                   imagesphereresize20 = zeros(7168:7168);
            	   newFile20 = regexprep(allfiles(i).name,'NucleusBig',[wellind '05AstroBig'],'ignorecase');        
                   imwrite(imagesphereresize20,[foldername1 '/' newFile20]);
                   clear imagesphereresize20;
               end
               
            else
            end
        % Case 2: One sphere remained: s=1     
            if(0<s_L && s_L<2);
               % Extracts the x and y coordinates from s 
               x_centroid(1) = s(1).Centroid(1);
               y_centroid(1) = s(1).Centroid(2);
               
               % Calculates the distance between the centroid of the
               % neurosphere to all boarders of the cover slip
               
               % Distance between centroid and left x-boarder
               d_x0_1 = x_centroid(1)-1;
               % Distance between centroid and right x-boarder
               d_x10752_1 = 10752 - x_centroid(1);
               % Distance between centroid and upper y-boarder
               d_y0_1 = y_centroid(1)-1;
               % Distance between centroid and lower x-boarder
               d_y10752_1 = 13824 - y_centroid(1);
               
               %Generation of an vector containing all distances in x and y for  the sphere
               %core. 7168/2 is inserted as the maximal allowed value to
               %add or to substract
               % V_x1m contains all values left of the centroid
               V_x1m = [d_x0_1;(7168/2)];
               % V_x1p contains all values right of the centroid
               V_x1p = [d_x10752_1;(7168/2)];
               % V_y1m contains all values above the centroid
               V_y1m = [d_y0_1;(7168/2)];
               % V_y1p contains all values below the centroid
               V_y1p = [d_y10752_1;(7168/2)];
               
               
               % Determination of the smallest distance in all directions
               % of V
               minx_1m = min(V_x1m(1:2));
               minx_1p = min(V_x1p(1:2));
               miny_1m = min(V_y1m(1:2));
               miny_1p = min(V_y1p(1:2));
               
               % Calculates the x and y coordinates of the rectangular
               % around the sphere core. Always minimal distances were
               % substrated or added
               x_1 = x_centroid(1) - minx_1m;
               x_2 = x_centroid(1) + minx_1p - 1;
               y_1 = y_centroid(1) - miny_1m;
               y_2 = y_centroid(1) + miny_1p - 1;
               
              
               
               
               %The rectangular image is cutted from the imgnucleus image containing the whole cover slip
               imagesphere1 = imgnucleus(y_1:y_2,x_1:x_2);
               % Dimensions of imagesphere1 are determined
               [r1 c1] = size(imagesphere1);
               % An empty matrix is generated
               imagesphereresize1 = zeros(7168:7168);
               % imagesphereresize1 is converted to 8-bit
               imagesphereresize1 = uint8(imagesphereresize1);
               %The empty indices in the imagesphereresize1 matrix are overwritten with imagesphere 1 entries
               imagesphereresize1(1:r1,1:c1)=imagesphere1;
               % imagesphereresize1 is saved to final destination
               newFile1 = regexprep(allfiles(i).name,allfiles(i).name(1:13),[wellind '01NucleusBig'],'ignorecase');        
               imwrite(imagesphereresize1,[foldername1 '/' newFile1]);
               wellname = (newFile1(1:3));
               wellList{n} = wellname;
               csvHandler.CellPosMatrix(wellname) = NucleusM(y_1:y_2,x_1:x_2);
               imagesphereresize1_small = imresize(imagesphereresize1, optionHandler.ScalingFactor);
               
               
               clear imagesphereresize1; 
               clear imagesphere1;
                
               imagesphereresize2 = zeros(7168:7168);
               newFile2 = regexprep(allfiles(i).name,allfiles(i).name(1:13),[wellind '02NucleusBig'],'ignorecase');        
               imwrite(imagesphereresize2,[foldername1 '/' newFile2]);
               
               csvHandler.CellPosMatrix(newFile2) = sparse(zeros(7168,7168));
               clear imagesphereresize2; 
               
               imagesphereresize3 = zeros(7168:7168);
               newFile3 = regexprep(allfiles(i).name,allfiles(i).name(1:13),[wellind '03NucleusBig'],'ignorecase');        
               imwrite(imagesphereresize3,[foldername1 '/' newFile3]);
               csvHandler.CellPosMatrix(newFile3) = sparse(zeros(7168,7168));
               clear imagesphereresize3; 

               imagesphereresize4 = zeros(7168:7168);
               newFile4 = regexprep(allfiles(i).name,allfiles(i).name(1:13),[wellind '04NucleusBig'],'ignorecase');        
               imwrite(imagesphereresize4,[foldername1 '/' newFile4]);
               csvHandler.CellPosMatrix(newFile4) = sparse(zeros(7168,7168));
               clear imagesphereresize4; 

               imagesphereresize5 = zeros(7168:7168);
               newFile5 = regexprep(allfiles(i).name,allfiles(i).name(1:13),[wellind '05NucleusBig'],'ignorecase');        
               imwrite(imagesphereresize5,[foldername1 '/' newFile5]);
               csvHandler.CellPosMatrix(newFile5) = sparse(zeros(7168,7168));
               clear imagesphereresize5;   
               
               if(Neuron_Channel > 0)
                   % Same for neurite channel


                   imagesphere6 = imgneurite(y_1:y_2,x_1:x_2);
                   [r1 c1] = size(imagesphere6);
                   imagesphereresize6 = zeros(7168:7168);
                   imagesphereresize6 = uint8(imagesphereresize6);
                   imagesphereresize6(1:r1,1:c1)=imagesphere6;
                   newFile6 = regexprep(allfiles(i).name,allfiles(i).name(1:13),[wellind '01NeuriteBig'],'ignorecase');        
                   imwrite(imagesphereresize6,[foldername1 '/' newFile6]);
                   clear imagesphereresize6;
                   clear imagesphere6;

                   imagesphereresize7 = zeros(7168:7168);
            	   newFile7 = regexprep(allfiles(i).name,allfiles(i).name(1:13),[wellind '02NeuriteBig'],'ignorecase');        
                   imwrite(imagesphereresize7,[foldername1 '/' newFile7]);
                   clear imagesphereresize7;

                   imagesphereresize8 = zeros(7168:7168);
            	   newFile8 = regexprep(allfiles(i).name,allfiles(i).name(1:13),[wellind '03NeuriteBig'],'ignorecase');        
                   imwrite(imagesphereresize8,[foldername1 '/' newFile8]);
                   clear imagesphereresize8;


                   imagesphereresize9 = zeros(7168:7168);
            	   newFile9 = regexprep(allfiles(i).name,allfiles(i).name(1:13),[wellind '04NeuriteBig'],'ignorecase');        
                   imwrite(imagesphereresize9,[foldername1 '/' newFile9]);
                   clear imagesphereresize9;

                   imagesphereresize10 = zeros(7168:7168);
            	   newFile10 = regexprep(allfiles(i).name,allfiles(i).name(1:13),[wellind '05NeuriteBig'],'ignorecase');        
                   imwrite(imagesphereresize10,[foldername1 '/' newFile10]);
                   clear imagesphereresize10;

               end
               
               
               
            else
            end    
        % Case 3: Two spheres remained: s=2    
            if(s_L>1 && s_L<3);
               % Extracts the x and y coordinates from s 
               x_centroid(1) = s(1).Centroid(1);
               y_centroid(1) = s(1).Centroid(2);
               x_centroid(2) = s(2).Centroid(1);
               y_centroid(2) = s(2).Centroid(2);
               % Calculates the distance between the centroid of the
               % neurosphere and all boarders of the cover slip
               
               % Distance between centroid(1) and centroid(2)
               d1_2 = 0.5* ((x_centroid(1)-x_centroid(2))^2+(y_centroid(1)-y_centroid(2))^2)^0.5;
               % Distance between centroid and left x-boarder
               d_x0_1 = x_centroid(1)-1;
               % Distance between centroid and right x-boarder
               d_x10752_1 = 10752 - x_centroid(1);
               % Distance between centroid and upper y-boarder
               d_y0_1 = y_centroid(1)-1;
               % Distance between centroid and lower y-boarder
               d_y10752_1 = 13824 - y_centroid(1);
               % Same for sphere core 2
               d_x0_2 = x_centroid(2)-1;
               d_x10752_2 = 10752 - x_centroid(2);
               d_y0_2 = y_centroid(2)-1;
               d_y10752_2 = 13824 - y_centroid(2);
               %Generation of an vector containing all distances in x and y for  the sphere
               %core. 7168/2 is inserted as the maximal allowed value to
               %add or to substract
               % V_x1m contains all values left of the centroid
               V_x1m = [d1_2;d_x0_1;(7168/2)];
               % V_x1p contains all values right of the centroid
               V_x1p = [d1_2;d_x10752_1;(7168/2)];
               % V_y1m contains all values above the centroid
               V_y1m = [d1_2;d_y0_1;(7168/2)];
               % V_y1p contains all values below the centroid
               V_y1p = [d1_2;d_y10752_1;(7168/2)];
               % Same for sphere core 2
               V_x2m = [d1_2;d_x0_2;(7168/2)];
               V_x2p = [d1_2;d_x10752_2;(7168/2)];
               V_y2m = [d1_2;d_y0_2;(7168/2)];
               V_y2p = [d1_2;d_y10752_2;(7168/2)];
               
                             
               % Determination of the smallest distance in all directions
               % of V
               
               minx_1m = min(V_x1m(1:3));
               minx_1p = min(V_x1p(1:3));
               miny_1m = min(V_y1m(1:3));
               miny_1p = min(V_y1p(1:3));
               minx_2m = min(V_x2m(1:3));
               minx_2p = min(V_x2p(1:3));
               miny_2m = min(V_y2m(1:3));
               miny_2p = min(V_y2p(1:3));
               
               % Calculates the x and y coordinates of the rectangular
               % around the sphere core. Always minimal distances were
               % substrated or added
               x_1 = x_centroid(1) - minx_1m;
               x_2 = x_centroid(1) + minx_1p;
               y_1 = y_centroid(1) - miny_1m;
               y_2 = y_centroid(1) + miny_1p;
               %The rectangular image is cutted from the imgnucleus image containing the whole cover slip
               imagesphere1 = imgnucleus(y_1:y_2,x_1:x_2);
               % Dimensions of imagesphere1 are determined
               [r1 c1] = size(imagesphere1);
               % An empty matrix is generated
               imagesphereresize1 = zeros(7168:7168);
               % imagesphereresize1 is converted to 8-bit
               imagesphereresize1 = uint8(imagesphereresize1);
               %The empty indices in the imagesphereresize1 matrix are overwritten with imagesphere 1 entries
               imagesphereresize1(1:r1,1:c1)=imagesphere1;
               % imagesphereresize1 is saved to final destination
               newFile1 = regexprep(allfiles(i).name,'NucleusBig',[wellind '01NucleusBig'],'ignorecase');        
               imwrite(imagesphereresize1,[foldername1 '/' newFile1]);
               csvHandler.CellPosMatrix(newFile1) = NucleusM(y_1:y_2,x_1:x_2);
               clear imagesphereresize1; 
               clear imagesphere1;
               
                           
               % Same for second sphere
               
                
               x_3 = x_centroid(2) - minx_2m;
               x_4 = x_centroid(2) + minx_2p -1;
               y_3 = y_centroid(2) - miny_2m;
               y_4 = y_centroid(2) + miny_2p -1;
               imagesphere2 = imgnucleus(y_3:y_4,x_3:x_4);
               [r2 c2] = size(imagesphere2);
               imagesphereresize2 = zeros(7168:7168);
               imagesphereresize2 = uint8(imagesphereresize2);
               imagesphereresize2(1:r2,1:c2)=imagesphere2;
               newFile2 = regexprep(allfiles(i).name,'NucleusBig',[wellind '02NucleusBig'],'ignorecase');        
               imwrite(imagesphereresize2,[foldername1 '/' newFile2]);
               csvHandler.CellPosMatrix(newFile2) = sparse(logical(zeros(7168,7168)));
               clear imagesphereresize2;
               clear imagesphere2;
               
               imagesphereresize3 = zeros(7168:7168);
               newFile3 = regexprep(allfiles(i).name,'NucleusBig',[wellind '03NucleusBig'],'ignorecase');        
               imwrite(imagesphereresize3,[foldername1 '/' newFile3]);
               csvHandler.CellPosMatrix(newFile3) = sparse(logical(zeros(7168,7168)));
               clear imagesphereresize3; 

               imagesphereresize4 = zeros(7168:7168);
               newFile4 = regexprep(allfiles(i).name,'NucleusBig',[wellind '04NucleusBig'],'ignorecase');        
               imwrite(imagesphereresize4,[foldername1 '/' newFile4]);
               csvHandler.CellPosMatrix(newFile4) = sparse(logical(zeros(7168,7168)));
               clear imagesphereresize4; 

               imagesphereresize5 = zeros(7168:7168);
               newFile5 = regexprep(allfiles(i).name,'NucleusBig',[wellind '05NucleusBig'],'ignorecase');               
               imwrite(imagesphereresize5,[foldername1 '/' newFile5]);
               csvHandler.CellPosMatrix(newFile5) = sparse(logical(zeros(7168,7168)));
               clear imagesphereresize5; 
               
               if(Neuron_Channel > 0)
                   % Same for neurite channel


                   imagesphere6 = imgneurite(y_1:y_2,x_1:x_2);
                   [r1 c1] = size(imagesphere6);
                   imagesphereresize6 = zeros(7168:7168);
                   imagesphereresize6 = uint8(imagesphereresize6);
                   imagesphereresize6(1:r1,1:c1)=imagesphere6;
                   newFile6 = regexprep(allfiles(i).name,'NucleusBig',[wellind '01NeuriteBig'],'ignorecase');        
                   imwrite(imagesphereresize6,[foldername1 '/' newFile6]);
                   clear imagesphereresize6;
                   clear imagesphere6;

                   imagesphere7 = imgneurite(y_3:y_4,x_3:x_4);
                   [r2 c2] = size(imagesphere7);
                   imagesphereresize7 = zeros(7168:7168);
                   imagesphereresize7 = uint8(imagesphereresize7);
                   imagesphereresize7(1:r2,1:c2)=imagesphere7;
                   newFile7 = regexprep(allfiles(i).name,'NucleusBig',[wellind '02NeuriteBig'],'ignorecase');        
                   imwrite(imagesphereresize7,[foldername1 '/' newFile7]);
                   clear imagesphereresize7;
                   clear imagesphere7;

                   imagesphereresize8 = zeros(7168:7168);
            	   newFile8 = regexprep(allfiles(i).name,'NucleusBig',[wellind '03NeuriteBig'],'ignorecase');        
                   imwrite(imagesphereresize8,[foldername1 '/' newFile8]);
                   clear imagesphereresize8;


                   imagesphereresize9 = zeros(7168:7168);
            	   newFile9 = regexprep(allfiles(i).name,'NucleusBig',[wellind '04NeuriteBig'],'ignorecase');        
                   imwrite(imagesphereresize9,[foldername1 '/' newFile9]);
                   clear imagesphereresize9;

                   imagesphereresize10 = zeros(7168:7168);
            	   newFile10 = regexprep(allfiles(i).name,'NucleusBig',[wellind '05NeuriteBig'],'ignorecase');        
                   imwrite(imagesphereresize10,[foldername1 '/' newFile10]);
                   clear imagesphereresize10;

               end
               
               if(Oligo_Channel > 0)
                   % Same for Oligos
                   imagesphere11 = imgoligo(y_1:y_2,x_1:x_2);
                   [r1 c1] = size(imagesphere11);
                   imagesphereresize11 = zeros(7168:7168);
                   imagesphereresize11 = uint8(imagesphereresize11);
                   imagesphereresize11(1:r1,1:c1)=imagesphere11;
                   newFile11 = regexprep(allfiles(i).name,'NucleusBig',[wellind '01OligoBig'],'ignorecase');        
                   imwrite(imagesphereresize11,[foldername1 '/' newFile11]);
                   clear imagesphereresize11;
                   clear imagesphere11;

                   imagesphere12 = imgoligo(y_3:y_4,x_3:x_4);
                   [r2 c2] = size(imagesphere12);
                   imagesphereresize12 = zeros(7168:7168);
                   imagesphereresize12 = uint8(imagesphereresize12);
                   imagesphereresize12(1:r2,1:c2)=imagesphere12;
                   newFile12 = regexprep(allfiles(i).name,'NucleusBig',[wellind '02OligoBig'],'ignorecase');        
                   imwrite(imagesphereresize12,[foldername1 '/' newFile12]);
                   clear imagesphereresize12;
                   clear imagesphere12;

                   imagesphereresize13 = zeros(7168:7168);
            	   newFile13 = regexprep(allfiles(i).name,'NucleusBig',[wellind '03OligoBig'],'ignorecase');        
                   imwrite(imagesphereresize13,[foldername1 '/' newFile13]);
                   clear imagesphereresize13;

                   imagesphereresize14 = zeros(7168:7168);
            	   newFile14 = regexprep(allfiles(i).name,'NucleusBig',[wellind '04OligoBig'],'ignorecase');        
                   imwrite(imagesphereresize14,[foldername1 '/' newFile14]);
                   clear imagesphereresize14;

                   imagesphereresize15 = zeros(7168:7168);
            	   newFile15 = regexprep(allfiles(i).name,'NucleusBig',[wellind '05OligoBig'],'ignorecase');        
                   imwrite(imagesphereresize15,[foldername1 '/' newFile15]);
                   clear imagesphereresize15;
               end
               
               if(Astro_Channel >0)
                   % Same for Astros
                   imagesphere16 = imgastro(y_1:y_2,x_1:x_2);
                   [r1 c1] = size(imagesphere16);
                   imagesphereresize16 = zeros(7168:7168);
                   imagesphereresize16 = uint8(imagesphereresize16);
                   imagesphereresize16(1:r1,1:c1)=imagesphere16;
                   newFile16 = regexprep(allfiles(i).name,'NucleusBig',[wellind '01AstroBig'],'ignorecase');        
                   imwrite(imagesphereresize16,[foldername1 '/' newFile16]);
                   clear imagesphereresize16;
                   clear imagesphere16;

                   imagesphere17 = imgastro(y_3:y_4,x_3:x_4);
                   [r2 c2] = size(imagesphere17);
                   imagesphereresize17 = zeros(7168:7168);
                   imagesphereresize17 = uint8(imagesphereresize17);
                   imagesphereresize17(1:r2,1:c2)=imagesphere17;
                   newFile17 = regexprep(allfiles(i).name,'NucleusBig',[wellind '02AstroBig'],'ignorecase');        
                   imwrite(imagesphereresize17,[foldername1 '/' newFile17]);
                   clear imagesphereresize17;
                   clear imagesphere17;

                   imagesphereresize18 = zeros(7168:7168);
            	   newFile18 = regexprep(allfiles(i).name,'NucleusBig',[wellind '03AstroBig'],'ignorecase');        
                   imwrite(imagesphereresize18,[foldername1 '/' newFile18]);
                   clear imagesphereresize18;

                   imagesphereresize19 = zeros(7168:7168);
            	   newFile19 = regexprep(allfiles(i).name,'NucleusBig',[wellind '04AstroBig'],'ignorecase');        
                   imwrite(imagesphereresize19,[foldername1 '/' newFile19]);
                   clear imagesphereresize19;

                   imagesphereresize20 = zeros(7168:7168);
            	   newFile20 = regexprep(allfiles(i).name,'NucleusBig',[wellind '05AstroBig'],'ignorecase');        
                   imwrite(imagesphereresize20,[foldername1 '/' newFile20]);
                   clear imagesphereresize20;
               end
               
               
                
            else
                
            end
            
        % Case 4: Three spheres remained: s=3
        
            if(s_L >2 && s_L <4);
               % Extracts the x and y coordinates from s 
               x_centroid(1) = s(1).Centroid(1);
               y_centroid(1) = s(1).Centroid(2);
               x_centroid(2) = s(2).Centroid(1);
               y_centroid(2) = s(2).Centroid(2);
               x_centroid(3) = s(3).Centroid(1);
               y_centroid(3) = s(3).Centroid(2);
               % Definition of a centroid quadrant in which the centroid of a potential center neurosphere has to be located. 
               %All other centroids are considerd as rim coordinates 
               quadrant1_x1 = 4032;
               quadrant1_x2 = 6720;
               quadrant1_y1 = 5184;
               quadrant1_y2 = 8640;
               
               %Calculates the distance between the centroids of the
               % three neurosphere 
               d1_2 = 0.5* ((x_centroid(1)-x_centroid(2))^2+(y_centroid(1)-y_centroid(2))^2)^0.5;
               d1_3 = 0.5* ((x_centroid(1)-x_centroid(3))^2+(y_centroid(1)-y_centroid(3))^2)^0.5;
               d2_3 = 0.5* ((x_centroid(3)-x_centroid(2))^2+(y_centroid(3)-y_centroid(2))^2)^0.5;
               
               Vd1 = [d1_2;d1_3]
               Vd2 = [d1_2;d2_3]
               Vd3 = [d1_3;d2_3]
               % The shortest distance between neurosphere cores is the
               % distance between the rim spheres and the center sphere.
               % Therefore for all centroids it is checked wether the coordinates of 
               % their centroid is located within the center quadrant.
               if(x_centroid(1)>=quadrant1_x1 && x_centroid(1)<=quadrant1_x2 && y_centroid(1)>=quadrant1_y1 && y_centroid(1)<=quadrant1_y2);
               % Since more than one sphere might be located in the
               % centroid quadrant, further the distance between center
               % spheres and the middle of the cover slip (dc_x) is
               % calculated     
                    dc_1 = ((x_centroid(1)-5376)^2+(y_centroid(1)-6912)^2)^0.5;
                    
                else
                % If the centroid is not located in the center quadrant the distance is set to an abitrary high value of dc_1 = 1000000000    
                    dc_1 = 1000000000;
                end 
                % Same for sphere 2 and 3
                if(x_centroid(2)>=quadrant1_x1 && x_centroid(2)<=quadrant1_x2 && y_centroid(2)>=quadrant1_y1 && y_centroid(2)<=quadrant1_y2);
                    dc_2 = ((x_centroid(2)-5376)^2+(y_centroid(2)-6912)^2)^0.5;
                    
                else
                    
                    dc_2 = 1000000000;
                end
                
                if(x_centroid(3)>=quadrant1_x1 && x_centroid(3)<=quadrant1_x2 && y_centroid(3)>=quadrant1_y1 && y_centroid(3)<=quadrant1_y2);
                    dc_3 = ((x_centroid(3)-5376)^2+(y_centroid(3)-6912)^2)^0.5;
                    
                else
                    
                    dc_3 = 1000000000;
                end
               % It is checked wether dc_1 is smaller than 1000000000 (no centroid sphere according to the above checked criteria) and smaller
               % than the distances of other centroid spheres. If dc_1 is
               % the smallest distance the centroid of sphere 1 is defined
               % as the centroid of the center sphere
               if(dc_1 < 1000000000 && dc_1 < dc_2 && dc_1 < dc_3);
                   x_centroid_c = x_centroid(1);
                   y_centroid_c = y_centroid(1);
                   missingc1 = 0;
                 
                   
               else
               % If above criteria are not fullfilled the centroid sphere
               % is missing and the centroid of this sphere is treated as
               % a rim sphere
                   missingc1 = 1;
               end    
               %Same for sphere 2 and 3 
               if(dc_2 < 1000000000 && dc_2 < dc_1 && dc_2 < dc_3);
                   x_centroid_c = x_centroid(2);
                   y_centroid_c = y_centroid(2);
                   missingc2 = 0;
               else
                   missingc2 = 1;
               end              
                
               if(dc_3 < 1000000000 && dc_3 < dc_1 && dc_3 < dc_2);
                   x_centroid_c = x_centroid(3);
                   y_centroid_c = y_centroid(3);
                   missingc3 = 0;
           
               else
                   missingc3 = 1;
               end
               % If all 3 spheres were defined as rim spheres, an artifical
               % center point is defined as the center point of the cover
               % slip
               if((missingc1+missingc2+missingc3) > 2);
                   x_centroid_c = 5376;
                   y_centroid_c = 6912;
               else
               end 
               
               % If sphere 1 is no center sphere the shortest distance
               % between sphere1 and the center sphere is calculated
               if(x_centroid(1) ~= x_centroid_c);
                   d_1_c = 0.5* (((x_centroid(1)-x_centroid_c)^2+(y_centroid(1)-y_centroid_c)^2)^0.5);
               else
               end   
               % Centroid of sphere 2 is located between sphere 1 and 3
               if(x_centroid(2) ~= x_centroid_c);
               % If sphere 2 is no center sphere the shortest distance
               % between sphere2 and the center sphere is calculated    
                   d_2_c = 0.5* (((x_centroid(2)-x_centroid_c)^2+(y_centroid(2)-y_centroid_c)^2)^0.5);
               else
               end
               % Centroid of sphere 3 is located right of sphere 1 and 2
               if(x_centroid(3) ~= x_centroid_c);
                   d_3_c = 0.5* (((x_centroid(3)-x_centroid_c)^2+(y_centroid(3)-y_centroid_c)^2)^0.5);
               else
               end
               
            
               % Defines wether centroid of sphere 1 lays left or right of the center
               % sphere! If sphere 1 is not the center sphere
                if(x_centroid(1) ~= x_centroid_c);
                   % First case: Check whether x_centroid(1) is left of the center sphere 
                   if(x_centroid(1) < x_centroid_c);
                      % Check if y_centroid(1) is below y_centroid_c 
                      if(y_centroid(1)<y_centroid_c);
                       % If y_centroid(1)<y_centroid_c the sphere has to be located at the
                       % upper left corner of the cover slip 
                       x_centroid_l(1) = x_centroid(1);
                       y_centroid_l(1) = y_centroid(1);
                       % Sphere is located in the upper left of the cover
                       % slip
                       l_1_1 = 1;
                       % Sphere is located in the lower left of the cover
                       % slip
                       l_1_2 = 0;
                       % Sphere is located in the upper right of the cover
                       % slip
                       r_1_4 = 0;
                       % Sphere is located in the lower right of the cover
                       % slip
                       r_1_5 = 0;
                       
                      else
                       % If y_centroid(1)>y_centroid_c the sphere has to be located at the
                       % lower left corner of the cover slip  
                       x_centroid_l(2) = x_centroid(1);
                       y_centroid_l(2) = y_centroid(1);
                       l_1_1 = 0
                       l_1_2 = 1
                       r_1_4 = 0
                       r_1_5 = 0 
                      end
                   % Second case: Check whether x_centroid(1) is right of the center sphere    
                   else
                      % Check if y_centroid(1) is below y_centroid_c)                  
                      if(y_centroid(1)<y_centroid_c) 
                       x_centroid_r(4) = x_centroid(1);
                       y_centroid_r(4) = y_centroid(1);
                       % If y_centroid(1)<y_centroid_c the sphere has to be located at the
                       % upper right corner of the cover slip
                       l_1_1 = 0
                       l_1_2 = 0
                       r_1_4 = 1
                       r_1_5 = 0
                      else
                      % If y_centroid(1)>y_centroid_c the sphere has to be located at the
                       % lower right corner of the cover slip     
                       x_centroid_r(5) = x_centroid(1);
                       y_centroid_r(5) = x_centroid(1);
                       l_1_1 = 0
                       l_1_2 = 0
                       r_1_4 = 0
                       r_1_5 = 1 
                      end 
                   end    
                else
                    l_1_1 = 0
                    l_1_2 = 0
                    r_1_4 = 0
                    r_1_5 = 0
                end    
               % Same for sphere 2 and 3
               if(x_centroid(2) ~= x_centroid_c)
                   if(x_centroid(2) < x_centroid_c);
                      if(y_centroid(2)<y_centroid_c) 
                       x_centroid_l(1) = x_centroid(2);
                       y_centroid_l(1) = y_centroid(2);
                       l_2_1 = 1
                       l_2_2 = 0
                       r_2_4 = 0
                       r_2_5 = 0
                       
                      else
                       x_centroid_l(2) = x_centroid(2);
                       y_centroid_l(2) = y_centroid(2);
                       l_2_1 = 0
                       l_2_2 = 1
                       r_2_4 = 0
                       r_2_5 = 0 
                      end 
                   else
                      if(y_centroid(2)<y_centroid_c) 
                       x_centroid_r(4) = x_centroid(2);
                       y_centroid_r(4) = y_centroid(2);
                       l_2_1 = 0
                       l_2_2 = 0
                       r_2_4 = 1
                       r_2_5 = 0
                      else
                       x_centroid_r(5) = x_centroid(2);
                       y_centroid_r(5) = x_centroid(2);
                       l_2_1 = 0
                       l_2_2 = 0
                       r_2_4 = 0
                       r_2_5 = 1 
                      end 
                   end    
                else
                    l_2_1 = 0
                    l_2_2 = 0
                    r_2_4 = 0
                    r_2_5 = 0
                end 
               
               if(x_centroid(3) ~= x_centroid_c)
                   if(x_centroid(3) < x_centroid_c);
                      if(y_centroid(3)<y_centroid_c) 
                       x_centroid_l(1) = x_centroid(3);
                       y_centroid_l(1) = y_centroid(3);
                       l_3_1 = 1
                       l_3_2 = 0
                       r_3_4 = 0
                       r_3_5 = 0
                       
                      else
                       x_centroid_l(2) = x_centroid(3);
                       y_centroid_l(2) = y_centroid(3);
                       l_3_1 = 0
                       l_3_2 = 1
                       r_3_4 = 0
                       r_3_5 = 0 
                      end 
                   else
                      if(y_centroid(3)<y_centroid_c) 
                       x_centroid_r(4) = x_centroid(3);
                       y_centroid_r(4) = y_centroid(3);
                       l_3_1 = 0
                       l_3_2 = 0
                       r_3_4 = 1
                       r_3_5 = 0
                      else
                       x_centroid_r(5) = x_centroid(3);
                       y_centroid_r(5) = x_centroid(3);
                       l_3_1 = 0
                       l_3_2 = 0
                       r_3_4 = 0
                       r_3_5 = 1 
                      end 
                   end    
               else
                    l_3_1 = 0
                    l_3_2 = 0
                    r_3_4 = 0
                    r_3_5 = 0
               end
               
               
               % Check for double entry positions:
               
               %Check if sphere 1,2 and 3 have the same position 
               if(l_2_1 == l_1_1 && l_2_2 == l_1_2 && r_2_4 == r_1_4 && r_2_5 == r_1_5 && l_3_1 == l_1_1 && l_3_2 == l_1_2 && r_3_4 == r_1_4 && r_3_5 == r_1_5)
                   
                   l_1_1_t = l_1_1
                   l_1_2_t = l_1_2
                   r_1_4_t = r_1_4
                   r_1_5_t = r_1_5
                   l_2_1_t = l_2_1
                   l_2_2_t = l_2_2
                   r_2_4_t = r_2_4
                   r_2_5_t = r_2_5
                   l_3_1_t = l_3_1
                   l_3_2_t = l_3_2
                   r_3_4_t = r_3_4
                   r_3_5_t = r_3_5
                   l_1_1 = 0
                   l_1_2 = 0
                   r_1_4 = 0
                   r_1_5 = 0
                   l_2_1 = 0
                   l_2_2 = 0
                   r_2_4 = 0
                   r_2_5 = 0
                   l_3_1 = 0
                   l_3_2 = 0
                   r_3_4 = 0
                   r_3_5 = 0
                   
                   
               else
                   l_1_1_t = 0
                   l_1_2_t = 0
                   r_1_4_t = 0
                   r_1_5_t = 0
                   l_2_1_t = 0
                   l_2_2_t = 0
                   r_2_4_t = 0
                   r_2_5_t = 0
                   l_3_1_t = 0
                   l_3_2_t = 0
                   r_3_4_t = 0
                   r_3_5_t = 0 
                   
               end    
               
               % Check if sphere 1 and 2 share the same position
               if(l_2_1 == l_1_1 && l_2_2 == l_1_2 && r_2_4 == r_1_4 && r_2_5 == r_1_5)
                 
                   l_1_1_d12 = l_1_1
                   l_1_2_d12 = l_1_2
                   r_1_4_d12 = r_1_4
                   r_1_5_d12 = r_1_5
                   l_2_1_d12 = l_2_1
                   l_2_2_d12 = l_2_2
                   r_2_4_d12 = r_2_4
                   r_2_5_d12 = r_2_5
                   l_3_1_d12 = 0
                   l_3_2_d12 = 0
                   r_3_4_d12 = 0
                   r_3_5_d12 = 0
                   l_1_1 = 0
                   l_1_2 = 0
                   r_1_4 = 0
                   r_1_5 = 0
                   l_2_1 = 0
                   l_2_2 = 0
                   r_2_4 = 0
                   r_2_5 = 0
                                              
               else
                   l_1_1_d12 = 0
                   l_1_2_d12 = 0
                   r_1_4_d12 = 0
                   r_1_5_d12 = 0
                   l_2_1_d12 = 0
                   l_2_2_d12 = 0
                   r_2_4_d12 = 0
                   r_2_5_d12 = 0 
                   
                       
               end
                   
               % Check if sphere 1 and 3 share the same position
               if(l_3_1 == l_1_1 && l_3_2 == l_1_2 && r_3_4 == r_1_4 && r_3_5 == r_1_5)
                 
                   l_1_1_d13 = l_1_1
                   l_1_2_d13 = l_1_2
                   r_1_4_d13 = r_1_4
                   r_1_5_d13 = r_1_5
                   l_2_1_d13 = 0
                   l_2_2_d13 = 0
                   r_2_4_d13 = 0
                   r_2_5_d13 = 0
                   l_3_1_d13 = l_3_1
                   l_3_2_d13 = l_3_2
                   r_3_4_d13 = r_3_4
                   r_3_5_d13 = r_3_5
                   l_1_1 = 0
                   l_1_2 = 0
                   r_1_4 = 0
                   r_1_5 = 0
                   l_3_1 = 0
                   l_3_2 = 0
                   r_3_4 = 0
                   r_3_5 = 0
                                              
               else
                   l_1_1_d13 = 0
                   l_1_2_d13 = 0
                   r_1_4_d13 = 0
                   r_1_5_d13 = 0
                   l_3_1_d13 = 0
                   l_3_2_d13 = 0
                   r_3_4_d13 = 0
                   r_3_5_d13 = 0 
                   
                       
                   end
                       
                   
                 
               
               
               if(l_2_1 == l_3_1 && l_2_2 == l_3_2 && r_2_4 == r_3_4 && r_2_5 == r_3_5)
                   B = 1
                   l_2_1_d23 = l_2_1
                   l_2_2_d23 = l_2_2
                   r_2_4_d23 = r_2_4
                   r_2_5_d23 = r_2_5
                   l_3_1_d23 = l_3_1
                   l_3_2_d23 = l_3_2
                   r_3_4_d23 = r_3_4
                   r_3_5_d23 = r_3_5
                   l_2_1 = 0
                   l_2_2 = 0
                   r_2_4 = 0
                   r_2_5 = 0
                   l_3_1 = 0
                   l_3_2 = 0
                   r_3_4 = 0
                   r_3_5 = 0
                   
               else
                   l_2_1_d23 = 0
                   l_2_2_d23 = 0
                   r_2_4_d23 = 0
                   r_2_5_d23 = 0
                   l_3_1_d23 = 0
                   l_3_2_d23 = 0
                   r_3_4_d23 = 0
                   r_3_5_d23 = 0
                   
               end    
                  
               
               
                            
               
               
               % Sphere 1 with smallest value of x_centroid
               
               
               
               % Go through potential positions
               % Case 1: Sphere is no center sphere and is located at the
               % upper left
               if(l_1_1 >0 && l_1_1 < 2);
                       % Coordinates to cut out sphere 1
                       x_1 = 1;
                       x_2 = x_centroid(1) + d_1_c;
                       y_1 = 1;
                       y_2 = y_centroid(1) + d_1_c;
               else
               end    
               % Case 2: Sphere is no center sphere and is located at the
               % lower left
               if(l_1_2 >0 && l_1_2 < 2);
                       % Coordinates to cut out sphere 1
                       x_1 = 1;
                       x_2 = x_centroid(1) + d_1_c;
                       y_1 = y_centroid(1) - d_1_c;
                       y_2 = 13824;
               else
               end
               % Case 3: Sphere is no center sphere and is located at the
               % upper right
               if(r_1_4 >0 && r_1_4 < 2);
                       % Coordinates to cut out sphere 1
                       x_1 = x_centroid(1) - d_1_c;
                       x_2 = 10752;
                       y_1 = 1;
                       y_2 = y_centroid(1) + d_1_c;
               else
               end
               % Case 4: Sphere is no center sphere and is located at the
               % lower right
               if(r_1_5 >0 && r_1_5 < 2);
                       % Coordinates to cut out sphere 1 
                       x_1 = x_centroid(1) - d_1_c;
                       x_2 = 10752;
                       y_1 = y_centroid(1) - d_1_c;
                       y_2 = 13824;
               else
               end
               % Going through all iterations for the case sphere 1 =
               % center sphere
               if(x_centroid(1) ~= x_centroid_c);
               else
                   % Case 1: sphere 2 and 3 are located left of sphere 1
                   if(x_centroid(2) < x_centroid(1) && x_centroid(3) < x_centroid(1));
                       % Find shortest distance to sphere 1 to sphere 2 and
                       % 3 to a maximum of 7168/2. Since both sphere 2 and sphere 3
                       % are located left of sphere 1, distance is just
                       % limited to the left and not to the right
                       V_1m = [d1_2 ; d1_3 ; (7168/2)];
                       min1m = min(V_1m(1:3));
                       % Maximal added distance to the right to obtain
                       % maximal images of 7168x7168 pixel
                       min1p = (7168-min1m);
                   else
                   end
                   % Case 2: sphere 2 and 3 are located right of sphere 1
                   if(x_centroid(2) > x_centroid(1) && x_centroid(3) > x_centroid(1));
                       % Find shortest distance to sphere 1 to sphere 2 and
                       % 3 to a maximum of 7168/2. Since both sphere 2 and sphere 3
                       % are located right of sphere 1, distance is just
                       % limited to the right and not to the left
                       V_1p = [d1_2 ; d1_3 ; (7168/2)];
                       min1p = min(V_1p(1:3));
                       min1m = (7168-min1p);
                   else
                   end
                   % Case 3: sphere 2 is located right of sphere 1 and 3 is located left of sphere 1
                   if(x_centroid(2) > x_centroid(1) && x_centroid(3) < x_centroid(1));
                       % Find minimal distance to the left and to the right. To the left
                       % only the distance between sphere 1 and 2 and to
                       % the right only the distance of sphere 1 and 3
                       % matter.                     
                       V_1m = [d1_3 ; (7168/2)];
                       V_1p = [d1_2 ; (7168/2)];
                       min1p = min(V_1p(1:2));
                       min1m = min(V_1m(1:2));
                   else
                   end
                   % Case 3: sphere 2 is located left of sphere 1 and 3 is located right of sphere 1
                   if(x_centroid(2) < x_centroid(1) && x_centroid(3) > x_centroid(1));
                       % Find minimal distance to the left and to the right. To the left
                       % only the distance between sphere 1 and 3 and to
                       % the right only the distance of sphere 1 and 2
                       % matter. 
                       V_1m = [d1_2 ; (7168/2)];
                       V_1p = [d1_3 ; (7168/2)];
                       min1p = min(V_1p(1:2));
                       min1m = min(V_1m(1:2));
                   else
                   end
              % Coordinates to cut out sphere 1  
                   x_1 = x_centroid(1) - min1m 
                   x_2 = x_centroid(1) + min1p
                   y_1 = y_centroid(1) - min1m
                   y_2 = y_centroid(1) + min1p
               end    
               
               % Cases for having two or three spheres at one location
               
               % Sphere 1 and 2 are in the same location
               
               if(l_1_1_d12 == 1)
                  if(y_centroid(1) < y_centroid(2))
                  x_1 = 1;
                  x_2 = x_centroid(1) + d1_2;
                  y_1 = 1;
                  y_2 = y_centroid(1) + d1_2; 
                  else
                  x_1 = 1;
                  x_2 = x_centroid(1) + d1_2;
                  y_1 = y_centroid(1) - d1_2;
                  y_2 = y_centroid(1) + (7168 - d1_2);    
                  end    
               end   
               
               if(l_1_2_d12 == 1)
                  if(y_centroid(1) < y_centroid(2))
                  x_1 = 1;
                  x_2 = x_centroid(1) + d1_2;
                  y_1 = y_centroid(1) - (7168 - d1_2);
                  y_2 = y_centroid(1) + d1_2; 
                  else
                  x_1 = 1;
                  x_2 = x_centroid(1) + d1_2;
                  y_1 = y_centroid(1) - d1_2;
                  y_2 = 13824;    
                  end    
               end 
               
               if(r_1_4_d12 == 1)
                  if(y_centroid(1) < y_centroid(2))
                  x_1 = x_centroid(1) - (7168 - d1_2);
                  x_2 = x_centroid(1) + d1_2;
                  y_1 = 1;
                  y_2 = y_centroid(1) + d1_2;
                  else
                  x_1 = x_centroid(1) - (7168 - d1_2);
                  x_2 = x_centroid(1) + d1_2;
                  y_1 = y_centroid(1) - d1_2
                  y_2 = y_centroid(1) + (7168 - d1_2);    
                  end    
               end 
               
               if(r_1_5_d12 == 1)
                  if(y_centroid(1) < y_centroid(2))
                  x_1 = x_centroid(1) - (7168 - d1_2);
                  x_2 = x_centroid(1) + d1_2;
                  y_1 = y_centroid(1) + d1_2;
                  y_2 = 13824;
                  else
                  x_1 = x_centroid(1) - (7168 - d1_2);
                  x_2 = x_centroid(1) + d1_2;
                  y_1 = y_centroid(1) + (7168 - d1_2)
                  y_2 = y_centroid(1) + d1_2;    
                  end    
               end 
               
               % Sphere 1 and 3 are at the same quadrant
               
               if(l_1_1_d13 == 1)
                  if(y_centroid(1) < y_centroid(3))
                  x_1 = 1;
                  x_2 = x_centroid(1) + d1_3;
                  y_1 = 1;
                  y_2 = y_centroid(1) + d1_3; 
                  else
                  x_1 = 1;
                  x_2 = x_centroid(1) + d1_3;
                  y_1 = y_centroid(1) - d1_3;
                  y_2 = y_centroid(1) + (7168 - d1_3);    
                  end    
               end   
               
               if(l_1_2_d13 == 1)
                  if(y_centroid(1) < y_centroid(3))
                  x_1 = 1;
                  x_2 = x_centroid(1) + d1_3;
                  y_1 = y_centroid(1) - (7168 - d1_3);
                  y_2 = y_centroid(1) + d1_3; 
                  else
                  x_1 = 1;
                  x_2 = x_centroid(1) + d1_3;
                  y_1 = y_centroid(1) - d1_3;
                  y_2 = 13824;    
                  end    
               end 
               
               if(r_1_4_d13 == 1)
                  if(y_centroid(1) < y_centroid(3))
                  x_1 = x_centroid(1) - (7168 - d1_3);
                  x_2 = x_centroid(1) + d1_3;
                  y_1 = 1;
                  y_2 = y_centroid(1) + d1_3;
                  else
                  x_1 = x_centroid(1) - (7168 - d1_3);
                  x_2 = x_centroid(1) + d1_3;
                  y_1 = y_centroid(1) - d1_3
                  y_2 = y_centroid(1) + (7168 - d1_3);    
                  end    
               end 
               
               if(r_1_5_d13 == 1)
                  if(y_centroid(1) < y_centroid(3))
                  x_1 = x_centroid(1) - (7168 - d1_3);
                  x_2 = x_centroid(1) + d1_3;
                  y_1 = y_centroid(1) + d1_3;
                  y_2 = 13824;
                  else
                  x_1 = x_centroid(1) - (7168 - d1_3);
                  x_2 = x_centroid(1) + d1_3;
                  y_1 = y_centroid(1) + (7168 - d1_3)
                  y_2 = y_centroid(1) + d1_3;    
                  end    
               end 
               
               
               % Sphere 1 and 2 and 3 are in the same location
               
               if(l_1_1_t == 1)
                  if(y_centroid(1) < y_centroid(2) && y_centroid(1) < y_centroid(3))
                  minxy = min(Vd1(1:2))    
                  x_1 = 1;
                  x_2 = x_centroid(1) + minxy;
                  y_1 = 1;
                  y_2 = y_centroid(1) + minxy; 
                  end
                  if(y_centroid(1) > y_centroid(2) && y_centroid(1) > y_centroid(3))
                  minxy = min(Vd1(1:2))   
                  x_1 = 1;
                  x_2 = x_centroid(1) + minxy;
                  y_1 = y_centroid(1) - minxy;
                  y_2 = y_centroid(1) + (7168-minxy); 
                  end
                  if(y_centroid(1) < y_centroid(2) && y_centroid(1) > y_centroid(3))
                  minxy = min(Vd1(1:2))    
                  x_1 = 1;
                  x_2 = x_centroid(1) + minxy;
                  y_1 = y_centroid(1) - d1_3;
                  y_2 = y_centroid(1) + d1_2; 
                  end
                  if(y_centroid(1) > y_centroid(2) && y_centroid(1) < y_centroid(3))
                  minxy = min(Vd1(1:2))    
                  x_1 = 1;
                  x_2 = x_centroid(1) + minxy;
                  y_1 = y_centroid(1) - d1_2;
                  y_2 = y_centroid(1) + d1_3; 
                  end
               end 
               
               if(l_1_2_t == 1)
                  if(y_centroid(1) < y_centroid(2) && y_centroid(1) < y_centroid(3))
                  minxy = min(Vd1(1:2))    
                  x_1 = 1;
                  x_2 = x_centroid(1) + minxy;
                  y_1 = y_centroid(1) - (7168-minxy);
                  y_2 = y_centroid(1) + minxy; 
                  end
                  if(y_centroid(1) > y_centroid(2) && y_centroid(1) > y_centroid(3))
                  minxy = min(Vd1(1:2))    
                  x_1 = 1;
                  x_2 = x_centroid(1) + minxy;
                  y_1 = y_centroid(1) - minxy;
                  y_2 = 13824; 
                  end
                  if(y_centroid(1) < y_centroid(2) && y_centroid(1) > y_centroid(3))
                  minxy = min(Vd1(1:2))    
                  x_1 = 1;
                  x_2 = x_centroid(1) + minxy;
                  y_1 = y_centroid(1) - d1_3;
                  y_2 = y_centroid(1) + d1_2; 
                  end
                  if(y_centroid(1) > y_centroid(2) && y_centroid(1) < y_centroid(3))
                  minxy = min(Vd1(1:2))    
                  x_1 = 1;
                  x_2 = x_centroid(1) + minxy;
                  y_1 = y_centroid(1) - d1_2;
                  y_2 = y_centroid(1) + d1_3; 
                  end
               end
               
                if(r_1_4_t == 1)
                  if(y_centroid(1) < y_centroid(2) && y_centroid(1) < y_centroid(3))
                  minxy = min(Vd1(1:2))    
                  x_1 = x_centroid(1) - (7168 - minxy);
                  x_2 = x_centroid(1) + minxy;
                  y_1 = 1;
                  y_2 = y_centroid(1) + minxy; 
                  end
                  if(y_centroid(1) > y_centroid(2) && y_centroid(1) > y_centroid(3))
                  minxy = min(Vd1(1:2))    
                  x_1 = x_centroid(1) - (7168 - minxy);
                  x_2 = x_centroid(1) + minxy;
                  y_1 = y_centroid(1) - minxy;
                  y_2 = y_centroid(1) + (7168 - minxy); 
                  end
                  if(y_centroid(1) < y_centroid(2) && y_centroid(1) > y_centroid(3))
                  minxy = min(Vd1(1:2))   
                  x_1 = x_centroid(1) - (7168 - minxy);
                  x_2 = x_centroid(1) + minxy;
                  y_1 = y_centroid(1) - d1_3;
                  y_2 = y_centroid(1) + d1_2; 
                  end
                  if(y_centroid(1) > y_centroid(2) && y_centroid(1) < y_centroid(3))
                  minxy = min(Vd1(1:2))    
                  x_1 = x_centroid(1) - (7168 - minxy);
                  x_2 = x_centroid(1) + minxy;
                  y_1 = y_centroid(1) - d1_2;
                  y_2 = y_centroid(1) + d1_3; 
                  end
                end
                
                if(r_1_5_t == 1)
                  if(y_centroid(1) < y_centroid(2) && y_centroid(1) < y_centroid(3))
                  minxy = min(Vd1(1:2))    
                  x_1 = x_centroid(1) - (7168 - minxy);
                  x_2 = x_centroid(1) + minxy;
                  y_1 = y_centroid(1) - (7168-minxy);
                  y_2 = y_centroid(1) + minxy;
                  end
                  if(y_centroid(1) > y_centroid(2) && y_centroid(1) > y_centroid(3))
                  minxy = min(Vd1(1:2))   
                  x_1 = x_centroid(1) - (7168 - minxy);
                  x_2 = x_centroid(1) + minxy;
                  y_1 = y_centroid(1) - minxy;
                  y_2 = 13824;  
                  end
                  if(y_centroid(1) < y_centroid(2) && y_centroid(1) > y_centroid(3))
                  minxy = min(Vd1(1:2))    
                  x_1 = x_centroid(1) - (7168 - minxy);
                  x_2 = x_centroid(1) + minxy;
                  y_1 = y_centroid(1) - d1_3;
                  y_2 = y_centroid(1) + d1_2; 
                  end
                  if(y_centroid(1) > y_centroid(2) && y_centroid(1) < y_centroid(3))
                  minxy = min(Vd1(1:2))    
                  x_1 = x_centroid(1) - (7168 - minxy);
                  x_2 = x_centroid(1) + minxy;
                  y_1 = y_centroid(1) - d1_2;
                  y_2 = y_centroid(1) + d1_3; 
                  end
                end
                
                if(x_1 < 0)
                    x_1 =0;
                end    
                if(x_2 > 10752)
                    x_2 =10752;
                end
                if(y_1 < 0)
                    y_1 =0;
                end
                if(y_2 > 13824)
                    y_2 =13824;
                end
               
                %The rectangular image is cutted from the imgnucleus image containing the whole cover slip
               imagesphere1 = imgnucleus(y_1:y_2,x_1:x_2);
               % Dimensions of imagesphere1 are determined
               [r1 c1] = size(imagesphere1);
               % An empty matrix is generated
               imagesphereresize1 = zeros(7168:7168);
               % imagesphereresize1 is converted to 8-bit
               imagesphereresize1 = uint8(imagesphereresize1);
               %The empty indices in the imagesphereresize1 matrix are overwritten with imagesphere 1 entries
               imagesphereresize1(1:r1,1:c1)=imagesphere1;
               % imagesphereresize1 is saved to final destination
               newFile1 = regexprep(allfiles(i).name,'NucleusBig',[wellind '01NucleusBig'],'ignorecase');        
               imwrite(imagesphereresize1,[foldername1 '/' newFile1]);
               csvHandler.CellPosMatrix(newFile1) = sparse(logical(zeros(7168,7168)));
               clear imagesphereresize1; 
               clear imagesphere1;
               
               % Sphere 2 with second smallest value of x_centroid
               
               
               
               
               if(l_2_1 >0 && l_2_1 < 2);
                       x_3 = 1;
                       x_4 = x_centroid(2) + d_2_c;
                       y_3 = 1;
                       y_4 = y_centroid(2) + d_2_c;
               else
               end    
               
               if(l_2_2 >0 && l_2_2 < 2);
                       x_3 = 1;
                       x_4 = x_centroid(2) + d_2_c;
                       y_3 = y_centroid(2) - d_2_c;
                       y_4 = 13824;
               else
               end
               
               if(r_2_4 >0 && r_2_4 < 2);
                       x_3 = x_centroid(2) - d_2_c;
                       x_4 = 10752;
                       y_3 = 1;
                       y_4 = y_centroid(2) + d_2_c;
               else
               end
               
               if(r_2_5 >0 && r_2_5 < 2);
                       x_3 = x_centroid(2) - d_2_c;
                       x_4 = 10752;
                       y_3 = y_centroid(2) - d_2_c;
                       y_4 = 13824;
               else
               end
               
               if(x_centroid(2) ~= x_centroid_c);
               else
                   if(x_centroid(1) < x_centroid(2) && x_centroid(3) < x_centroid(2));
                       V_1m = [d1_2 ; d2_3 ; (7168/2)];
                       min1m = min(V_1m(1:3));
                       min1p = (7168-min1m);
                   else
                   end
                   if(x_centroid(1) > x_centroid(2) && x_centroid(3) > x_centroid(2));
                       V_1p = [d1_2 ; d2_3 ; (7168/2)];
                       min1p = min(V_1p(1:3));
                       min1m = (7168-min1p);
                   else
                   end
                   if(x_centroid(1) > x_centroid(2) && x_centroid(3) < x_centroid(2));
                       V_1m = [d2_3 ; (7168/2)];
                       V_1p = [d1_2 ; (7168/2)];
                       min1p = min(V_1p(1:2));
                       min1m = min(V_1m(1:2));
                   else
                       
                   end
                   if(x_centroid(1) < x_centroid(2) && x_centroid(3) > x_centroid(2));
                       V_1m = [d1_2 ; (7168/2)];
                       V_1p = [d2_3 ; (7168/2)];
                       min1p = min(V_1p(1:2));
                       min1m = min(V_1m(1:2));
                        
                   else
                       
                   end
                   
                   x_3 = x_centroid(2) - min1m 
                   x_4 = x_centroid(2) + min1p
                   y_3 = y_centroid(2) - min1m
                   y_4 = y_centroid(2) + min1p
               end  
               
               % Cases for having two or three spheres at one location
               
               % Sphere 1 and 2 are in the same location
               
               if(l_2_1_d12 == 1)
                  if(y_centroid(2) < y_centroid(1))
                  x_3 = x_centroid(2) - d1_2;
                  x_4 = x_centroid(2) + (7168 - d1_2);
                  y_3 = 1;
                  y_4 = y_centroid(2) + d1_2; 
                  else
                  x_3 = x_centroid(2) - d1_2;
                  x_4 = x_centroid(2) + (7168 - d1_2);
                  y_3 = y_centroid(2) - d1_2;
                  y_4 = y_centroid(2) + (7168 - d1_2);    
                  end    
               end   
               
               if(l_2_2_d12 == 1)
                  if(y_centroid(2) < y_centroid(1))
                  x_3 = x_centroid(2) - d1_2;
                  x_4 = x_centroid(2) + (7168 - d1_2);
                  y_3 = y_centroid(2) - (7168 - d1_2);
                  y_4 = y_centroid(2) + d1_2; 
                  else
                  x_3 = x_centroid(2) - d1_2;
                  x_4 = x_centroid(2) + (7168 - d1_2);
                  y_3 = y_centroid(2) - d1_2;
                  y_4 = 13824;    
                  end    
               end 
               
               if(r_2_4_d12 == 1)
                  if(y_centroid(2) < y_centroid(1))
                  x_3 = x_centroid(2) - d1_2;
                  x_4 = 10752;
                  y_3 = 1;
                  y_4 = y_centroid(2) + d1_2;
                  else
                  x_3 = x_centroid(2) - d1_2;
                  x_4 = 10752;
                  y_3 = y_centroid(2) - d1_2
                  y_4 = y_centroid(2) + (7168 - d1_2);    
                  end    
               end 
               
               if(r_2_5_d12 == 1)
                  if(y_centroid(2) < y_centroid(1))
                  x_3 = x_centroid(2) - d1_2;
                  x_4 = 10752;
                  y_3 = y_centroid(2) + d1_2;
                  y_4 = 13824;
                  else
                  x_3 = x_centroid(2) - d1_2;
                  x_4 = 10752;
                  y_3 = y_centroid(2) + (7168 - d1_2)
                  y_4 = y_centroid(2) + d1_2;    
                  end    
               end 
               
               % Sphere 2 and 3 are in the same location
               
               if(l_2_1_d23 == 1)
                  if(y_centroid(2) < y_centroid(3))
                  x_3 = 1;
                  x_4 = x_centroid(2) + d2_3;
                  y_3 = 1;
                  y_4 = y_centroid(2) + d2_3; 
                  else
                  x_3 = 1;
                  x_4 = x_centroid(2) + d2_3;
                  y_3 = y_centroid(2) - d2_3;
                  y_4 = y_centroid(2) + (7168 - d2_3);    
                  end    
               end   
               
               if(l_2_2_d23 == 1)
                  if(y_centroid(2) < y_centroid(3))
                  x_3 = 1;
                  x_4 = x_centroid(2) + d2_3;
                  y_3 = y_centroid(2) - (7168 - d2_3);
                  y_4 = y_centroid(2) + d2_3; 
                  else
                  x_3 = 1;
                  x_4 = x_centroid(2) + d2_3;
                  y_3 = y_centroid(2) - d2_3;
                  y_4 = 13824;    
                  end    
               end 
               
               if(r_2_4_d23 == 1)
                  if(y_centroid(2) < y_centroid(3))
                  x_3 = x_centroid(2) - (7168 - d2_3);
                  x_4 = x_centroid(2) + d2_3;
                  y_3 = 1;
                  y_4 = y_centroid(2) + d2_3;
                  else
                  x_3 = x_centroid(2) - (7168 - d2_3);
                  x_4 = x_centroid(2) + d2_3;
                  y_3 = y_centroid(2) - d2_3
                  y_4 = y_centroid(2) + (7168 - d2_3);    
                  end    
               end 
               
               if(r_2_5_d23 == 1)
                  if(y_centroid(2) < y_centroid(3))
                  x_3 = x_centroid(2) - (7168 - d2_3);
                  x_4 = x_centroid(2) + d2_3;
                  y_3 = y_centroid(2) - (7168 - d2_3);
                  y_4 = y_centroid(2) + d2_3; 
                  else
                  x_3 = x_centroid(2) - (7168 - d2_3);
                  x_4 = x_centroid(2) + d2_3;
                  y_3 = y_centroid(2) - d2_3;
                  y_4 = 13824;     
                  end    
               end 
               
               % Sphere 1 and 2 and 3 are in the same location
               
               if(l_2_1_t == 1)
                  if(y_centroid(2) < y_centroid(1) && y_centroid(2) < y_centroid(3))
                  minxy = min(Vd2(1:2))    
                  x_3 = x_centroid(2) -d1_2;
                  x_4 = x_centroid(2) +d2_3;
                  y_3 = 1;
                  y_4 = y_centroid(2) + minxy; 
                  end
                  if(y_centroid(2) > y_centroid(1) && y_centroid(2) > y_centroid(3))
                  minxy = min(Vd2(1:2))     
                  x_3 = x_centroid(2) -d1_2;
                  x_4 = x_centroid(2) +d2_3;
                  y_3 = y_centroid(2) - minxy;
                  y_4 = y_centroid(2) + (7168 - minxy); 
                  end
                  if(y_centroid(2) < y_centroid(1) && y_centroid(2) > y_centroid(3))
                  minxy = min(Vd2(1:2))     
                  x_3 = x_centroid(2) -d1_2;
                  x_4 = x_centroid(2) +d2_3;
                  y_3 = y_centroid(2) - d2_3;
                  y_4 = y_centroid(2) + d1_2; 
                  end
                  if(y_centroid(2) > y_centroid(1) && y_centroid(2) < y_centroid(3))
                  minxy = min(Vd2(1:2))   
                  x_3 = x_centroid(2) -d1_2;
                  x_4 = x_centroid(2) +d2_3;
                  y_3 = y_centroid(2) - d1_2;
                  y_4 = y_centroid(2) + d2_3; 
                  end
               end 
               
               if(l_2_2_t == 1)
                  if(y_centroid(2) < y_centroid(1) && y_centroid(2) < y_centroid(3))
                  minxy = min(Vd2(1:2))     
                  x_3 = x_centroid(2) -d1_2;
                  x_4 = x_centroid(2) +d2_3;
                  y_3 = y_centroid(2) - (7168-minxy);
                  y_4 = y_centroid(2) + minxy; 
                  end
                  if(y_centroid(2) > y_centroid(1) && y_centroid(2) > y_centroid(3))
                  minxy = min(Vd2(1:2))     
                  x_3 = x_centroid(2) -d1_2;
                  x_4 = x_centroid(2) +d2_3;
                  y_3 = y_centroid(2) - minxy;
                  y_4 = 13824; 
                  end
                  if(y_centroid(2) < y_centroid(1) && y_centroid(2) > y_centroid(3))
                  minxy = min(Vd2(1:2))     
                  x_3 = x_centroid(2) -d1_2;
                  x_4 = x_centroid(2) +d2_3;
                  y_3 = y_centroid(2) - d2_3;
                  y_4 = y_centroid(2) + d1_2; 
                  end
                  if(y_centroid(2) > y_centroid(1) && y_centroid(2) < y_centroid(3))
                  minxy = min(Vd2(1:2))     
                  x_3 = x_centroid(2) -d1_2;
                  x_4 = x_centroid(2) +d2_3;
                  y_3 = y_centroid(2) - d1_2;
                  y_4 = y_centroid(2) + d2_3; 
                  end
               end
               
                if(r_2_4_t == 1)
                  if(y_centroid(2) < y_centroid(1) && y_centroid(2) < y_centroid(3))
                  minxy = min(Vd2(1:2))    
                  x_3 = x_centroid(2) -d1_2;
                  x_4 = x_centroid(2) +d2_3;
                  y_3 = 1;
                  y_4 = y_centroid(2) + minxy; 
                  end
                  if(y_centroid(2) > y_centroid(1) && y_centroid(2) > y_centroid(3))
                  minxy = min(Vd2(1:2))     
                  x_3 = x_centroid(2) -d1_2;
                  x_4 = x_centroid(2) +d2_3;
                  y_3 = y_centroid(2) - minxy;
                  y_4 = y_centroid(2) + (7168 - minxy); 
                  end
                  if(y_centroid(2) < y_centroid(1) && y_centroid(2) > y_centroid(3))
                  minxy = min(Vd2(1:2))     
                  x_3 = x_centroid(2) -d1_2;
                  x_4 = x_centroid(2) +d2_3;
                  y_3 = y_centroid(2) - d2_3;
                  y_4 = y_centroid(2) + d1_2; 
                  end
                  if(y_centroid(2) > y_centroid(1) && y_centroid(2) < y_centroid(3))
                  minxy = min(Vd2(1:2))     
                  x_3 = x_centroid(2) -d1_2;
                  x_4 = x_centroid(2) +d2_3;
                  y_3 = y_centroid(2) - d1_2;
                  y_4 = y_centroid(2) + d2_3; 
                  end
                end
                
                if(r_2_5_t == 1)
                  if(y_centroid(2) < y_centroid(1) && y_centroid(2) < y_centroid(3))
                  minxy = min(Vd2(1:2))    
                  x_3 = x_centroid(2) -d1_2;
                  x_4 = x_centroid(2) +d2_3;
                  y_3 = y_centroid(2) - (7168-minxy);
                  y_4 = y_centroid(2) + minxy;
                  end
                  if(y_centroid(2) > y_centroid(1) && y_centroid(2) > y_centroid(3))
                  minxy = min(Vd2(1:2))     
                  x_3 = x_centroid(2) -d1_2;
                  x_4 = x_centroid(2) +d2_3;
                  y_3 = y_centroid(2) - minxy;
                  y_4 = 13824;  
                  end
                  if(y_centroid(2) < y_centroid(1) && y_centroid(2) > y_centroid(3))
                  minxy = min(Vd2(1:2))     
                  x_3 = x_centroid(2) -d1_2;
                  x_4 = x_centroid(2) +d2_3;
                  y_3 = y_centroid(2) - d2_3;
                  y_4 = y_centroid(2) + d1_2; 
                  end
                  if(y_centroid(2) > y_centroid(1) && y_centroid(2) < y_centroid(3))
                  minxy = min(Vd2(1:2))     
                  x_3 = x_centroid(2) -d1_2;
                  x_4 = x_centroid(2) +d2_3;
                  y_3 = y_centroid(2) - d1_2;
                  y_4 = y_centroid(2) + d2_3; 
                  end
                end
               
                if(x_3 < 0)
                    x_3 =0;
                end    
                if(x_4 > 10752)
                    x_4 =10752;
                end
                if(y_3 < 0)
                    y_3 =0;
                end
                if(y_4 > 13824)
                    y_4 =13824;
                end
               %The rectangular image is cutted from the imgnucleus image containing the whole cover slip
               imagesphere2 = imgnucleus(y_3:y_4,x_3:x_4);
               % Dimensions of imagesphere1 are determined
               [r2 c2] = size(imagesphere2);
               % An empty matrix is generated
               imagesphereresize2 = zeros(7168:7168);
               % imagesphereresize1 is converted to 8-bit
               imagesphereresize2 = uint8(imagesphereresize2);
               %The empty indices in the imagesphereresize1 matrix are overwritten with imagesphere 1 entries
               imagesphereresize2(1:r2,1:c2)=imagesphere2;
               % imagesphereresize1 is saved to final destination
               newFile2 = regexprep(allfiles(i).name,'NucleusBig',[wellind '02NucleusBig'],'ignorecase');        
               imwrite(imagesphereresize2,[foldername1 '/' newFile2]);
               clear imagesphereresize2;
               clear imagesphere2;
               
               
            % Sphere 3 with third smallest value of x_centroid
               
               
                             
               if(l_3_1 >0 && l_3_1 < 2);
                       x_5 = 1;
                       x_6 = x_centroid(3) + d_3_c;
                       y_5 = 1;
                       y_6 = y_centroid(3) + d_3_c;
               else
               end    
               
               if(l_3_2 >0 && l_3_2 < 2);
                       x_5 = 1;
                       x_6 = x_centroid(3) + d_3_c;
                       y_5 = y_centroid(3) - d_3_c;
                       y_6 = 13824;
               else
               end
               
               if(r_3_4 >0 && r_3_4 < 2);
                       x_5 = x_centroid(3) - d_3_c;
                       x_6 = 10752;
                       y_5 = 1;
                       y_6 = y_centroid(3) + d_3_c;
               else
               end
               
               if(r_3_5 >0 && r_3_5 < 2);
                       x_5 = x_centroid(3) - d_3_c;
                       x_6 = 10752;
                       y_5 = y_centroid(3) - d_3_c;
                       y_6 = 13824;
               else
               end
               
               if(x_centroid(3) ~= x_centroid_c);
               else
                   if(x_centroid(1) < x_centroid(3) && x_centroid(1) < x_centroid(3));
                       V_1m = [d1_2 ; d1_3 ; (7168/2)];
                       min1m = min(V_1m(1:3));
                       min1p = (7168-min1m);
                   else
                   end
                   if(x_centroid(1) > x_centroid(3) && x_centroid(2) > x_centroid(3));
                       V_1p = [d1_2 ; d1_3 ; (7168/2)];
                       min1p = min(V_1p(1:3));
                       min1m = (7168-min1p);
                   else
                   end
                   if(x_centroid(1) > x_centroid(3) && x_centroid(2) < x_centroid(3));
                       V_1m = [d1_3 ; (7168/2)];
                       V_1p = [d1_2 ; (7168/2)];
                       min1p = min(V_1p(1:2));
                       min1m = min(V_1m(1:2));
                   else
                       
                   end
                   if(x_centroid(1) < x_centroid(3) && x_centroid(2) > x_centroid(3));
                       V_1m = [d1_2 ; (7168/2)];
                       V_1p = [d1_3 ; (7168/2)];
                       min1p = min(V_1p(1:2));
                       min1m = min(V_1m(1:2));
                        
                   else
                       
                   end
                   
                   x_5 = x_centroid(3) - min1m 
                   x_6 = x_centroid(3) + min1p
                   y_5 = y_centroid(3) - min1m
                   y_6 = y_centroid(3) + min1p
               end  
               
               % Cases for having two or three spheres at one location
               
                % Sphere 1 and 3 are in the same location
               
               if(l_3_1_d13 == 1)
                  if(y_centroid(3) < y_centroid(1))
                  x_5 = x_centroid(3) - d1_3;
                  x_6 = x_centroid(3) + (7168 - d1_3);
                  y_5 = 1;
                  y_6 = y_centroid(3) + d1_3; 
                  else
                  x_5 = x_centroid(3) - d1_3;
                  x_6 = x_centroid(3) + (7168 - d1_3);
                  y_5 = y_centroid(3) - d1_3;
                  y_6 = y_centroid(3) + (7168 - d1_3);    
                  end    
               end   
               
               if(l_3_2_d13 == 1)
                  if(y_centroid(3) < y_centroid(1))
                  x_5 = x_centroid(3) - d1_3;
                  x_6 = x_centroid(3) + (7168 - d1_3);
                  y_5 = y_centroid(3) - (7168 - d1_3);
                  y_6 = y_centroid(3) + d1_3; 
                  else
                  x_5 = x_centroid(3) - d1_3;
                  x_6 = x_centroid(3) + (7168 - d1_3);
                  y_5 = y_centroid(3) - d1_3;
                  y_6 = 13824;    
                  end    
               end 
               
               if(r_3_4_d13 == 1)
                  if(y_centroid(3) < y_centroid(1))
                  x_5 = x_centroid(3)  - d1_3;
                  x_6 = 10752;
                  y_5 = 1;
                  y_6 = y_centroid(3) + d1_3;
                  else
                  x_5 = x_centroid(3)  - d1_3;
                  x_6 = 10752;
                  y_5 = y_centroid(3) - d1_3
                  y_6 = y_centroid(3) + (7168 - d1_3);    
                  end    
               end 
               
               % Sphere 2 and 3 are in the same location
               
               if(l_3_1_d23 == 1)
                  if(y_centroid(3) < y_centroid(2))
                  x_5 = x_centroid(3) - d2_3;
                  x_6 = x_centroid(3) + (7168 - d2_3);
                  y_5 = 1;
                  y_6 = y_centroid(3) + d2_3; 
                  else
                  x_5 = x_centroid(3) - d2_3;
                  x_6 = x_centroid(3) + (7168 - d2_3);
                  y_5 = y_centroid(3) - d1_3;
                  y_6 = y_centroid(3) + (7168 - d2_3);    
                  end    
               end   
               
               if(l_3_2_d23 == 1)
                  if(y_centroid(3) < y_centroid(2))
                  x_5 = x_centroid(3) - d2_3;
                  x_6 = x_centroid(3) + (7168 - d2_3);
                  y_5 = y_centroid(3) - (7168 - d2_3);
                  y_6 = y_centroid(3) + d2_3; 
                  else
                  x_5 = x_centroid(3) - d2_3;
                  x_6 = x_centroid(3) + (7168 - d2_3);
                  y_5 = y_centroid(3) - d2_3;
                  y_6 = 13824;    
                  end    
               end 
               
               if(r_3_4_d23 == 1)
                  if(y_centroid(3) < y_centroid(2))
                  x_5 = x_centroid(3)  - d2_3;
                  x_6 = 10752;
                  y_5 = 1;
                  y_6 = y_centroid(3) + d2_3;
                  else
                  x_5 = x_centroid(3)  - d2_3;
                  x_6 = 10752;
                  y_5 = y_centroid(3) - d2_3
                  y_6 = y_centroid(3) + (7168 - d2_3);    
                  end    
               end 
               
               if(r_3_5_d23 == 1)
                  if(y_centroid(3) < y_centroid(2))
                  x_5 = x_centroid(3)  - d2_3;
                  x_6 = 10752;
                  y_5 = y_centroid(3) - (7168 - d2_3);
                  y_6 = y_centroid(3) + d2_3; 
                  else
                  x_5 = x_centroid(3)  - d2_3;
                  x_6 = 10752;
                  y_5 = y_centroid(3) - d2_3;
                  y_6 = 13824;     
                  end    
               end 
               
               % Sphere 1 and 2 and 3 are in the same location
               
               if(l_3_1_t == 1)
                  if(y_centroid(3) < y_centroid(1) && y_centroid(3) < y_centroid(2))
                  minxy = min(Vd3(1:2))     
                  x_5 = x_centroid(3) - d2_3;
                  x_6 = x_centroid(3) + (7168 -d2_3);
                  y_5 = 1;
                  y_6 = y_centroid(3) + minxy; 
                  end
                  if(y_centroid(3) > y_centroid(1) && y_centroid(3) > y_centroid(2))
                  minxy = min(Vd3(1:2))    
                  x_5 = x_centroid(3) - d2_3;
                  x_6 = x_centroid(3) + (7168 -d2_3);
                  y_5 = y_centroid(3) - minxy;
                  y_6 = y_centroid(3) + (7168 - minxy); 
                  end
                  if(y_centroid(3) < y_centroid(1) && y_centroid(3) > y_centroid(2))
                  minxy = min(Vd3(1:2))    
                  x_5 = x_centroid(3) - d2_3;
                  x_6 = x_centroid(3) + (7168 -d2_3);
                  y_5 = y_centroid(3) - d1_3;
                  y_6 = y_centroid(3) + d1_2; 
                  end
                  if(y_centroid(3) > y_centroid(1) && y_centroid(3) < y_centroid(2))
                  minxy = min(Vd3(1:2))    
                  x_5 = x_centroid(3) - d2_3;
                  x_6 = x_centroid(3) + (7168 -d2_3);
                  y_5 = y_centroid(3) - d1_2;
                  y_6 = y_centroid(3) + d1_3; 
                  end
               end 
               
               if(l_3_2_t == 1)
                  if(y_centroid(3) < y_centroid(1) && y_centroid(3) < y_centroid(2))
                  minxy = min(Vd3(1:2))    
                  x_5 = x_centroid(3) - d2_3;
                  x_6 = x_centroid(3) + (7168 -d2_3);
                  y_5 = y_centroid(3) - (7168-minxy);
                  y_6 = y_centroid(3) + minxy; 
                  end
                  if(y_centroid(3) > y_centroid(1) && y_centroid(3) > y_centroid(2))
                  minxy = min(Vd3(1:2))    
                  x_5 = x_centroid(3) - d2_3;
                  x_6 = x_centroid(3) + (7168 -d2_3);
                  y_5 = y_centroid(3) - minxy;
                  y_6 = 13824; 
                  end
                  if(y_centroid(3) < y_centroid(1) && y_centroid(3) > y_centroid(2))
                  minxy = min(Vd3(1:2))    
                  x_5 = x_centroid(3) - d2_3;
                  x_6 = x_centroid(3) + (7168 -d2_3);
                  y_5 = y_centroid(3) - d1_3;
                  y_6 = y_centroid(3) + d1_2; 
                  end
                  if(y_centroid(3) > y_centroid(1) && y_centroid(3) < y_centroid(2))
                  minxy = min(Vd3(1:2))    
                  x_5 = x_centroid(3) - d2_3;
                  x_6 = x_centroid(3) + (7168 -d2_3);
                  y_5 = y_centroid(3) - d1_2;
                  y_6 = y_centroid(3) + d1_3; 
                  end
               end
               
                if(r_3_4_t == 1)
                  if(y_centroid(3) < y_centroid(1) && y_centroid(3) < y_centroid(2))
                  minxy = min(Vd3(1:2))    
                  x_5 = x_centroid(3) -d2_3;
                  x_6 = 10752;
                  y_5 = 1;
                  y_6 = y_centroid(3) + minxy; 
                  end
                  if(y_centroid(3) > y_centroid(1) && y_centroid(3) > y_centroid(2))
                  minxy = min(Vd3(1:2))    
                  x_5 = x_centroid(3) -d2_3;
                  x_6 = 10752;
                  y_5 = y_centroid(3) - minxy;
                  y_6 = y_centroid(3) + (7168 - minxy); 
                  end
                  if(y_centroid(3) < y_centroid(1) && y_centroid(3) > y_centroid(2))
                  minxy = min(Vd3(1:2))    
                  x_5 = x_centroid(3) -d2_3;
                  x_6 = 10752;
                  y_5 = y_centroid(3) - d1_3;
                  y_6 = y_centroid(3) + d1_2; 
                  end
                  if(y_centroid(3) > y_centroid(1) && y_centroid(3) < y_centroid(2))
                  minxy = min(Vd3(1:2))    
                  x_5 = x_centroid(3) -d2_3;
                  x_6 = 10752;
                  y_5 = y_centroid(3) - d1_2;
                  y_6 = y_centroid(3) + d1_3; 
                  end
                end
                
                if(r_3_5_t == 1)
                  if(y_centroid(3) < y_centroid(1) && y_centroid(3) < y_centroid(2))
                  minxy = min(Vd3(1:2))    
                  x_5 = x_centroid(3) -d2_3;
                  x_6 = 10752;
                  y_5 = y_centroid(3) - (7168-minxy);
                  y_6 = y_centroid(3) + minxy;
                  end
                  if(y_centroid(3) > y_centroid(1) && y_centroid(3) > y_centroid(2))
                  minxy = min(Vd3(1:2))    
                  x_5 = x_centroid(3) -d2_3;
                  x_6 = 10752;
                  y_5 = y_centroid(3) - minxy;
                  y_6 = 13824;  
                  end
                  if(y_centroid(3) < y_centroid(1) && y_centroid(3) > y_centroid(2))
                  minxy = min(Vd3(1:2))    
                  x_5 = x_centroid(3) -d2_3;
                  x_6 = 10752;
                  y_5 = y_centroid(3) - d1_3;
                  y_6 = y_centroid(3) + d1_2; 
                  end
                  if(y_centroid(3) > y_centroid(1) && y_centroid(3) < y_centroid(2))
                  minxy = min(Vd3(1:2))    
                  x_5 = x_centroid(3) -d2_3;
                  x_6 = 10752;
                  y_5 = y_centroid(3) - d1_2;
                  y_6 = y_centroid(3) + d1_3; 
                  end
                end
                
               if(x_5 < 0)
                    x_5 =0;
                end    
                if(x_6 > 10752)
                    x_6 =10752;
                end
                if(y_5 < 0)
                    y_5 =0;
                end
                if(y_6 > 13824)
                    y_6 =13824;
                end
               
                %The rectangular image is cutted from the imgnucleus image containing the whole cover slip
               imagesphere3 = imgnucleus(y_5:y_6,x_5:x_6);
               % Dimensions of imagesphere1 are determined
               [r3 c3] = size(imagesphere3);
               % An empty matrix is generated
               imagesphereresize3 = zeros(7168:7168);
               % imagesphereresize1 is converted to 8-bit
               imagesphereresize3 = uint8(imagesphereresize3);
               %The empty indices in the imagesphereresize1 matrix are overwritten with imagesphere 1 entries
               imagesphereresize3(1:r3,1:c3)=imagesphere3;
               % imagesphereresize1 is saved to final destination
               newFile3 = regexprep(allfiles(i).name,'NucleusBig',[wellind '03NucleusBig'],'ignorecase');        
               imwrite(imagesphereresize3,[foldername1 '/' newFile3]);
               clear imagesphereresize3;
               clear imagesphere3;
               
               imagesphereresize4 = zeros(7168:7168);
               newFile4 = regexprep(allfiles(i).name,'NucleusBig',[wellind '04NucleusBig'],'ignorecase');        
               imwrite(imagesphereresize4,[foldername1 '/' newFile4]);
               clear imagesphereresize4; 

               imagesphereresize5 = zeros(7168:7168);
               newFile5 = regexprep(allfiles(i).name,'NucleusBig',[wellind '05NucleusBig'],'ignorecase');        
               imwrite(imagesphereresize5,[foldername1 '/' newFile5]);
               clear imagesphereresize5; 
               
               if(Neuron_Channel > 0)
                   % Same for neurite channel


                   imagesphere6 = imgneurite(y_1:y_2,x_1:x_2);
                   [r1 c1] = size(imagesphere6);
                   imagesphereresize6 = zeros(7168:7168);
                   imagesphereresize6 = uint8(imagesphereresize6);
                   imagesphereresize6(1:r1,1:c1)=imagesphere6;
                   newFile6 = regexprep(allfiles(i).name,'NucleusBig',[wellind '01NeuriteBig'],'ignorecase');        
                   imwrite(imagesphereresize6,[foldername1 '/' newFile6]);
                   clear imagesphereresize6;
                   clear imagesphere6;

                   imagesphere7 = imgneurite(y_3:y_4,x_3:x_4);
                   [r2 c2] = size(imagesphere7);
                   imagesphereresize7 = zeros(7168:7168);
                   imagesphereresize7 = uint8(imagesphereresize7);
                   imagesphereresize7(1:r2,1:c2)=imagesphere7;
                   newFile7 = regexprep(allfiles(i).name,'NucleusBig',[wellind '02NeuriteBig'],'ignorecase');        
                   imwrite(imagesphereresize7,[foldername1 '/' newFile7]);
                   clear imagesphereresize7;
                   clear imagesphere7;

                   imagesphere8 = imgneurite(y_5:y_6,x_5:x_6);
                   [r3 c3] = size(imagesphere8);
                   imagesphereresize8 = zeros(7168:7168);
                   imagesphereresize8 = uint8(imagesphereresize8);
                   imagesphereresize8(1:r3,1:c3)=imagesphere8;
                   newFile8 = regexprep(allfiles(i).name,'NucleusBig',[wellind '03NeuriteBig'],'ignorecase');        
                   imwrite(imagesphereresize8,[foldername1 '/' newFile8]);
                   clear imagesphereresize8;
                   clear imagesphere8;

                   imagesphereresize9 = zeros(7168:7168);
            	   newFile9 = regexprep(allfiles(i).name,'NucleusBig',[wellind '04NeuriteBig'],'ignorecase');        
                   imwrite(imagesphereresize9,[foldername1 '/' newFile9]);
                   clear imagesphereresize9;

                   imagesphereresize10 = zeros(7168:7168);
            	   newFile10 = regexprep(allfiles(i).name,'NucleusBig',[wellind '05NeuriteBig'],'ignorecase');        
                   imwrite(imagesphereresize10,[foldername1 '/' newFile10]);
                   clear imagesphereresize10;

               end
               
               if(Oligo_Channel > 0)
                   % Same for Oligos
                   imagesphere11 = imgoligo(y_1:y_2,x_1:x_2);
                   [r1 c1] = size(imagesphere11);
                   imagesphereresize11 = zeros(7168:7168);
                   imagesphereresize11 = uint8(imagesphereresize11);
                   imagesphereresize11(1:r1,1:c1)=imagesphere11;
                   newFile11 = regexprep(allfiles(i).name,'NucleusBig',[wellind '01OligoBig'],'ignorecase');        
                   imwrite(imagesphereresize11,[foldername1 '/' newFile11]);
                   clear imagesphereresize11;
                   clear imagesphere11;

                   imagesphere12 = imgoligo(y_3:y_4,x_3:x_4);
                   [r2 c2] = size(imagesphere12);
                   imagesphereresize12 = zeros(7168:7168);
                   imagesphereresize12 = uint8(imagesphereresize12);
                   imagesphereresize12(1:r2,1:c2)=imagesphere12;
                   newFile12 = regexprep(allfiles(i).name,'NucleusBig',[wellind '02OligoBig'],'ignorecase');        
                   imwrite(imagesphereresize12,[foldername1 '/' newFile12]);
                   clear imagesphereresize12;
                   clear imagesphere12;

                   imagesphere13 = imgoligo(y_5:y_6,x_5:x_6);
                   [r3 c3] = size(imagesphere13);
                   imagesphereresize13 = zeros(7168:7168);
                   imagesphereresize13 = uint8(imagesphereresize13);
                   imagesphereresize13(1:r3,1:c3)=imagesphere13;
                   newFile13 = regexprep(allfiles(i).name,'NucleusBig',[wellind '03OligoBig'],'ignorecase');        
                   imwrite(imagesphereresize13,[foldername1 '/' newFile13]);
                   clear imagesphereresize13;
                   clear imagesphere13;

                   imagesphereresize14 = zeros(7168:7168);
            	   newFile14 = regexprep(allfiles(i).name,'NucleusBig',[wellind '04OligoBig'],'ignorecase');        
                   imwrite(imagesphereresize14,[foldername1 '/' newFile14]);
                   clear imagesphereresize14;

                   imagesphereresize15 = zeros(7168:7168);
            	   newFile15 = regexprep(allfiles(i).name,'NucleusBig',[wellind '05OligoBig'],'ignorecase');        
                   imwrite(imagesphereresize15,[foldername1 '/' newFile15]);
                   clear imagesphereresize15;
               end
               
               if(Astro_Channel >0)
                   % Same for Astros
                   imagesphere16 = imgastro(y_1:y_2,x_1:x_2);
                   [r1 c1] = size(imagesphere16);
                   imagesphereresize16 = zeros(7168:7168);
                   imagesphereresize16 = uint8(imagesphereresize16);
                   imagesphereresize16(1:r1,1:c1)=imagesphere16;
                   newFile16 = regexprep(allfiles(i).name,'NucleusBig',[wellind '01AstroBig'],'ignorecase');        
                   imwrite(imagesphereresize16,[foldername1 '/' newFile16]);
                   clear imagesphereresize16;
                   clear imagesphere16;

                   imagesphere17 = imgastro(y_3:y_4,x_3:x_4);
                   [r2 c2] = size(imagesphere17);
                   imagesphereresize17 = zeros(7168:7168);
                   imagesphereresize17 = uint8(imagesphereresize17);
                   imagesphereresize17(1:r2,1:c2)=imagesphere17;
                   newFile17 = regexprep(allfiles(i).name,'NucleusBig',[wellind '02AstroBig'],'ignorecase');        
                   imwrite(imagesphereresize17,[foldername1 '/' newFile17]);
                   clear imagesphereresize17;
                   clear imagesphere17;

                   imagesphere18 = imgastro(y_5:y_6,x_5:x_6);
                   [r3 c3] = size(imagesphere18);
                   imagesphereresize18 = zeros(7168:7168);
                   imagesphereresize18 = uint8(imagesphereresize18);
                   imagesphereresize18(1:r3,1:c3)=imagesphere18;
                   newFile18 = regexprep(allfiles(i).name,'NucleusBig',[wellind '03AstroBig'],'ignorecase');        
                   imwrite(imagesphereresize18,[foldername1 '/' newFile18]);
                   clear imagesphereresize18;
                   clear imagesphere18;

                   imagesphereresize19 = zeros(7168:7168);
            	   newFile19 = regexprep(allfiles(i).name,'NucleusBig',[wellind '04AstroBig'],'ignorecase');        
                   imwrite(imagesphereresize19,[foldername1 '/' newFile19]);
                   clear imagesphereresize19;

                   imagesphereresize20 = zeros(7168:7168);
            	   newFile20 = regexprep(allfiles(i).name,'NucleusBig',[wellind '05AstroBig'],'ignorecase');        
                   imwrite(imagesphereresize20,[foldername1 '/' newFile20]);
                   clear imagesphereresize20;
               end
              
            else
                
            end    
            
            % Case 5: Four spheres remained: s=4
            
            if(s_L>3 && s_L<5);
               % Extracts the x and y coordinates from s 
               x_centroid(1) = s(1).Centroid(1);
               y_centroid(1) = s(1).Centroid(2);
               x_centroid(2) = s(2).Centroid(1);
               y_centroid(2) = s(2).Centroid(2);
               x_centroid(3) = s(3).Centroid(1);
               y_centroid(3) = s(3).Centroid(2);
               x_centroid(4) = s(4).Centroid(1);
               y_centroid(4) = s(4).Centroid(2);
               % Definition of a centroid quadrant in which the centroid of a potential center neurosphere has to be located. 
               % All other centroids are considerd as rim coordinates
               quadrant1_x1 = 4032;
               quadrant1_x2 = 6720;
               quadrant1_y1 = 5184;
               quadrant1_y2 = 8640;
               % Calculates the distance between the centroids of the
               % four neurosphere
               d1_2 = 0.5* ((x_centroid(1)-x_centroid(2))^2+(y_centroid(1)-y_centroid(2))^2)^0.5;
               d1_3 = 0.5* ((x_centroid(1)-x_centroid(3))^2+(y_centroid(1)-y_centroid(3))^2)^0.5;
               d1_4 = 0.5* ((x_centroid(1)-x_centroid(4))^2+(y_centroid(1)-y_centroid(4))^2)^0.5;
               d2_3 = 0.5* ((x_centroid(3)-x_centroid(2))^2+(y_centroid(3)-y_centroid(2))^2)^0.5;
               d2_4 = 0.5* ((x_centroid(4)-x_centroid(2))^2+(y_centroid(4)-y_centroid(2))^2)^0.5;
               d3_4 = 0.5* ((x_centroid(3)-x_centroid(4))^2+(y_centroid(3)-y_centroid(4))^2)^0.5;
               % The shortest distance between neurosphere cores is the
               % distance between the rim spheres and the center sphere.
               % Therefore for all centroids it is checked wether the coordinates of 
               % their centroid is located within the center quadrant.
                if(x_centroid(1)>=quadrant1_x1 && x_centroid(1)<=quadrant1_x2 && y_centroid(1)>=quadrant1_y1 && y_centroid(1)<=quadrant1_y2);
                    % Since more than one sphere might be located in the
                    % centroid quadrant, further the distance between center
                    % spheres and the middle of the cover slip (dc_x) is
                    % calculated
                    dc_1 = ((x_centroid(1)-5376)^2+(y_centroid(1)-6912)^2)^0.5;
                else
                    % If the centroid is not located in the center quadrant the distance is set to an abitrary high value of dc_1 = 1000000000
                    dc_1 = 1000000000;
                end 
                % Same for sphere 2,3 and 4
                if(x_centroid(2)>=quadrant1_x1 && x_centroid(2)<=quadrant1_x2 && y_centroid(2)>=quadrant1_y1 && y_centroid(2)<=quadrant1_y2);
                    dc_2 = ((x_centroid(2)-5376)^2+(y_centroid(2)-6912)^2)^0.5;
                    
                else
                    
                    dc_2 = 1000000000;
                end
                
                if(x_centroid(3)>=quadrant1_x1 && x_centroid(3)<=quadrant1_x2 && y_centroid(3)>=quadrant1_y1 && y_centroid(3)<=quadrant1_y2);
                    dc_3 = ((x_centroid(3)-5376)^2+(y_centroid(3)-6912)^2)^0.5;
                    
                else
                    
                    dc_3 = 1000000000;
                end
                
                if(x_centroid(4)>=quadrant1_x1 && x_centroid(4)<=quadrant1_x2 && y_centroid(4)>=quadrant1_y1 && y_centroid(4)<=quadrant1_y2);
                    dc_4 = ((x_centroid(4)-5376)^2+(y_centroid(4)-6912)^2)^0.5;
                    
                else
                    
                    dc_4 = 1000000000;
                end
               % It is checked whether dc_1 is smaller than 1000000000 (no centroid sphere according to the above checked criteria) and smaller
               % than the distances of other centroid spheres. If dc_1 is
               % the smallest distance the centroid of sphere 1 is defined
               % as the centroid of the center sphere 
               if(dc_1 < 1000000000 && dc_1 < dc_2 && dc_1 < dc_3 && dc_1 < dc_4);
                   x_centroid_c = x_centroid(1);
                   y_centroid_c = y_centroid(1);
                   missingc1 = 0;
                 
                   
               else
                   % If above criteria are not fullfilled the centroid sphere
                   % is missing and the centroid of this sphere is treated as
                   % a rim sphere
                   missingc1 = 1;
               end    
               %Same for sphere 2, 3 and 4 
               if(dc_2 < 1000000000 && dc_2 < dc_1 && dc_2 < dc_3 && dc_2 < dc_4);
                   x_centroid_c = x_centroid(2);
                   y_centroid_c = y_centroid(2);
                   missingc2 = 0;
               else
                   missingc2 = 1;
               end              
                
               if(dc_3 < 1000000000 && dc_3 < dc_1 && dc_3 < dc_2 && dc_3 < dc_4);
                   x_centroid_c = x_centroid(3);
                   y_centroid_c = y_centroid(3);
                   missingc3 = 0;
           
               else
                   missingc3 = 1;
               end
               
               if(dc_4 < 1000000000 && dc_4 < dc_1 && dc_4 < dc_2 && dc_4 < dc_3);
                   x_centroid_c = x_centroid(4);
                   y_centroid_c = y_centroid(4);
                   missingc4 = 0;
           
               else
                   missingc4 = 1;
               end
               % If all 4 spheres were defined as rim spheres, an artifical
               % center point is defined as the center point of the cover
               % slip
               if((missingc1+missingc2+missingc3+missingc4) > 3);
                   x_centroid_c = 5376;
                   y_centroid_c = 6912;
               else
               end    
               % If sphere 1 is no center sphere the shortest distance
               % between sphere 1 and the center sphere is calculated
               if(x_centroid(1) ~= x_centroid_c);
                   d_1_c = 0.5* (((x_centroid(1)-x_centroid_c)^2+(y_centroid(1)-y_centroid_c)^2)^0.5);
               else
               end   
               % Same for sphere 2, 3 and 4
               if(x_centroid(2) ~= x_centroid_c);
                   d_2_c = 0.5* (((x_centroid(2)-x_centroid_c)^2+(y_centroid(2)-y_centroid_c)^2)^0.5);
               else
               end
               if(x_centroid(3) ~= x_centroid_c);
                   d_3_c = 0.5* (((x_centroid(3)-x_centroid_c)^2+(y_centroid(3)-y_centroid_c)^2)^0.5);
               else
               end
               
               if(x_centroid(4) ~= x_centroid_c);
                   d_4_c = 0.5* (((x_centroid(4)-x_centroid_c)^2+(y_centroid(4)-y_centroid_c)^2)^0.5);
               else
                   V_4 = [d1_4 ; d2_4 ; d3_4 ; (7168/2)];
                   min4 = min(V_4(1:4));
                   d_4_c = min4;
               end
            
               % Defines wether centroid lays left or right of the center
               % sphere! If sphere 1 is not the center sphere
                if(x_centroid(1) ~= x_centroid_c);
                   % First case: Check whether x_centroid(1) is left of the center sphere
                   if(x_centroid(1) < x_centroid_c);
                      % Check if y_centroid(1) is below y_centroid_c 
                      if(y_centroid(1)<y_centroid_c); 
                       % If y_centroid(1)<y_centroid_c the sphere has to be located at the
                       % upper left corner of the cover slip
                       x_centroid_l(1) = x_centroid(1);
                       y_centroid_l(1) = y_centroid(1);
                       % Sphere is located in the upper left of the cover
                       % slip
                       l_1_1 = 1
                       % Sphere is located in the lower left of the cover
                       % slip
                       l_1_2 = 0
                       % Sphere is located in the upper right of the cover
                       % slip
                       r_1_4 = 0
                       % Sphere is located in the lower right of the cover
                       % slip
                       r_1_5 = 0
                       
                      else
                       % If y_centroid(1)>y_centroid_c the sphere has to be located at the
                       % lower left corner of the cover slip   
                       x_centroid_l(2) = x_centroid(1);
                       y_centroid_l(2) = y_centroid(1);
                       l_1_1 = 0
                       l_1_2 = 1
                       r_1_4 = 0
                       r_1_5 = 0 
                      end 
                   else
                   % Second case: Check whether x_centroid(1) is right of the center sphere    
                      % Check if y_centroid(1) is below y_centroid_c)
                      if(y_centroid(1)<y_centroid_c) 
                       % If y_centroid(1)<y_centroid_c the sphere has to be located at the
                       % upper right corner of the cover slip   
                       x_centroid_r(4) = x_centroid(1);
                       y_centroid_r(4) = y_centroid(1);
                       l_1_1 = 0
                       l_1_2 = 0
                       r_1_4 = 1
                       r_1_5 = 0
                      else
                       % If y_centroid(1)>y_centroid_c the sphere has to be located at the
                       % lower right corner of the cover slip   
                       x_centroid_r(5) = x_centroid(1);
                       y_centroid_r(5) = x_centroid(1);
                       l_1_1 = 0
                       l_1_2 = 0
                       r_1_4 = 0
                       r_1_5 = 1 
                      end 
                   end    
                else
                    l_1_1 = 0
                    l_1_2 = 0
                    r_1_4 = 0
                    r_1_5 = 0
                end    
               % Same for sphere 2, 3 and 4
               if(x_centroid(2) ~= x_centroid_c)
                   if(x_centroid(2) < x_centroid_c);
                      if(y_centroid(2)<y_centroid_c) 
                       x_centroid_l(1) = x_centroid(2);
                       y_centroid_l(1) = y_centroid(2);
                       l_2_1 = 1
                       l_2_2 = 0
                       r_2_4 = 0
                       r_2_5 = 0
                       
                      else
                       x_centroid_l(2) = x_centroid(2);
                       y_centroid_l(2) = y_centroid(2);
                       l_2_1 = 0
                       l_2_2 = 1
                       r_2_4 = 0
                       r_2_5 = 0 
                      end 
                   else
                      if(y_centroid(2)<y_centroid_c) 
                       x_centroid_r(4) = x_centroid(2);
                       y_centroid_r(4) = y_centroid(2);
                       l_2_1 = 0
                       l_2_2 = 0
                       r_2_4 = 1
                       r_2_5 = 0
                      else
                       x_centroid_r(5) = x_centroid(2);
                       y_centroid_r(5) = x_centroid(2);
                       l_2_1 = 0
                       l_2_2 = 0
                       r_2_4 = 0
                       r_2_5 = 1 
                      end 
                   end    
                else
                    l_2_1 = 0
                    l_2_2 = 0
                    r_2_4 = 0
                    r_2_5 = 0
                end 
               
               if(x_centroid(3) ~= x_centroid_c)
                   if(x_centroid(3) < x_centroid_c);
                      if(y_centroid(3)<y_centroid_c) 
                       x_centroid_l(1) = x_centroid(3);
                       y_centroid_l(1) = y_centroid(3);
                       l_3_1 = 1
                       l_3_2 = 0
                       r_3_4 = 0
                       r_3_5 = 0
                       
                      else
                       x_centroid_l(2) = x_centroid(3);
                       y_centroid_l(2) = y_centroid(3);
                       l_3_1 = 0
                       l_3_2 = 1
                       r_3_4 = 0
                       r_3_5 = 0 
                      end 
                   else
                      if(y_centroid(3)<y_centroid_c) 
                       x_centroid_r(4) = x_centroid(3);
                       y_centroid_r(4) = y_centroid(3);
                       l_3_1 = 0
                       l_3_2 = 0
                       r_3_4 = 1
                       r_3_5 = 0
                      else
                       x_centroid_r(5) = x_centroid(3);
                       y_centroid_r(5) = x_centroid(3);
                       l_3_1 = 0
                       l_3_2 = 0
                       r_3_4 = 0
                       r_3_5 = 1 
                      end 
                   end    
               else
                    l_3_1 = 0
                    l_3_2 = 0
                    r_3_4 = 0
                    r_3_5 = 0
               end
               
               
               if(x_centroid(4) ~= x_centroid_c);
                   if(x_centroid(4) < x_centroid_c);
                      if(y_centroid(4)<y_centroid_c); 
                       x_centroid_l(1) = x_centroid(4);
                       y_centroid_l(1) = y_centroid(4);
                       l_4_1 = 1
                       l_4_2 = 0
                       r_4_4 = 0
                       r_4_5 = 0
                       
                      else
                       x_centroid_l(2) = x_centroid(4);
                       y_centroid_l(2) = y_centroid(4);
                       l_4_1 = 0
                       l_4_2 = 1
                       r_4_4 = 0
                       r_4_5 = 0 
                      end 
                   else
                      if(y_centroid(4)<y_centroid_c) 
                       x_centroid_r(4) = x_centroid(4);
                       y_centroid_r(4) = y_centroid(4);
                       l_4_1 = 0
                       l_4_2 = 0
                       r_4_4 = 1
                       r_4_5 = 0
                      else
                       x_centroid_r(5) = x_centroid(4);
                       y_centroid_r(5) = x_centroid(4);
                       l_4_1 = 0
                       l_4_2 = 0
                       r_4_4 = 0
                       r_4_5 = 1 
                      end 
                   end    
                else
                    l_4_1 = 0
                    l_4_2 = 0
                    r_4_4 = 0
                    r_4_5 = 0
               end    
               
               
               % Check for multiple entry positions:
               
               % Check if all spheres at the same position
               if(l_2_1 == l_1_1 && l_2_2 == l_1_2 && r_2_4 == r_1_4 && r_2_5 == r_1_5 && l_3_1 == l_1_1 && l_3_2 == l_1_2 && r_3_4 == r_1_4 && r_3_5 == r_1_5 && l_4_1 == l_1_1 && l_4_2 == l_1_2 && r_4_4 == r_1_4 && r_4_5 == r_1_5)
                   
                   l_1_1_q = l_1_1
                   l_1_2_q = l_1_2
                   r_1_4_q = r_1_4
                   r_1_5_q = r_1_5
                   l_2_1_q = l_2_1
                   l_2_2_q = l_2_2
                   r_2_4_q = r_2_4
                   r_2_5_q = r_2_5
                   l_3_1_q = l_3_1
                   l_3_2_q = l_3_2
                   r_3_4_q = r_3_4
                   r_3_5_q = r_3_5
                   l_4_1_q = l_4_1
                   l_4_2_q = l_4_2
                   r_4_4_q = r_4_4
                   r_4_5_q = r_4_5
                   l_1_1 = 0
                   l_1_2 = 0
                   r_1_4 = 0
                   r_1_5 = 0
                   l_2_1 = 0
                   l_2_2 = 0
                   r_2_4 = 0
                   r_2_5 = 0
                   l_3_1 = 0
                   l_3_2 = 0
                   r_3_4 = 0
                   r_3_5 = 0
                   l_4_1 = 0
                   l_4_2 = 0
                   r_4_4 = 0
                   r_4_5 = 0
                   
                else
                   l_1_1_q = 0
                   l_1_2_q = 0
                   r_1_4_q = 0
                   r_1_5_q = 0
                   l_2_1_q = 0
                   l_2_2_q = 0
                   r_2_4_q = 0
                   r_2_5_q = 0
                   l_3_1_q = 0
                   l_3_2_q = 0
                   r_3_4_q = 0
                   r_3_5_q = 0 
                   l_4_1_q = 0
                   l_4_2_q = 0
                   r_4_4_q = 0
                   r_4_5_q = 0
                   
               end    
               
               % Check for Triplets
               % 1,2,3 Triplet
               
               if(l_1_1 == l_2_1 && l_1_2 == l_2_2 && r_1_4 == r_2_4 && r_1_5 == r_2_5 && l_1_1 == l_3_1 && l_1_2 == l_3_2 && r_1_4 == r_3_4 && r_1_5 == r_3_5)
                   l_1_1_t = l_1_1
                   l_1_2_t = l_1_2
                   r_1_4_t = r_1_4
                   r_1_5_t = r_1_5
                   l_2_1_t = l_2_1
                   l_2_2_t = l_2_2
                   r_2_4_t = r_2_4
                   r_2_5_t = r_2_5
                   l_3_1_t = l_3_1
                   l_3_2_t = l_3_2
                   r_3_4_t = r_3_4
                   r_3_5_t = r_3_5
                   l_4_1_t = 0
                   l_4_2_t = 0
                   r_4_4_t = 0
                   r_4_5_t = 0
                   l_1_1 = 0
                   l_1_2 = 0
                   r_1_4 = 0
                   r_1_5 = 0
                   l_2_1 = 0
                   l_2_2 = 0
                   r_2_4 = 0
                   r_2_5 = 0
                   l_3_1 = 0
                   l_3_2 = 0
                   r_3_4 = 0
                   r_3_5 = 0
                   
                   
                   
               else
                   l_1_1_t = 0
                   l_1_2_t = 0
                   r_1_4_t = 0
                   r_1_5_t = 0
                   l_2_1_t = 0
                   l_2_2_t = 0
                   r_2_4_t = 0
                   r_2_5_t = 0
                   l_3_1_t = 0
                   l_3_2_t = 0
                   r_3_4_t = 0
                   r_3_5_t = 0 
                 
                   
               end  
               
               % 1,2,4 Triplet
               if(l_1_1 == l_2_1 && l_1_2 == l_2_2 && r_1_4 == r_2_4 && r_1_5 == r_2_5 && l_1_1 == l_3_1 && l_1_2 == l_3_2 && r_1_4 == r_3_4 && r_1_5 == r_3_5)
                   t = 1
               else    
               if(l_1_1 == l_2_1 && l_1_2 == l_2_2 && r_1_4 == r_2_4 && r_1_5 == r_2_5 && l_1_1 == l_4_1 && l_1_2 == l_4_2 && r_1_4 == r_4_4 && r_1_5 == r_4_5)
                   l_1_1_t = l_1_1
                   l_1_2_t = l_1_2
                   r_1_4_t = r_1_4
                   r_1_5_t = r_1_5
                   l_2_1_t = l_2_1
                   l_2_2_t = l_2_2
                   r_2_4_t = r_2_4
                   r_2_5_t = r_2_5
                   l_3_1_t = 0
                   l_3_2_t = 0
                   r_3_4_t = 0
                   r_3_5_t = 0
                   l_4_1_t = l_4_1
                   l_4_2_t = l_4_2
                   r_4_4_t = r_4_4
                   r_4_5_t = r_4_5
                   l_1_1 = 0
                   l_1_2 = 0
                   r_1_4 = 0
                   r_1_5 = 0
                   l_2_1 = 0
                   l_2_2 = 0
                   r_2_4 = 0
                   r_2_5 = 0
                   l_4_1 = 0
                   l_4_2 = 0
                   r_4_4 = 0
                   r_4_5 = 0
                   
                   t = 1
                   
               else
                   l_1_1_t = 0
                   l_1_2_t = 0
                   r_1_4_t = 0
                   r_1_5_t = 0
                   l_2_1_t = 0
                   l_2_2_t = 0
                   r_2_4_t = 0
                   r_2_5_t = 0
                   l_4_1_t = 0
                   l_4_2_t = 0
                   r_4_4_t = 0
                   r_4_5_t = 0 
                   t = 0
                   
               end 
               end
               
               
               % 1,3,4 Triplet
               if(t == 1)
                   t = 1
               else    
               if(l_1_1 == l_3_1 && l_1_2 == l_3_2 && r_1_4 == r_3_4 && r_1_5 == r_3_5 && l_1_1 == l_4_1 && l_1_2 == l_4_2 && r_1_4 == r_4_4 && r_1_5 == r_4_5)
                   l_1_1_t = l_1_1
                   l_1_2_t = l_1_2
                   r_1_4_t = r_1_4
                   r_1_5_t = r_1_5
                   l_2_1_t = 0
                   l_2_2_t = 0
                   r_2_4_t = 0
                   r_2_5_t = 0
                   l_3_1_t = l_3_1
                   l_3_2_t = l_3_2
                   r_3_4_t = r_3_4
                   r_3_5_t = r_3_5
                   l_4_1_t = l_4_1
                   l_4_2_t = l_4_2
                   r_4_4_t = r_4_4
                   r_4_5_t = r_4_5
                   l_1_1 = 0
                   l_1_2 = 0
                   r_1_4 = 0
                   r_1_5 = 0
                   l_3_1 = 0
                   l_3_2 = 0
                   r_3_4 = 0
                   r_3_5 = 0
                   l_4_1 = 0
                   l_4_2 = 0
                   r_4_4 = 0
                   r_4_5 = 0
                   t=1
                   
                   
               else
                   l_1_1_t = 0
                   l_1_2_t = 0
                   r_1_4_t = 0
                   r_1_5_t = 0
                   l_3_1_t = 0
                   l_3_2_t = 0
                   r_3_4_t = 0
                   r_3_5_t = 0
                   l_4_1_t = 0
                   l_4_2_t = 0
                   r_4_4_t = 0
                   r_4_5_t = 0 
                   t = 0
                   
                   
               end 
               end
               
               % 2,3,4 Triplet
               if(t==1)
                  
               else    
               if(l_3_1 == l_2_1 && l_3_2 == l_2_2 && r_3_4 == r_2_4 && r_3_5 == r_2_5 && l_4_1 == l_2_1 && l_4_2 == l_2_2 && r_4_4 == r_2_4 && r_4_5 == r_2_5)
                   
                   l_1_1_t = 0
                   l_1_2_t = 0
                   r_1_4_t = 0
                   r_1_5_t = 0
                   l_2_1_t = l_2_1
                   l_2_2_t = l_2_2
                   r_2_4_t = r_2_4
                   r_2_5_t = r_2_5
                   l_3_1_t = l_3_1
                   l_3_2_t = l_3_2
                   r_3_4_t = r_3_4
                   r_3_5_t = r_3_5
                   l_4_1_t = l_4_1
                   l_4_2_t = l_4_2
                   r_4_4_t = r_4_4
                   r_4_5_t = r_4_5
                   l_2_1 = 0
                   l_2_2 = 0
                   r_2_4 = 0
                   r_2_5 = 0
                   l_3_1 = 0
                   l_3_2 = 0
                   r_3_4 = 0
                   r_3_5 = 0
                   l_4_1 = 0
                   l_4_2 = 0
                   r_4_4 = 0
                   r_4_5 = 0
                   
                   
               else
                   l_2_1_t = 0
                   l_2_2_t = 0
                   r_2_4_t = 0
                   r_2_5_t = 0
                   l_3_1_t = 0
                   l_3_2_t = 0
                   r_3_4_t = 0
                   r_3_5_t = 0 
                   l_4_1_t = 0
                   l_4_2_t = 0
                   r_4_4_t = 0
                   r_4_5_t = 0
                   
               end  
               end
               % Check for doublets
               
               % Same position of 1,2
               
               if(l_1_1 == l_2_1 && l_1_2 == l_2_2 && r_1_4 == r_2_4 && r_1_5 == r_2_5)
                 
                   l_1_1_d12 = l_1_1
                   l_1_2_d12 = l_1_2
                   r_1_4_d12 = r_1_4
                   r_1_5_d12 = r_1_5
                   l_2_1_d12 = l_2_1
                   l_2_2_d12 = l_2_2
                   r_2_4_d12 = r_2_4
                   r_2_5_d12 = r_2_5
                   l_1_1 = 0
                   l_1_2 = 0
                   r_1_4 = 0
                   r_1_5 = 0
                   l_2_1 = 0
                   l_2_2 = 0
                   r_2_4 = 0
                   r_2_5 = 0
                                              
               else
                   l_1_1_d12 = 0
                   l_1_2_d12 = 0
                   r_1_4_d12 = 0
                   r_1_5_d12 = 0
                   l_2_1_d12 = 0
                   l_2_2_d12 = 0
                   r_2_4_d12 = 0
                   r_2_5_d12 = 0 
                   
               end
              
               % Same position of 1,3
               
               if(l_1_1 == l_3_1 && l_1_2 == l_3_2 && r_1_4 == r_3_4 && r_1_5 == r_3_5)
                 
                   l_1_1_d13 = l_1_1
                   l_1_2_d13 = l_1_2
                   r_1_4_d13 = r_1_4
                   r_1_5_d13 = r_1_5
                   l_3_1_d13 = l_2_1
                   l_3_2_d13 = l_2_2
                   r_3_4_d13 = r_2_4
                   r_3_5_d13 = r_2_5
                   l_1_1 = 0
                   l_1_2 = 0
                   r_1_4 = 0
                   r_1_5 = 0
                   l_3_1 = 0
                   l_3_2 = 0
                   r_3_4 = 0
                   r_3_5 = 0
                                              
               else
                   l_1_1_d13 = 0
                   l_1_2_d13 = 0
                   r_1_4_d13 = 0
                   r_1_5_d13 = 0
                   l_3_1_d13 = 0
                   l_3_2_d13 = 0
                   r_3_4_d13 = 0
                   r_3_5_d13 = 0 
                   
               end
              
               % Same position of 1,4
               
               if(l_1_1 == l_4_1 && l_1_2 == l_4_2 && r_1_4 == r_4_4 && r_1_5 == r_4_5)
                 
                   l_1_1_d14 = l_1_1
                   l_1_2_d14 = l_1_2
                   r_1_4_d14 = r_1_4
                   r_1_5_d14 = r_1_5
                   l_4_1_d14 = l_2_1
                   l_4_2_d14 = l_2_2
                   r_4_4_d14 = r_2_4
                   r_4_5_d14 = r_2_5
                   l_1_1 = 0
                   l_1_2 = 0
                   r_1_4 = 0
                   r_1_5 = 0
                   l_4_1 = 0
                   l_4_2 = 0
                   r_4_4 = 0
                   r_4_5 = 0
                                              
               else
                   l_1_1_d14 = 0
                   l_1_2_d14 = 0
                   r_1_4_d14 = 0
                   r_1_5_d14 = 0
                   l_4_1_d14 = 0
                   l_4_2_d14 = 0
                   r_4_4_d14 = 0
                   r_4_5_d14 = 0 
                   
              end
                       
                   
              % Same position of 2,3   
               
               
               if(l_2_1 == l_3_1 && l_2_2 == l_3_2 && r_2_4 == r_3_4 && r_2_5 == r_3_5)
                   B = 1
                   l_2_1_d23 = l_2_1
                   l_2_2_d23 = l_2_2
                   r_2_4_d23 = r_2_4
                   r_2_5_d23 = r_2_5
                   l_3_1_d23 = l_3_1
                   l_3_2_d23 = l_3_2
                   r_3_4_d23 = r_3_4
                   r_3_5_d23 = r_3_5
                   l_2_1 = 0
                   l_2_2 = 0
                   r_2_4 = 0
                   r_2_5 = 0
                   l_3_1 = 0
                   l_3_2 = 0
                   r_3_4 = 0
                   r_3_5 = 0
                   
               else
                   l_2_1_d23 = 0
                   l_2_2_d23 = 0
                   r_2_4_d23 = 0
                   r_2_5_d23 = 0
                   l_3_1_d23 = 0
                   l_3_2_d23 = 0
                   r_3_4_d23 = 0
                   r_3_5_d23 = 0
                   
               end    
               
               % Same position of 2,4   
               
               
               if(l_2_1 == l_4_1 && l_2_2 == l_4_2 && r_2_4 == r_4_4 && r_2_5 == r_4_5)
                   B = 1
                   l_2_1_d24 = l_2_1
                   l_2_2_d24 = l_2_2
                   r_2_4_d24 = r_2_4
                   r_2_5_d24 = r_2_5
                   l_4_1_d24 = l_3_1
                   l_4_2_d24 = l_3_2
                   r_4_4_d24 = r_3_4
                   r_4_5_d24 = r_3_5
                   l_2_1 = 0
                   l_2_2 = 0
                   r_2_4 = 0
                   r_2_5 = 0
                   l_4_1 = 0
                   l_4_2 = 0
                   r_4_4 = 0
                   r_4_5 = 0
                   
               else
                   l_2_1_d24 = 0
                   l_2_2_d24 = 0
                   r_2_4_d24 = 0
                   r_2_5_d24 = 0
                   l_4_1_d24 = 0
                   l_4_2_d24 = 0
                   r_4_4_d24 = 0
                   r_4_5_d24 = 0
                   
               end  
               % Same position of 3,4   
               
               
               if(l_4_1 == l_3_1 && l_4_2 == l_3_2 && r_4_4 == r_3_4 && r_4_5 == r_3_5)
                   B = 1
                   l_3_1_d34 = l_3_1
                   l_3_2_d34 = l_3_2
                   r_3_4_d34 = r_3_4
                   r_3_5_d34 = r_3_5
                   l_4_1_d34 = l_4_1
                   l_4_2_d34 = l_4_2
                   r_4_4_d34 = r_4_4
                   r_4_5_d34 = r_4_5
                   l_3_1 = 0
                   l_3_2 = 0
                   r_3_4 = 0
                   r_3_5 = 0
                   l_4_1 = 0
                   l_4_2 = 0
                   r_4_4 = 0
                   r_4_5 = 0
                   
               else
                   l_3_1_d34 = 0
                   l_3_2_d34 = 0
                   r_3_4_d34 = 0
                   r_3_5_d34 = 0
                   l_4_1_d34 = 0
                   l_4_2_d34 = 0
                   r_4_4_d34 = 0
                   r_4_5_d34 = 0
                   
               end 
               
               % Sphere 1 with smallest value of x_centroid
               
               % Go through potential positions
               % Case 1: Sphere is no center sphere and is located at the
               % upper left
               if(l_1_1 >0 && l_1_1 < 2);
                       % Coordinates to cut out sphere 1
                       x_1 = 1;
                       x_2 = x_centroid(1) + d_1_c;
                       y_1 = 1;
                       y_2 = y_centroid(1) + d_1_c;
               else
               end    
               % Case 2: Sphere is no center sphere and is located at the
               % lower left
               if(l_1_2 >0 && l_1_2 < 2);
                       % Coordinates to cut out sphere 1
                       x_1 = 1;
                       x_2 = x_centroid(1) + d_1_c;
                       y_1 = y_centroid(1) - d_1_c;
                       y_2 = 13824;
               else
               end
               % Case 3: Sphere is no center sphere and is located at the
               % upper right
               if(r_1_4 >0 && r_1_4 < 2);
                       % Coordinates to cut out sphere 1    
                       x_1 = x_centroid(1) - d_1_c;
                       x_2 = 10752;
                       y_1 = 1;
                       y_2 = y_centroid(1) + d_1_c;
               else
               end
               % Case 4: Sphere is no center sphere and is located at the
               % lower right
               if(r_1_5 >0 && r_1_5 < 2);
                       % Coordinates to cut out sphere 1
                       x_1 = x_centroid(1) - d_1_c;
                       x_2 = 10752;
                       y_1 = y_centroid(1) - d_1_c;
                       y_2 = 13824;
               else
               end
               
               % Going through all iterations for the case sphere 1 =
               % center sphere
               if(x_centroid(1) ~= x_centroid_c);
               else
                   % Case 1: sphere 2, 3, 4 are located left of sphere 1
                   if(x_centroid(2) < x_centroid(1) && x_centroid(3) < x_centroid(1) && x_centroid(4) < x_centroid(1));
                       % Find shortest distance to sphere 1 to sphere 2,3
                       % and 3 to a maximum of 7168/2. Since sphere 2, 3
                       % and 4 are located left of sphere 1, distance is just
                       % limited to the left and not to the right
                       V_1m = [d1_2 ; d1_3 ; d1_4 ; (7168/2)];
                       min1m = min(V_1m);
                       % Maximal added distance to the right to obtain
                       % maximal images of 7168x7168 pixel
                       min1p = (7168-min1m);
                   else
                   end
                   % Case 2: sphere 2, 3 and 4 are located right of sphere 1
                   if(x_centroid(2) > x_centroid(1) && x_centroid(3) > x_centroid(1) && x_centroid(4) > x_centroid(1));
                       % Find shortest distance to sphere 1 to sphere 2, 3 and
                       % 4 to a maximum of 7168/2. Since sphere 2, 3
                       % and 4 are located right of sphere 1, distance is just
                       % limited to the right and not to the left
                       V_1p = [d1_2 ; d1_3 ; d1_4 (7168/2)];
                       min1p = min(V_1p);
                       % Maximal added distance to the left to obtain
                       % maximal images of 7168x7168 pixel
                       min1m = (7168-min1p);
                   else
                   end
                   % Case 3: sphere 2 and 3 are located left of sphere 1 and 4 is located right of sphere 1
                   if(x_centroid(2) < x_centroid(1) && x_centroid(3) < x_centroid(1) && x_centroid(4) > x_centroid(1));
                       % Find minimal distance to the left and to the right. To the left
                       % only the distance between sphere 1 and 2 and 1 and 3 and to
                       % the right only the distance of sphere 1 and 4
                       % matter. 
                       V_1m = [d1_2 ; d1_3 ; (7168/2)];
                       V_1p = [d1_4 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);  
                   else  
                   end
                   % Case 4: sphere 2 and 4 are located left of sphere 1 and 3 is located right of sphere 1
                   if(x_centroid(2) < x_centroid(1) && x_centroid(3) > x_centroid(1) && x_centroid(4) < x_centroid(1));
                       % Find minimal distance to the left and to the right. To the left
                       % only the distance between sphere 1 and 2 and 1 and 4 and to
                       % the right only the distance of sphere 1 and 4
                       % matter.
                       V_1m = [d1_2 ; d1_4 ; (7168/2)];
                       V_1p = [d1_3 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   else
                   end
                   % Case 5: sphere 3 and 4 are located left of sphere 1 and 2 is located right of sphere 1
                   if(x_centroid(2) > x_centroid(1) && x_centroid(3) < x_centroid(1) && x_centroid(4) < x_centroid(1));
                       % Find minimal distance to the left and to the right. To the left
                       % only the distance between sphere 1 and 3 and 1 and 4 and to
                       % the right only the distance of sphere 1 and 2
                       % matter.
                       V_1m = [d1_3 ; d1_4 ; (7168/2)];
                       V_1p = [d1_2 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   else
                   end
                   % Case 6: sphere 2 is located left of sphere 1 and 3 and 4 are located right of sphere 1
                   if(x_centroid(2) < x_centroid(1) && x_centroid(3) > x_centroid(1) && x_centroid(4) > x_centroid(1));
                       % Find minimal distance to the left and to the right. To the left
                       % only the distance between sphere 1 and 2 and to
                       % the right only the distance of sphere 1 and 3 and
                       % 1 and 4 matter.
                       V_1m = [d1_2 ; (7168/2)];
                       V_1p = [d1_3 ; d1_4 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   else
                   end
                   % Case 7: sphere 4 is located left of sphere 1 and 2 and 3 are located right of sphere 1
                   if(x_centroid(2) > x_centroid(1) && x_centroid(3) > x_centroid(1) && x_centroid(4) < x_centroid(1));
                       % Find minimal distance to the left and to the right. To the left
                       % only the distance between sphere 1 and 4 and to
                       % the right only the distance of sphere 1 and 2 and
                       % 1 and 3 matter.
                       V_1m = [d1_4 ; (7168/2)];
                       V_1p = [d1_2 ; d1_3 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   else
                   end
                   % Case 8: sphere 3 is located left of sphere 1 and 2 and 4 are located right of sphere 1
                   if(x_centroid(2) > x_centroid(1) && x_centroid(3) < x_centroid(1) && x_centroid(4) > x_centroid(1));
                       % Find minimal distance to the left and to the right. To the left
                       % only the distance between sphere 1 and 3 and to
                       % the right only the distance of sphere 1 and 2 and
                       % 1 and 4 matter.
                       V_1m = [d1_3 ; (7168/2)];
                       V_1p = [d1_2 ; d1_4 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   else
                   end
                   
                   % Coordinates to cut out sphere 1
                   x_1 = x_centroid(1) - min1m 
                   x_2 = x_centroid(1) + min1p
                   y_1 = y_centroid(1) - min1m
                   y_2 = y_centroid(1) + min1p
                   
                    
               end    
               % Case for all four spheres in the same spot
                   
                   if(l_1_1_q == 1)
                       Vdq_x = [d1_2 ; d1_3 ; d1_4 ; 7168/2]
                       Vdq_y_m = [d1_2 ; d1_3 ; d1_4 ; 7168/2 ; (y_centroid(1)-1)]
                       Vdq_y_p = [d1_2 ; d1_3 ; d1_4 ; 7168/2 ]
                       miny_m = min(Vdq_y_m(1:5))
                       miny_p = min(Vdq_y_m(1:4))
                       minx = min(Vdq_x(1:4))
                       x_1 = 1
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   end   
                       
                   if(l_1_2_q == 1)
                       Vdq_x = [d1_2 ; d1_3 ; d1_4 ; 7168/2]
                       Vdq_y_m = [d1_2 ; d1_3 ; d1_4 ; 7168/2]
                       Vdq_y_p = [d1_2 ; d1_3 ; d1_4 ; 7168/2 ; (13824 - y_centroid(1))]
                       miny_m = min(Vdq_y_m(1:4))
                       miny_p = min(Vdq_y_p(1:5))
                       minx = min(Vdq_x(1:4))
                       x_1 = 1
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   end 
                   
                   if(r_1_4_q == 1)
                       Vdq_x = [d1_2 ; d1_3 ; d1_4 ; 7168/2]
                       Vdq_y_m = [d1_2 ; d1_3 ; d1_4 ; 7168/2 ; (y_centroid(1)-1)]
                       Vdq_y_p = [d1_2 ; d1_3 ; d1_4 ; 7168/2 ]
                       miny_m = min(Vdq_y_m(1:5))
                       miny_p = min(Vdq_y_p(1:4))
                       minx = min(Vdq_x(1:4))
                       x_1 = x_centroid(1) - (7168 - minx)
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   end 
                   
                   if(r_1_5_q == 1)
                       Vdq_x = [d1_2 ; d1_3 ; d1_4 ; 7168/2]
                        Vdq_y_m = [d1_2 ; d1_3 ; d1_4 ; 7168/2]
                       Vdq_y_p = [d1_2 ; d1_3 ; d1_4 ; 7168/2 ; (13824 - y_centroid(1))]
                       miny_m = min(Vdq_y_m(1:4))
                       miny_p = min(Vdq_y_p(1:5))
                       minx = min(Vdq_x(1:4))
                       x_1 = x_centroid(1) - (7168 - minx)
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   end
               
                   % Case for 1,2,3 at the same position
                   if(l_1_1_t == 1)
                       Vdt_x = [d1_2 ; d1_3 ; 7168/2]
                       Vdt_y_m = [d1_2 ; d1_3  ; 7168/2 ; (y_centroid(1)-1)]
                       Vdt_y_p = [d1_2 ; d1_3  ; 7168/2 ]
                       miny_m = min(Vdt_y_m(1:4))
                       miny_p = min(Vdt_y_m(1:3))
                       minx = min(Vdt_x(1:3))
                       x_1 = 1
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   end   
                       
                   if(l_1_2_t == 1)
                       Vdt_x = [d1_2 ; d1_3 ;  7168/2]
                       Vdt_y_m = [d1_2 ; d1_3 ;  7168/2]
                       Vdt_y_p = [d1_2 ; d1_3 ;  7168/2 ; (13824 - y_centroid(1))]
                       miny_m = min(Vdt_y_m(1:3))
                       miny_p = min(Vdt_y_p(1:4))
                       minx = min(Vdt_x(1:3))
                       x_1 = 1
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   end 
                   
                   if(r_1_4_t == 1)
                       Vdt_x = [d1_2 ; d1_3 ;  7168/2]
                       Vdt_y_m = [d1_2 ; d1_3 ;  7168/2 ; (y_centroid(1)-1)]
                       Vdt_y_p = [d1_2 ; d1_3 ;  7168/2 ]
                       miny_m = min(Vdt_y_m(1:4))
                       miny_p = min(Vdt_y_p(1:3))
                       minx = min(Vdt_x(1:3))
                       x_1 = x_centroid(1) - (7168 - minx)
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   end 
                   
                   if(r_1_5_t == 1)
                       Vdt_x = [d1_2 ; d1_3 ;  7168/2]
                        Vdt_y_m = [d1_2 ; d1_3 ;  7168/2]
                       Vdt_y_p = [d1_2 ; d1_3 ;  7168/2 ; (13824 - y_centroid(1))]
                       miny_m = min(Vdt_y_m(1:3))
                       miny_p = min(Vdt_y_p(1:4))
                       minx = min(Vdt_x(1:3))
                       x_1 = x_centroid(1) - (7168 - minx)
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   end
                   
                   
                   % Case fox 1,2 are the same quadrant
                   
                   if(l_1_1_d12 == 1)
                       Vdd_x = [d1_2 ; 7168/2]
                       Vdd_y_m = [d1_2; 7168/2 ; (y_centroid(1)-1)]
                       Vdd_y_p = [d1_2 7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_m(1:2))
                       minx = min(Vdd_x(1:2))
                       x_1 = 1
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   end   
                       
                   if(l_1_2_d12 == 1)
                       Vdd_x = [d1_2 ; 7168/2]
                       Vdd_y_m = [d1_2  ;  7168/2]
                       Vdd_y_p = [d1_2;  7168/2 ; (13824 - y_centroid(1))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_1 = 1
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   end 
                   
                   if(r_1_4_d12 == 1)
                       Vdd_x = [d1_2;   7168/2]
                       Vdd_y_m = [d1_2;   7168/2 ; (y_centroid(1)-1)]
                       Vdd_y_p = [d1_2;   7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_p(1:2))
                       minx = min(Vdd_x(1:2))
                       x_1 = x_centroid(1) - (7168 - minx)
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   end 
                   
                   if(r_1_5_d12 == 1)
                       Vdd_x = [d1_2;  7168/2]
                        Vdd_y_m = [d1_2;  7168/2]
                       Vdd_y_p = [d1_2;   7168/2 ; (13824 - y_centroid(1))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdt_x(1:2))
                       x_1 = x_centroid(1) - (7168 - minx)
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   end
                   
                % Case fox 1,3 are the same quadrant
                   
                   if(l_1_1_d13 == 1)
                       Vdd_x = [d1_3 ; 7168/2]
                       Vdd_y_m = [d1_3; 7168/2 ; (y_centroid(1)-1)]
                       Vdd_y_p = [d1_3 7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_m(1:2))
                       minx = min(Vdd_x(1:2))
                       x_1 = 1
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   end   
                       
                   if(l_1_2_d13 == 1)
                       Vdd_x = [d1_3 ; 7168/2]
                       Vdd_y_m = [d1_3  ;  7168/2]
                       Vdd_y_p = [d1_3;  7168/2 ; (13824 - y_centroid(1))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_1 = 1
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   end 
                   
                   if(r_1_4_d13 == 1)
                       Vdd_x = [d1_3;   7168/2]
                       Vdd_y_m = [d1_3;   7168/2 ; (y_centroid(1)-1)]
                       Vdd_y_p = [d1_3;   7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_p(1:2))
                       minx = min(Vdd_x(1:2))
                       x_1 = x_centroid(1) - (7168 - minx)
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   end 
                   
                   if(r_1_5_d13 == 1)
                       Vdd_x = [d1_3;  7168/2]
                        Vdd_y_m = [d1_3;  7168/2]
                       Vdd_y_p = [d1_3;   7168/2 ; (13824 - y_centroid(1))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdt_x(1:2))
                       x_1 = x_centroid(1) - (7168 - minx)
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   end   
                  % Case fox 1,4 are the same quadrant
                   
                   if(l_1_1_d14 == 1)
                       Vdd_x = [d1_4 ; 7168/2]
                       Vdd_y_m = [d1_4; 7168/2 ; (y_centroid(1)-1)]
                       Vdd_y_p = [d1_4 7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_m(1:2))
                       minx = min(Vdd_x(1:2))
                       x_1 = 1
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   end   
                       
                   if(l_1_2_d14 == 1)
                       Vdd_x = [d1_4 ; 7168/2]
                       Vdd_y_m = [d1_4  ;  7168/2]
                       Vdd_y_p = [d1_4;  7168/2 ; (13824 - y_centroid(1))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_1 = 1
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   end 
                   
                   if(r_1_4_d14 == 1)
                       Vdd_x = [d1_4;   7168/2]
                       Vdd_y_m = [d1_4;   7168/2 ; (y_centroid(1)-1)]
                       Vdd_y_p = [d1_4;   7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_p(1:2))
                       minx = min(Vdd_x(1:2))
                       x_1 = x_centroid(1) - (7168 - minx)
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   end 
                   
                   if(r_1_5_d14 == 1)
                       Vdd_x = [d1_4;  7168/2]
                        Vdd_y_m = [d1_4;  7168/2]
                       Vdd_y_p = [d1_4;   7168/2 ; (13824 - y_centroid(1))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdt_x(1:2))
                       x_1 = x_centroid(1) - (7168 - minx)
                       x_2 = x_centroid(1) + minx
                       y_1 = y_centroid(1) - miny_m
                       y_2 = y_centroid(1) + miny_p
                   end 
                   
                    
                if(x_1 < 1)
                    x_1 = 1
                end    
                
                if(x_2 > 10752)
                    x_2 = 10752
                end
                
                if(y_1 < 1)
                    y_1 = 1
                end
                if(y_2 < 1)
                    y_2 = 1
                end   
                %The rectangular image is cutted from the imgnucleus image containing the whole cover slip
               imagesphere1 = imgnucleus(y_1:y_2,x_1:x_2);
               % Dimensions of imagesphere1 are determined
               [r1 c1] = size(imagesphere1);
               % An empty matrix is generated
               imagesphereresize1 = zeros(7168:7168);
               % imagesphereresize1 is converted to 8-bit
               imagesphereresize1 = uint8(imagesphereresize1);
               %The empty indices in the imagesphereresize1 matrix are overwritten with imagesphere 1 entries
               imagesphereresize1(1:r1,1:c1)=imagesphere1;
               % imagesphereresize1 is saved to final destination
               newFile1 = regexprep(allfiles(i).name,'NucleusBig',[wellind '01NucleusBig'],'ignorecase');        
               imwrite(imagesphereresize1,[foldername1 '/' newFile1]);
               clear imagesphereresize1; 
               clear imagesphere1;
               
            
               % Sphere 2 with smallest value of x_centroid
               
               if(l_2_1 >0 && l_2_1 < 2);
                       x_3 = 1;
                       x_4 = x_centroid(2) + d_2_c;
                       y_3 = 1;
                       y_4 = y_centroid(2) + d_2_c;
               else
               end    
               
               if(l_2_2 >0 && l_2_2 < 2);
                       x_3 = 1;
                       x_4 = x_centroid(2) + d_2_c;
                       y_3 = y_centroid(2) - d_2_c;
                       y_4 = 13824;
               else
               end
               
               if(r_2_4 >0 && r_2_4 < 2);
                       x_3 = x_centroid(2) - d_2_c;
                       x_4 = 10752;
                       y_3 = 1;
                       y_4 = y_centroid(2) + d_2_c;
               else
               end
               
               if(r_2_5 >0 && r_2_5 < 2);
                       x_3 = x_centroid(2) - d_2_c;
                       x_4 = 10752;
                       y_3 = y_centroid(2) - d_2_c;
                       y_4 = 13824;
               else
               end
               
               % Going over all possible distributions of sphere cores
               if(x_centroid(2) ~= x_centroid_c);
               else
                   % 1st permutation
                   if(x_centroid(1) < x_centroid(2) && x_centroid(3) < x_centroid(2) && x_centroid(4) < x_centroid(2));
                       V_1m = [d1_2 ; d2_3 ; d2_4 ; (7168/2)];
                       min1m = min(V_1m);
                       min1p = (7168-min1m);
                   else
                   end
                   % 2nd permutation
                   if(x_centroid(1) > x_centroid(2) && x_centroid(3) > x_centroid(2) && x_centroid(4) > x_centroid(2));
                       V_1p = [d1_2 ; d2_3 ; d2_4 (7168/2)];
                       min1p = min(V_1p);
                       min1m = (7168-min1p);
                   else
                   end
                   %3rd permutation
                   if(x_centroid(1) < x_centroid(2) && x_centroid(3) < x_centroid(2) && x_centroid(4) > x_centroid(2));
                       V_1m = [d1_2 ; d2_3 ; (7168/2)];
                       V_1p = [d2_4 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                       
                   else
                       
                   end
                   %4th permutation
                   if(x_centroid(1) < x_centroid(2) && x_centroid(3) > x_centroid(2) && x_centroid(4) < x_centroid(2));
                       V_1m = [d1_2 ; d2_4 ; (7168/2)];
                       V_1p = [d2_3 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   else
                   end
                   %5th permutation
                   if(x_centroid(1) > x_centroid(2) && x_centroid(3) < x_centroid(2) && x_centroid(4) < x_centroid(2));
                       V_1m = [d2_3 ; d2_4 ; (7168/2)];
                       V_1p = [d1_2 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   else
                   end
                   %6th permutation
                   if(x_centroid(1) < x_centroid(2) && x_centroid(3) > x_centroid(2) && x_centroid(4) > x_centroid(2));
                       V_1m = [d1_2 ; (7168/2)];
                       V_1p = [d2_3 ; d2_4 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   else
                   end
                   %7th permutation
                   if(x_centroid(1) > x_centroid(2) && x_centroid(3) > x_centroid(2) && x_centroid(4) < x_centroid(2));
                       V_1m = [d2_4 ; (7168/2)];
                       V_1p = [d1_2 ; d2_3 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   else
                   end
                   %8th permutation
                   if(x_centroid(1) > x_centroid(2) && x_centroid(3) < x_centroid(2) && x_centroid(4) > x_centroid(2));
                       V_1m = [d2_3 ; (7168/2)];
                       V_1p = [d1_2 ; d2_4 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   else
                   end
                   x_3 = x_centroid(2) - min1m 
                   x_4 = x_centroid(2) + min1p
                   y_3 = y_centroid(2) - min1m
                   y_4 = y_centroid(2) + min1p
                   
                   
                   
                   
                   
                   
               end    
               
               % Case for all four spheres in the same spot
                   
                   if(l_2_1_q == 1)
                       Vdq_x = [d1_2 ; d2_3 ; d2_4 ; 7168/2]
                       Vdq_y_m = [d1_2 ; d2_3 ; d2_4 ; 7168/2 ; (y_centroid(2)-1)]
                       Vdq_y_p = [d1_2 ; d2_3 ; d2_4 ; 7168/2 ]
                       miny_m = min(Vdq_y_m(1:5))
                       miny_p = min(Vdq_y_p(1:4))
                       minx = min(Vdq_x(1:4))
                       x_3 = x_centroid(2) - minx 
                       x_4 = x_centroid(2) + minx
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   end   
                       
                   if(l_2_2_q == 1)
                       Vdq_x = [d1_2 ; d2_3 ; d2_4 ; 7168/2]
                       Vdq_y_m = [d1_2 ; d2_3 ; d2_4 ; 7168/2]
                       Vdq_y_p = [d1_2 ; d2_3 ; d2_4 ; 7168/2 ; (13824 - y_centroid(2))]
                       miny_m = min(Vdq_y_m(1:4))
                       miny_p = min(Vdq_y_p(1:5))
                       minx = min(Vdq_x(1:4))
                       x_3 = x_centroid(2) - minx
                       x_4 = x_centroid(2) + minx
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   end 
                   
                   if(r_2_4_q == 1)
                       Vdq_x = [d1_2 ; d2_3 ; d2_4 ; 7168/2]
                       Vdq_y_m = [d1_2 ; d2_3 ; d2_4 ; 7168/2 ; (y_centroid(2)-1)]
                       Vdq_y_p = [d1_2 ; d2_3 ; d2_4 ; 7168/2 ]
                       miny_m = min(Vdq_y_m(1:5))
                       miny_p = min(Vdq_y_p(1:4))
                       minx = min(Vdq_x(1:4))
                       x_3 = x_centroid(2) - minx
                       x_4 = x_centroid(2) + minx
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   end 
                   
                   if(r_2_5_q == 1)
                       Vdq_x = [d1_2 ; d2_3 ; d2_4 ; 7168/2]
                        Vdq_y_m = [d1_2 ; d2_3 ; d2_4 ; 7168/2]
                       Vdq_y_p = [d1_2 ; d2_3 ; d2_4 ; 7168/2 ; (13824 - y_centroid(2))]
                       miny_m = min(Vdq_y_m(1:4))
                       miny_p = min(Vdq_y_p(1:5))
                       minx = min(Vdq_x(1:4))
                       x_3 = x_centroid(2) - minx
                       x_4 = x_centroid(2) + minx
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   end 
                   
                   
               % Case for 1,2,3 at the same position
                   if(l_2_1_t == 1)
                       Vdt_x = [d1_2 ; d2_3 ; 7168/2]
                       Vdt_y_m = [d1_2 ; d2_3  ; 7168/2 ; (y_centroid(2)-1)]
                       Vdt_y_p = [d1_2 ; d2_3  ; 7168/2 ]
                       miny_m = min(Vdt_y_m(1:4))
                       miny_p = min(Vdt_y_m(1:3))
                       minx = min(Vdt_x(1:3))
                       x_3 = x_centroid(2) - minx
                       x_4 = x_centroid(2) + minx
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   end   
                       
                   if(l_2_2_t == 1)
                       Vdt_x = [d1_2 ; d2_3 ;  7168/2]
                       Vdt_y_m = [d1_2 ; d2_3 ;  7168/2]
                       Vdt_y_p = [d1_2 ; d2_3 ;  7168/2 ; (13824 - y_centroid(2))]
                       miny_m = min(Vdt_y_m(1:3))
                       miny_p = min(Vdt_y_p(1:4))
                       minx = min(Vdt_x(1:3))
                       x_3 = x_centroid(2) - minx
                       x_4 = x_centroid(2) + minx
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   end 
                   
                   if(r_2_4_t == 1)
                       Vdt_x = [d1_2 ; d2_3 ;  7168/2]
                       Vdt_y_m = [d1_2 ; d2_3 ;  7168/2 ; (y_centroid(2)-1)]
                       Vdt_y_p = [d1_2 ; d2_3 ;  7168/2 ]
                       miny_m = min(Vdt_y_m(1:4))
                       miny_p = min(Vdt_y_p(1:3))
                       minx = min(Vdt_x(1:3))
                       x_3 = x_centroid(2) - minx
                       x_4 = x_centroid(2) + minx
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   end 
                   
                   if(r_2_5_t == 1)
                       Vdt_x = [d1_2 ; d2_3 ;  7168/2]
                        Vdt_y_m = [d1_2 ; d2_3 ;  7168/2]
                       Vdt_y_p = [d1_2 ; d2_3 ;  7168/2 ; (13824 - y_centroid(2))]
                       miny_m = min(Vdt_y_m(1:3))
                       miny_p = min(Vdt_y_p(1:4))
                       minx = min(Vdt_x(1:3))
                       x_3 = x_centroid(2) - minx
                       x_4 = x_centroid(2) + minx
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   end   
                   
                    % Case for 2,3,4 at the same position
                   if(l_2_1_t == 1)
                       Vdt_x = [d2_4 ; d2_3 ; 7168/2]
                       Vdt_y_m = [d2_4 ; d2_3  ; 7168/2 ; (y_centroid(2)-1)]
                       Vdt_y_p = [d2_4 ; d2_3  ; 7168/2 ]
                       miny_m = min(Vdt_y_m(1:4))
                       miny_p = min(Vdt_y_m(1:3))
                       minx = min(Vdt_x(1:3))
                       x_3 = x_centroid(2) - minx
                       x_4 = x_centroid(2) + minx
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   end   
                       
                   if(l_2_2_t == 1)
                       Vdt_x = [d2_4 ; d2_3 ;  7168/2]
                       Vdt_y_m = [d2_4 ; d2_3 ;  7168/2]
                       Vdt_y_p = [d2_4 ; d2_3 ;  7168/2 ; (13824 - y_centroid(2))]
                       miny_m = min(Vdt_y_m(1:3))
                       miny_p = min(Vdt_y_p(1:4))
                       minx = min(Vdt_x(1:3))
                       x_3 = x_centroid(2) - minx
                       x_4 = x_centroid(2) + minx
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   end 
                   
                   if(r_2_4_t == 1)
                       Vdt_x = [d2_4 ; d2_3 ;  7168/2]
                       Vdt_y_m = [d2_4 ; d2_3 ;  7168/2 ; (y_centroid(2)-1)]
                       Vdt_y_p = [d2_4 ; d2_3 ;  7168/2 ]
                       miny_m = min(Vdt_y_m(1:4))
                       miny_p = min(Vdt_y_p(1:3))
                       minx = min(Vdt_x(1:3))
                       x_3 = x_centroid(2) - minx
                       x_4 = x_centroid(2) + minx
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   end 
                   
                   if(r_2_5_t == 1)
                       Vdt_x = [d2_4 ; d2_3 ;  7168/2]
                        Vdt_y_m = [d2_4 ; d2_3 ;  7168/2]
                       Vdt_y_p = [d2_4 ; d2_3 ;  7168/2 ; (13824 - y_centroid(2))]
                       miny_m = min(Vdt_y_m(1:3))
                       miny_p = min(Vdt_y_p(1:4))
                       minx = min(Vdt_x(1:3))
                       x_3 = x_centroid(2) - minx
                       x_4 = x_centroid(2) + minx
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   end  
                   
                % Case fox 1,2 are the same quadrant
                   
                   if(l_2_1_d12 == 1)
                       Vdd_x = [d1_2 ; 7168/2]
                       Vdd_y_m = [d1_2 ; 7168/2 ; (y_centroid(2)-1)]
                       Vdd_y_p = [d1_2 ;  7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_m(1:2))
                       minx = min(Vdd_x(1:2))
                       x_3 = x_centroid(2) - minx
                       x_4 = x_centroid(2) + (7168-minx)
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   end   
                       
                   if(l_2_2_d12 == 1)
                       Vdd_x = [d1_2 ;  7168/2]
                       Vdd_y_m = [d1_2  ;  7168/2]
                       Vdd_y_p = [d1_2 ;  7168/2 ; (13824 - y_centroid(2))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_3 = x_centroid(2) - minx
                       x_4 = x_centroid(2) + (7168-minx)
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   end 
                   
                   if(r_2_4_d12 == 1)
                       Vdd_x = [d1_2 ;   7168/2]
                       Vdd_y_m = [d1_2 ;   7168/2 ; (y_centroid(2)-1)]
                       Vdd_y_p = [d1_2 ;   7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_p(1:2))
                       minx = min(Vdd_x(1:2))
                       x_3 = x_centroid(2) - minx
                       x_4 = 10752
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   end 
                   
                   if(r_2_5_d12 == 1)
                       Vdd_x = [d1_2 ;  7168/2]
                        Vdd_y_m = [d1_2 ;  7168/2]
                       Vdd_y_p = [d1_2 ;   7168/2 ; (13824 - y_centroid(2))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdt_x(1:2))
                       x_3 = x_centroid(2) - minx
                       x_4 = 10752
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   end  
                   
                   % Case fox 2,3 are the same quadrant
                   
                               
                   if(l_2_1_d23 == 1)
                       Vdd_x = [d2_3 ; 7168/2]
                       Vdd_y_m = [d2_3 ; 7168/2 ; (y_centroid(2)-1)]
                       Vdd_y_p = [d2_3 ;  7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_m(1:2))
                       minx = min(Vdd_x(1:2))
                       x_3 = x_centroid(2) - minx
                       x_4 = x_centroid(2) + (7168-minx)
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   end   
                       
                   if(l_2_2_d23 == 1)
                       Vdd_x = [d2_3 ;  7168/2]
                       Vdd_y_m = [d2_3  ;  7168/2]
                       Vdd_y_p = [d2_3 ;  7168/2 ; (13824 - y_centroid(2))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_3 = x_centroid(2) - minx
                       x_4 = x_centroid(2) + (7168-minx)
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   end 
                   
                   if(r_2_4_d23 == 1)
                       Vdd_x = [d2_3 ;   7168/2]
                       Vdd_y_m = [d2_3 ;   7168/2 ; (y_centroid(2)-1)]
                       Vdd_y_p = [d2_3 ;   7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_p(1:2))
                       minx = min(Vdd_x(1:2))
                       x_3 = x_centroid(2) - minx
                       x_4 = 10752
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   end 
                   
                   if(r_2_5_d23 == 1)
                       Vdd_x = [d2_3 ;  7168/2]
                        Vdd_y_m = [d2_3 ;  7168/2]
                       Vdd_y_p = [d2_3 ;   7168/2 ; (13824 - y_centroid(2))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_3 = x_centroid(2) - minx
                       x_4 = 10752
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   end  
                   
                   % Case fox 2,4 are the same quadrant
                   
                               
                   if(l_2_1_d24 == 1)
                       Vdd_x = [d2_4 ; 7168/2]
                       Vdd_y_m = [d2_4 ; 7168/2 ; (y_centroid(2)-1)]
                       Vdd_y_p = [d2_4 ;  7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_m(1:2))
                       minx = min(Vdd_x(1:2))
                       x_3 = x_centroid(2) - minx
                       x_4 = x_centroid(2) + (7168-minx)
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   end   
                       
                   if(l_2_2_d24 == 1)
                       Vdd_x = [d2_4 ;  7168/2]
                       Vdd_y_m = [d2_4  ;  7168/2]
                       Vdd_y_p = [d2_4 ;  7168/2 ; (13824 - y_centroid(2))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_3 = x_centroid(2) - minx
                       x_4 = x_centroid(2) + (7168-minx)
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   end 
                   
                   if(r_2_4_d24 == 1)
                       Vdd_x = [d2_4 ;   7168/2]
                       Vdd_y_m = [d2_4 ;   7168/2 ; (y_centroid(2)-1)]
                       Vdd_y_p = [d2_4 ;   7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_p(1:2))
                       minx = min(Vdd_x(1:2))
                       x_3 = x_centroid(2) - minx
                       x_4 = 10752
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   end 
                   
                   if(r_2_5_d24 == 1)
                       Vdd_x = [d2_4 ;  7168/2]
                        Vdd_y_m = [d2_4 ;  7168/2]
                       Vdd_y_p = [d2_4 ;   7168/2 ; (13824 - y_centroid(2))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_3 = x_centroid(2) - minx
                       x_4 = 10752
                       y_3 = y_centroid(2) - miny_m
                       y_4 = y_centroid(2) + miny_p
                   end
                if(x_3 < 1)
                    x_3 = 1
                end    
                
                if(x_4 > 10752)
                    x_4 = 10752
                end
                
                if(y_3 < 1)
                    y_3 = 1
                end
                if(y_4 < 1)
                    y_4 = 1
                end   
                %The rectangular image is cutted from the imgnucleus image containing the whole cover slip
               imagesphere2 = imgnucleus(y_3:y_4,x_3:x_4);
               % Dimensions of imagesphere1 are determined
               [r2 c2] = size(imagesphere2);
               % An empty matrix is generated
               imagesphereresize2 = zeros(7168:7168);
               % imagesphereresize1 is converted to 8-bit
               imagesphereresize2 = uint8(imagesphereresize2);
               %The empty indices in the imagesphereresize1 matrix are overwritten with imagesphere 1 entries
               imagesphereresize2(1:r2,1:c2)=imagesphere2;
               % imagesphereresize1 is saved to final destination
               newFile2 = regexprep(allfiles(i).name,'NucleusBig',[wellind '02NucleusBig'],'ignorecase');        
               imwrite(imagesphereresize2,[foldername1 '/' newFile2]);
               clear imagesphereresize2; 
               clear imagesphere2;
              
               % Sphere 3 with smallest value of x_centroid
              
               if(l_3_1 >0 && l_3_1 < 2);
                       x_5 = 1;
                       x_6 = x_centroid(3) + d_3_c;
                       y_5 = 1;
                       y_6 = y_centroid(3) + d_3_c;
               else
               end    
               
               if(l_3_2 >0 && l_3_2 < 2);
                       x_5 = 1;
                       x_6 = x_centroid(3) + d_3_c;
                       y_5 = y_centroid(3) - d_3_c;
                       y_6 = 13824;
               else
               end
               
               if(r_3_4 >0 && r_3_4 < 2);
                       x_5 = x_centroid(3) - d_3_c;
                       x_6 = 10752;
                       y_5 = 1;
                       y_6 = y_centroid(3) + d_3_c;
               else
               end
               
               if(r_3_5 >0 && r_3_5 < 2);
                       x_5 = x_centroid(3) - d_3_c;
                       x_6 = 10752;
                       y_5 = y_centroid(3) - d_3_c;
                       y_6 = 13824;
               else
               end
               
               % Going over all possible distributions of sphere cores
               if(x_centroid(3) ~= x_centroid_c);
               else
                   % 1st permutation
                   if(x_centroid(1) < x_centroid(3) && x_centroid(2) < x_centroid(3) && x_centroid(4) < x_centroid(3));
                       V_1m = [d1_3 ; d2_3 ; d3_4 ; (7168/2)];
                       min1m = min(V_1m);
                       min1p = (7168-min1m);
                   else
                   end
                   % 2nd permutation
                   if(x_centroid(1) > x_centroid(3) && x_centroid(2) > x_centroid(3) && x_centroid(4) > x_centroid(3));
                       V_1p = [d1_3 ; d2_3 ; d3_4 (7168/2)];
                       min1p = min(V_1p);
                       min1m = (7168-min1p);
                   else
                   end
                   %3rd permutation
                   if(x_centroid(1) < x_centroid(3) && x_centroid(2) < x_centroid(3) && x_centroid(4) > x_centroid(3));
                       V_1m = [d1_3 ; d2_3 ; (7168/2)];
                       V_1p = [d3_4 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                       
                   else
                       
                   end
                   %4th permutation
                   if(x_centroid(1) < x_centroid(3) && x_centroid(2) > x_centroid(3) && x_centroid(4) < x_centroid(3));
                       V_1m = [d1_3 ; d3_4 ; (7168/2)];
                       V_1p = [d2_3 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   else
                   end
                   %5th permutation
                   if(x_centroid(1) > x_centroid(3) && x_centroid(2) < x_centroid(3) && x_centroid(4) < x_centroid(3));
                       V_1m = [d2_3 ; d3_4 ; (7168/2)];
                       V_1p = [d1_3 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   else
                   end
                   %6th permutation
                   if(x_centroid(1) < x_centroid(3) && x_centroid(2) > x_centroid(3) && x_centroid(4) > x_centroid(3));
                       V_1m = [d1_3 ; (7168/2)];
                       V_1p = [d2_3 ; d3_4 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   else
                   end
                   %7th permutation
                   if(x_centroid(1) > x_centroid(3) && x_centroid(2) > x_centroid(3) && x_centroid(4) < x_centroid(3));
                       V_1m = [d3_4 ; (7168/2)];
                       V_1p = [d1_3 ; d2_3 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   else
                   end
                   %8th permutation
                   if(x_centroid(1) > x_centroid(3) && x_centroid(2) < x_centroid(3) && x_centroid(4) > x_centroid(3));
                       V_1m = [d2_3 ; (7168/2)];
                       V_1p = [d1_3 ; d3_4 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   else
                   end
                   x_5 = x_centroid(3) - min1m 
                   x_6 = x_centroid(3) + min1p
                   y_5 = y_centroid(3) - min1m
                   y_6 = y_centroid(3) + min1p
                   
                   
                   
               end    
               
               % Case for all four spheres in the same spot
                   
                   if(l_3_1_q == 1)
                       Vdq_x = [d1_3 ; d2_3 ; d3_4 ; 7168/2]
                       Vdq_y_m = [d1_3 ; d2_3 ; d3_4 ; 7168/2 ; (y_centroid(3)-1)]
                       Vdq_y_p = [d1_3 ; d2_3 ; d3_4 ; 7168/2 ]
                       miny_m = min(Vdq_y_m(1:5))
                       miny_p = min(Vdq_y_p(1:4))
                       minx = min(Vdq_x(1:4))
                       x_5 = x_centroid(3) - minx 
                       x_6 = x_centroid(3) + minx
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   end   
                       
                   if(l_3_2_q == 1)
                       Vdq_x = [d1_3 ; d2_3 ; d3_4 ; 7168/2]
                       Vdq_y_m = [d1_3 ; d2_3 ; d3_4 ; 7168/2]
                       Vdq_y_p = [d1_3 ; d2_3 ; d3_4 ; 7168/2 ; (13824 - y_centroid(3))]
                       miny_m = min(Vdq_y_m(1:4))
                       miny_p = min(Vdq_p_m(1:5))
                       minx = min(Vdq_x(1:4))
                       x_5 = x_centroid(3) - minx
                       x_6 = x_centroid(3) + minx
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   end 
                   
                   if(r_3_4_q == 1)
                       Vdq_x = [d1_3 ; d2_3 ; d3_4 ; 7168/2]
                       Vdq_y_m = [d1_3 ; d2_3 ; d3_4 ; 7168/2 ; (y_centroid(3)-1)]
                       Vdq_y_p = [d1_3 ; d2_3 ; d3_4 ; 7168/2 ]
                       miny_m = min(Vdq_y_m(1:5))
                       miny_p = min(Vdq_y_p(1:4))
                       minx = min(Vdq_x(1:4))
                       x_5 = x_centroid(3) - minx
                       x_6 = x_centroid(3) + minx
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   end 
                   
                   if(r_3_5_q == 1)
                       Vdq_x = [d1_3 ; d2_3 ; d3_4 ; 7168/2]
                        Vdq_y_m = [d1_3 ; d2_3 ; d3_4 ; 7168/2]
                       Vdq_y_p = [d1_3 ; d2_3 ; d3_4 ; 7168/2 ; (13824 - y_centroid(3))]
                       miny_m = min(Vdq_y_m(1:4))
                       miny_p = min(Vdq_y_p(1:5))
                       minx = min(Vdq_x(1:4))
                       x_5 = x_centroid(3) - minx
                       x_6 = x_centroid(3) + minx
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   end 
                 
                 % Case for 1,2,3 at the same position
                 
                   if(l_3_1_t == 1)
                       Vdt_x = [d1_3 ; d2_3 ; 7168/2]
                       Vdt_y_m = [d1_3 ; d2_3  ; 7168/2 ; (y_centroid(3)-1)]
                       Vdt_y_p = [d1_3 ; d2_3  ; 7168/2 ]
                       miny_m = min(Vdt_y_m(1:4))
                       miny_p = min(Vdt_y_m(1:3))
                       minx = min(Vdt_x(1:3))
                       x_5 = x_centroid(3) - minx
                       x_6 = x_centroid(3) + minx
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   end   
                       
                   if(l_3_2_t == 1)
                       Vdt_x = [d1_3 ; d2_3 ;  7168/2]
                       Vdt_y_m = [d1_3 ; d2_3 ;  7168/2]
                       Vdt_y_p = [d1_3 ; d2_3 ;  7168/2 ; (13824 - y_centroid(3))]
                       miny_m = min(Vdt_y_m(1:3))
                       miny_p = min(Vdt_y_p(1:4))
                       minx = min(Vdt_x(1:3))
                       x_5 = x_centroid(3) - minx
                       x_6 = x_centroid(3) + minx
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   end 
                   
                   if(r_3_4_t == 1)
                       Vdt_x = [d1_3 ; d2_3 ;  7168/2]
                       Vdt_y_m = [d1_3 ; d2_3 ;  7168/2 ; (y_centroid(3)-1)]
                       Vdt_y_p = [d1_3 ; d2_3 ;  7168/2 ]
                       miny_m = min(Vdt_y_m(1:4))
                       miny_p = min(Vdt_y_p(1:3))
                       minx = min(Vdt_x(1:3))
                       x_5 = x_centroid(3) - minx
                       x_6 = x_centroid(3) + minx
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   end 
                   
                   if(r_3_5_t == 1)
                       Vdt_x = [d1_3 ; d2_3 ;  7168/2]
                        Vdt_y_m = [d1_3 ; d2_3 ;  7168/2]
                       Vdt_y_p = [d1_3 ; d2_3 ;  7168/2 ; (13824 - y_centroid(3))]
                       miny_m = min(Vdt_y_m(1:3))
                       miny_p = min(Vdt_y_p(1:4))
                       minx = min(Vdt_x(1:3))
                       x_5 = x_centroid(3) - minx
                       x_6 = x_centroid(3) + minx
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   end  
                 
                 % Case for 2,3,4 at the same position
                   if(l_3_1_t == 1)
                       Vdt_x = [d3_4 ; d2_3 ; 7168/2]
                       Vdt_y_m = [d3_4 ; d2_3  ; 7168/2 ; (y_centroid(3)-1)]
                       Vdt_y_p = [d3_4 ; d2_3  ; 7168/2 ]
                       miny_m = min(Vdt_y_m(1:4))
                       miny_p = min(Vdt_y_m(1:3))
                       minx = min(Vdt_x(1:3))
                       x_5 = x_centroid(3) - minx
                       x_6 = x_centroid(3) + minx
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   end   
                       
                   if(l_3_2_t == 1)
                       Vdt_x = [d3_4 ; d2_3 ;  7168/2]
                       Vdt_y_m = [d3_4 ; d2_3 ;  7168/2]
                       Vdt_y_p = [d3_4 ; d2_3 ;  7168/2 ; (13824 - y_centroid(3))]
                       miny_m = min(Vdt_y_m(1:3))
                       miny_p = min(Vdt_y_p(1:4))
                       minx = min(Vdt_x(1:3))
                       x_5 = x_centroid(3) - minx
                       x_6 = x_centroid(3) + minx
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   end 
                   
                   if(r_3_4_t == 1)
                       Vdt_x = [d3_4 ; d2_3 ;  7168/2]
                       Vdt_y_m = [d3_4 ; d2_3 ;  7168/2 ; (y_centroid(3)-1)]
                       Vdt_y_p = [d3_4 ; d2_3 ;  7168/2 ]
                       miny_m = min(Vdt_y_m(1:4))
                       miny_p = min(Vdt_y_p(1:3))
                       minx = min(Vdt_x(1:3))
                       x_5 = x_centroid(3) - minx
                       x_6 = x_centroid(3) + minx
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   end 
                   
                   if(r_3_5_t == 1)
                       Vdt_x = [d3_4 ; d2_3 ;  7168/2]
                        Vdt_y_m = [d3_4 ; d2_3 ;  7168/2]
                       Vdt_y_p = [d3_4 ; d2_3 ;  7168/2 ; (13824 - y_centroid(3))]
                       miny_m = min(Vdt_y_m(1:3))
                       miny_p = min(Vdt_y_p(1:4))
                       minx = min(Vdt_x(1:3))
                       x_5 = x_centroid(3) - minx
                       x_6 = x_centroid(3) + minx
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   end    
               % Case fox 1,3 are the same quadrant
                   
                   if(l_3_1_d13 == 1)
                       Vdd_x = [d1_3 ; 7168/2]
                       Vdd_y_m = [d1_3 ; 7168/2 ; (y_centroid(3)-1)]
                       Vdd_y_p = [d1_3 ;  7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_m(1:2))
                       minx = min(Vdd_x(1:2))
                       x_5 = x_centroid(3) - minx
                       x_6 = x_centroid(3) + (7168 - minx)
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   end   
                       
                   if(l_3_2_d13 == 1)
                       Vdd_x = [d1_3 ;  7168/2]
                       Vdd_y_m = [d1_3  ;  7168/2]
                       Vdd_y_p = [d1_3 ;  7168/2 ; (13824 - y_centroid(3))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_5 = x_centroid(3) - minx
                       x_6 = x_centroid(3) + (7168 - minx)
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   end 
                   
                   if(r_3_4_d13 == 1)
                       Vdd_x = [d1_3 ;   7168/2]
                       Vdd_y_m = [d1_3 ;   7168/2 ; (y_centroid(3)-1)]
                       Vdd_y_p = [d1_3 ;   7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_p(1:2))
                       minx = min(Vdd_x(1:2))
                       x_5 = x_centroid(3) - minx
                       x_6 = 10752
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   end 
                   
                   if(r_3_5_d13 == 1)
                       Vdd_x = [d1_3 ;  7168/2]
                        Vdd_y_m = [d1_3 ;  7168/2]
                       Vdd_y_p = [d1_3 ;   7168/2 ; (13824 - y_centroid(3))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_5 = x_centroid(3) - minx
                       x_6 = 10752
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   end
                   
                % Case fox 2,3 are the same quadrant
                   
                   if(l_3_1_d23 == 1)
                       Vdd_x = [d2_3 ; 7168/2]
                       Vdd_y_m = [d2_3;7168/2 ; (y_centroid(3)-1)]
                       Vdd_y_p = [d2_3 ;  7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_m(1:2))
                       minx = min(Vdd_x(1:2))
                       x_5 = x_centroid(3) - minx
                       x_6 = x_centroid(3) + (7168 - minx)
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   end   
                       
                   if(l_3_2_d23 == 1)
                       Vdd_x = [d2_3 ;  7168/2]
                       Vdd_y_m = [d2_3  ;  7168/2]
                       Vdd_y_p = [d2_3 ;  7168/2 ; (13824 - y_centroid(3))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_5 = x_centroid(3) - minx
                       x_6 = x_centroid(3) + (7168 - minx)
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   end 
                   
                   if(r_3_4_d23 == 1)
                       Vdd_x = [d2_3 ;   7168/2]
                       Vdd_y_m = [d2_3 ;   7168/2 ; (y_centroid(3)-1)]
                       Vdd_y_p = [d2_3 ;   7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_p(1:2))
                       minx = min(Vdd_x(1:2))
                       x_5 = x_centroid(3) - minx
                       x_6 = 10752
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   end 
                   
                   if(r_3_5_d23 == 1)
                       Vdd_x = [d2_3 ;  7168/2]
                        Vdd_y_m = [d2_3 ;  7168/2]
                       Vdd_y_p = [d2_3 ;   7168/2 ; (13824 - y_centroid(3))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_5 = x_centroid(3) - minx
                       x_6 = 10752
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   end  
                   
                   % Case fox 3,4 are the same quadrant
                   
                   if(l_3_1_d34 == 1)
                       Vdd_x = [d3_4 ; 7168/2]
                       Vdd_y_m = [d3_4 ; 7168/2 ; (y_centroid(3)-1)]
                       Vdd_y_p = [d3_4 ;  7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_m(1:2))
                       minx = min(Vdd_x(1:2))
                       x_5 = x_centroid(3) - minx
                       x_6 = x_centroid(3) + (7168 - minx)
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   end   
                       
                   if(l_3_2_d34 == 1)
                       Vdd_x = [d3_4 ;  7168/2]
                       Vdd_y_m = [d3_4  ;  7168/2]
                       Vdd_y_p = [d3_4 ;  7168/2 ; (13824 - y_centroid(3))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_5 = x_centroid(3) - minx
                       x_6 = x_centroid(3) + (7168 - minx)
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   end 
                   
                   if(r_3_4_d34 == 1)
                       Vdd_x = [d3_4 ;   7168/2]
                       Vdd_y_m = [d3_4 ;   7168/2 ; (y_centroid(3)-1)]
                       Vdd_y_p = [d3_4 ;   7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_p(1:2))
                       minx = min(Vdd_x(1:2))
                       x_5 = x_centroid(3) - minx
                       x_6 = 10752
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   end 
                   
                   if(r_3_5_d34 == 1)
                       Vdd_x = [d3_4 ;  7168/2]
                        Vdd_y_m = [d3_4 ;  7168/2]
                       Vdd_y_p = [d3_4 ;   7168/2 ; (13824 - y_centroid(3))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_5 = x_centroid(3) - minx
                       x_6 = 10752
                       y_5 = y_centroid(3) - miny_m
                       y_6 = y_centroid(3) + miny_p
                   end 
                if(x_5 < 1)
                    x_5 = 1
                end    
                
                if(x_6 > 10752)
                    x_6 = 10752
                end
                
                if(y_5 < 1)
                    y_5 = 1
                end
                if(y_6 < 1)
                    y_6 = 1
                end
                %The rectangular image is cutted from the imgnucleus image containing the whole cover slip
               imagesphere3 = imgnucleus(y_5:y_6,x_5:x_6);
               % Dimensions of imagesphere1 are determined
               [r3 c3] = size(imagesphere3);
               % An empty matrix is generated
               imagesphereresize3 = zeros(7168:7168);
               % imagesphereresize1 is converted to 8-bit
               imagesphereresize3 = uint8(imagesphereresize3);
               %The empty indices in the imagesphereresize1 matrix are overwritten with imagesphere 1 entries
               imagesphereresize3(1:r3,1:c3)=imagesphere3;
               % imagesphereresize1 is saved to final destination
               newFile3 = regexprep(allfiles(i).name,'NucleusBig',[wellind '03NucleusBig'],'ignorecase');        
               imwrite(imagesphereresize3,[foldername1 '/' newFile3]);
               clear imagesphereresize3;
               clear imagesphere3;
               
               
               % Sphere 4 with smallest value of x_centroid
              
               if(l_4_1 >0 && l_4_1 < 2);
                       x_7 = 1;
                       x_8 = x_centroid(4) + d_4_c;
                       y_7 = 1;
                       y_8 = y_centroid(4) + d_4_c;
               else
               end    
               
               if(l_4_2 >0 && l_4_2 < 2);
                       x_7 = 1;
                       x_8 = x_centroid(4) + d_4_c;
                       y_7 = y_centroid(4) - d_4_c;
                       y_8 = 13824;
               else
               end
               
               if(r_4_4 >0 && r_4_4 < 2);
                       x_7 = x_centroid(4) - d_4_c;
                       x_8 = 10752;
                       y_7 = 1;
                       y_8 = y_centroid(4) + d_4_c;
               else
               end
               
               if(r_4_5 >0 && r_4_5 < 2);
                       x_7 = x_centroid(4) - d_4_c;
                       x_8 = 10752;
                       y_7 = y_centroid(4) - d_4_c;
                       y_8 = 13824;
               else
               end
               
               % Going over all possible distributions of sphere cores
               if(x_centroid(4) ~= x_centroid_c);
               else
                   % 1st permutation
                   if(x_centroid(1) < x_centroid(4) && x_centroid(2) < x_centroid(4) && x_centroid(3) < x_centroid(4));
                       V_1m = [d1_4 ; d2_4 ; d3_4 ; (7168/2)];
                       min1m = min(V_1m);
                       min1p = (7168-min1m);
                   else
                   end
                   % 2nd permutation
                   if(x_centroid(1) > x_centroid(4) && x_centroid(2) > x_centroid(4) && x_centroid(3) > x_centroid(4));
                       V_1p = [d1_4 ; d2_4 ; d3_4 (7168/2)];
                       min1p = min(V_1p);
                       min1m = (7168-min1p);
                   else
                   end
                   %3rd permutation
                   if(x_centroid(1) < x_centroid(4) && x_centroid(2) < x_centroid(4) && x_centroid(3) > x_centroid(4));
                       V_1m = [d1_4 ; d2_4 ; (7168/2)];
                       V_1p = [d3_4 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                       
                   else
                       
                   end
                   %4th permutation
                   if(x_centroid(1) < x_centroid(4) && x_centroid(2) > x_centroid(4) && x_centroid(3) < x_centroid(4));
                       V_1m = [d1_4 ; d3_4 ; (7168/2)];
                       V_1p = [d2_4 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   else
                   end
                   %5th permutation
                   if(x_centroid(1) > x_centroid(4) && x_centroid(2) < x_centroid(4) && x_centroid(3) < x_centroid(4));
                       V_1m = [d2_4 ; d3_4 ; (7168/2)];
                       V_1p = [d1_4 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   else
                   end
                   %6th permutation
                   if(x_centroid(1) < x_centroid(4) && x_centroid(2) > x_centroid(4) && x_centroid(3) > x_centroid(4));
                       V_1m = [d1_4 ; (7168/2)];
                       V_1p = [d2_4 ; d3_4 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   else
                   end
                   %7th permutation
                   if(x_centroid(1) > x_centroid(4) && x_centroid(2) > x_centroid(4) && x_centroid(3) < x_centroid(4));
                       V_1m = [d3_4 ; (7168/2)];
                       V_1p = [d1_4 ; d2_4 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   else
                   end
                   %8th permutation
                   if(x_centroid(1) > x_centroid(4) && x_centroid(2) < x_centroid(4) && x_centroid(3) > x_centroid(4));
                       V_1m = [d2_4 ; (7168/2)];
                       V_1p = [d1_4 ; d3_4 ; (7168/2)];
                       min1p = min(V_1p);
                       min1m = min(V_1m);
                   else
                   end
                   x_7 = x_centroid(4) - min1m 
                   x_8 = x_centroid(4) + min1p
                   y_7 = y_centroid(4) - min1m
                   y_8 = y_centroid(4) + min1p
                   
                   
                  
                   
                   
               end    
               
                % Case for all four spheres in the same spot
                   
                   if(l_4_1_q == 1)
                       Vdq_x = [d1_4 ; d2_4 ; d3_4 ; 7168/2]
                       Vdq_y_m = [d1_4 ; d2_4 ; d3_4 ; 7168/2 ; (y_centroid(4)-1)]
                       Vdq_y_p = [d1_4 ; d2_4 ; d3_4 ; 7168/2 ]
                       miny_m = min(Vdq_y_m(1:5))
                       miny_p = min(Vdq_y_p(1:4))
                       minx = min(Vdq_x(1:4))
                       x_7 = x_centroid(4) - minx 
                       x_8 = x_centroid(4) + minx
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   end   
                       
                   if(l_4_2_q == 1)
                       Vdq_x = [d1_4 ; d2_4 ; d3_4 ; 7168/2]
                       Vdq_y_m = [d1_4 ; d2_4 ; d3_4 ; 7168/2]
                       Vdq_y_p = [d1_4 ; d2_4 ; d3_4 ; 7168/2 ; (13824 - y_centroid(4))]
                       miny_m = min(Vdq_y_m(1:4))
                       miny_p = min(Vdq_y_p(1:5))
                       minx = min(Vdq_x(1:4))
                       x_7 = x_centroid(4) - minx
                       x_8 = x_centroid(4) + minx
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   end 
                   
                   if(r_4_4_q == 1)
                       Vdq_x = [d1_4 ; d2_4 ; d3_4 ; 7168/2]
                       Vdq_y_m = [d1_4 ; d2_4 ; d3_4 ; 7168/2 ; (y_centroid(4)-1)]
                       Vdq_y_p = [d1_4 ; d2_4 ; d3_4 ; 7168/2 ]
                       miny_m = min(Vdq_y_m(1:5))
                       miny_p = min(Vdq_y_p(1:4))
                       minx = min(Vdq_x(1:4))
                       x_7 = x_centroid(4) - minx
                       x_8 = x_centroid(4) + minx
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   end 
                   
                   if(r_4_5_q == 1)
                       Vdq_x = [d1_4 ; d2_4 ; d3_4 ; 7168/2]
                        Vdq_y_m = [d1_4 ; d2_4 ; d3_4 ; 7168/2]
                       Vdq_y_p = [d1_4 ; d2_4 ; d3_4 ; 7168/2 ; (13824 - y_centroid(4))]
                       miny_m = min(Vdq_y_m(1:4))
                       miny_p = min(Vdq_y_p(1:5))
                       minx = min(Vdq_x(1:4))
                       x_7 = x_centroid(4) - minx
                       x_8 = x_centroid(4) + minx
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   end 
                   
                   
                 % Case for 2,3,4 at the same position
                   if(l_4_1_t == 1)
                       Vdt_x = [d3_4 ; d2_4 ; 7168/2]
                       Vdt_y_m = [d3_4 ; d2_4  ; 7168/2 ; (y_centroid(4)-1)]
                       Vdt_y_p = [d3_4 ; d2_4  ; 7168/2 ]
                       miny_m = min(Vdt_y_m(1:4))
                       miny_p = min(Vdt_y_m(1:3))
                       minx = min(Vdt_x(1:3))
                       x_7 = x_centroid(4) - minx
                       x_8 = x_centroid(4) + minx
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   end   
                       
                   if(l_4_2_t == 1)
                       Vdt_x = [d3_4 ; d2_4 ;  7168/2]
                       Vdt_y_m = [d3_4 ; d2_4 ;  7168/2]
                       Vdt_y_p = [d3_4 ; d2_4 ;  7168/2 ; (13824 - y_centroid(4))]
                       miny_m = min(Vdt_y_m(1:3))
                       miny_p = min(Vdt_y_p(1:4))
                       minx = min(Vdt_x(1:3))
                       x_7 = x_centroid(4) - minx
                       x_8 = x_centroid(4) + minx
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   end 
                   
                   if(r_4_4_t == 1)
                       Vdt_x = [d3_4 ; d2_4 ;  7168/2]
                       Vdt_y_m = [d3_4 ; d2_4 ;  7168/2 ; (y_centroid(4)-1)]
                       Vdt_y_p = [d3_4 ; d2_4 ;  7168/2 ]
                       miny_m = min(Vdt_y_m(1:4))
                       miny_p = min(Vdt_y_p(1:3))
                       minx = min(Vdt_x(1:3))
                       x_7 = x_centroid(4) - minx
                       x_8 = x_centroid(4) + minx
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   end 
                   
                   if(r_4_5_t == 1)
                       Vdt_x = [d3_4 ; d2_4 ;  7168/2]
                        Vdt_y_m = [d3_4 ; d2_4 ;  7168/2]
                       Vdt_y_p = [d3_4 ; d2_4 ;  7168/2 ; (13824 - y_centroid(4))]
                       miny_m = min(Vdt_y_m(1:3))
                       miny_p = min(Vdt_y_p(1:4))
                       minx = min(Vdt_x(1:3))
                       x_7 = x_centroid(4) - minx
                       x_8 = x_centroid(4) + minx
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   end   
                    % Case fox 1,4 are the same quadrant
                   
                   if(l_4_1_d14 == 1)
                       Vdd_x = [d1_4 ; 7168/2]
                       Vdd_y_m = [d1_4 ; 7168/2 ; (y_centroid(4)-1)]
                       Vdd_y_p = [d1_4 ;  7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_m(1:2))
                       minx = min(Vdd_x(1:2))
                       x_7 = x_centroid(4) - minx
                       x_8 = x_centroid(4) + (7168 - minx)
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   end   
                       
                   if(l_4_2_d14 == 1)
                       Vdd_x = [d1_4 ;  7168/2]
                       Vdd_y_m = [d1_4  ;  7168/2]
                       Vdd_y_p = [d1_4 ;  7168/2 ; (13824 - y_centroid(4))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_7 = x_centroid(4) - minx
                       x_8 = x_centroid(4) + (7168 - minx)
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   end 
                   
                   if(r_4_4_d14 == 1)
                       Vdd_x = [d1_4 ;   7168/2]
                       Vdd_y_m = [d1_4 ;   7168/2 ; (y_centroid(4)-1)]
                       Vdd_y_p = [d1_4 ;   7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_p(1:2))
                       minx = min(Vdd_x(1:2))
                       x_7 = x_centroid(4) - minx
                       x_8 = 10752
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   end 
                   
                   if(r_4_5_d14 == 1)
                       Vdd_x = [d1_4 ;  7168/2]
                        Vdd_y_m = [d1_4 ;  7168/2]
                       Vdd_y_p = [d1_4 ;   7168/2 ; (13824 - y_centroid(4))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_7 = x_centroid(4) - minx
                       x_8 = 10752
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   end 
                   
                    % Case fox 2,4 are the same quadrant
                   
                   if(l_4_1_d24 == 1)
                       Vdd_x = [d2_4 ; 7168/2]
                       Vdd_y_m = [d2_4 ; 7168/2 ; (y_centroid(4)-1)]
                       Vdd_y_p = [d2_4 ;  7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_m(1:2))
                       minx = min(Vdd_x(1:2))
                       x_7 = x_centroid(4) - minx
                       x_8 = x_centroid(4) + (7168 - minx)
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   end   
                       
                   if(l_4_2_d24 == 1)
                       Vdd_x = [d2_4 ;  7168/2]
                       Vdd_y_m = [d2_4  ;  7168/2]
                       Vdd_y_p = [d2_4 ;  7168/2 ; (13824 - y_centroid(4))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_7 = x_centroid(4) - minx
                       x_8 = x_centroid(4) + (7168 - minx)
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   end 
                   
                   if(r_4_4_d24 == 1)
                       Vdd_x = [d2_4 ;   7168/2]
                       Vdd_y_m = [d2_4 ;   7168/2 ; (y_centroid(4)-1)]
                       Vdd_y_p = [d2_4 ;   7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_p(1:2))
                       minx = min(Vdd_x(1:2))
                       x_7 = x_centroid(4) - minx
                       x_8 = 10752
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   end 
                   
                   if(r_4_5_d24 == 1)
                       Vdd_x = [d2_4 ;  7168/2]
                        Vdd_y_m = [d2_4 ;  7168/2]
                       Vdd_y_p = [d2_4 ;   7168/2 ; (13824 - y_centroid(4))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_7 = x_centroid(4) - minx
                       x_8 = 10752
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   end 
                   
                   % Case fox 3,4 are the same quadrant
                   
                   if(l_4_1_d34 == 1)
                       Vdd_x = [d3_4 ; 7168/2]
                       Vdd_y_m = [d3_4 ; 7168/2 ; (y_centroid(4)-1)]
                       Vdd_y_p = [d3_4 ;  7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_m(1:2))
                       minx = min(Vdd_x(1:2))
                       x_7 = x_centroid(4) - minx
                       x_8 = x_centroid(4) + (7168 - minx)
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   end   
                       
                   if(l_4_2_d34 == 1)
                       Vdd_x = [d3_4 ;  7168/2]
                       Vdd_y_m = [d3_4  ;  7168/2]
                       Vdd_y_p = [d3_4 ;  7168/2 ; (13824 - y_centroid(4))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_7 = x_centroid(4) - minx
                       x_8 = x_centroid(4) + (7168 - minx)
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   end 
                   
                   if(r_4_4_d34 == 1)
                       Vdd_x = [d3_4 ;   7168/2]
                       Vdd_y_m = [d3_4 ;   7168/2 ; (y_centroid(4)-1)]
                       Vdd_y_p = [d3_4 ;   7168/2 ]
                       miny_m = min(Vdd_y_m(1:3))
                       miny_p = min(Vdd_y_p(1:2))
                       minx = min(Vdd_x(1:2))
                       x_7 = x_centroid(4) - minx
                       x_8 = 10752
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   end 
                   
                   if(r_4_5_d34 == 1)
                       Vdd_x = [d3_4 ;  7168/2]
                        Vdd_y_m = [d3_4 ;  7168/2]
                       Vdd_y_p = [d3_4 ;   7168/2 ; (13824 - y_centroid(4))]
                       miny_m = min(Vdd_y_m(1:2))
                       miny_p = min(Vdd_y_p(1:3))
                       minx = min(Vdd_x(1:2))
                       x_7 = x_centroid(4) - minx
                       x_8 = 10752
                       y_7 = y_centroid(4) - miny_m
                       y_8 = y_centroid(4) + miny_p
                   end 
                   
                if(x_7 < 1)
                    x_7 = 1
                end    
                
                if(x_8 > 10752)
                    x_8 = 10752
                end
                
                if(y_7 < 1)
                    y_7 = 1
                end
                if(y_8 < 1)
                    y_8 = 1
                end
                %The rectangular image is cutted from the imgnucleus image containing the whole cover slip
               imagesphere4 = imgnucleus(y_7:y_8,x_7:x_8);
               % Dimensions of imagesphere1 are determined
               [r4 c4] = size(imagesphere4);
               % An empty matrix is generated
               imagesphereresize4 = zeros(7168:7168);
               % imagesphereresize1 is converted to 8-bit
               imagesphereresize4 = uint8(imagesphereresize4);
               %The empty indices in the imagesphereresize1 matrix are overwritten with imagesphere 1 entries
               imagesphereresize4(1:r4,1:c4)=imagesphere4;
               % imagesphereresize1 is saved to final destination
               newFile4 = regexprep(allfiles(i).name,'NucleusBig',[wellind '04NucleusBig'],'ignorecase');        
               imwrite(imagesphereresize4,[foldername1 '/' newFile4]);
               clear imagesphereresize4;
               clear imagesphere4;
               
               imagesphereresize5 = zeros(7168:7168);
               newFile5 = regexprep(allfiles(i).name,'NucleusBig',[wellind '05NucleusBig'],'ignorecase');        
               imwrite(imagesphereresize5,[foldername1 '/' newFile5]);
               clear imagesphereresize5;
               
               if(Neuron_Channel > 0)
                   % Same for neurite channel


                   imagesphere6 = imgneurite(y_1:y_2,x_1:x_2);
                   [r1 c1] = size(imagesphere6);
                   imagesphereresize6 = zeros(7168:7168);
                   imagesphereresize6 = uint8(imagesphereresize6);
                   imagesphereresize6(1:r1,1:c1)=imagesphere6;
                   newFile6 = regexprep(allfiles(i).name,'NucleusBig',[wellind '01NeuriteBig'],'ignorecase');        
                   imwrite(imagesphereresize6,[foldername1 '/' newFile6]);
                   clear imagesphereresize6;
                   clear imagesphere6;

                   imagesphere7 = imgneurite(y_3:y_4,x_3:x_4);
                   [r2 c2] = size(imagesphere7);
                   imagesphereresize7 = zeros(7168:7168);
                   imagesphereresize7 = uint8(imagesphereresize7);
                   imagesphereresize7(1:r2,1:c2)=imagesphere7;
                   newFile7 = regexprep(allfiles(i).name,'NucleusBig',[wellind '02NeuriteBig'],'ignorecase');        
                   imwrite(imagesphereresize7,[foldername1 '/' newFile7]);
                   clear imagesphereresize7;
                   clear imagesphere7;

                   imagesphere8 = imgneurite(y_5:y_6,x_5:x_6);
                   [r3 c3] = size(imagesphere8);
                   imagesphereresize8 = zeros(7168:7168);
                   imagesphereresize8 = uint8(imagesphereresize8);
                   imagesphereresize8(1:r3,1:c3)=imagesphere8;
                   newFile8 = regexprep(allfiles(i).name,'NucleusBig',[wellind '03NeuriteBig'],'ignorecase');        
                   imwrite(imagesphereresize8,[foldername1 '/' newFile8]);
                   clear imagesphereresize8;
                   clear imagesphere8;

                   imagesphere9 = imgneurite(y_7:y_8,x_7:x_8);
                   [r4 c4] = size(imagesphere9);
                   imagesphereresize9 = zeros(7168:7168);
                   imagesphereresize9 = uint8(imagesphereresize9);
                   imagesphereresize9(1:r4,1:c4)=imagesphere9;
                   newFile9 = regexprep(allfiles(i).name,'NucleusBig',[wellind '04NeuriteBig'],'ignorecase');        
                   imwrite(imagesphereresize9,[foldername1 '/' newFile9]);
                   clear imagesphereresize9; 
                   clear imagesphere9;

                   imagesphereresize10 = zeros(7168:7168);
            	   newFile10 = regexprep(allfiles(i).name,'NucleusBig',[wellind '05NeuriteBig'],'ignorecase');        
                   imwrite(imagesphereresize10,[foldername1 '/' newFile10]);
                   clear imagesphereresize10;

               end
               
               if(Oligo_Channel > 0)
                   % Same for Oligos
                   imagesphere11 = imgoligo(y_1:y_2,x_1:x_2);
                   [r1 c1] = size(imagesphere11);
                   imagesphereresize11 = zeros(7168:7168);
                   imagesphereresize11 = uint8(imagesphereresize11);
                   imagesphereresize11(1:r1,1:c1)=imagesphere11;
                   newFile11 = regexprep(allfiles(i).name,'NucleusBig',[wellind '01OligoBig'],'ignorecase');        
                   imwrite(imagesphereresize11,[foldername1 '/' newFile11]);
                   clear imagesphereresize11;
                   clear imagesphere11;

                   imagesphere12 = imgoligo(y_3:y_4,x_3:x_4);
                   [r2 c2] = size(imagesphere12);
                   imagesphereresize12 = zeros(7168:7168);
                   imagesphereresize12 = uint8(imagesphereresize12);
                   imagesphereresize12(1:r2,1:c2)=imagesphere12;
                   newFile12 = regexprep(allfiles(i).name,'NucleusBig',[wellind '02OligoBig'],'ignorecase');        
                   imwrite(imagesphereresize12,[foldername1 '/' newFile12]);
                   clear imagesphereresize12;
                   clear imagesphere12;

                   imagesphere13 = imgoligo(y_5:y_6,x_5:x_6);
                   [r3 c3] = size(imagesphere13);
                   imagesphereresize13 = zeros(7168:7168);
                   imagesphereresize13 = uint8(imagesphereresize13);
                   imagesphereresize13(1:r3,1:c3)=imagesphere13;
                   newFile13 = regexprep(allfiles(i).name,'NucleusBig',[wellind '03OligoBig'],'ignorecase');        
                   imwrite(imagesphereresize13,[foldername1 '/' newFile13]);
                   clear imagesphereresize13;
                   clear imagesphere13;

                   imagesphere14 = imgoligo(y_7:y_8,x_7:x_8);
                   [r4 c4] = size(imagesphere14);
                   imagesphereresize14 = zeros(7168:7168);
                   imagesphereresize14 = uint8(imagesphereresize14);
                   imagesphereresize14(1:r4,1:c4)=imagesphere14;
                   newFile14 = regexprep(allfiles(i).name,'NucleusBig',[wellind '04OligoBig'],'ignorecase');        
                   imwrite(imagesphereresize14,[foldername1 '/' newFile14]);
                   clear imagesphereresize14; 
                   clear imagesphere14;

                   imagesphereresize15 = zeros(7168:7168);
            	   newFile15 = regexprep(allfiles(i).name,'NucleusBig',[wellind '05OligoBig'],'ignorecase');        
                   imwrite(imagesphereresize15,[foldername1 '/' newFile15]);
                   clear imagesphereresize15;
               end
               
               if(Astro_Channel >0)
                   % Same for Astros
                   imagesphere16 = imgastro(y_1:y_2,x_1:x_2);
                   [r1 c1] = size(imagesphere16);
                   imagesphereresize16 = zeros(7168:7168);
                   imagesphereresize16 = uint8(imagesphereresize16);
                   imagesphereresize16(1:r1,1:c1)=imagesphere16;
                   newFile16 = regexprep(allfiles(i).name,'NucleusBig',[wellind '01AstroBig'],'ignorecase');        
                   imwrite(imagesphereresize16,[foldername1 '/' newFile16]);
                   clear imagesphereresize16;
                   clear imagesphere16;

                   imagesphere17 = imgastro(y_3:y_4,x_3:x_4);
                   [r2 c2] = size(imagesphere17);
                   imagesphereresize17 = zeros(7168:7168);
                   imagesphereresize17 = uint8(imagesphereresize17);
                   imagesphereresize17(1:r2,1:c2)=imagesphere17;
                   newFile17 = regexprep(allfiles(i).name,'NucleusBig',[wellind '02AstroBig'],'ignorecase');        
                   imwrite(imagesphereresize17,[foldername1 '/' newFile17]);
                   clear imagesphereresize17;
                   clear imagesphere17;

                   imagesphere18 = imgastro(y_5:y_6,x_5:x_6);
                   [r3 c3] = size(imagesphere18);
                   imagesphereresize18 = zeros(7168:7168);
                   imagesphereresize18 = uint8(imagesphereresize18);
                   imagesphereresize18(1:r3,1:c3)=imagesphere18;
                   newFile18 = regexprep(allfiles(i).name,'NucleusBig',[wellind '03AstroBig'],'ignorecase');        
                   imwrite(imagesphereresize18,[foldername1 '/' newFile18]);
                   clear imagesphereresize18;
                   clear imagesphere18;

                   imagesphere19 = imgastro(y_7:y_8,x_7:x_8);
                   [r4 c4] = size(imagesphere19);
                   imagesphereresize19 = zeros(7168:7168);
                   imagesphereresize19 = uint8(imagesphereresize19);
                   imagesphereresize19(1:r4,1:c4)=imagesphere19;
                   newFile19 = regexprep(allfiles(i).name,'NucleusBig',[wellind '04AstroBig'],'ignorecase');        
                   imwrite(imagesphereresize19,[foldername1 '/' newFile19]);
                   clear imagesphereresize19; 
                   clear imagesphere19;

                   imagesphereresize20 = zeros(7168:7168);
            	   newFile20 = regexprep(allfiles(i).name,'NucleusBig',[wellind '05AstroBig'],'ignorecase');        
                   imwrite(imagesphereresize20,[foldername1 '/' newFile20]);
                   clear imagesphereresize20;
               end
            else
                
            end  
            
            if(s_L >= 5);    
               % Extracts the x and y coordinates from s  
               x_centroid(1) = s(1).Centroid(1);
               y_centroid(1) = s(1).Centroid(2);
               x_centroid(2) = s(2).Centroid(1);
               y_centroid(2) = s(2).Centroid(2);
               x_centroid(3) = s(3).Centroid(1);
               y_centroid(3) = s(3).Centroid(2);
               x_centroid(4) = s(4).Centroid(1);
               y_centroid(4) = s(4).Centroid(2);
               x_centroid(5) = s(5).Centroid(1);
               y_centroid(5) = s(5).Centroid(2);
               % Calculates the distance between the centroids of the
               % neurosphere an all boarders of the cover slip      
               
               
               
               
               
               % Distance between centroid(1) and centroid(2) 
               d1_2 = ((x_centroid(1)-x_centroid(2))^2+(y_centroid(1)-y_centroid(2))^2)^0.5; 
               % Distance between centroid(1) and centroid(3)
               d1_3 = ((x_centroid(1)-x_centroid(3))^2+(y_centroid(1)-y_centroid(3))^2)^0.5;
               % Distance between centroid(1) and centroid(4)
               d1_4 = ((x_centroid(1)-x_centroid(4))^2+(y_centroid(1)-y_centroid(4))^2)^0.5;
               % Distance between centroid(1) and centroid(5)
               d1_5 = ((x_centroid(1)-x_centroid(5))^2+(y_centroid(1)-y_centroid(5))^2)^0.5;
               % Distance between centroid(2) and centroid(3)
               d2_3 = ((x_centroid(3)-x_centroid(2))^2+(y_centroid(3)-y_centroid(2))^2)^0.5;
               % Distance between centroid(2) and centroid(4)
               d2_4 = ((x_centroid(4)-x_centroid(2))^2+(y_centroid(4)-y_centroid(2))^2)^0.5;
               % Distance between centroid(2) and centroid(5)
               d2_5 = ((x_centroid(5)-x_centroid(2))^2+(y_centroid(5)-y_centroid(2))^2)^0.5;
               % Distance between centroid(3) and centroid(4)
               d3_4 = ((x_centroid(4)-x_centroid(3))^2+(y_centroid(4)-y_centroid(3))^2)^0.5;
               % Distance between centroid(3) and centroid(5)
               d3_5 = ((x_centroid(5)-x_centroid(3))^2+(y_centroid(5)-y_centroid(3))^2)^0.5;
               % Distance between centroid(4) and centroid(5)
               d4_5 = ((x_centroid(4)-x_centroid(5))^2+(y_centroid(4)-y_centroid(5))^2)^0.5;
               %Distances to rims for sphere 1
               
               d1_x_1 = ((x_centroid(1)-1)^2+(y_centroid(1)-y_centroid(1))^2)^0.5
               d1_x10752 = ((10752 - x_centroid(1)-1)+(y_centroid(1)-y_centroid(1))^2)^0.5
               d1_y0 = ((x_centroid(1)-x_centroid(1))^2+(y_centroid(1)-1)^2)^0.5
               d1_y13824 = ((x_centroid(1)-x_centroid(1))^2+(13824-y_centroid(1))^2)^0.5
               
               
               
         
               
               
                              
               %Sphere 1 and 2:
               if(d1_2<MinimumDistance);
                   S12 = 1;
                   % Calculate line equation for d_12 
                   m_12 = (y_centroid(2)-y_centroid(1))/(x_centroid(2)-x_centroid(1));
                   b_12 = y_centroid(1)-(m_12*x_centroid(1));
                   % 2) Calculate Coordinate of d_12/2
                   x_c_12 = x_centroid(1) + (x_centroid(2)-x_centroid(1))/2;
                   y_c_12 = m_12*x_c_12 + b_12
                   % Calculate max distance in x from sphere 2 to 1:
                   x_12_1 = x_centroid(1) - (maxaddedlength);
                   x_12_2 = x_c_12
                   %Introduce ratio of x/y (to rule out cases where two
                   %spheres have a very small differences in x or y but not
                   %in the other coordinate
                   xy_1 = abs(x_centroid(2)-x_centroid(1))/abs(y_centroid(2)-y_centroid(1))
                   yx_1 = abs(y_centroid(2)-y_centroid(1))/abs(x_centroid(2)-x_centroid(1))
                   if(xy_1 < minxy_ratio && d1_2 > mindist)
                       x_c_12 = 1000000;
                       y_c_12 = 1000000;
                       x_12_1 = x_centroid(1) - (maxaddedlength);
                       x_12_2 = x_centroid(1) + (maxaddedlength);
                       y_12_1 = y_centroid(1)-(maxaddedlength);
                       y_12_2 = y_centroid(1)+(maxaddedlength);
                   end 
                   if(yx_1 < minxy_ratio && d1_2 > mindist)
                       x_c_12 = 1000000;
                       y_c_12 = 1000000;
                       x_12_1 = x_centroid(1) - (maxaddedlength);
                       x_12_2 = x_centroid(1) + (maxaddedlength);
                       y_12_1 = y_centroid(1)-(maxaddedlength);
                       y_12_2 = y_centroid(1)+(maxaddedlength);
                   end
                   if(y_c_12 > y_centroid(1))
                       y_12_1 = y_centroid(1)-(maxaddedlength)
                       y_12_2 = y_c_12
                   else 
                       y_12_1 = y_c_12
                       y_12_2 = y_centroid(1)+(maxaddedlength)
                   end    
               else
                   S12 = 0;
                   x_c_12 = 1000000;
                   y_c_12 = 1000000;
                   x_12_1 = x_centroid(1) - (maxaddedlength);
                   x_12_2 = x_centroid(1) + (maxaddedlength);
                   y_12_1 = y_centroid(1)-(maxaddedlength);
                   y_12_2 = y_centroid(1)+(maxaddedlength);
               end
               
               %Sphere 1 and 3:
               if(d1_3<MinimumDistance);
                   S13 = 1;
                   % Calculate line equation for d_13 
                   m_13 = (y_centroid(3)-y_centroid(1))/(x_centroid(3)-x_centroid(1));
                   b_13 = y_centroid(1)-(m_13*x_centroid(1));
                   % 2) Calculate Coordinate of d_13/2
                   x_c_13 = x_centroid(1) + (x_centroid(3)-x_centroid(1))/2;
                   y_c_13 = m_13*x_c_13 + b_13
                   % Calculate max distance in x from sphere 2 to 1:
                   x_13_1 = x_centroid(1) - (maxaddedlength);
                   x_13_2 = x_c_13
                   %Introduce ratio of x/y (to rule out cases where two
                   %spheres have a very small differences in x or y but not
                   %in the other coordinate
                   xy_2 = abs(x_centroid(3)-x_centroid(1))/abs(y_centroid(3)-y_centroid(1))
                   yx_2 = abs(y_centroid(3)-y_centroid(1))/abs(x_centroid(3)-x_centroid(1))
                   if(xy_2 < minxy_ratio && d1_3 > mindist)
                       x_c_13 = 1000000;
                       y_c_13 = 1000000;
                       x_13_1 = x_centroid(1) - (maxaddedlength);
                       x_13_2 = x_centroid(1) + (maxaddedlength);
                       y_13_1 = y_centroid(1)-(maxaddedlength);
                       y_13_2 = y_centroid(1)+(maxaddedlength);
                   end 
                   if(yx_2 < minxy_ratio && d1_3 > mindist)
                       x_c_13 = 1000000;
                       y_c_13 = 1000000;
                       x_13_1 = x_centroid(1) - (maxaddedlength);
                       x_13_2 = x_centroid(1) + (maxaddedlength);
                       y_13_1 = y_centroid(1)-(maxaddedlength);
                       y_13_2 = y_centroid(1)+(maxaddedlength);
                   end
                   if(y_c_13 > y_centroid(1))
                       y_13_1 = y_centroid(1)-(maxaddedlength)
                       y_13_2 = y_c_13
                   else 
                       y_13_1 = y_c_13
                       y_13_2 = y_centroid(1)+(maxaddedlength)
                   end    
               else
                   S13 = 0;
                   x_c_13 = 1000000;
                   y_c_13 = 1000000;
                   x_13_1 = x_centroid(1) - (maxaddedlength);
                   x_13_2 = x_centroid(1) + (maxaddedlength);
                   y_13_1 = y_centroid(1)-(maxaddedlength);
                   y_13_2 = y_centroid(1)+(maxaddedlength);
               end
               
               %Sphere 1 and 4:
               if(d1_4<MinimumDistance);
                   S14 = 1;
                   % Calculate line equation for d_14 
                   m_14 = (y_centroid(4)-y_centroid(1))/(x_centroid(4)-x_centroid(1));
                   b_14 = y_centroid(1)-(m_14*x_centroid(1));
                   % 2) Calculate Coordinate of d_14/2
                   x_c_14 = x_centroid(1) + (x_centroid(4)-x_centroid(1))/2;
                   y_c_14 = m_14*x_c_14 + b_14
                   % Calculate max distance in x from sphere 2 to 1:
                   x_14_1 = x_centroid(1) - (maxaddedlength);
                   x_14_2 = x_c_14
                   %Introduce ratio of x/y (to rule out cases where two
                   %spheres have a very small differences in x or y but not
                   %in the other coordinate
                   xy_3 = abs(x_centroid(4)-x_centroid(1))/abs(y_centroid(4)-y_centroid(1))
                   yx_3 = abs(y_centroid(4)-y_centroid(1))/abs(x_centroid(4)-x_centroid(1))
                   if(xy_3 < minxy_ratio && d1_4 > mindist)
                       x_c_14 = 1000000;
                       y_c_14 = 1000000;
                       x_14_1 = x_centroid(1) - (maxaddedlength);
                       x_14_2 = x_centroid(1) + (maxaddedlength);
                       y_14_1 = y_centroid(1)-(maxaddedlength);
                       y_14_2 = y_centroid(1)+(maxaddedlength);
                   end   
                   if(yx_3 < minxy_ratio && d1_4 > mindist)
                       x_c_14 = 1000000;
                       y_c_14 = 1000000;
                       x_14_1 = x_centroid(1) - (maxaddedlength);
                       x_14_2 = x_centroid(1) + (maxaddedlength);
                       y_14_1 = y_centroid(1)-(maxaddedlength);
                       y_14_2 = y_centroid(1)+(maxaddedlength);
                   end
                   if(y_c_14 > y_centroid(1))
                       y_14_1 = y_centroid(1)-(maxaddedlength)
                       y_14_2 = y_c_14
                   else 
                       y_14_1 = y_c_14
                       y_14_2 = y_centroid(1)+(maxaddedlength)
                   end    
               else
                   S14 = 0;
                   x_c_14 = 1000000;
                   y_c_14 = 1000000;
                   x_14_1 = x_centroid(1) - (maxaddedlength);
                   x_14_2 = x_centroid(1) + (maxaddedlength);
                   y_14_1 = y_centroid(1)-(maxaddedlength);
                   y_14_2 = y_centroid(1)+(maxaddedlength);
               end
               
               %Sphere 1 and 5:
               if(d1_5<MinimumDistance);
                   S15 = 1;
                   % Calculate line equation for d_15 
                   m_15 = (y_centroid(5)-y_centroid(1))/(x_centroid(5)-x_centroid(1));
                   b_15 = y_centroid(1)-(m_15*x_centroid(1));
                   % 2) Calculate Coordinate of d_15/2
                   x_c_15 = x_centroid(1) + (x_centroid(5)-x_centroid(1))/2;
                   y_c_15 = m_15*x_c_15 + b_15
                   % Calculate max distance in x from sphere 2 to 1:
                   x_15_1 = x_centroid(1) - (maxaddedlength);
                   x_15_2 = x_c_15
                   %Introduce ratio of x/y (to rule out cases where two
                   %spheres have a very small differences in x or y but not
                   %in the other coordinate
                   xy_4 = abs(x_centroid(5)-x_centroid(1))/abs(y_centroid(5)-y_centroid(1))
                   yx_4 = abs(y_centroid(5)-y_centroid(1))/abs(x_centroid(5)-x_centroid(1))
                   if(xy_4 < minxy_ratio && d1_5 > mindist)
                       x_c_15 = 1000000;
                       y_c_15 = 1000000;
                       x_15_1 = x_centroid(1) - (maxaddedlength);
                       x_15_2 = x_centroid(1) + (maxaddedlength);
                       y_15_1 = y_centroid(1)-(maxaddedlength);
                       y_15_2 = y_centroid(1)+(maxaddedlength);
                   end  
                   if(yx_4 < minxy_ratio && d1_5 > mindist)
                       x_c_15 = 1000000;
                       y_c_15 = 1000000;
                       x_15_1 = x_centroid(1) - (maxaddedlength);
                       x_15_2 = x_centroid(1) + (maxaddedlength);
                       y_15_1 = y_centroid(1)-(maxaddedlength);
                       y_15_2 = y_centroid(1)+(maxaddedlength);
                   end  
                   if(y_c_15 > y_centroid(1))
                       y_15_1 = y_centroid(1)-(maxaddedlength)
                       y_15_2 = y_c_15
                   else 
                       y_15_1 = y_c_15
                       y_15_2 = y_centroid(1)+(maxaddedlength)
                   end    
               else
                   S15 = 0;
                   x_c_15 = 1000000;
                   y_c_15 = 1000000;
                   x_15_1 = x_centroid(1) - (maxaddedlength);
                   x_15_2 = x_centroid(1) + (maxaddedlength);
                   y_15_1 = y_centroid(1)-(maxaddedlength);
                   y_15_2 = y_centroid(1)+(maxaddedlength);
               end
               
             
               
               min_x_1 = x_centroid(1) - (maxaddedlength);
               
               V_x6 = [x_c_12;x_c_13;x_c_14;x_c_15];
               min_x_2 = min(V_x6(1:4));
               
                            
               if(min_x_2 == 1000000)
                   min_x_2 = x_centroid(1) + (maxaddedlength);
               end    
                                             
               if(y_c_12 < 1000000 || y_c_13 < 1000000 || y_c_14 < 1000000 || y_c_15 < 1000000)
                   
                   if(y_c_12 - y_centroid(1)>0 && y_c_12 - y_centroid(1)<500000);
                       y_c_12_s = 1000000;
                   else
                       y_c_12_s = y_c_12; 
                   end 
                   if(y_c_13 - y_centroid(1)>0 && y_c_13 - y_centroid(1)<500000);
                       y_c_13_s = 1000000;
                   else
                       y_c_13_s = y_c_13;     
                   end
                   if(y_c_14 - y_centroid(1)>0 && y_c_14 - y_centroid(1)<500000);
                       y_c_14_s = 1000000;
                   else
                       y_c_14_s = y_c_14;     
                   end
                   if(y_c_15 - y_centroid(1)>0 && y_c_15 - y_centroid(1)<500000);
                       y_c_15_s = 1000000;
                   else
                       y_c_15_s = y_c_15;    
                   end
                   V_y5=[y_c_12_s;y_c_13_s;y_c_14_s;y_c_15_s];
                   min_y_1 = min(V_y5(1:4));
                   if(min_y_1 == 1000000)
                       min_y_1 = y_centroid(1)- (maxaddedlength);
                   end
                   
               else
                   min_y_1 = y_centroid(1)- (maxaddedlength);
               end
               
               if(y_c_12 < 1000000 || y_c_13 < 1000000 || y_c_14 < 1000000 || y_c_15 < 1000000)
                   if(y_c_12 - y_centroid(1)<0 && y_c_12 - y_centroid(1)<500000);
                       y_c_12_s = 1000000;
                   else
                       y_c_12_s = y_c_12;
                   end    
                   if(y_c_13 - y_centroid(1)<0 && y_c_13 - y_centroid(1)<500000);
                       y_c_13_s = 1000000;
                   else
                       y_c_13_s = y_c_13;
                   end
                   if(y_c_14 - y_centroid(1)<0 && y_c_14 - y_centroid(1)<500000);
                       y_c_14_s = 1000000;
                   else
                       y_c_14_s = y_c_14;
                   end
                   if(y_c_15 - y_centroid(1)<0 && y_c_15 - y_centroid(1)<500000);
                       y_c_15_s = 1000000;
                   else
                       y_c_15_s = y_c_15;
                   end
                   V_y6=[y_c_12_s;y_c_13_s;y_c_14_s;y_c_15_s];
                   min_y_2 = min(V_y6(1:4));
                   if(min_y_2 == 1000000)
                       min_y_2 = y_centroid(1)+ (maxaddedlength);
                   end    
                   
               else
                   min_y_2 = y_centroid(1)+ (maxaddedlength);
               end
               
                                  
               if(min_x_1<1)
                   x_1 = 1
               else
                   x_1 = min_x_1;
               end
               
               if(min_x_2>10752)
                   x_2 = 10752
               else
                   x_2 = min_x_2;
               end
               
               if(min_y_1<1)
                   y_1 = 1
               else
                   y_1 = min_y_1;
               end
               
               if(min_y_2>13824)
                   y_2 = 13824
               else
                   y_2 = min_y_2;
               end
                     
                    
               
               %The rectangular image is cutted from the imgnucleus image containing the whole cover slip
               imagesphere1 = imgnucleus(y_1:y_2,x_1:x_2);
               % Dimensions of imagesphere1 are determined
               [r1 c1] = size(imagesphere1);
               % An empty matrix is generated
               imagesphereresize1 = zeros(7168:7168);
               % imagesphereresize1 is converted to 8-bit
               imagesphereresize1 = uint8(imagesphereresize1);
               %The empty indices in the imagesphereresize1 matrix are overwritten with imagesphere 1 entries
               imagesphereresize1(1:r1,1:c1)=imagesphere1;
               % imagesphereresize1 is saved to final destination
               newFile1 = regexprep(allfiles(i).name,'NucleusBig',[wellind '01NucleusBig'],'ignorecase');        
               imwrite(imagesphereresize1,[foldername1 '/' newFile1]);
               clear imagesphereresize1;
               clear imagesphere1;
               
               % Same for sphere core 2
              if(d1_2<MinimumDistance);
                   S21 = 1;
                   % Calculate line equation for d_12 
                   m_12 = (y_centroid(2)-y_centroid(1))/(x_centroid(2)-x_centroid(1));
                   b_12 = y_centroid(1)-(m_12*x_centroid(1));
                   % 2) Calculate Coordinate of d_12/2
                   x_c_12 = x_centroid(1) + (x_centroid(2)-x_centroid(1))/2;
                   y_c_12 = m_12*x_c_12 + b_12
                   % Calculate max distance in x from sphere 2 to 1:
                   x_12_1 = x_c_12;
                   x_12_2 = x_centroid(2) + (maxaddedlength);
                   %Introduce ratio of x/y (to rule out cases where two
                   %spheres have a very small differences in x or y but not
                   %in the other coordinate
                   xy_1 = abs(x_centroid(2)-x_centroid(1))/abs(y_centroid(2)-y_centroid(1))
                   yx_1 = abs(y_centroid(2)-y_centroid(1))/abs(x_centroid(2)-x_centroid(1))
                   if(xy_1 < minxy_ratio && d1_2 > mindist)
                       x_c_12 = 1000000;
                       y_c_12 = 1000000;
                       x_12_1 = x_centroid(2) - (maxaddedlength);
                       x_12_2 = x_centroid(2) + (maxaddedlength);
                       y_12_1 = y_centroid(2)-(maxaddedlength);
                       y_12_2 = y_centroid(2)+(maxaddedlength);
                   end  
                   if(yx_1 < minxy_ratio && d1_2 > mindist)
                       x_c_12 = 1000000;
                       y_c_12 = 1000000;
                       x_12_1 = x_centroid(2) - (maxaddedlength);
                       x_12_2 = x_centroid(2) + (maxaddedlength);
                       y_12_1 = y_centroid(2)-(maxaddedlength);
                       y_12_2 = y_centroid(2)+(maxaddedlength);
                   end 
                   if(y_c_12 > y_centroid(2))
                       y_12_1 = y_centroid(2)-(maxaddedlength)
                       y_12_2 = y_c_12
                   else 
                       y_12_1 = y_c_12
                       y_12_2 = y_centroid(2)+(maxaddedlength)
                   end    
               else
                   S12 = 0;
                   x_c_12 = 1000000;
                   y_c_12 = 1000000;
                   x_12_1 = x_centroid(2) - (maxaddedlength);
                   x_12_2 = x_centroid(2) + (maxaddedlength);
                   y_12_1 = y_centroid(2)-(maxaddedlength);
                   y_12_2 = y_centroid(2)+(maxaddedlength);
              end
               
              if(d2_3<MinimumDistance);
                   S23 = 1;
                   % Calculate line equation for d_12 
                   m_23 = (y_centroid(3)-y_centroid(2))/(x_centroid(3)-x_centroid(2));
                   b_23 = y_centroid(2)-(m_23*x_centroid(2));
                   % 2) Calculate Coordinate of d_12/2
                   x_c_23 = x_centroid(2) + (x_centroid(3)-x_centroid(2))/2;
                   y_c_23 = m_23*x_c_23 + b_23
                   % Calculate max distance in x from sphere 2 to 1:
                   x_23_1 = x_centroid(2) - (maxaddedlength);
                   x_23_2 = x_c_23;
                   xy_2 = abs(x_centroid(2)-x_centroid(3))/abs(y_centroid(2)-y_centroid(3))
                   yx_2 = abs(y_centroid(2)-y_centroid(3))/abs(x_centroid(2)-x_centroid(3))
                   if(xy_2 < minxy_ratio && d2_3 > mindist)
                       x_c_23 = 1000000;
                       y_c_23 = 1000000;
                       x_23_1 = x_centroid(2) - (maxaddedlength);
                       x_23_2 = x_centroid(2) + (maxaddedlength);
                       y_23_1 = y_centroid(2)-(maxaddedlength);
                       y_23_2 = y_centroid(2)+(maxaddedlength);
                   end
                   if(yx_2 < minxy_ratio && d2_3 > mindist)
                       x_c_23 = 1000000;
                       y_c_23 = 1000000;
                       x_23_1 = x_centroid(2) - (maxaddedlength);
                       x_23_2 = x_centroid(2) + (maxaddedlength);
                       y_23_1 = y_centroid(2)-(maxaddedlength);
                       y_23_2 = y_centroid(2)+(maxaddedlength);
                   end
                   if(y_c_23 > y_centroid(2))
                       y_23_1 = y_centroid(2)-(maxaddedlength)
                       y_23_2 = y_c_23
                   else 
                       y_23_1 = y_c_23
                       y_23_2 = y_centroid(2)+(maxaddedlength)
                   end    
               else
                   S12 = 0;
                   x_c_23 = 1000000;
                   y_c_23 = 1000000;
                   x_23_1 = x_centroid(2) - (maxaddedlength);
                   x_23_2 = x_centroid(2) + (maxaddedlength);
                   y_23_1 = y_centroid(2)-(maxaddedlength);
                   y_23_2 = y_centroid(2)+(maxaddedlength);
              end
              
              if(d2_4<MinimumDistance);
                   S24 = 1;
                   % Calculate line equation for d_12 
                   m_24 = (y_centroid(4)-y_centroid(2))/(x_centroid(4)-x_centroid(2));
                   b_24 = y_centroid(2)-(m_24*x_centroid(2));
                   % 2) Calculate Coordinate of d_12/2
                   x_c_24 = x_centroid(2) + (x_centroid(4)-x_centroid(2))/2;
                   y_c_24 = m_24*x_c_24 + b_24
                   % Calculate max distance in x from sphere 2 to 1:
                   x_24_1 = x_centroid(2) - (maxaddedlength);
                   x_24_2 = x_c_24;
                   xy_3 = abs(x_centroid(2)-x_centroid(4))/abs(y_centroid(2)-y_centroid(4))
                   yx_3 = abs(y_centroid(2)-y_centroid(4))/abs(x_centroid(2)-x_centroid(4))
                   if(xy_3 < minxy_ratio && d2_4 > mindist)
                       x_c_24 = 1000000;
                       y_c_24 = 1000000;
                       x_24_1 = x_centroid(2) - (maxaddedlength);
                       x_24_2 = x_centroid(2) + (maxaddedlength);
                       y_24_1 = y_centroid(2)-(maxaddedlength);
                       y_24_2 = y_centroid(2)+(maxaddedlength);
                   end   
                   if(yx_3 < minxy_ratio && d2_4 > mindist)
                       x_c_24 = 1000000;
                       y_c_24 = 1000000;
                       x_24_1 = x_centroid(2) - (maxaddedlength);
                       x_24_2 = x_centroid(2) + (maxaddedlength);
                       y_24_1 = y_centroid(2)-(maxaddedlength);
                       y_24_2 = y_centroid(2)+(maxaddedlength);
                   end  
                   if(y_c_24 > y_centroid(2))
                       y_24_1 = y_centroid(2)-(maxaddedlength)
                       y_24_2 = y_c_24
                   else 
                       y_24_1 = y_c_24
                       y_24_2 = y_centroid(2)+(maxaddedlength)
                   end    
               else
                   S24 = 0;
                   x_c_24 = 1000000;
                   y_c_24 = 1000000;
                   x_24_1 = x_centroid(2) - (maxaddedlength);
                   x_24_2 = x_centroid(2) + (maxaddedlength);
                   y_24_1 = y_centroid(2)-(maxaddedlength);
                   y_24_2 = y_centroid(2)+(maxaddedlength);
              end
               if(d2_5<MinimumDistance);
                   S25 = 1;
                   % Calculate line equation for d_12 
                   m_25 = (y_centroid(5)-y_centroid(2))/(x_centroid(5)-x_centroid(2));
                   b_25 = y_centroid(2)-(m_25*x_centroid(2));
                   % 2) Calculate Coordinate of d_12/2
                   x_c_25 = x_centroid(2) + (x_centroid(5)-x_centroid(2))/2;
                   y_c_25 = m_25*x_c_25 + b_25
                   % Calculate max distance in x from sphere 2 to 1:
                   x_25_1 = x_centroid(2) - (maxaddedlength);
                   x_25_2 = x_c_25;
                   xy_4 = abs(x_centroid(2)-x_centroid(5))/abs(y_centroid(2)-y_centroid(5))
                   yx_4 = abs(y_centroid(2)-y_centroid(5))/abs(x_centroid(2)-x_centroid(5))
                   if(xy_4 < minxy_ratio && d2_5 > mindist)
                       x_c_25 = 1000000;
                       y_c_25 = 1000000;
                       x_25_1 = x_centroid(2) - (maxaddedlength);
                       x_25_2 = x_centroid(2) + (maxaddedlength);
                       y_25_1 = y_centroid(2)-(maxaddedlength);
                       y_25_2 = y_centroid(2)+(maxaddedlength);
                   end  
                   if(yx_4 < minxy_ratio && d2_5 > mindist)
                       x_c_25 = 1000000;
                       y_c_25 = 1000000;
                       x_25_1 = x_centroid(2) - (maxaddedlength);
                       x_25_2 = x_centroid(2) + (maxaddedlength);
                       y_25_1 = y_centroid(2)-(maxaddedlength);
                       y_25_2 = y_centroid(2)+(maxaddedlength);
                   end
                   if(y_c_25 > y_centroid(2))
                       y_25_1 = y_centroid(2)-(maxaddedlength)
                       y_25_2 = y_c_25
                   else 
                       y_25_1 = y_c_25
                       y_25_2 = y_centroid(2)+(maxaddedlength)
                   end    
               else
                   S25 = 0;
                   x_c_25 = 1000000;
                   y_c_25 = 1000000;
                   x_25_1 = x_centroid(2) - (maxaddedlength);
                   x_25_2 = x_centroid(2) + (maxaddedlength);
                   y_25_1 = y_centroid(2)-(maxaddedlength);
                   y_25_2 = y_centroid(2)+(maxaddedlength);
               end
               
               if(x_c_12 < 1000000)
                   min_x_3 = x_c_12;
               else
                   min_x_3 = x_centroid(2) - (maxaddedlength);
               end    
               
               V_x6 = [x_c_23;x_c_24;x_c_25];
               min_x_4 = min(V_x6(1:3));
               
               if(min_x_4 == 1000000)
                   min_x_4 = x_centroid(2) + (maxaddedlength);
               end    
                                             
               if(y_c_12 < 1000000 || y_c_23 < 1000000 || y_c_24 < 1000000 || y_c_25 < 1000000)
                   
                   if(y_c_12 - y_centroid(2)>0 && y_c_12 - y_centroid(2)<500000);
                       y_c_12_s = 1000000;
                   else
                       y_c_12_s = y_c_12; 
                   end 
                   if(y_c_23 - y_centroid(2)>0 && y_c_23 - y_centroid(2)<500000);
                       y_c_23_s = 1000000;
                   else
                       y_c_23_s = y_c_23;     
                   end
                   if(y_c_24 - y_centroid(2)>0 && y_c_24 - y_centroid(2)<500000);
                       y_c_24_s = 1000000;
                   else
                       y_c_24_s = y_c_24;     
                   end
                   if(y_c_25 - y_centroid(2)>0 && y_c_25 - y_centroid(2)<500000);
                       y_c_25_s = 1000000;
                   else
                       y_c_25_s = y_c_25;    
                   end
                   V_y5=[y_c_12_s;y_c_23_s;y_c_24_s;y_c_25_s];
                   min_y_3 = min(V_y5(1:4));
                   if(min_y_3 == 1000000)
                       min_y_3 = y_centroid(2)- (maxaddedlength);
                   end
                   
               else
                   min_y_3 = y_centroid(2)- (maxaddedlength);
               end
               
               if(y_c_12 < 1000000 || y_c_23 < 1000000 || y_c_24 < 1000000 || y_c_25 < 1000000)
                   if(y_c_12 - y_centroid(2)<0 && y_c_12 - y_centroid(2)<500000);
                       y_c_12_s = 1000000;
                   else
                       y_c_12_s = y_c_12;
                   end    
                   if(y_c_23 - y_centroid(2)<0 && y_c_23 - y_centroid(2)<500000);
                       y_c_23_s = 1000000;
                   else
                       y_c_23_s = y_c_23;
                   end
                   if(y_c_24 - y_centroid(2)<0 && y_c_24 - y_centroid(2)<500000);
                       y_c_24_s = 1000000;
                   else
                       y_c_24_s = y_c_24;
                   end
                   if(y_c_25 - y_centroid(2)<0 && y_c_25 - y_centroid(2)<500000);
                       y_c_25_s = 1000000;
                   else
                       y_c_25_s = y_c_25;
                   end
                   V_y6=[y_c_12_s;y_c_23_s;y_c_24_s;y_c_25_s];
                   min_y_4 = min(V_y6(1:4));
                   if(min_y_4 == 1000000)
                       min_y_4 = y_centroid(2)+ (maxaddedlength);
                   end    
                   
               else
                   min_y_4 = y_centroid(2)+ (maxaddedlength);
               end
                   
               if(min_x_3<1)
                   x_3 = 1
               else
                   x_3 = min_x_3;
               end
               
               if(min_x_4>10752)
                   x_4 = 10752
               else
                   x_4 = min_x_4;
               end
               
               if(min_y_3<1)
                   y_3 = 1
               else
                   y_3 = min_y_3;
               end
               
               if(min_y_4>13824)
                   y_4 = 13824
               else
                   y_4 = min_y_4;
               end
               
               imagesphere2 = imgnucleus(y_3:y_4,x_3:x_4);
               [r2 c2] = size(imagesphere2);
               imagesphereresize2 = zeros(7168:7168);
               imagesphereresize2 = uint8(imagesphereresize2);
               imagesphereresize2(1:r2,1:c2)=imagesphere2;
               newFile2 = regexprep(allfiles(i).name,'NucleusBig',[wellind '02NucleusBig'],'ignorecase');        
               imwrite(imagesphereresize2,[foldername1 '/' newFile2]);
               clear imagesphereresize2;
               clear imagesphere2;
               
               % Same for sphere core 3
               
               if(d1_3<MinimumDistance);
                   S31 = 1;
                   % Calculate line equation for d_12 
                   m_13 = (y_centroid(3)-y_centroid(1))/(x_centroid(3)-x_centroid(1));
                   b_13 = y_centroid(1)-(m_13*x_centroid(1));
                   % 2) Calculate Coordinate of d_12/2
                   x_c_13 = x_centroid(1) + (x_centroid(3)-x_centroid(1))/2;
                   y_c_13 = m_13*x_c_13 + b_13
                   % Calculate max distance in x from sphere 2 to 1:
                   x_13_1 = x_c_13;
                   x_13_2 = x_centroid(3) + (maxaddedlength);
                   %Introduce ratio of x/y (to rule out cases where two
                   %spheres have a very small differences in x or y but not
                   %in the other coordinate
                   xy_1 = abs(x_centroid(3)-x_centroid(1))/abs(y_centroid(3)-y_centroid(1))
                   yx_1 = abs(y_centroid(3)-y_centroid(1))/abs(x_centroid(3)-x_centroid(1))
                   if(xy_1 < minxy_ratio && d1_3 > mindist)
                       x_c_13 = 1000000;
                       y_c_13 = 1000000;
                       x_13_1 = x_centroid(3) - (maxaddedlength);
                       x_13_2 = x_centroid(3) + (maxaddedlength);
                       y_13_1 = y_centroid(3)-(maxaddedlength);
                       y_13_2 = y_centroid(3)+(maxaddedlength);
                   end  
                   if(yx_1 < minxy_ratio && d1_3 > mindist)
                       x_c_13 = 1000000;
                       y_c_13 = 1000000;
                       x_13_1 = x_centroid(3) - (maxaddedlength);
                       x_13_2 = x_centroid(3) + (maxaddedlength);
                       y_13_1 = y_centroid(3)-(maxaddedlength);
                       y_13_2 = y_centroid(3)+(maxaddedlength);
                   end  
                   if(y_c_13 > y_centroid(3))
                       y_13_1 = y_centroid(3)-(maxaddedlength)
                       y_13_2 = y_c_13
                   else 
                       y_13_1 = y_c_13
                       y_13_2 = y_centroid(3)+(maxaddedlength)
                   end    
               else
                   S31 = 0;
                   x_c_13 = 1000000;
                   y_c_13 = 1000000;
                   x_13_1 = x_centroid(3) - (maxaddedlength);
                   x_13_2 = x_centroid(3) + (maxaddedlength);
                   y_13_1 = y_centroid(3)-(maxaddedlength);
                   y_13_2 = y_centroid(3)+(maxaddedlength);
              end
               
              if(d2_3<MinimumDistance);
                   S32 = 1;
                   % Calculate line equation for d_12 
                   m_23 = (y_centroid(3)-y_centroid(2))/(x_centroid(3)-x_centroid(2));
                   b_23 = y_centroid(2)-(m_23*x_centroid(2));
                   % 2) Calculate Coordinate of d_12/2
                   x_c_23 = x_centroid(2) + (x_centroid(3)-x_centroid(2))/2;
                   y_c_23 = m_23*x_c_23 + b_23
                   % Calculate max distance in x from sphere 2 to 1:
                   x_23_1 = x_c_23;
                   x_23_2 = x_centroid(3) + (maxaddedlength);
                   xy_2 = abs(x_centroid(3)-x_centroid(2))/abs(y_centroid(3)-y_centroid(2))
                   yx_2 = abs(y_centroid(3)-y_centroid(2))/abs(x_centroid(3)-x_centroid(2))
                   if(xy_2 < minxy_ratio && d2_3 > mindist)
                       x_c_23 = 1000000;
                       y_c_23 = 1000000;
                       x_23_1 = x_centroid(3) - (maxaddedlength);
                       x_23_2 = x_centroid(3) + (maxaddedlength);
                       y_23_1 = y_centroid(3)-(maxaddedlength);
                       y_23_2 = y_centroid(3)+(maxaddedlength);
                   end  
                   if(yx_2 < minxy_ratio && d2_3 > mindist)
                       x_c_23 = 1000000;
                       y_c_23 = 1000000;
                       x_23_1 = x_centroid(3) - (maxaddedlength);
                       x_23_2 = x_centroid(3) + (maxaddedlength);
                       y_23_1 = y_centroid(3)-(maxaddedlength);
                       y_23_2 = y_centroid(3)+(maxaddedlength);
                   end
                   if(y_c_23 > y_centroid(3))
                       y_23_1 = y_centroid(3)-(maxaddedlength)
                       y_23_2 = y_c_23
                   else 
                       y_23_1 = y_c_23
                       y_23_2 = y_centroid(3)+(maxaddedlength)
                   end    
               else
                   S32 = 0;
                   x_c_23 = 1000000;
                   y_c_23 = 1000000;
                   x_23_1 = x_centroid(3) - (maxaddedlength);
                   x_23_2 = x_centroid(3) + (maxaddedlength);
                   y_23_1 = y_centroid(3)-(maxaddedlength);
                   y_23_2 = y_centroid(3)+(maxaddedlength);
              end
              
              if(d3_4<MinimumDistance);
                   S34 = 1;
                   % Calculate line equation for d_12 
                   m_34 = (y_centroid(4)-y_centroid(3))/(x_centroid(4)-x_centroid(3));
                   b_34 = y_centroid(3)-(m_34*x_centroid(3));
                   % 2) Calculate Coordinate of d_12/2
                   x_c_34 = x_centroid(3) + (x_centroid(4)-x_centroid(3))/2;
                   y_c_34 = m_34*x_c_34 + b_34
                   % Calculate max distance in x from sphere 2 to 1:
                   x_34_1 = x_centroid(3) - (maxaddedlength);
                   x_34_2 = x_c_34;
                   xy_3 = abs(x_centroid(3)-x_centroid(4))/abs(y_centroid(3)-y_centroid(4))
                   yx_3 = abs(y_centroid(3)-y_centroid(4))/abs(x_centroid(3)-x_centroid(4))
                   if(xy_3 < minxy_ratio && d3_4 > mindist)
                       x_c_34 = 1000000;
                       y_c_34 = 1000000;
                       x_34_1 = x_centroid(3) - (maxaddedlength);
                       x_34_2 = x_centroid(3) + (maxaddedlength);
                       y_34_1 = y_centroid(3)-(maxaddedlength);
                       y_34_2 = y_centroid(3)+(maxaddedlength);
                   end  
                   if(yx_3 < minxy_ratio && d3_4 > mindist)
                       x_c_34 = 1000000;
                       y_c_34 = 1000000;
                       x_34_1 = x_centroid(3) - (maxaddedlength);
                       x_34_2 = x_centroid(3) + (maxaddedlength);
                       y_34_1 = y_centroid(3)-(maxaddedlength);
                       y_34_2 = y_centroid(3)+(maxaddedlength);
                   end
                   if(y_c_34 > y_centroid(3))
                       y_34_1 = y_centroid(3)-(maxaddedlength)
                       y_34_2 = y_c_34
                   else 
                       y_34_1 = y_c_34
                       y_34_2 = y_centroid(3)+(maxaddedlength)
                   end    
               else
                   S34 = 0;
                   x_c_34 = 1000000;
                   y_c_34 = 1000000;
                   x_34_1 = x_centroid(3) - (maxaddedlength);
                   x_34_2 = x_centroid(3) + (maxaddedlength);
                   y_34_1 = y_centroid(3)-(maxaddedlength);
                   y_34_2 = y_centroid(3)+(maxaddedlength);
              end
               if(d3_5<MinimumDistance);
                   S35 = 1;
                   % Calculate line equation for d_12 
                   m_35 = (y_centroid(5)-y_centroid(3))/(x_centroid(5)-x_centroid(3));
                   b_35 = y_centroid(3)-(m_35*x_centroid(3));
                   % 2) Calculate Coordinate of d_12/2
                   x_c_35 = x_centroid(3) + (x_centroid(5)-x_centroid(3))/2;
                   y_c_35 = m_35*x_c_35 + b_35
                   % Calculate max distance in x from sphere 2 to 1:
                   x_35_1 = x_centroid(3) - (maxaddedlength);
                   x_35_2 = x_c_35;
                   xy_4 = abs(x_centroid(3)-x_centroid(5))/abs(y_centroid(3)-y_centroid(5))
                   yx_4 = abs(y_centroid(3)-y_centroid(5))/abs(x_centroid(3)-x_centroid(5))
                   if(xy_4 < minxy_ratio && d3_5 > mindist)
                       x_c_35 = 1000000;
                       y_c_35 = 1000000;
                       x_35_1 = x_centroid(3) - (maxaddedlength);
                       x_35_2 = x_centroid(3) + (maxaddedlength);
                       y_35_1 = y_centroid(3)-(maxaddedlength);
                       y_35_2 = y_centroid(3)+(maxaddedlength);
                   end  
                   if(yx_4 < minxy_ratio && d3_5 > mindist)
                       x_c_35 = 1000000;
                       y_c_35 = 1000000;
                       x_35_1 = x_centroid(3) - (maxaddedlength);
                       x_35_2 = x_centroid(3) + (maxaddedlength);
                       y_35_1 = y_centroid(3)-(maxaddedlength);
                       y_35_2 = y_centroid(3)+(maxaddedlength);
                   end
                   if(y_c_35 > y_centroid(3))
                       y_35_1 = y_centroid(3)-(maxaddedlength)
                       y_35_2 = y_c_35
                   else 
                       y_35_1 = y_c_35
                       y_35_2 = y_centroid(3)+(maxaddedlength)
                   end    
               else
                   S35 = 0;
                   x_c_35 = 1000000;
                   y_c_35 = 1000000;
                   x_35_1 = x_centroid(3) - (maxaddedlength);
                   x_35_2 = x_centroid(3) + (maxaddedlength);
                   y_35_1 = y_centroid(3)-(maxaddedlength);
                   y_35_2 = y_centroid(3)+(maxaddedlength);
               end
                              
               if(x_c_13 >0 && x_c_23>0 && x_c_13 <1000000 && x_c_23<1000000 )
                   V_x5=[x_c_13;x_c_23];
                   min_x_5 = min(V_x5(1:2));
               else
                   if(x_c_13>0 && x_c_13 <1000000)
                       min_x_5 = x_c_13
                   else
                       if(x_c_23>0 && x_c_23<1000000)
                       min_x_5 = x_c_23
                       else
                           min_x_5 = x_centroid(3)-(maxaddedlength);
                       end
                   end
               end 
               
               if(x_c_34 >0 && x_c_35>0 && x_c_34 <1000000 && x_c_35<1000000)
                   V_x6=[x_c_34;x_c_35];
                   min_x_6 = min(V_x6(1:2));
               else
                   if(x_c_34>0 && x_c_34 <1000000)
                       min_x_6 = x_c_34
                   else
                       if(x_c_35>0 && x_c_35<1000000)
                       min_x_6 = x_c_35
                       else
                           min_x_6 = x_centroid(3)+(maxaddedlength);
                       end
                   end
               end 
               
               
                                             
               if(y_c_13 < 1000000 || y_c_23 < 1000000 || y_c_34 < 1000000 || y_c_35 < 1000000)
                   
                   if(y_c_13 - y_centroid(3)>0 && y_c_13 - y_centroid(3)<500000);
                       y_c_13_s = 1000000;
                   else
                       y_c_13_s = y_c_13; 
                   end 
                   if(y_c_23 - y_centroid(3)>0 && y_c_23 - y_centroid(3)<500000);
                       y_c_23_s = 1000000;
                   else
                       y_c_23_s = y_c_23;     
                   end
                   if(y_c_34 - y_centroid(3)>0 && y_c_34 - y_centroid(3)<500000);
                       y_c_34_s = 1000000;
                   else
                       y_c_34_s = y_c_34;     
                   end
                   if(y_c_35 - y_centroid(3)>0 && y_c_35 - y_centroid(3)<500000);
                       y_c_35_s = 1000000;
                   else
                       y_c_35_s = y_c_35;    
                   end
                   V_y5=[y_c_13_s;y_c_23_s;y_c_34_s;y_c_35_s];
                   min_y_5 = min(V_y5(1:4));
                   if(min_y_5 == 1000000)
                       min_y_5 = y_centroid(3)- (maxaddedlength);
                   end
                   
               else
                   min_y_5 = y_centroid(3)- (maxaddedlength);
               end
               
               if(y_c_13 < 1000000 || y_c_23 < 1000000 || y_c_34 < 1000000 || y_c_35 < 1000000)
                   if(y_c_13 - y_centroid(3)<0 && y_c_13 - y_centroid(3)<500000);
                       y_c_13_s = 1000000;
                   else
                       y_c_13_s = y_c_13;
                   end    
                   if(y_c_23 - y_centroid(3)<0 && y_c_23 - y_centroid(3)<500000);
                       y_c_23_s = 1000000;
                   else
                       y_c_23_s = y_c_23;
                   end
                   if(y_c_34 - y_centroid(3)<0 && y_c_34 - y_centroid(3)<500000);
                       y_c_34_s = 1000000;
                   else
                       y_c_34_s = y_c_34;
                   end
                   if(y_c_35 - y_centroid(3)<0 && y_c_35 - y_centroid(3)<500000);
                       y_c_35_s = 1000000;
                   else
                       y_c_35_s = y_c_35;
                   end
                   V_y6=[y_c_13_s;y_c_23_s;y_c_34_s;y_c_35_s];
                   min_y_6 = min(V_y6(1:4));
                   if(min_y_6 == 1000000)
                       min_y_6 = y_centroid(3)+ (maxaddedlength);
                   end    
                   
               else
                   min_y_6 = y_centroid(3)+ (maxaddedlength);
               end
                   
               if(min_x_5<1)
                   x_5 = 1
               else
                   x_5 = min_x_5;
               end
               
               if(min_x_6>10752)
                   x_6 = 10752
               else
                   x_6 = min_x_6;
               end
               
               if(min_y_5<1)
                   y_5 = 1
               else
                   y_5 = min_y_5;
               end
               
               if(min_y_6>13824)
                   y_6 = 13824
               else
                   y_6 = min_y_6;
               end
               
               
               
               
               
               
               imagesphere3 = imgnucleus(y_5:y_6,x_5:x_6);
               [r3 c3] = size(imagesphere3);
               imagesphereresize3 = zeros(7168:7168);
               imagesphereresize3 = uint8(imagesphereresize3);
               imagesphereresize3(1:r3,1:c3)=imagesphere3;
               newFile3 = regexprep(allfiles(i).name,'NucleusBig',[wellind '03NucleusBig'],'ignorecase');        
               imwrite(imagesphereresize3,[foldername1 '/' newFile3]);
               clear imagesphereresize3;
               clear imagesphere3;
               
               % Same for sphere core 4
               
               if(d1_4<MinimumDistance);
                   S41 = 1;
                   % Calculate line equation for d_12 
                   m_14 = (y_centroid(4)-y_centroid(1))/(x_centroid(4)-x_centroid(1));
                   b_14 = y_centroid(1)-(m_14*x_centroid(1));
                   % 2) Calculate Coordinate of d_12/2
                   x_c_14 = x_centroid(1) + (x_centroid(4)-x_centroid(1))/2;
                   y_c_14 = m_14*x_c_14 + b_14
                   % Calculate max distance in x from sphere 2 to 1:
                   x_14_1 = x_c_14;
                   x_14_2 = x_centroid(4) + (maxaddedlength);
                   %Introduce ratio of x/y (to rule out cases where two
                   %spheres have a very small differences in x or y but not
                   %in the other coordinate
                   xy_1 = abs(x_centroid(4)-x_centroid(1))/abs(y_centroid(4)-y_centroid(1))
                   yx_1 = abs(y_centroid(4)-y_centroid(1))/abs(x_centroid(4)-x_centroid(1))
                   if(xy_1 < minxy_ratio && d1_4 > mindist)
                       x_c_14 = 1000000;
                       y_c_14 = 1000000;
                       x_14_1 = x_centroid(4) - (maxaddedlength);
                       x_14_2 = x_centroid(4) + (maxaddedlength);
                       y_14_1 = y_centroid(4)-(maxaddedlength);
                       y_14_2 = y_centroid(4)+(maxaddedlength);
                   end  
                   if(yx_1 < minxy_ratio && d1_4 > mindist)
                       x_c_14 = 1000000;
                       y_c_14 = 1000000;
                       x_14_1 = x_centroid(4) - (maxaddedlength);
                       x_14_2 = x_centroid(4) + (maxaddedlength);
                       y_14_1 = y_centroid(4)-(maxaddedlength);
                       y_14_2 = y_centroid(4)+(maxaddedlength);
                   end  
                   if(y_c_14 > y_centroid(4))
                       y_14_1 = y_centroid(4)-(maxaddedlength)
                       y_14_2 = y_c_14
                   else 
                       y_14_1 = y_c_14
                       y_14_2 = y_centroid(4)+(maxaddedlength)
                   end    
               else
                   S41 = 0;
                   x_c_14 = 1000000;
                   y_c_14 = 1000000;
                   x_14_1 = x_centroid(4) - (maxaddedlength);
                   x_14_2 = x_centroid(4) + (maxaddedlength);
                   y_14_1 = y_centroid(4)-(maxaddedlength);
                   y_14_2 = y_centroid(4)+(maxaddedlength);
              end
               
              if(d2_4<MinimumDistance);
                   S42 = 1;
                   % Calculate line equation for d_12 
                   m_24 = (y_centroid(4)-y_centroid(2))/(x_centroid(4)-x_centroid(2));
                   b_24 = y_centroid(2)-(m_24*x_centroid(2));
                   % 2) Calculate Coordinate of d_12/2
                   x_c_24 = x_centroid(2) + (x_centroid(4)-x_centroid(2))/2;
                   y_c_24 = m_24*x_c_24 + b_24
                   % Calculate max distance in x from sphere 2 to 1:
                   x_24_1 = x_c_24;
                   x_24_2 = x_centroid(4) + (maxaddedlength);
                   xy_2 = abs(x_centroid(4)-x_centroid(2))/abs(y_centroid(4)-y_centroid(2))
                   yx_2 = abs(y_centroid(4)-y_centroid(2))/abs(x_centroid(4)-x_centroid(2))
                   if(xy_2 < minxy_ratio && d2_4 > mindist)
                       x_c_24 = 1000000;
                       y_c_24 = 1000000;
                       x_24_1 = x_centroid(4) - (maxaddedlength);
                       x_24_2 = x_centroid(4) + (maxaddedlength);
                       y_24_1 = y_centroid(4)-(maxaddedlength);
                       y_24_2 = y_centroid(4)+(maxaddedlength);
                   end  
                   if(yx_2 < minxy_ratio && d2_4 > mindist)
                       x_c_24 = 1000000;
                       y_c_24 = 1000000;
                       x_24_1 = x_centroid(4) - (maxaddedlength);
                       x_24_2 = x_centroid(4) + (maxaddedlength);
                       y_24_1 = y_centroid(4)-(maxaddedlength);
                       y_24_2 = y_centroid(4)+(maxaddedlength);
                   end
                   if(y_c_24 > y_centroid(4))
                       y_24_1 = y_centroid(4)-(maxaddedlength)
                       y_24_2 = y_c_24
                   else 
                       y_24_1 = y_c_24
                       y_24_2 = y_centroid(4)+(maxaddedlength)
                   end    
               else
                   S42 = 0;
                   x_c_24 = 1000000;
                   y_c_24 = 1000000;
                   x_24_1 = x_centroid(4) - (maxaddedlength);
                   x_24_2 = x_centroid(4) + (maxaddedlength);
                   y_24_1 = y_centroid(4)-(maxaddedlength);
                   y_24_2 = y_centroid(4)+(maxaddedlength);
              end
              
              if(d3_4<MinimumDistance);
                   S43 = 1;
                   % Calculate line equation for d_12 
                   m_34 = (y_centroid(4)-y_centroid(3))/(x_centroid(4)-x_centroid(3));
                   b_34 = y_centroid(3)-(m_34*x_centroid(3));
                   % 2) Calculate Coordinate of d_12/2
                   x_c_34 = x_centroid(3) + (x_centroid(4)-x_centroid(3))/2;
                   y_c_34 = m_34*x_c_34 + b_34
                   % Calculate max distance in x from sphere 2 to 1:
                   x_34_1 = x_c_34;
                   x_34_2 = x_centroid(4) - (maxaddedlength);
                   xy_3 = abs(x_centroid(3)-x_centroid(4))/abs(y_centroid(3)-y_centroid(4))
                   yx_3 = abs(y_centroid(3)-y_centroid(4))/abs(x_centroid(3)-x_centroid(4))
                   if(xy_3 < minxy_ratio && d3_4 > mindist)
                       x_c_34 = 1000000;
                       y_c_34 = 1000000;
                       x_34_1 = x_centroid(4) - (maxaddedlength);
                       x_34_2 = x_centroid(4) + (maxaddedlength);
                       y_34_1 = y_centroid(4)-(maxaddedlength);
                       y_34_2 = y_centroid(4)+(maxaddedlength);
                   end  
                   if(yx_3 < minxy_ratio && d3_4 > mindist)
                       x_c_34 = 1000000;
                       y_c_34 = 1000000;
                       x_34_1 = x_centroid(4) - (maxaddedlength);
                       x_34_2 = x_centroid(4) + (maxaddedlength);
                       y_34_1 = y_centroid(4)-(maxaddedlength);
                       y_34_2 = y_centroid(4)+(maxaddedlength);
                   end
                   if(y_c_34 > y_centroid(4))
                       y_34_1 = y_centroid(4)-(maxaddedlength)
                       y_34_2 = y_c_34
                   else 
                       y_34_1 = y_c_34
                       y_34_2 = y_centroid(4)+(maxaddedlength)
                   end    
               else
                   S34 = 0;
                   x_c_34 = 1000000;
                   y_c_34 = 1000000;
                   x_34_1 = x_centroid(4) - (maxaddedlength);
                   x_34_2 = x_centroid(4) + (maxaddedlength);
                   y_34_1 = y_centroid(4)-(maxaddedlength);
                   y_34_2 = y_centroid(4)+(maxaddedlength);
              end
               if(d4_5<MinimumDistance);
                   S54 = 1;
                   % Calculate line equation for d_12 
                   m_45 = (y_centroid(5)-y_centroid(4))/(x_centroid(5)-x_centroid(4));
                   b_45 = y_centroid(4)-(m_45*x_centroid(4));
                   % 2) Calculate Coordinate of d_12/2
                   x_c_45 = x_centroid(4) + (x_centroid(5)-x_centroid(4))/2;
                   y_c_45 = m_45*x_c_45 + b_45
                   % Calculate max distance in x from sphere 2 to 1:
                   x_45_1 = x_centroid(4) - (maxaddedlength);
                   x_45_2 = x_c_45;
                   xy_4 = abs(x_centroid(4)-x_centroid(5))/abs(y_centroid(4)-y_centroid(5))
                   yx_4 = abs(y_centroid(4)-y_centroid(5))/abs(x_centroid(4)-x_centroid(5))
                   if(xy_4 < minxy_ratio && d4_5 > mindist)
                       x_c_45 = 1000000;
                       y_c_45 = 1000000;
                       x_45_1 = x_centroid(4) - (maxaddedlength);
                       x_45_2 = x_centroid(4) + (maxaddedlength);
                       y_45_1 = y_centroid(4)-(maxaddedlength);
                       y_45_2 = y_centroid(4)+(maxaddedlength);
                   end  
                   if(yx_4 < minxy_ratio && d4_5 > mindist)
                       x_c_45 = 1000000;
                       y_c_45 = 1000000;
                       x_45_1 = x_centroid(4) - (maxaddedlength);
                       x_45_2 = x_centroid(4) + (maxaddedlength);
                       y_45_1 = y_centroid(4)-(maxaddedlength);
                       y_45_2 = y_centroid(4)+(maxaddedlength);
                   end
                   if(y_c_45 > y_centroid(4))
                       y_45_1 = y_centroid(4)-(maxaddedlength)
                       y_45_2 = y_c_45
                   else 
                       y_45_1 = y_c_45
                       y_45_2 = y_centroid(4)+(maxaddedlength)
                   end    
               else
                   S45 = 0;
                   x_c_45 = 1000000;
                   y_c_45 = 1000000;
                   x_45_1 = x_centroid(4) - (maxaddedlength);
                   x_45_2 = x_centroid(4) + (maxaddedlength);
                   y_45_1 = y_centroid(4)-(maxaddedlength);
                   y_45_2 = y_centroid(4)+(maxaddedlength);
               end
                              
               V_x7 = [x_c_14;x_c_24;x_c_35];
               min_x_7 = min(V_x7(1:3));
               if(min_x_7 ==1000000)
                   min_x_7 = x_centroid(4)-(maxaddedlength);
               end    
               min_x_8 = x_c_45;
               if(min_x_8 == 1000000)
                   min_x_8 = x_centroid(4) + (maxaddedlength);
               end    
               
                                             
               if(y_c_14 < 1000000 || y_c_24 < 1000000 || y_c_34 < 1000000 || y_c_45 < 1000000)
                   
                   if(y_c_14 - y_centroid(4)>0 && y_c_14 - y_centroid(4)<500000);
                       y_c_14_s = 1000000;
                   else
                       y_c_14_s = y_c_14; 
                   end 
                   if(y_c_24 - y_centroid(4)>0 && y_c_24 - y_centroid(4)<500000);
                       y_c_24_s = 1000000;
                   else
                       y_c_24_s = y_c_24;     
                   end
                   if(y_c_34 - y_centroid(4)>0 && y_c_34 - y_centroid(4)<500000);
                       y_c_34_s = 1000000;
                   else
                       y_c_34_s = y_c_34;     
                   end
                   if(y_c_45 - y_centroid(4)>0 && y_c_45 - y_centroid(4)<500000);
                       y_c_45_s = 1000000;
                   else
                       y_c_45_s = y_c_45;    
                   end
                   V_y5=[y_c_14_s;y_c_24_s;y_c_34_s;y_c_45_s];
                   min_y_7 = min(V_y5(1:4));
                   if(min_y_7 == 1000000)
                       min_y_7 = y_centroid(4)- (maxaddedlength);
                   end
                   
               else
                   min_y_7 = y_centroid(4)- (maxaddedlength);
               end
               
               if(y_c_14 < 1000000 || y_c_24 < 1000000 || y_c_34 < 1000000 || y_c_45 < 1000000)
                   if(y_c_14 - y_centroid(4)<0 && y_c_14 - y_centroid(4)<500000);
                       y_c_14_s = 1000000;
                   else
                       y_c_14_s = y_c_14;
                   end    
                   if(y_c_24 - y_centroid(4)<0 && y_c_24 - y_centroid(4)<500000);
                       y_c_24_s = 1000000;
                   else
                       y_c_24_s = y_c_24;
                   end
                   if(y_c_34 - y_centroid(4)<0 && y_c_34 - y_centroid(4)<500000);
                       y_c_34_s = 1000000;
                   else
                       y_c_34_s = y_c_34;
                   end
                   if(y_c_45 - y_centroid(4)<0 && y_c_45 - y_centroid(4)<500000);
                       y_c_45_s = 1000000;
                   else
                       y_c_45_s = y_c_45;
                   end
                   V_y6=[y_c_14_s;y_c_24_s;y_c_34_s;y_c_45_s];
                   min_y_8 = min(V_y6(1:4));
                   if(min_y_8 == 1000000)
                       min_y_8 = y_centroid(4)+ (maxaddedlength);
                   end    
                   
               else
                   min_y_8 = y_centroid(4)+ (maxaddedlength);
               end
                   
               if(min_x_7<1)
                   x_7 = 1
               else
                   x_7 = min_x_7;
               end
               
               if(min_x_8>10752)
                   x_8 = 10752
               else
                   x_8 = min_x_8;
               end
               
               if(min_y_7<1)
                   y_7 = 1
               else
                   y_7 = min_y_7;
               end
               
               if(min_y_8>13824)
                   y_8 = 13824
               else
                   y_8 = min_y_8;
               end
               
               
               
               imagesphere4 = imgnucleus(y_7:y_8,x_7:x_8);
               [r4 c4] = size(imagesphere4);
               imagesphereresize4 = zeros(7168:7168);
               imagesphereresize4 = uint8(imagesphereresize4);
               imagesphereresize4(1:r4,1:c4)=imagesphere4;
               newFile4 = regexprep(allfiles(i).name,'NucleusBig',[wellind '04NucleusBig'],'ignorecase');        
               imwrite(imagesphereresize4,[foldername1 '/' newFile4]);
               clear imagesphereresize4; 
               clear imagesphere4;

               if(d1_5<MinimumDistance);
                   S51 = 1;
                   % Calculate line equation for d_12 
                   m_15 = (y_centroid(5)-y_centroid(1))/(x_centroid(5)-x_centroid(1));
                   b_15 = y_centroid(1)-(m_15*x_centroid(1));
                   % 2) Calculate Coordinate of d_12/2
                   x_c_15 = x_centroid(1) + (x_centroid(5)-x_centroid(1))/2;
                   y_c_15 = m_15*x_c_15 + b_15
                   % Calculate max distance in x from sphere 2 to 1:
                   x_15_1 = x_c_15;
                   x_15_2 = x_centroid(5) + (maxaddedlength);
                   %Introduce ratio of x/y (to rule out cases where two
                   %spheres have a very small differences in x or y but not
                   %in the other coordinate
                   xy_1 = abs(x_centroid(5)-x_centroid(1))/abs(y_centroid(5)-y_centroid(1))
                   yx_1 = abs(y_centroid(5)-y_centroid(1))/abs(x_centroid(5)-x_centroid(1))
                   if(xy_1 < minxy_ratio && d1_5 > mindist)
                       x_c_15 = 1000000;
                       y_c_15 = 1000000;
                       x_15_1 = x_centroid(5) - (maxaddedlength);
                       x_15_2 = x_centroid(5) + (maxaddedlength);
                       y_15_1 = y_centroid(5)-(maxaddedlength);
                       y_15_2 = y_centroid(5)+(maxaddedlength);
                   end  
                   if(yx_1 < minxy_ratio && d1_5 > mindist)
                       x_c_15 = 1000000;
                       y_c_15 = 1000000;
                       x_15_1 = x_centroid(5) - (maxaddedlength);
                       x_15_2 = x_centroid(5) + (maxaddedlength);
                       y_15_1 = y_centroid(5)-(maxaddedlength);
                       y_15_2 = y_centroid(5)+(maxaddedlength);
                   end  
                   if(y_c_15 > y_centroid(5))
                       y_15_1 = y_centroid(5)-(maxaddedlength)
                       y_15_2 = y_c_15
                   else 
                       y_15_1 = y_c_15
                       y_15_2 = y_centroid(5)+(maxaddedlength)
                   end    
               else
                   S51 = 0;
                   x_c_15 = 1000000;
                   y_c_15 = 1000000;
                   x_15_1 = x_centroid(5) - (maxaddedlength);
                   x_15_2 = x_centroid(5) + (maxaddedlength);
                   y_15_1 = y_centroid(5)-(maxaddedlength);
                   y_15_2 = y_centroid(5)+(maxaddedlength);
              end
               
              if(d2_5<MinimumDistance);
                   S52 = 1;
                   % Calculate line equation for d_12 
                   m_25 = (y_centroid(5)-y_centroid(2))/(x_centroid(5)-x_centroid(2));
                   b_25 = y_centroid(2)-(m_25*x_centroid(2));
                   % 2) Calculate Coordinate of d_12/2
                   x_c_25 = x_centroid(2) + (x_centroid(5)-x_centroid(2))/2;
                   y_c_25 = m_25*x_c_25 + b_25
                   % Calculate max distance in x from sphere 2 to 1:
                   x_25_1 = x_c_25;
                   x_25_2 = x_centroid(5) + (maxaddedlength);
                   xy_2 = abs(x_centroid(5)-x_centroid(2))/abs(y_centroid(5)-y_centroid(2))
                   yx_2 = abs(y_centroid(5)-y_centroid(2))/abs(x_centroid(5)-x_centroid(2))
                   if(xy_2 < minxy_ratio && d2_5 > mindist)
                       x_c_25 = 1000000;
                       y_c_25 = 1000000;
                       x_25_1 = x_centroid(5) - (maxaddedlength);
                       x_25_2 = x_centroid(5) + (maxaddedlength);
                       y_25_1 = y_centroid(5)-(maxaddedlength);
                       y_25_2 = y_centroid(5)+(maxaddedlength);
                   end  
                   if(yx_2 < minxy_ratio && d2_5 > mindist)
                       x_c_25 = 1000000;
                       y_c_25 = 1000000;
                       x_25_1 = x_centroid(5) - (maxaddedlength);
                       x_25_2 = x_centroid(5) + (maxaddedlength);
                       y_25_1 = y_centroid(5)-(maxaddedlength);
                       y_25_2 = y_centroid(5)+(maxaddedlength);
                   end
                   if(y_c_25 > y_centroid(5))
                       y_25_1 = y_centroid(5)-(maxaddedlength)
                       y_25_2 = y_c_25
                   else 
                       y_25_1 = y_c_25
                       y_25_2 = y_centroid(5)+(maxaddedlength)
                   end    
               else
                   S52 = 0;
                   x_c_25 = 1000000;
                   y_c_25 = 1000000;
                   x_25_1 = x_centroid(5) - (maxaddedlength);
                   x_25_2 = x_centroid(5) + (maxaddedlength);
                   y_25_1 = y_centroid(5)-(maxaddedlength);
                   y_25_2 = y_centroid(5)+(maxaddedlength);
              end
              
              if(d3_5<MinimumDistance);
                   S53 = 1;
                   % Calculate line equation for d_12 
                   m_35 = (y_centroid(5)-y_centroid(3))/(x_centroid(5)-x_centroid(3));
                   b_35 = y_centroid(3)-(m_35*x_centroid(3));
                   % 2) Calculate Coordinate of d_12/2
                   x_c_35 = x_centroid(3) + (x_centroid(5)-x_centroid(3))/2;
                   y_c_35 = m_35*x_c_35 + b_35
                   % Calculate max distance in x from sphere 2 to 1:
                   x_35_1 = x_c_35;
                   x_35_2 = x_centroid(5) - (maxaddedlength);
                   xy_3 = abs(x_centroid(3)-x_centroid(5))/abs(y_centroid(3)-y_centroid(5))
                   yx_3 = abs(y_centroid(3)-y_centroid(5))/abs(x_centroid(3)-x_centroid(5))
                   if(xy_3 < minxy_ratio && d3_5 > mindist)
                       x_c_35 = 1000000;
                       y_c_35 = 1000000;
                       x_35_1 = x_centroid(5) - (maxaddedlength);
                       x_35_2 = x_centroid(5) + (maxaddedlength);
                       y_35_1 = y_centroid(5)-(maxaddedlength);
                       y_35_2 = y_centroid(5)+(maxaddedlength);
                   end  
                   if(yx_3 < minxy_ratio && d3_5 > mindist)
                       x_c_35 = 1000000;
                       y_c_35 = 1000000;
                       x_35_1 = x_centroid(5) - (maxaddedlength);
                       x_35_2 = x_centroid(5) + (maxaddedlength);
                       y_35_1 = y_centroid(5)-(maxaddedlength);
                       y_35_2 = y_centroid(5)+(maxaddedlength);
                   end
                   if(y_c_35 > y_centroid(5))
                       y_35_1 = y_centroid(5)-(maxaddedlength)
                       y_35_2 = y_c_35
                   else 
                       y_35_1 = y_c_35
                       y_35_2 = y_centroid(5)+(maxaddedlength)
                   end    
               else
                   S53 = 0;
                   x_c_35 = 1000000;
                   y_c_35 = 1000000;
                   x_35_1 = x_centroid(5) - (maxaddedlength);
                   x_35_2 = x_centroid(5) + (maxaddedlength);
                   y_35_1 = y_centroid(5)-(maxaddedlength);
                   y_35_2 = y_centroid(5)+(maxaddedlength);
              end
               if(d4_5<MinimumDistance);
                   S54 = 1;
                   % Calculate line equation for d_12 
                   m_45 = (y_centroid(5)-y_centroid(4))/(x_centroid(5)-x_centroid(4));
                   b_45 = y_centroid(4)-(m_45*x_centroid(4));
                   % 2) Calculate Coordinate of d_12/2
                   x_c_45 = x_centroid(4) + (x_centroid(5)-x_centroid(4))/2;
                   y_c_45 = m_45*x_c_45 + b_45
                   % Calculate max distance in x from sphere 2 to 1:
                   x_45_1 = x_c_45;
                   x_45_2 = x_centroid(4) - (maxaddedlength);
                   xy_4 = abs(x_centroid(4)-x_centroid(5))/abs(y_centroid(4)-y_centroid(5))
                   yx_4 = abs(y_centroid(4)-y_centroid(5))/abs(x_centroid(4)-x_centroid(5))
                   if(xy_4 < minxy_ratio && d4_5 > mindist)
                       x_c_45 = 1000000;
                       y_c_45 = 1000000;
                       x_45_1 = x_centroid(5) - (maxaddedlength);
                       x_45_2 = x_centroid(5) + (maxaddedlength);
                       y_45_1 = y_centroid(5)-(maxaddedlength);
                       y_45_2 = y_centroid(5)+(maxaddedlength);
                   end  
                   if(yx_4 < minxy_ratio && d4_5 > mindist)
                       x_c_45 = 1000000;
                       y_c_45 = 1000000;
                       x_45_1 = x_centroid(5) - (maxaddedlength);
                       x_45_2 = x_centroid(5) + (maxaddedlength);
                       y_45_1 = y_centroid(5)-(maxaddedlength);
                       y_45_2 = y_centroid(5)+(maxaddedlength);
                   end
                   if(y_c_45 > y_centroid(5))
                       y_45_1 = y_centroid(5)-(maxaddedlength)
                       y_45_2 = y_c_45
                   else 
                       y_45_1 = y_c_45
                       y_45_2 = y_centroid(5)+(maxaddedlength)
                   end    
               else
                   S45 = 0;
                   x_c_45 = 1000000;
                   y_c_45 = 1000000;
                   x_45_1 = x_centroid(5) - (maxaddedlength);
                   x_45_2 = x_centroid(5) + (maxaddedlength);
                   y_45_1 = y_centroid(5)-(maxaddedlength);
                   y_45_2 = y_centroid(5)+(maxaddedlength);
               end
                              
               V_x9 = [x_c_15;x_c_25;x_c_35;x_c_45];
               min_x_9 = min(V_x9(1:4));
               if(min_x_9 ==1000000)
                   min_x_9 = x_centroid(5)-(maxaddedlength);
               end    
               min_x_10 = x_centroid(5) + (maxaddedlength);
               
               
                                             
               if(y_c_15 < 1000000 || y_c_25 < 1000000 || y_c_35 < 1000000 || y_c_45 < 1000000)
                   
                   if(y_c_15 - y_centroid(5)>0 && y_c_15 - y_centroid(5)<500000);
                       y_c_15_s = 1000000;
                   else
                       y_c_15_s = y_c_15; 
                   end 
                   if(y_c_25 - y_centroid(5)>0 && y_c_25 - y_centroid(5)<500000);
                       y_c_25_s = 1000000;
                   else
                       y_c_25_s = y_c_25;     
                   end
                   if(y_c_35 - y_centroid(5)>0 && y_c_35 - y_centroid(5)<500000);
                       y_c_35_s = 1000000;
                   else
                       y_c_35_s = y_c_35;     
                   end
                   if(y_c_45 - y_centroid(5)>0 && y_c_45 - y_centroid(5)<500000);
                       y_c_45_s = 1000000;
                   else
                       y_c_45_s = y_c_45;    
                   end
                   V_y9=[y_c_15_s;y_c_25_s;y_c_35_s;y_c_45_s];
                   min_y_9 = min(V_y9(1:4));
                   if(min_y_9 == 1000000)
                       min_y_9 = y_centroid(5)- (maxaddedlength);
                   end
                   
               else
                   min_y_9 = y_centroid(5)- (maxaddedlength);
               end
               
               if(y_c_15 < 1000000 || y_c_25 < 1000000 || y_c_35 < 1000000 || y_c_45 < 1000000)
                   if(y_c_15 - y_centroid(5)<0 && y_c_15 - y_centroid(5)<500000);
                       y_c_15_s = 1000000;
                   else
                       y_c_15_s = y_c_15;
                   end    
                   if(y_c_25 - y_centroid(5)<0 && y_c_25 - y_centroid(5)<500000);
                       y_c_25_s = 1000000;
                   else
                       y_c_25_s = y_c_25;
                   end
                   if(y_c_35 - y_centroid(5)<0 && y_c_35 - y_centroid(5)<500000);
                       y_c_35_s = 1000000;
                   else
                       y_c_35_s = y_c_35;
                   end
                   if(y_c_45 - y_centroid(5)<0 && y_c_45 - y_centroid(5)<500000);
                       y_c_45_s = 1000000;
                   else
                       y_c_45_s = y_c_45;
                   end
                   V_y10=[y_c_15_s;y_c_25_s;y_c_35_s;y_c_45_s];
                   min_y_10 = min(V_y10(1:4));
                   if(min_y_10 == 1000000)
                       min_y_10 = y_centroid(5)+ (maxaddedlength);
                   end    
                   
               else
                   min_y_10 = y_centroid(5)+ (maxaddedlength);
               end
                   
               if(min_x_9<1)
                   x_9 = 1
               else
                   x_9 = min_x_9;
               end
               
               if(min_x_10>10752)
                   x_10 = 10752
               else
                   x_10 = min_x_10;
               end
               
               if(min_y_9<1)
                   y_9 = 1
               else
                   y_9 = min_y_9;
               end
               
               if(min_y_10>13824)
                   y_10 = 13824
               else
                   y_10 = min_y_10;
               end
               
                       
               
               imagesphere5 = imgnucleus(y_9:y_10,x_9:x_10);
               [r5 c5] = size(imagesphere5);
               imagesphereresize5 = zeros(7168:7168);
               imagesphereresize5 = uint8(imagesphereresize5);
               imagesphereresize5(1:r5,1:c5)=imagesphere5;
               newFile5 = regexprep(allfiles(i).name,'NucleusBig',[wellind '05NucleusBig'],'ignorecase');        
               imwrite(imagesphereresize5,[foldername1 '/' newFile5]);
               clear imagesphereresize5;  
               clear imagesphere5;
               
               
               if(Neuron_Channel > 0)
                   % Same for neurite channel


                   imagesphere6 = imgneurite(y_1:y_2,x_1:x_2);
                   [r1 c1] = size(imagesphere6);
                   imagesphereresize6 = zeros(7168:7168);
                   imagesphereresize6 = uint8(imagesphereresize6);
                   imagesphereresize6(1:r1,1:c1)=imagesphere6;
                   newFile6 = regexprep(allfiles(i).name,'NucleusBig',[wellind '01NeuriteBig'],'ignorecase');        
                   imwrite(imagesphereresize6,[foldername1 '/' newFile6]);
                   clear imagesphereresize6;
                   clear imagesphere6;

                   imagesphere7 = imgneurite(y_3:y_4,x_3:x_4);
                   [r2 c2] = size(imagesphere7);
                   imagesphereresize7 = zeros(7168:7168);
                   imagesphereresize7 = uint8(imagesphereresize7);
                   imagesphereresize7(1:r2,1:c2)=imagesphere7;
                   newFile7 = regexprep(allfiles(i).name,'NucleusBig',[wellind '02NeuriteBig'],'ignorecase');        
                   imwrite(imagesphereresize7,[foldername1 '/' newFile7]);
                   clear imagesphereresize7;
                   clear imagesphere7;

                   imagesphere8 = imgneurite(y_5:y_6,x_5:x_6);
                   [r3 c3] = size(imagesphere8);
                   imagesphereresize8 = zeros(7168:7168);
                   imagesphereresize8 = uint8(imagesphereresize8);
                   imagesphereresize8(1:r3,1:c3)=imagesphere8;
                   newFile8 = regexprep(allfiles(i).name,'NucleusBig',[wellind '03NeuriteBig'],'ignorecase');        
                   imwrite(imagesphereresize8,[foldername1 '/' newFile8]);
                   clear imagesphereresize8;
                   clear imagesphere8;

                   imagesphere9 = imgneurite(y_7:y_8,x_7:x_8);
                   [r4 c4] = size(imagesphere9);
                   imagesphereresize9 = zeros(7168:7168);
                   imagesphereresize9 = uint8(imagesphereresize9);
                   imagesphereresize9(1:r4,1:c4)=imagesphere9;
                   newFile9 = regexprep(allfiles(i).name,'NucleusBig',[wellind '04NeuriteBig'],'ignorecase');        
                   imwrite(imagesphereresize9,[foldername1 '/' newFile9]);
                   clear imagesphereresize9; 
                   clear imagesphere9;

                   imagesphere10 = imgneurite(y_9:y_10,x_9:x_10);
                   [r5 c5] = size(imagesphere10);
                   imagesphereresize10 = zeros(7168:7168);
                   imagesphereresize10 = uint8(imagesphereresize10);
                   imagesphereresize10(1:r5,1:c5)=imagesphere10;
                   newFile5 = regexprep(allfiles(i).name,'NucleusBig',[wellind '05NeuriteBig'],'ignorecase');        
                   imwrite(imagesphereresize10,[foldername1 '/' newFile5]);
                   clear imagesphereresize10;  
                   clear imagesphere10;
               end
               
               if(Oligo_Channel > 0)
                   % Same for Oligos
                   imagesphere11 = imgoligo(y_1:y_2,x_1:x_2);
                   [r1 c1] = size(imagesphere11);
                   imagesphereresize11 = zeros(7168:7168);
                   imagesphereresize11 = uint8(imagesphereresize11);
                   imagesphereresize11(1:r1,1:c1)=imagesphere11;
                   newFile11 = regexprep(allfiles(i).name,'NucleusBig',[wellind '01OligoBig'],'ignorecase');        
                   imwrite(imagesphereresize11,[foldername1 '/' newFile11]);
                   clear imagesphereresize11;
                   clear imagesphere11;

                   imagesphere12 = imgoligo(y_3:y_4,x_3:x_4);
                   [r2 c2] = size(imagesphere12);
                   imagesphereresize12 = zeros(7168:7168);
                   imagesphereresize12 = uint8(imagesphereresize12);
                   imagesphereresize12(1:r2,1:c2)=imagesphere12;
                   newFile12 = regexprep(allfiles(i).name,'NucleusBig',[wellind '02OligoBig'],'ignorecase');        
                   imwrite(imagesphereresize12,[foldername1 '/' newFile12]);
                   clear imagesphereresize12;
                   clear imagesphere12;

                   imagesphere13 = imgoligo(y_5:y_6,x_5:x_6);
                   [r3 c3] = size(imagesphere13);
                   imagesphereresize13 = zeros(7168:7168);
                   imagesphereresize13 = uint8(imagesphereresize13);
                   imagesphereresize13(1:r3,1:c3)=imagesphere13;
                   newFile13 = regexprep(allfiles(i).name,'NucleusBig',[wellind '03OligoBig'],'ignorecase');        
                   imwrite(imagesphereresize13,[foldername1 '/' newFile13]);
                   clear imagesphereresize13;
                   clear imagesphere13;

                   imagesphere14 = imgoligo(y_7:y_8,x_7:x_8);
                   [r4 c4] = size(imagesphere14);
                   imagesphereresize14 = zeros(7168:7168);
                   imagesphereresize14 = uint8(imagesphereresize14);
                   imagesphereresize14(1:r4,1:c4)=imagesphere14;
                   newFile14 = regexprep(allfiles(i).name,'NucleusBig',[wellind '04OligoBig'],'ignorecase');        
                   imwrite(imagesphereresize14,[foldername1 '/' newFile14]);
                   clear imagesphereresize14; 
                   clear imagesphere14;

                   imagesphere15 = imgoligo(y_9:y_10,x_9:x_10);
                   [r5 c5] = size(imagesphere15);
                   imagesphereresize15 = zeros(7168:7168);
                   imagesphereresize15 = uint8(imagesphereresize15);
                   imagesphereresize15(1:r5,1:c5)=imagesphere15;
                   newFile15 = regexprep(allfiles(i).name,'NucleusBig',[wellind '05OligoBig'],'ignorecase');        
                   imwrite(imagesphereresize15,[foldername1 '/' newFile15]);
                   clear imagesphereresize15;  
                   clear imagesphere15;
               end
               
               if(Astro_Channel >0)
                   % Same for Astros
                   imagesphere16 = imgastro(y_1:y_2,x_1:x_2);
                   [r1 c1] = size(imagesphere16);
                   imagesphereresize16 = zeros(7168:7168);
                   imagesphereresize16 = uint8(imagesphereresize16);
                   imagesphereresize16(1:r1,1:c1)=imagesphere16;
                   newFile16 = regexprep(allfiles(i).name,'NucleusBig',[wellind '01AstroBig'],'ignorecase');        
                   imwrite(imagesphereresize16,[foldername1 '/' newFile16]);
                   clear imagesphereresize16;
                   clear imagesphere16;

                   imagesphere17 = imgastro(y_3:y_4,x_3:x_4);
                   [r2 c2] = size(imagesphere17);
                   imagesphereresize17 = zeros(7168:7168);
                   imagesphereresize17 = uint8(imagesphereresize17);
                   imagesphereresize17(1:r2,1:c2)=imagesphere17;
                   newFile17 = regexprep(allfiles(i).name,'NucleusBig',[wellind '02AstroBig'],'ignorecase');        
                   imwrite(imagesphereresize17,[foldername1 '/' newFile17]);
                   clear imagesphereresize17;
                   clear imagesphere17;

                   imagesphere18 = imgastro(y_5:y_6,x_5:x_6);
                   [r3 c3] = size(imagesphere18);
                   imagesphereresize18 = zeros(7168:7168);
                   imagesphereresize18 = uint8(imagesphereresize18);
                   imagesphereresize18(1:r3,1:c3)=imagesphere18;
                   newFile18 = regexprep(allfiles(i).name,'NucleusBig',[wellind '03AstroBig'],'ignorecase');        
                   imwrite(imagesphereresize18,[foldername1 '/' newFile18]);
                   clear imagesphereresize18;
                   clear imagesphere18;

                   imagesphere19 = imgastro(y_7:y_8,x_7:x_8);
                   [r4 c4] = size(imagesphere19);
                   imagesphereresize19 = zeros(7168:7168);
                   imagesphereresize19 = uint8(imagesphereresize19);
                   imagesphereresize19(1:r4,1:c4)=imagesphere19;
                   newFile19 = regexprep(allfiles(i).name,'NucleusBig',[wellind '04AstroBig'],'ignorecase');        
                   imwrite(imagesphereresize19,[foldername1 '/' newFile19]);
                   clear imagesphereresize19; 
                   clear imagesphere19;

                   imagesphere20 = imgastro(y_9:y_10,x_9:x_10);
                   [r5 c5] = size(imagesphere20);
                   imagesphereresize20 = zeros(7168:7168);
                   imagesphereresize20 = uint8(imagesphereresize20);
                   imagesphereresize20(1:r5,1:c5)=imagesphere20;
                   newFile20 = regexprep(allfiles(i).name,'NucleusBig',[wellind '05AstroBig'],'ignorecase');        
                   imwrite(imagesphereresize20,[foldername1 '/' newFile20]);
                   clear imagesphereresize20;  
                   clear imagesphere20;
               end
                
        
            else
                          
            end    
            
               
        
    
        
   csvHandler.CellPosMatrix(allfiles(i).name) = 0;     
end
        
        clear imgnucleus;
        clear imgneurite;
        clear imgoligo;
        clear imgastro;
     %Delete original Matrix
     
end

end


##### SOURCE END #####
--></body></html>